(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[3708],{37753:function(){},27973:function(_t,O,y){"use strict";y.d(O,{zj:function(){return qe},oI:function(){return Nr},ni:function(){return le},gg:function(){return wr}});var V=y(82195);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function b(Vt,se,_e,Le){function ot(Rt){return Rt instanceof _e?Rt:new _e(function(jt){jt(Rt)})}return new(_e||(_e=Promise))(function(Rt,jt){function w(Ae){try{ve(Le.next(Ae))}catch(Je){jt(Je)}}function N(Ae){try{ve(Le.throw(Ae))}catch(Je){jt(Je)}}function ve(Ae){Ae.done?Rt(Ae.value):ot(Ae.value).then(w,N)}ve((Le=Le.apply(Vt,se||[])).next())})}function p(Vt,se){var _e={label:0,sent:function(){if(Rt[0]&1)throw Rt[1];return Rt[1]},trys:[],ops:[]},Le,ot,Rt,jt;return jt={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(jt[Symbol.iterator]=function(){return this}),jt;function w(ve){return function(Ae){return N([ve,Ae])}}function N(ve){if(Le)throw new TypeError("Generator is already executing.");for(;_e;)try{if(Le=1,ot&&(Rt=ve[0]&2?ot.return:ve[0]?ot.throw||((Rt=ot.return)&&Rt.call(ot),0):ot.next)&&!(Rt=Rt.call(ot,ve[1])).done)return Rt;switch(ot=0,Rt&&(ve=[ve[0]&2,Rt.value]),ve[0]){case 0:case 1:Rt=ve;break;case 4:return _e.label++,{value:ve[1],done:!1};case 5:_e.label++,ot=ve[1],ve=[0];continue;case 7:ve=_e.ops.pop(),_e.trys.pop();continue;default:if(Rt=_e.trys,!(Rt=Rt.length>0&&Rt[Rt.length-1])&&(ve[0]===6||ve[0]===2)){_e=0;continue}if(ve[0]===3&&(!Rt||ve[1]>Rt[0]&&ve[1]<Rt[3])){_e.label=ve[1];break}if(ve[0]===6&&_e.label<Rt[1]){_e.label=Rt[1],Rt=ve;break}if(Rt&&_e.label<Rt[2]){_e.label=Rt[2],_e.ops.push(ve);break}Rt[2]&&_e.ops.pop(),_e.trys.pop();continue}ve=se.call(Vt,_e)}catch(Ae){ve=[6,Ae],ot=0}finally{Le=Rt=0}if(ve[0]&5)throw ve[1];return{value:ve[0]?ve[1]:void 0,done:!0}}}function G(Vt,se){var _e=typeof Symbol=="function"&&Vt[Symbol.iterator];if(!_e)return Vt;var Le=_e.call(Vt),ot,Rt=[],jt;try{for(;(se===void 0||se-- >0)&&!(ot=Le.next()).done;)Rt.push(ot.value)}catch(w){jt={error:w}}finally{try{ot&&!ot.done&&(_e=Le.return)&&_e.call(Le)}finally{if(jt)throw jt.error}}return Rt}function S(){for(var Vt=[],se=0;se<arguments.length;se++)Vt=Vt.concat(G(arguments[se]));return Vt}function F(Vt){return Vt&&Vt.__esModule&&Object.prototype.hasOwnProperty.call(Vt,"default")?Vt.default:Vt}function te(Vt,se){return se={exports:{}},Vt(se,se.exports),se.exports}var ce=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=_e;function _e(Le){return Le&&typeof Le.length=="number"&&Le.length>=0&&Le.length%1==0}Vt.exports=se.default});F(ce);var q=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=function(_e){return function(){for(var Le=[],ot=arguments.length;ot--;)Le[ot]=arguments[ot];var Rt=Le.pop();return _e.call(this,Le,Rt)}},Vt.exports=se.default});F(q);var we=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.fallback=ot,se.wrap=Rt;var _e=se.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Le=se.hasNextTick=typeof V=="object"&&typeof V.nextTick=="function";function ot(w){setTimeout(w,0)}function Rt(w){return function(N){for(var ve=[],Ae=arguments.length-1;Ae-- >0;)ve[Ae]=arguments[Ae+1];return w(function(){return N.apply(void 0,ve)})}}var jt;_e?jt=setImmediate:Le?jt=V.nextTick:jt=ot,se.default=Rt(jt)});F(we);var Pe=we.fallback,Be=we.wrap,Oe=we.hasSetImmediate,Nt=we.hasNextTick,Xt=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Rt;var _e=ot(q),Le=ot(we);function ot(N){return N&&N.__esModule?N:{default:N}}function Rt(N){return(0,Bt.isAsync)(N)?function(){for(var ve=[],Ae=arguments.length;Ae--;)ve[Ae]=arguments[Ae];var Je=ve.pop(),st=N.apply(this,ve);return jt(st,Je)}:(0,_e.default)(function(ve,Ae){var Je;try{Je=N.apply(this,ve)}catch(st){return Ae(st)}if(Je&&typeof Je.then=="function")return jt(Je,Ae);Ae(null,Je)})}function jt(N,ve){return N.then(function(Ae){w(ve,null,Ae)},function(Ae){w(ve,Ae&&Ae.message?Ae:new Error(Ae))})}function w(N,ve,Ae){try{N(ve,Ae)}catch(Je){(0,Le.default)(function(st){throw st},Je)}}Vt.exports=se.default});F(Xt);var Bt=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.isAsyncIterable=se.isAsyncGenerator=se.isAsync=void 0;var _e=Le(Xt);function Le(N){return N&&N.__esModule?N:{default:N}}function ot(N){return N[Symbol.toStringTag]==="AsyncFunction"}function Rt(N){return N[Symbol.toStringTag]==="AsyncGenerator"}function jt(N){return typeof N[Symbol.asyncIterator]=="function"}function w(N){if(typeof N!="function")throw new Error("expected a function");return ot(N)?(0,_e.default)(N):N}se.default=w,se.isAsync=ot,se.isAsyncGenerator=Rt,se.isAsyncIterable=jt});F(Bt);var Qe=Bt.isAsyncIterable,xt=Bt.isAsyncGenerator,nt=Bt.isAsync,cr=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=_e;function _e(Le,ot){if(ot===void 0&&(ot=Le.length),!ot)throw new Error("arity is undefined");function Rt(){for(var jt=this,w=[],N=arguments.length;N--;)w[N]=arguments[N];return typeof w[ot-1]=="function"?Le.apply(this,w):new Promise(function(ve,Ae){w[ot-1]=function(Je){for(var st=[],Lt=arguments.length-1;Lt-- >0;)st[Lt]=arguments[Lt+1];if(Je)return Ae(Je);ve(st.length>1?st:st[0])},Le.apply(jt,w)})}return Object.defineProperty(Rt,"name",{configurable:!0,value:"awaitable("+Le.name+")"}),Rt}Vt.exports=se.default});F(cr);var At=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0});var _e=Rt(ce),Le=Rt(Bt),ot=Rt(cr);function Rt(jt){return jt&&jt.__esModule?jt:{default:jt}}se.default=(0,ot.default)(function(jt,w,N){var ve=(0,_e.default)(w)?[]:{};jt(w,function(Ae,Je,st){(0,Le.default)(Ae)(function(Lt){for(var X,Tt=[],Kt=arguments.length-1;Kt-- >0;)Tt[Kt]=arguments[Kt+1];Tt.length<2&&(X=Tt,Tt=X[0]),ve[Je]=Tt,st(Lt)})},function(Ae){return N(Ae,ve)})},3),Vt.exports=se.default});F(At);var Gt=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=_e;function _e(Le){function ot(){for(var Rt=[],jt=arguments.length;jt--;)Rt[jt]=arguments[jt];if(Le!==null){var w=Le;Le=null,w.apply(this,Rt)}}return Object.assign(ot,Le),ot}Vt.exports=se.default});F(Gt);var St=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=function(_e){return _e[Symbol.iterator]&&_e[Symbol.iterator]()},Vt.exports=se.default});F(St);var Ze=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=N;var _e=ot(ce),Le=ot(St);function ot(ve){return ve&&ve.__esModule?ve:{default:ve}}function Rt(ve){var Ae=-1,Je=ve.length;return function(){return++Ae<Je?{value:ve[Ae],key:Ae}:null}}function jt(ve){var Ae=-1;return function(){var st=ve.next();return st.done?null:(Ae++,{value:st.value,key:Ae})}}function w(ve){var Ae=ve?Object.keys(ve):[],Je=-1,st=Ae.length;return function(){var X=Ae[++Je];return Je<st?{value:ve[X],key:X}:null}}function N(ve){if((0,_e.default)(ve))return Rt(ve);var Ae=(0,Le.default)(ve);return Ae?jt(Ae):w(ve)}Vt.exports=se.default});F(Ze);var yt=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=_e;function _e(Le){return function(){for(var ot=[],Rt=arguments.length;Rt--;)ot[Rt]=arguments[Rt];if(Le===null)throw new Error("Callback was already called.");var jt=Le;Le=null,jt.apply(this,ot)}}Vt.exports=se.default});F(yt);var Me=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0});var _e={};se.default=_e,Vt.exports=se.default});F(Me);var Te=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=ot;var _e=Le(Me);function Le(Rt){return Rt&&Rt.__esModule?Rt:{default:Rt}}function ot(Rt,jt,w,N){var ve=!1,Ae=!1,Je=!1,st=0,Lt=0;function X(){st>=jt||Je||ve||(Je=!0,Rt.next().then(function(hr){var _r=hr.value,Ar=hr.done;if(!(Ae||ve)){if(Je=!1,Ar){ve=!0,st<=0&&N(null);return}st++,w(_r,Lt,Tt),Lt++,X()}}).catch(Kt))}function Tt(hr,_r){if(st-=1,!Ae){if(hr)return Kt(hr);if(hr===!1){ve=!0,Ae=!0;return}if(_r===_e.default||ve&&st<=0)return ve=!0,N(null);X()}}function Kt(hr){Ae||(Je=!1,ve=!0,N(hr))}X()}Vt.exports=se.default});F(Te);var Ie=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0});var _e=w(Gt),Le=w(Ze),ot=w(yt),Rt=w(Te),jt=w(Me);function w(N){return N&&N.__esModule?N:{default:N}}se.default=function(N){return function(ve,Ae,Je){if(Je=(0,_e.default)(Je),N<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!ve)return Je(null);if((0,Bt.isAsyncGenerator)(ve))return(0,Rt.default)(ve,N,Ae,Je);if((0,Bt.isAsyncIterable)(ve))return(0,Rt.default)(ve[Symbol.asyncIterator](),N,Ae,Je);var st=(0,Le.default)(ve),Lt=!1,X=!1,Tt=0,Kt=!1;function hr(Ar,Rr){if(!X)if(Tt-=1,Ar)Lt=!0,Je(Ar);else if(Ar===!1)Lt=!0,X=!0;else{if(Rr===jt.default||Lt&&Tt<=0)return Lt=!0,Je(null);Kt||_r()}}function _r(){for(Kt=!0;Tt<N&&!Lt;){var Ar=st();if(Ar===null){Lt=!0,Tt<=0&&Je(null);return}Tt+=1,Ae(Ar.value,Ar.key,(0,ot.default)(hr))}Kt=!1}_r()}},Vt.exports=se.default});F(Ie);var bt=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0});var _e=Rt(Ie),Le=Rt(Bt),ot=Rt(cr);function Rt(w){return w&&w.__esModule?w:{default:w}}function jt(w,N,ve,Ae){return(0,_e.default)(N)(w,(0,Le.default)(ve),Ae)}se.default=(0,ot.default)(jt,4),Vt.exports=se.default});F(bt);var tr=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0});var _e=ot(bt),Le=ot(cr);function ot(jt){return jt&&jt.__esModule?jt:{default:jt}}function Rt(jt,w,N){return(0,_e.default)(jt,1,w,N)}se.default=(0,Le.default)(Rt,3),Vt.exports=se.default});F(tr);var ae=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Rt;var _e=ot(At),Le=ot(tr);function ot(jt){return jt&&jt.__esModule?jt:{default:jt}}function Rt(jt,w){return(0,_e.default)(Le.default,jt,w)}Vt.exports=se.default}),Ee=F(ae),le=function(){function Vt(){for(var se=arguments,_e=[],Le=0;Le<arguments.length;Le++)_e[Le]=se[Le];this.args=[],this.tasks=[]}return Vt.prototype.call=function(){for(var se=arguments,_e=[],Le=0;Le<arguments.length;Le++)_e[Le]=se[Le];return this.args=_e,Ee(this.tasks)},Vt.prototype.tap=function(se,_e){var Le=this;this.tasks.push(function(ot){_e.apply(void 0,S(Le.args)),ot(null,se)})},Vt}(),Q=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0});var _e=ve(ce),Le=ve(Me),ot=ve(bt),Rt=ve(Gt),jt=ve(yt),w=ve(Bt),N=ve(cr);function ve(Lt){return Lt&&Lt.__esModule?Lt:{default:Lt}}function Ae(Lt,X,Tt){Tt=(0,Rt.default)(Tt);var Kt=0,hr=0,_r=Lt.length,Ar=!1;_r===0&&Tt(null);function Rr(et,gt){et===!1&&(Ar=!0),Ar!==!0&&(et?Tt(et):(++hr===_r||gt===Le.default)&&Tt(null))}for(;Kt<_r;Kt++)X(Lt[Kt],Kt,(0,jt.default)(Rr))}function Je(Lt,X,Tt){return(0,ot.default)(Lt,Infinity,X,Tt)}function st(Lt,X,Tt){var Kt=(0,_e.default)(Lt)?Ae:Je;return Kt(Lt,(0,w.default)(X),Tt)}se.default=(0,N.default)(st,3),Vt.exports=se.default});F(Q);var re=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Rt;var _e=ot(Q),Le=ot(At);function ot(jt){return jt&&jt.__esModule?jt:{default:jt}}function Rt(jt,w){return(0,Le.default)(_e.default,jt,w)}Vt.exports=se.default}),ke=F(re),qe=function(){function Vt(){for(var se=arguments,_e=[],Le=0;Le<arguments.length;Le++)_e[Le]=se[Le];this.tasks=[]}return Vt.prototype.promise=function(){for(var se=arguments,_e=[],Le=0;Le<arguments.length;Le++)_e[Le]=se[Le];return ke(this.tasks)},Vt.prototype.tapPromise=function(se,_e){var Le=this;this.tasks.push(function(ot){return b(Le,void 0,void 0,function(){return p(this,function(Rt){switch(Rt.label){case 0:return[4,_e()];case 1:return Rt.sent(),ot(null,se),[2]}})})})},Vt}(),Wt=te(function(Vt,se){Object.defineProperty(se,"__esModule",{value:!0});var _e=jt(Gt),Le=jt(yt),ot=jt(Bt),Rt=jt(cr);function jt(N){return N&&N.__esModule?N:{default:N}}function w(N,ve){if(ve=(0,_e.default)(ve),!Array.isArray(N))return ve(new Error("First argument to waterfall must be an array of functions"));if(!N.length)return ve();var Ae=0;function Je(Lt){var X=(0,ot.default)(N[Ae++]);X.apply(void 0,Lt.concat([(0,Le.default)(st)]))}function st(Lt){for(var X=[],Tt=arguments.length-1;Tt-- >0;)X[Tt]=arguments[Tt+1];if(Lt!==!1){if(Lt||Ae===N.length)return ve.apply(void 0,[Lt].concat(X));Je(X)}}Je([])}se.default=(0,Rt.default)(w),Vt.exports=se.default}),Or=F(Wt),wr=function(){function Vt(){for(var se=arguments,_e=[],Le=0;Le<arguments.length;Le++)_e[Le]=se[Le];this.tasks=[]}return Vt.prototype.call=function(){for(var se=arguments,_e=[],Le=0;Le<arguments.length;Le++)_e[Le]=se[Le];return Or(this.tasks)},Vt.prototype.tap=function(se,_e){this.tasks.length===0?this.tasks.push(function(Le){var ot=_e();Le(ot?null:!1,ot)}):this.tasks.push(function(Le,ot){var Rt=_e();ot(Rt?null:!1,se)})},Vt}(),Nr=function(){function Vt(){for(var se=arguments,_e=[],Le=0;Le<arguments.length;Le++)_e[Le]=se[Le];this.tasks=[]}return Vt.prototype.call=function(){for(var se=arguments,_e=[],Le=0;Le<arguments.length;Le++)_e[Le]=se[Le];return Ee(this.tasks)},Vt.prototype.tap=function(se,_e){this.tasks.push(function(Le){var ot=_e();Le(ot,se)})},Vt}()},13252:function(_t,O,y){"use strict";y.d(O,{nC:function(){return V.ZP},Hp:function(){return V.Hp},e7:function(){return V.e7},yT:function(){return V.yT},vK:function(){return p.v},BlendType:function(){return S.h},AttributeType:function(){return F.GC},ScaleTypes:function(){return F.vY},StyleScaleType:function(){return F.ee},MapServiceEvent:function(){return q.I},CoordinateSystem:function(){return we.l},CoordinateUniform:function(){return we.k},CameraUniform:function(){return Oe.l},SceneEventList:function(){return Bt.P},PositionType:function(){return St.d},gl:function(){return N.gl}});var V=y(74453),b=y(19525),p=y(90200),G=y(98886),S=y(28095),F=y(98842),te=y(47926),ce=y.n(te);y.o(te,"CameraUniform")&&y.d(O,{CameraUniform:function(){return te.CameraUniform}}),y.o(te,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return te.CityBuildingLayer}}),y.o(te,"CoordinateSystem")&&y.d(O,{CoordinateSystem:function(){return te.CoordinateSystem}}),y.o(te,"CoordinateUniform")&&y.d(O,{CoordinateUniform:function(){return te.CoordinateUniform}}),y.o(te,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return te.HeatmapLayer}}),y.o(te,"ImageLayer")&&y.d(O,{ImageLayer:function(){return te.ImageLayer}}),y.o(te,"LineLayer")&&y.d(O,{LineLayer:function(){return te.LineLayer}}),y.o(te,"MapServiceEvent")&&y.d(O,{MapServiceEvent:function(){return te.MapServiceEvent}}),y.o(te,"Marker")&&y.d(O,{Marker:function(){return te.Marker}}),y.o(te,"PointLayer")&&y.d(O,{PointLayer:function(){return te.PointLayer}}),y.o(te,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return te.PolygonLayer}}),y.o(te,"Popup")&&y.d(O,{Popup:function(){return te.Popup}}),y.o(te,"PositionType")&&y.d(O,{PositionType:function(){return te.PositionType}}),y.o(te,"RasterLayer")&&y.d(O,{RasterLayer:function(){return te.RasterLayer}}),y.o(te,"Scene")&&y.d(O,{Scene:function(){return te.Scene}}),y.o(te,"SceneEventList")&&y.d(O,{SceneEventList:function(){return te.SceneEventList}}),y.o(te,"gl")&&y.d(O,{gl:function(){return te.gl}});var q=y(53848),we=y(45953),Pe=y(66388),Be=y.n(Pe);y.o(Pe,"CameraUniform")&&y.d(O,{CameraUniform:function(){return Pe.CameraUniform}}),y.o(Pe,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Pe.CityBuildingLayer}}),y.o(Pe,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Pe.HeatmapLayer}}),y.o(Pe,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Pe.ImageLayer}}),y.o(Pe,"LineLayer")&&y.d(O,{LineLayer:function(){return Pe.LineLayer}}),y.o(Pe,"Marker")&&y.d(O,{Marker:function(){return Pe.Marker}}),y.o(Pe,"PointLayer")&&y.d(O,{PointLayer:function(){return Pe.PointLayer}}),y.o(Pe,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Pe.PolygonLayer}}),y.o(Pe,"Popup")&&y.d(O,{Popup:function(){return Pe.Popup}}),y.o(Pe,"PositionType")&&y.d(O,{PositionType:function(){return Pe.PositionType}}),y.o(Pe,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Pe.RasterLayer}}),y.o(Pe,"Scene")&&y.d(O,{Scene:function(){return Pe.Scene}}),y.o(Pe,"SceneEventList")&&y.d(O,{SceneEventList:function(){return Pe.SceneEventList}}),y.o(Pe,"gl")&&y.d(O,{gl:function(){return Pe.gl}});var Oe=y(3244),Nt=y(64906),Xt=y.n(Nt);y.o(Nt,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Nt.CityBuildingLayer}}),y.o(Nt,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Nt.HeatmapLayer}}),y.o(Nt,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Nt.ImageLayer}}),y.o(Nt,"LineLayer")&&y.d(O,{LineLayer:function(){return Nt.LineLayer}}),y.o(Nt,"Marker")&&y.d(O,{Marker:function(){return Nt.Marker}}),y.o(Nt,"PointLayer")&&y.d(O,{PointLayer:function(){return Nt.PointLayer}}),y.o(Nt,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Nt.PolygonLayer}}),y.o(Nt,"Popup")&&y.d(O,{Popup:function(){return Nt.Popup}}),y.o(Nt,"PositionType")&&y.d(O,{PositionType:function(){return Nt.PositionType}}),y.o(Nt,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Nt.RasterLayer}}),y.o(Nt,"Scene")&&y.d(O,{Scene:function(){return Nt.Scene}}),y.o(Nt,"SceneEventList")&&y.d(O,{SceneEventList:function(){return Nt.SceneEventList}}),y.o(Nt,"gl")&&y.d(O,{gl:function(){return Nt.gl}});var Bt=y(13199),Qe=y(26494),xt=y.n(Qe);y.o(Qe,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Qe.CityBuildingLayer}}),y.o(Qe,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Qe.HeatmapLayer}}),y.o(Qe,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Qe.ImageLayer}}),y.o(Qe,"LineLayer")&&y.d(O,{LineLayer:function(){return Qe.LineLayer}}),y.o(Qe,"Marker")&&y.d(O,{Marker:function(){return Qe.Marker}}),y.o(Qe,"PointLayer")&&y.d(O,{PointLayer:function(){return Qe.PointLayer}}),y.o(Qe,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Qe.PolygonLayer}}),y.o(Qe,"Popup")&&y.d(O,{Popup:function(){return Qe.Popup}}),y.o(Qe,"PositionType")&&y.d(O,{PositionType:function(){return Qe.PositionType}}),y.o(Qe,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Qe.RasterLayer}}),y.o(Qe,"Scene")&&y.d(O,{Scene:function(){return Qe.Scene}}),y.o(Qe,"gl")&&y.d(O,{gl:function(){return Qe.gl}});var nt=y(16488),cr=y.n(nt);y.o(nt,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return nt.CityBuildingLayer}}),y.o(nt,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return nt.HeatmapLayer}}),y.o(nt,"ImageLayer")&&y.d(O,{ImageLayer:function(){return nt.ImageLayer}}),y.o(nt,"LineLayer")&&y.d(O,{LineLayer:function(){return nt.LineLayer}}),y.o(nt,"Marker")&&y.d(O,{Marker:function(){return nt.Marker}}),y.o(nt,"PointLayer")&&y.d(O,{PointLayer:function(){return nt.PointLayer}}),y.o(nt,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return nt.PolygonLayer}}),y.o(nt,"Popup")&&y.d(O,{Popup:function(){return nt.Popup}}),y.o(nt,"PositionType")&&y.d(O,{PositionType:function(){return nt.PositionType}}),y.o(nt,"RasterLayer")&&y.d(O,{RasterLayer:function(){return nt.RasterLayer}}),y.o(nt,"Scene")&&y.d(O,{Scene:function(){return nt.Scene}}),y.o(nt,"gl")&&y.d(O,{gl:function(){return nt.gl}});var At=y(48700),Gt=y.n(At);y.o(At,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return At.CityBuildingLayer}}),y.o(At,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return At.HeatmapLayer}}),y.o(At,"ImageLayer")&&y.d(O,{ImageLayer:function(){return At.ImageLayer}}),y.o(At,"LineLayer")&&y.d(O,{LineLayer:function(){return At.LineLayer}}),y.o(At,"Marker")&&y.d(O,{Marker:function(){return At.Marker}}),y.o(At,"PointLayer")&&y.d(O,{PointLayer:function(){return At.PointLayer}}),y.o(At,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return At.PolygonLayer}}),y.o(At,"Popup")&&y.d(O,{Popup:function(){return At.Popup}}),y.o(At,"PositionType")&&y.d(O,{PositionType:function(){return At.PositionType}}),y.o(At,"RasterLayer")&&y.d(O,{RasterLayer:function(){return At.RasterLayer}}),y.o(At,"Scene")&&y.d(O,{Scene:function(){return At.Scene}}),y.o(At,"gl")&&y.d(O,{gl:function(){return At.gl}});var St=y(10273),Ze=y(98810),yt=y.n(Ze);y.o(Ze,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Ze.CityBuildingLayer}}),y.o(Ze,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Ze.HeatmapLayer}}),y.o(Ze,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Ze.ImageLayer}}),y.o(Ze,"LineLayer")&&y.d(O,{LineLayer:function(){return Ze.LineLayer}}),y.o(Ze,"Marker")&&y.d(O,{Marker:function(){return Ze.Marker}}),y.o(Ze,"PointLayer")&&y.d(O,{PointLayer:function(){return Ze.PointLayer}}),y.o(Ze,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Ze.PolygonLayer}}),y.o(Ze,"Popup")&&y.d(O,{Popup:function(){return Ze.Popup}}),y.o(Ze,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Ze.RasterLayer}}),y.o(Ze,"Scene")&&y.d(O,{Scene:function(){return Ze.Scene}}),y.o(Ze,"gl")&&y.d(O,{gl:function(){return Ze.gl}});var Me=y(23990),Te=y.n(Me);y.o(Me,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Me.CityBuildingLayer}}),y.o(Me,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Me.HeatmapLayer}}),y.o(Me,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Me.ImageLayer}}),y.o(Me,"LineLayer")&&y.d(O,{LineLayer:function(){return Me.LineLayer}}),y.o(Me,"Marker")&&y.d(O,{Marker:function(){return Me.Marker}}),y.o(Me,"PointLayer")&&y.d(O,{PointLayer:function(){return Me.PointLayer}}),y.o(Me,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Me.PolygonLayer}}),y.o(Me,"Popup")&&y.d(O,{Popup:function(){return Me.Popup}}),y.o(Me,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Me.RasterLayer}}),y.o(Me,"Scene")&&y.d(O,{Scene:function(){return Me.Scene}}),y.o(Me,"gl")&&y.d(O,{gl:function(){return Me.gl}});var Ie=y(47822),bt=y.n(Ie);y.o(Ie,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Ie.CityBuildingLayer}}),y.o(Ie,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Ie.HeatmapLayer}}),y.o(Ie,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Ie.ImageLayer}}),y.o(Ie,"LineLayer")&&y.d(O,{LineLayer:function(){return Ie.LineLayer}}),y.o(Ie,"Marker")&&y.d(O,{Marker:function(){return Ie.Marker}}),y.o(Ie,"PointLayer")&&y.d(O,{PointLayer:function(){return Ie.PointLayer}}),y.o(Ie,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Ie.PolygonLayer}}),y.o(Ie,"Popup")&&y.d(O,{Popup:function(){return Ie.Popup}}),y.o(Ie,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Ie.RasterLayer}}),y.o(Ie,"Scene")&&y.d(O,{Scene:function(){return Ie.Scene}}),y.o(Ie,"gl")&&y.d(O,{gl:function(){return Ie.gl}});var tr=y(15211),ae=y(90671),Ee=y.n(ae);y.o(ae,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return ae.CityBuildingLayer}}),y.o(ae,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return ae.HeatmapLayer}}),y.o(ae,"ImageLayer")&&y.d(O,{ImageLayer:function(){return ae.ImageLayer}}),y.o(ae,"LineLayer")&&y.d(O,{LineLayer:function(){return ae.LineLayer}}),y.o(ae,"Marker")&&y.d(O,{Marker:function(){return ae.Marker}}),y.o(ae,"PointLayer")&&y.d(O,{PointLayer:function(){return ae.PointLayer}}),y.o(ae,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return ae.PolygonLayer}}),y.o(ae,"Popup")&&y.d(O,{Popup:function(){return ae.Popup}}),y.o(ae,"RasterLayer")&&y.d(O,{RasterLayer:function(){return ae.RasterLayer}}),y.o(ae,"Scene")&&y.d(O,{Scene:function(){return ae.Scene}}),y.o(ae,"gl")&&y.d(O,{gl:function(){return ae.gl}});var le=y(77869),Q=y.n(le);y.o(le,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return le.CityBuildingLayer}}),y.o(le,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return le.HeatmapLayer}}),y.o(le,"ImageLayer")&&y.d(O,{ImageLayer:function(){return le.ImageLayer}}),y.o(le,"LineLayer")&&y.d(O,{LineLayer:function(){return le.LineLayer}}),y.o(le,"Marker")&&y.d(O,{Marker:function(){return le.Marker}}),y.o(le,"PointLayer")&&y.d(O,{PointLayer:function(){return le.PointLayer}}),y.o(le,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return le.PolygonLayer}}),y.o(le,"Popup")&&y.d(O,{Popup:function(){return le.Popup}}),y.o(le,"RasterLayer")&&y.d(O,{RasterLayer:function(){return le.RasterLayer}}),y.o(le,"Scene")&&y.d(O,{Scene:function(){return le.Scene}}),y.o(le,"gl")&&y.d(O,{gl:function(){return le.gl}});var re=y(17239),ke=y.n(re);y.o(re,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return re.CityBuildingLayer}}),y.o(re,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return re.HeatmapLayer}}),y.o(re,"ImageLayer")&&y.d(O,{ImageLayer:function(){return re.ImageLayer}}),y.o(re,"LineLayer")&&y.d(O,{LineLayer:function(){return re.LineLayer}}),y.o(re,"Marker")&&y.d(O,{Marker:function(){return re.Marker}}),y.o(re,"PointLayer")&&y.d(O,{PointLayer:function(){return re.PointLayer}}),y.o(re,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return re.PolygonLayer}}),y.o(re,"Popup")&&y.d(O,{Popup:function(){return re.Popup}}),y.o(re,"RasterLayer")&&y.d(O,{RasterLayer:function(){return re.RasterLayer}}),y.o(re,"Scene")&&y.d(O,{Scene:function(){return re.Scene}}),y.o(re,"gl")&&y.d(O,{gl:function(){return re.gl}});var qe=y(79357),Wt=y.n(qe);y.o(qe,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return qe.CityBuildingLayer}}),y.o(qe,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return qe.HeatmapLayer}}),y.o(qe,"ImageLayer")&&y.d(O,{ImageLayer:function(){return qe.ImageLayer}}),y.o(qe,"LineLayer")&&y.d(O,{LineLayer:function(){return qe.LineLayer}}),y.o(qe,"Marker")&&y.d(O,{Marker:function(){return qe.Marker}}),y.o(qe,"PointLayer")&&y.d(O,{PointLayer:function(){return qe.PointLayer}}),y.o(qe,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return qe.PolygonLayer}}),y.o(qe,"Popup")&&y.d(O,{Popup:function(){return qe.Popup}}),y.o(qe,"RasterLayer")&&y.d(O,{RasterLayer:function(){return qe.RasterLayer}}),y.o(qe,"Scene")&&y.d(O,{Scene:function(){return qe.Scene}}),y.o(qe,"gl")&&y.d(O,{gl:function(){return qe.gl}});var Or=y(24054),wr=y.n(Or);y.o(Or,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Or.CityBuildingLayer}}),y.o(Or,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Or.HeatmapLayer}}),y.o(Or,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Or.ImageLayer}}),y.o(Or,"LineLayer")&&y.d(O,{LineLayer:function(){return Or.LineLayer}}),y.o(Or,"Marker")&&y.d(O,{Marker:function(){return Or.Marker}}),y.o(Or,"PointLayer")&&y.d(O,{PointLayer:function(){return Or.PointLayer}}),y.o(Or,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Or.PolygonLayer}}),y.o(Or,"Popup")&&y.d(O,{Popup:function(){return Or.Popup}}),y.o(Or,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Or.RasterLayer}}),y.o(Or,"Scene")&&y.d(O,{Scene:function(){return Or.Scene}}),y.o(Or,"gl")&&y.d(O,{gl:function(){return Or.gl}});var Nr=y(41139),Vt=y.n(Nr);y.o(Nr,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return Nr.CityBuildingLayer}}),y.o(Nr,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return Nr.HeatmapLayer}}),y.o(Nr,"ImageLayer")&&y.d(O,{ImageLayer:function(){return Nr.ImageLayer}}),y.o(Nr,"LineLayer")&&y.d(O,{LineLayer:function(){return Nr.LineLayer}}),y.o(Nr,"Marker")&&y.d(O,{Marker:function(){return Nr.Marker}}),y.o(Nr,"PointLayer")&&y.d(O,{PointLayer:function(){return Nr.PointLayer}}),y.o(Nr,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return Nr.PolygonLayer}}),y.o(Nr,"Popup")&&y.d(O,{Popup:function(){return Nr.Popup}}),y.o(Nr,"RasterLayer")&&y.d(O,{RasterLayer:function(){return Nr.RasterLayer}}),y.o(Nr,"Scene")&&y.d(O,{Scene:function(){return Nr.Scene}}),y.o(Nr,"gl")&&y.d(O,{gl:function(){return Nr.gl}});var se=y(4951),_e=y(74173),Le=y.n(_e);y.o(_e,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return _e.CityBuildingLayer}}),y.o(_e,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return _e.HeatmapLayer}}),y.o(_e,"ImageLayer")&&y.d(O,{ImageLayer:function(){return _e.ImageLayer}}),y.o(_e,"LineLayer")&&y.d(O,{LineLayer:function(){return _e.LineLayer}}),y.o(_e,"Marker")&&y.d(O,{Marker:function(){return _e.Marker}}),y.o(_e,"PointLayer")&&y.d(O,{PointLayer:function(){return _e.PointLayer}}),y.o(_e,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return _e.PolygonLayer}}),y.o(_e,"Popup")&&y.d(O,{Popup:function(){return _e.Popup}}),y.o(_e,"RasterLayer")&&y.d(O,{RasterLayer:function(){return _e.RasterLayer}}),y.o(_e,"Scene")&&y.d(O,{Scene:function(){return _e.Scene}}),y.o(_e,"gl")&&y.d(O,{gl:function(){return _e.gl}});var ot=y(62188),Rt=y.n(ot);y.o(ot,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return ot.CityBuildingLayer}}),y.o(ot,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return ot.HeatmapLayer}}),y.o(ot,"ImageLayer")&&y.d(O,{ImageLayer:function(){return ot.ImageLayer}}),y.o(ot,"LineLayer")&&y.d(O,{LineLayer:function(){return ot.LineLayer}}),y.o(ot,"Marker")&&y.d(O,{Marker:function(){return ot.Marker}}),y.o(ot,"PointLayer")&&y.d(O,{PointLayer:function(){return ot.PointLayer}}),y.o(ot,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return ot.PolygonLayer}}),y.o(ot,"Popup")&&y.d(O,{Popup:function(){return ot.Popup}}),y.o(ot,"RasterLayer")&&y.d(O,{RasterLayer:function(){return ot.RasterLayer}}),y.o(ot,"Scene")&&y.d(O,{Scene:function(){return ot.Scene}}),y.o(ot,"gl")&&y.d(O,{gl:function(){return ot.gl}});var jt=y(75613),w=y.n(jt);y.o(jt,"CityBuildingLayer")&&y.d(O,{CityBuildingLayer:function(){return jt.CityBuildingLayer}}),y.o(jt,"HeatmapLayer")&&y.d(O,{HeatmapLayer:function(){return jt.HeatmapLayer}}),y.o(jt,"ImageLayer")&&y.d(O,{ImageLayer:function(){return jt.ImageLayer}}),y.o(jt,"LineLayer")&&y.d(O,{LineLayer:function(){return jt.LineLayer}}),y.o(jt,"Marker")&&y.d(O,{Marker:function(){return jt.Marker}}),y.o(jt,"PointLayer")&&y.d(O,{PointLayer:function(){return jt.PointLayer}}),y.o(jt,"PolygonLayer")&&y.d(O,{PolygonLayer:function(){return jt.PolygonLayer}}),y.o(jt,"Popup")&&y.d(O,{Popup:function(){return jt.Popup}}),y.o(jt,"RasterLayer")&&y.d(O,{RasterLayer:function(){return jt.RasterLayer}}),y.o(jt,"Scene")&&y.d(O,{Scene:function(){return jt.Scene}}),y.o(jt,"gl")&&y.d(O,{gl:function(){return jt.gl}});var N=y(28725)},74453:function(_t,O,y){"use strict";y.d(O,{e7:function(){return Xl},Hp:function(){return lc},ZP:function(){return Pf},yT:function(){return co}});var V=y(80642),b=y(85910),p=y.n(b),G=y(62141),S=y(3020),F=y(90200),te=y(4763),ce=y(96285),q=y(76553),we=y(33692),Pe=y(23197),Be=y.n(Pe);function Oe(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function Nt(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?Oe(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):Oe(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}function Xt(B,U){var M;if(typeof Symbol=="undefined"||B[Symbol.iterator]==null){if(Array.isArray(B)||(M=Bt(B))||U&&B&&typeof B.length=="number"){M&&(B=M);var R=0,ee=function(){};return{s:ee,n:function(){return R>=B.length?{done:!0}:{done:!1,value:B[R++]}},e:function(vr){throw vr},f:ee}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ge=!0,rt=!1,wt;return{s:function(){M=B[Symbol.iterator]()},n:function(){var vr=M.next();return ge=vr.done,vr},e:function(vr){rt=!0,wt=vr},f:function(){try{!ge&&M.return!=null&&M.return()}finally{if(rt)throw wt}}}}function Bt(B,U){if(!!B){if(typeof B=="string")return Qe(B,U);var M=Object.prototype.toString.call(B).slice(8,-1);if(M==="Object"&&B.constructor&&(M=B.constructor.name),M==="Map"||M==="Set")return Array.from(B);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Qe(B,U)}}function Qe(B,U){(U==null||U>B.length)&&(U=B.length);for(var M=0,R=new Array(U);M<U;M++)R[M]=B[M];return R}var xt=30;function nt(B){var U=B.characterSet,M=B.getFontWidth,R=B.fontHeight,ee=B.buffer,ge=B.maxCanvasWidth,rt=B.mapping,wt=rt===void 0?{}:rt,Et=B.xOffset,vr=Et===void 0?0:Et,Vr=B.yOffset,In=Vr===void 0?0:Vr,Nn=0,si=vr;Array.from(U).forEach(function(Ei,pa){if(!wt[Ei]){var wi=M(Ei,pa);si+xt>ge&&(si=0,Nn++),wt[Ei]={x:si,y:In+Nn*xt,width:xt,height:xt,advance:wi},si+=xt}});var Pi=R+ee*2;return{mapping:wt,xOffset:si,yOffset:In+Nn*Pi,canvasHeight:Gt(In+(Nn+1)*Pi)}}function cr(B,U,M){var R=0,ee=0,ge=0,rt=[],wt={},Et=Xt(B),vr;try{for(Et.s();!(vr=Et.n()).done;){var Vr=vr.value;if(!wt[Vr.id]){var In=Vr.size;R+In+U>M&&(At(wt,rt,ee),R=0,ee=ge+ee+U,ge=0,rt=[]),rt.push({icon:Vr,xOffset:R}),R=R+In+U,ge=Math.max(ge,In)}}}catch(si){Et.e(si)}finally{Et.f()}rt.length>0&&At(wt,rt,ee);var Nn=Gt(ge+ee+U);return{mapping:wt,canvasHeight:Nn}}function At(B,U,M){var R=Xt(U),ee;try{for(R.s();!(ee=R.n()).done;){var ge=ee.value,rt=ge.icon,wt=ge.xOffset;B[rt.id]=Nt(Nt({},rt),{},{x:wt,y:M,image:rt.image,width:rt.width,height:rt.height})}}catch(Et){R.e(Et)}finally{R.f()}}function Gt(B){return Math.pow(2,Math.ceil(Math.log2(B)))}var St,Ze,yt;function Me(B,U){var M;if(typeof Symbol=="undefined"||B[Symbol.iterator]==null){if(Array.isArray(B)||(M=Te(B))||U&&B&&typeof B.length=="number"){M&&(B=M);var R=0,ee=function(){};return{s:ee,n:function(){return R>=B.length?{done:!0}:{done:!1,value:B[R++]}},e:function(vr){throw vr},f:ee}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ge=!0,rt=!1,wt;return{s:function(){M=B[Symbol.iterator]()},n:function(){var vr=M.next();return ge=vr.done,vr},e:function(vr){rt=!0,wt=vr},f:function(){try{!ge&&M.return!=null&&M.return()}finally{if(rt)throw wt}}}}function Te(B,U){if(!!B){if(typeof B=="string")return Ie(B,U);var M=Object.prototype.toString.call(B).slice(8,-1);if(M==="Object"&&B.constructor&&(M=B.constructor.name),M==="Map"||M==="Set")return Array.from(B);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Ie(B,U)}}function Ie(B,U){(U==null||U>B.length)&&(U=B.length);for(var M=0,R=new Array(U);M<U;M++)R[M]=B[M];return R}function bt(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function tr(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?bt(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):bt(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}var ae=se(),Ee="sans-serif",le="normal",Q=24,re=3,ke=.25,qe=8,Wt=1024,Or=1,wr=1,Nr=3,Vt=null;function se(){for(var B=[],U=32;U<128;U++)B.push(String.fromCharCode(U));return B}function _e(B,U,M,R){B.font="".concat(R," ").concat(M,"px ").concat(U),B.fillStyle="black",B.textBaseline="middle"}function Le(B,U){for(var M=0;M<B.length;M++)U.data[4*M+3]=B[M]}var ot=(St=(0,G.b2)(),St(Ze=(yt=function(){function B(){(0,ce.Z)(this,B),this.fontAtlas=void 0,this.iconFontMap=void 0,this.iconFontGlyphs={},this.fontOptions=void 0,this.key=void 0,this.cache=new we.z6(Nr)}return(0,q.Z)(B,[{key:"scale",get:function(){return wr}},{key:"canvas",get:function(){var M=this.cache.get(this.key);return M&&M.data}},{key:"mapping",get:function(){var M=this.cache.get(this.key);return M&&M.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Ee,fontWeight:le,characterSet:ae,fontSize:Q,buffer:re,sdf:!0,cutoff:ke,radius:qe,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(M){var R=this;M.forEach(function(ee){R.iconFontGlyphs[ee.name]=ee.unicode})}},{key:"addIconFont",value:function(M,R){this.iconFontMap.set(M,R)}},{key:"getIconFontKey",value:function(M){return this.iconFontMap.get(M)||M}},{key:"getGlyph",value:function(M){return this.iconFontGlyphs[M]?String.fromCharCode(parseInt(this.iconFontGlyphs[M],16)):""}},{key:"setFontOptions",value:function(M){this.fontOptions=tr(tr({},this.fontOptions),M),this.key=this.getKey();var R=this.getNewChars(this.key,this.fontOptions.characterSet),ee=this.cache.get(this.key);if(!(ee&&R.length===0)){var ge=this.generateFontAtlas(this.key,R,ee);this.fontAtlas=ge,this.cache.set(this.key,ge)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(M,R,ee){var ge=this.fontOptions,rt=ge.fontFamily,wt=ge.fontWeight,Et=ge.fontSize,vr=ge.buffer,Vr=ge.sdf,In=ge.radius,Nn=ge.cutoff,si=ge.iconfont,Pi=ee&&ee.data;Pi||(Pi=document.createElement("canvas"),Pi.width=Wt);var Ei=Pi.getContext("2d");_e(Ei,rt,Et,wt);var pa=nt(tr({getFontWidth:function(Bs){return Ei.measureText(Bs).width},fontHeight:Et*wr,buffer:vr,characterSet:R,maxCanvasWidth:Wt},ee&&{mapping:ee.mapping,xOffset:ee.xOffset,yOffset:ee.yOffset})),wi=pa.mapping,ja=pa.canvasHeight,Bo=pa.xOffset,Uo=pa.yOffset,Yo=Ei.getImageData(0,0,Pi.width,Pi.height);if(Pi.height=ja,Ei.putImageData(Yo,0,0),_e(Ei,rt,Et,wt),Vr){var fo=new(Be())(Et,vr,In,Nn,rt,wt),Sa=Ei.getImageData(0,0,fo.size,fo.size),ga=Me(R),wo;try{for(ga.s();!(wo=ga.n()).done;){var ho=wo.value;if(si){var Za=String.fromCharCode(parseInt(ho.replace("&#x","").replace(";",""),16)),$o=fo.draw(Za);Le($o,Sa)}else Le(fo.draw(ho),Sa);Ei.putImageData(Sa,wi[ho].x,wi[ho].y)}}catch(_s){ga.e(_s)}finally{ga.f()}}else{var Jo=Me(R),Ic;try{for(Jo.s();!(Ic=Jo.n()).done;){var Kl=Ic.value;Ei.fillText(Kl,wi[Kl].x,wi[Kl].y+Et*Or)}}catch(_s){Jo.e(_s)}finally{Jo.f()}}return{xOffset:Bo,yOffset:Uo,mapping:wi,data:Pi,width:Pi.width,height:Pi.height}}},{key:"getKey",value:function(){return"key";var M,R,ee,ge,rt,wt,Et,vr}},{key:"getNewChars",value:function(M,R){var ee=this.cache.get(M);if(!ee)return R;var ge=[],rt=ee.mapping,wt=new Set(Object.keys(rt)),Et=new Set(R);return Et.forEach(function(vr){wt.has(vr)||ge.push(vr)}),ge}}]),B}(),yt))||Ze),Rt=y(75304),jt=y(77071),w=y(34521),N,ve,Ae;function Je(B){var U=st();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function st(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var Lt=3,X=1024,Tt=64,Kt=(N=(0,G.b2)(),N(ve=(Ae=function(B){(0,Rt.Z)(M,B);var U=Je(M);function M(){var R;(0,ce.Z)(this,M);for(var ee=arguments.length,ge=new Array(ee),rt=0;rt<ee;rt++)ge[rt]=arguments[rt];return R=U.call.apply(U,[this].concat(ge)),R.canvasHeight=128,R.texture=void 0,R.canvas=void 0,R.iconData=void 0,R.iconMap=void 0,R.ctx=void 0,R.loadingImageCount=0,R}return(0,q.Z)(M,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(ee,ge){var rt=this,wt=new Image;if(this.loadingImageCount++,this.hasImage(ee))throw new Error("Image Id already exists");this.iconData.push({id:ee,size:Tt}),this.updateIconMap(),this.loadImage(ge).then(function(Et){wt=Et;var vr=rt.iconData.find(function(Vr){return Vr.id===ee});vr&&(vr.image=wt,vr.width=wt.width,vr.height=wt.height),rt.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(ee){return this.iconMap.hasOwnProperty(ee)}},{key:"removeImage",value:function(ee){this.hasImage(ee)&&(this.iconData=this.iconData.filter(function(ge){return ge.id!==ee}),delete this.iconMap[ee],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var ee=this;this.canvas.width=X,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(ge){var rt=ee.iconMap[ge],wt=rt.x,Et=rt.y,vr=rt.image,Vr=rt.width,In=Vr===void 0?64:Vr,Nn=rt.height,si=Nn===void 0?64:Nn,Pi=Math.max(In,si),Ei=Pi/Tt,pa=si/Ei,wi=In/Ei;vr&&ee.ctx.drawImage(vr,wt+(Tt-wi)/2,Et+(Tt-pa)/2,wi,pa)})}},{key:"updateIconMap",value:function(){var ee=cr(this.iconData,Lt,X),ge=ee.mapping,rt=ee.canvasHeight;this.iconMap=ge,this.canvasHeight=rt}},{key:"loadImage",value:function(ee){return new Promise(function(ge,rt){if(ee instanceof HTMLImageElement){ge(ee);return}var wt=new Image;wt.crossOrigin="anonymous",wt.onload=function(){ge(wt)},wt.onerror=function(){rt(new Error("Could not load image at "+ee))},wt.src=ee instanceof File?URL.createObjectURL(ee):ee})}}]),M}(b.EventEmitter),Ae))||ve),hr=y(19877),_r=y(29327),Ar,Rr,et,gt=(Ar=(0,G.b2)(),Ar(Rr=(et=function(){function B(){(0,ce.Z)(this,B),this.viewport=void 0,this.overridedViewProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0,this.jitteredProjectionMatrix=void 0,this.viewMatrixInverse=void 0,this.cameraPosition=void 0}return(0,q.Z)(B,[{key:"init",value:function(){}},{key:"update",value:function(M){this.viewport=M,this.viewMatrixInverse=_r.create(),_r.invert(this.viewMatrixInverse,M.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var M=this.viewport.getCenter(),R=(0,hr.Z)(M,2),ee=R[0],ge=R[1];return[ee,ge]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(M,R){return this.viewport.projectFlat(M,R)}},{key:"setViewProjectionMatrix",value:function(M){this.overridedViewProjectionMatrix=M}},{key:"jitterProjectionMatrix",value:function(M,R){var ee=_r.fromTranslation(_r.create(),[M,R,0]);this.jitteredProjectionMatrix=_r.multiply(_r.create(),ee,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=_r.multiply(_r.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),B}(),et))||Rr),dt,fr,$r;function mt(B,U){var M;if(typeof Symbol=="undefined"||B[Symbol.iterator]==null){if(Array.isArray(B)||(M=Dt(B))||U&&B&&typeof B.length=="number"){M&&(B=M);var R=0,ee=function(){};return{s:ee,n:function(){return R>=B.length?{done:!0}:{done:!1,value:B[R++]}},e:function(vr){throw vr},f:ee}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ge=!0,rt=!1,wt;return{s:function(){M=B[Symbol.iterator]()},n:function(){var vr=M.next();return ge=vr.done,vr},e:function(vr){rt=!0,wt=vr},f:function(){try{!ge&&M.return!=null&&M.return()}finally{if(rt)throw wt}}}}function Dt(B,U){if(!!B){if(typeof B=="string")return ar(B,U);var M=Object.prototype.toString.call(B).slice(8,-1);if(M==="Object"&&B.constructor&&(M=B.constructor.name),M==="Map"||M==="Set")return Array.from(B);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return ar(B,U)}}function ar(B,U){(U==null||U>B.length)&&(U=B.length);for(var M=0,R=new Array(U);M<U;M++)R[M]=B[M];return R}var sr=(dt=(0,G.b2)(),dt(fr=($r=function(){function B(){(0,ce.Z)(this,B),this.container=void 0,this.controlCorners=void 0,this.controlContainer=void 0,this.scene=void 0,this.mapsService=void 0,this.controls=[],this.unAddControls=[]}return(0,q.Z)(B,[{key:"init",value:function(M,R){this.container=M.container,this.scene=R,this.mapsService=R.get(F.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(M,R){var ee=R.get(F.v.IMapService);ee.map?(M.addTo(this.scene),this.controls.push(M)):this.unAddControls.push(M)}},{key:"getControlByName",value:function(M){return this.controls.find(function(R){return R.controlOption.name===M})}},{key:"removeControl",value:function(M){var R=this.controls.indexOf(M);return R>-1&&this.controls.splice(R,1),M.remove(),this}},{key:"addControls",value:function(){var M=this;this.unAddControls.forEach(function(R){R.addTo(M.scene),M.controls.push(R)}),this.unAddControls=[]}},{key:"destroy",value:function(){var M=mt(this.controls),R;try{for(M.s();!(R=M.n()).done;){var ee=R.value;ee.remove()}}catch(ge){M.e(ge)}finally{M.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var M=this.controlCorners={},R="l7-",ee=this.controlContainer=we.SO.create("div",R+"control-container",this.container);function ge(rt,wt){var Et=R+rt+" "+R+wt;M[rt+wt]=we.SO.create("div",Et,ee)}ge("top","left"),ge("top","right"),ge("bottom","left"),ge("bottom","right")}},{key:"clearControlPos",value:function(){for(var M in this.controlCorners)this.controlCorners[M]&&we.SO.remove(this.controlCorners[M]);this.controlContainer&&we.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),B}(),$r))||fr),yn,_n,ai,vi=(yn=(0,G.b2)(),yn(_n=(ai=function(){function B(){(0,ce.Z)(this,B),this.container=void 0,this.scene=void 0,this.mapsService=void 0,this.markers=[],this.markerLayers=[],this.unAddMarkers=[],this.unAddMarkerLayers=[]}return(0,q.Z)(B,[{key:"addMarkerLayer",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(M),M.addTo(this.scene)):this.unAddMarkerLayers.push(M)}},{key:"removeMarkerLayer",value:function(M){M.destroy(),this.markerLayers.indexOf(M);var R=this.markerLayers.indexOf(M);R>-1&&this.markerLayers.splice(R,1)}},{key:"addMarker",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(M),M.addTo(this.scene)):this.unAddMarkers.push(M)}},{key:"addMarkers",value:function(){var M=this;this.unAddMarkers.forEach(function(R){R.addTo(M.scene),M.markers.push(R)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var M=this;this.unAddMarkerLayers.forEach(function(R){M.markerLayers.push(R),R.addTo(M.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(M){M.remove(),this.markers.indexOf(M);var R=this.markers.indexOf(M);R>-1&&this.markers.splice(R,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(F.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(M){M.remove()}),this.markers=[],this.markerLayers.forEach(function(M){M.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(M){M.destroy()}}]),B}(),ai))||_n),Di,Zi,oi,$=(Di=(0,G.b2)(),Di(Zi=(oi=function(){function B(){(0,ce.Z)(this,B),this.scene=void 0,this.popup=void 0,this.mapsService=void 0,this.unAddPopup=void 0}return(0,q.Z)(B,[{key:"removePopup",value:function(M){M.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(M){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(M.addTo(this.scene),this.popup=M):this.unAddPopup=M}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(F.v.IMapService)}}]),B}(),oi))||Zi),I=y(82492),j=y.n(I),Y={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},ue=Y,De,He,he;function Ne(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function Ct(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?Ne(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):Ne(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}var kr={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},jr={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},$t=(De=(0,G.b2)(),De(He=(he=function(){function B(){(0,ce.Z)(this,B),this.sceneConfigCache={},this.layerConfigCache={}}return(0,q.Z)(B,[{key:"getSceneConfig",value:function(M){return this.sceneConfigCache[M]}},{key:"getSceneWarninfo",value:function(M){return ue[M]}},{key:"setSceneConfig",value:function(M,R){this.sceneConfigCache[M]=Ct(Ct({},kr),R)}},{key:"getLayerConfig",value:function(M){return this.layerConfigCache[M]}},{key:"setLayerConfig",value:function(M,R,ee){this.layerConfigCache[R]=Ct({},j()({},this.sceneConfigCache[M],jr,ee))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),B}(),he))||He),yr=y(17912),qr=y(25882),gn=y(85263),dr=Math.PI/180,hn=512,ln=4003e4;function fn(B){var U=B.latitude,M=U===void 0?0:U,R=B.zoom,ee=R===void 0?0:R,ge=B.scale,rt=B.highPrecision,wt=rt===void 0?!1:rt,Et=B.flipY,vr=Et===void 0?!1:Et;ge=ge!==void 0?ge:Math.pow(2,ee);var Vr={},In=hn*ge,Nn=Math.cos(M*dr),si=In/360,Pi=si/Nn,Ei=In/ln/Nn;if(Vr.pixelsPerMeter=[Ei,-Ei,Ei],Vr.metersPerPixel=[1/Ei,-1/Ei,1/Ei],Vr.pixelsPerDegree=[si,-Pi,Ei],Vr.degreesPerPixel=[1/si,-1/Pi,1/Ei],wt){var pa=dr*Math.tan(M*dr)/Nn,wi=si*pa/2,ja=In/ln*pa,Bo=ja/Pi*Ei;Vr.pixelsPerDegree2=[0,-wi,ja],Vr.pixelsPerMeter2=[Bo,0,Bo],vr&&(Vr.pixelsPerDegree2[1]=-Vr.pixelsPerDegree2[1],Vr.pixelsPerMeter2[1]=-Vr.pixelsPerMeter2[1])}return vr&&(Vr.pixelsPerMeter[1]=-Vr.pixelsPerMeter[1],Vr.metersPerPixel[1]=-Vr.metersPerPixel[1],Vr.pixelsPerDegree[1]=-Vr.pixelsPerDegree[1],Vr.degreesPerPixel[1]=-Vr.degreesPerPixel[1]),Vr}var ri=y(45953),dn,ci,Bi,pi,_i,Ai,xo=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Wi=(dn=(0,G.b2)(),ci=(0,G.f3)(F.v.ICameraService),dn(Bi=(pi=(Ai=function(){function B(){(0,ce.Z)(this,B),this.needRefresh=!0,(0,yr.Z)(this,"cameraService",_i,this),this.coordinateSystem=void 0,this.viewportCenter=void 0,this.viewportCenterProjection=void 0,this.pixelsPerDegree=void 0,this.pixelsPerDegree2=void 0,this.pixelsPerMeter=void 0}return(0,q.Z)(B,[{key:"refresh",value:function(){var M=this.cameraService.getZoom(),R=this.cameraService.getZoomScale(),ee=this.cameraService.getCenter(),ge=fn({latitude:ee[1],zoom:M}),rt=ge.pixelsPerMeter,wt=ge.pixelsPerDegree;this.viewportCenter=ee,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=rt,this.pixelsPerDegree=wt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===ri.l.LNGLAT||this.coordinateSystem===ri.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===ri.l.LNGLAT_OFFSET?this.calculateLnglatOffset(ee,M):this.coordinateSystem===ri.l.P20_OFFSET&&this.calculateLnglatOffset(ee,M,R,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(M){this.coordinateSystem=M}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(M,R,ee,ge){var rt=fn({latitude:M[1],zoom:R,scale:ee,flipY:ge,highPrecision:!0}),wt=rt.pixelsPerMeter,Et=rt.pixelsPerDegree,vr=rt.pixelsPerDegree2,Vr=this.cameraService.getViewMatrix(),In=this.cameraService.getProjectionMatrix(),Nn=_r.multiply([],In,Vr),si=this.cameraService.projectFlat([Math.fround(M[0]),Math.fround(M[1])],Math.pow(2,R));this.viewportCenterProjection=gn.fF([],[si[0],si[1],0,1],Nn),Vr=this.cameraService.getViewMatrixUncentered()||Vr,Nn=_r.multiply([],In,Vr),Nn=_r.multiply([],Nn,xo),this.cameraService.setViewProjectionMatrix(Nn),this.pixelsPerMeter=wt,this.pixelsPerDegree=Et,this.pixelsPerDegree2=vr}}]),B}(),Ai),_i=(0,qr.Z)(pi.prototype,"cameraService",[ci],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pi))||Bi),mi=y(26306),Fn=y(68420),kn=y.n(Fn),Zn=y(15211),ra,js,ua,Ki,mu,gu,ya,no;function Ya(B){var U=Na();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function Na(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var Ho={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancle"},aa=(ra=(0,G.b2)(),js=(0,G.f3)(F.v.IMapService),ua=(0,G.f3)(F.v.ILogService),ra(Ki=(mu=(no=function(B){(0,Rt.Z)(M,B);var U=Ya(M);function M(){var R;(0,ce.Z)(this,M);for(var ee=arguments.length,ge=new Array(ee),rt=0;rt<ee;rt++)ge[rt]=arguments[rt];return R=U.call.apply(U,[this].concat(ge)),(0,yr.Z)(R,"mapService",gu,(0,mi.Z)(R)),(0,yr.Z)(R,"logger",ya,(0,mi.Z)(R)),R.hammertime=void 0,R.lastClickTime=0,R.lastClickXY=[-1,-1],R.clickTimer=void 0,R.$containter=void 0,R.onDrag=function(wt){var Et=R.interactionEvent(wt);Et.type=Ho[Et.type],R.emit(Zn.s.Drag,Et)},R.onHammer=function(wt){wt.srcEvent.stopPropagation();var Et=R.interactionEvent(wt);R.emit(Zn.s.Hover,Et)},R.onTouch=function(wt){var Et=wt.touches[0];R.onHover({x:Et.pageX,y:Et.pageY,type:"touch"})},R.onHover=function(wt){var Et=wt.clientX,vr=wt.clientY,Vr=Et,In=vr,Nn=wt.type,si=R.mapService.getMapContainer();if(si){var Pi=si.getBoundingClientRect(),Ei=Pi.top,pa=Pi.left;Vr=Vr-pa-si.clientLeft,In=In-Ei-si.clientTop}var wi=R.mapService.containerToLngLat([Vr,In]);if(Nn==="click"){if("ontouchstart"in document.documentElement)return;R.isDoubleTap(Vr,In,wi);return}if(Nn==="touch"){R.isDoubleTap(Vr,In,wi);return}Nn!=="click"&&Nn!=="dblclick"&&R.emit(Zn.s.Hover,{x:Vr,y:In,lngLat:wi,type:Nn,target:wt})},R}return(0,q.Z)(M,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Zn.s.Hover)}},{key:"triggerHover",value:function(ee){var ge=ee.x,rt=ee.y;this.emit(Zn.s.Hover,{x:ge,y:rt})}},{key:"triggerSelect",value:function(ee){this.emit(Zn.s.Select,{featureId:ee})}},{key:"triggerActive",value:function(ee){this.emit(Zn.s.Active,{featureId:ee})}},{key:"addEventListenerOnMap",value:function(){var ee=this.mapService.getMapContainer();if(ee){var ge=new(kn()).Manager(ee);ge.add(new(kn()).Tap({event:"dblclick",taps:2})),ge.add(new(kn()).Tap({event:"click"})),ge.add(new(kn()).Pan({threshold:0,pointers:0})),ge.add(new(kn()).Press({})),ge.on("dblclick click",this.onHammer),ge.on("panstart panmove panend pancancel",this.onDrag),ee.addEventListener("mousemove",this.onHover),ee.addEventListener("mousedown",this.onHover,!0),ee.addEventListener("mouseup",this.onHover),ee.addEventListener("contextmenu",this.onHover),this.hammertime=ge,this.logger.debug("add event listeners on canvas")}}},{key:"removeEventListenerOnMap",value:function(){var ee=this.mapService.getMapContainer();ee&&(ee.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),ee.removeEventListener("mousedown",this.onHover),ee.removeEventListener("mouseup",this.onHover),ee.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(ee){var ge=ee.type,rt=ee.pointerType,wt,Et;rt==="touch"?(Et=Math.floor(ee.pointers[0].clientY),wt=Math.floor(ee.pointers[0].clientX)):(Et=Math.floor(ee.srcEvent.y),wt=Math.floor(ee.srcEvent.x));var vr=this.mapService.getMapContainer();if(vr){var Vr=vr.getBoundingClientRect(),In=Vr.top,Nn=Vr.left;wt-=Nn,Et-=In}var si=this.mapService.containerToLngLat([wt,Et]);return{x:wt,y:Et,lngLat:si,type:ge,target:ee.srcEvent}}},{key:"isDoubleTap",value:function(ee,ge,rt){var wt=this,Et=new Date().getTime(),vr="click";Et-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-ee)<10&&Math.abs(this.lastClickXY[1]-ge)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),vr="dblclick",this.emit(Zn.s.Hover,{x:ee,y:ge,lngLat:rt,type:vr})):(this.lastClickTime=Et,this.lastClickXY=[ee,ge],this.clickTimer=setTimeout(function(){vr="click",wt.emit(Zn.s.Hover,{x:ee,y:ge,lngLat:rt,type:vr})},400))}}]),M}(p()),no),gu=(0,qr.Z)(mu.prototype,"mapService",[js],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ya=(0,qr.Z)(mu.prototype,"logger",[ua],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mu))||Ki),Ga=y(78864),io=y(87757),oa=y.n(io),qi=y(28725),Pl,ts,$a,Ha,la,it,pe,Ke,qt,Wr,bn,xi;function _a(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function Vi(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?_a(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):_a(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}var Wa=(Pl=(0,G.b2)(),ts=(0,G.f3)(F.v.IRendererService),$a=(0,G.f3)(F.v.IGlobalConfigService),Ha=(0,G.f3)(F.v.IInteractionService),la=(0,G.f3)(F.v.ILayerService),Pl(it=(pe=(xi=function(){function B(){var U=this;(0,ce.Z)(this,B),(0,yr.Z)(this,"rendererService",Ke,this),(0,yr.Z)(this,"configService",qt,this),(0,yr.Z)(this,"interactionService",Wr,this),(0,yr.Z)(this,"layerService",bn,this),this.pickingFBO=void 0,this.width=0,this.height=0,this.alreadyInPicking=!1,this.pickBufferScale=1,this.pickFromPickingFBO=function(M,R){var ee,ge=R.x,rt=R.y,wt=R.lngLat,Et=R.type,vr=R.target,Vr=!1,In=U.rendererService,Nn=In.getViewportSize,si=In.readPixels,Pi=In.getContainer,Ei=Pi().getBoundingClientRect(),pa=Ei.width,wi=Ei.height;pa*=we.SO.DPR,wi*=we.SO.DPR;var ja=M.getLayerConfig(),Bo=ja.enableHighlight,Uo=ja.enableSelect,Yo=ge*we.SO.DPR,fo=rt*we.SO.DPR;if(Yo>pa-1*we.SO.DPR||Yo<0||fo>wi-1*we.SO.DPR||fo<0)return!1;var Sa;if(Sa=si({x:Math.floor(Yo/U.pickBufferScale),y:Math.floor((wi-(rt+1)*we.SO.DPR)/U.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:U.pickingFBO}),Sa[0]!==0||Sa[1]!==0||Sa[2]!==0){var ga=(0,we.W0)(Sa),wo=M.getSource().getFeatureById(ga);ga!==M.getCurrentPickId()&&Et==="mousemove"&&(Et="mouseenter");var ho={x:ge,y:rt,type:Et,lngLat:wt,featureId:ga,feature:wo,target:vr};wo&&(Vr=!0,M.setCurrentPickId(ga),U.triggerHoverOnLayer(M,ho))}else{var Za={x:ge,y:rt,lngLat:wt,type:M.getCurrentPickId()!==null&&Et==="mousemove"?"mouseout":"un"+Et,featureId:null,target:vr,feature:null};U.triggerHoverOnLayer(M,Vi(Vi({},Za),{},{type:"unpick"})),U.triggerHoverOnLayer(M,Za),M.setCurrentPickId(null)}if(Bo&&U.highlightPickedFeature(M,Sa),Uo&&Et==="click"&&((ee=Sa)===null||ee===void 0?void 0:ee.toString())!==[0,0,0,0].toString()){var $o=(0,we.W0)(Sa);M.getCurrentSelectedId()===null||$o!==M.getCurrentSelectedId()?(U.selectFeature(M,Sa),M.setCurrentSelectedId($o)):(U.selectFeature(M,new Uint8Array([0,0,0,0])),M.setCurrentSelectedId(null))}return Vr}}return(0,q.Z)(B,[{key:"init",value:function(M){var R=this.rendererService,ee=R.createTexture2D,ge=R.createFramebuffer,rt=R.getViewportSize,wt=R.getContainer,Et=wt().getBoundingClientRect(),vr=Et.width,Vr=Et.height;vr*=we.SO.DPR,Vr*=we.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(M).pickBufferScale||1,this.pickingFBO=ge({color:ee({width:Math.round(vr/this.pickBufferScale),height:Math.round(Vr/this.pickBufferScale),wrapS:qi.gl.CLAMP_TO_EDGE,wrapT:qi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(Zn.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var U=(0,Ga.Z)(oa().mark(function R(ee,ge,rt){var wt=this,Et,vr,Vr,In;return oa().wrap(function(si){for(;;)switch(si.prev=si.next){case 0:Et=this.rendererService,vr=Et.useFramebuffer,Vr=Et.clear,In=Et.getContainer,this.resizePickingFBO(),vr(this.pickingFBO,function(){Vr({framebuffer:wt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),ee.hooks.beforePickingEncode.call(),ee.renderModels(),ee.hooks.afterPickingEncode.call();var Pi=wt.pickBox(ee,ge);rt(Pi)});case 3:case"end":return si.stop()}},R,this)}));function M(R,ee,ge){return U.apply(this,arguments)}return M}()},{key:"pickBox",value:function(M,R){var ee=this,ge=R.map(function(Za){var $o=Za<0?0:Za;return Math.floor($o*we.SO.DPR/ee.pickBufferScale)}),rt=(0,hr.Z)(ge,4),wt=rt[0],Et=rt[1],vr=rt[2],Vr=rt[3],In=this.rendererService,Nn=In.getViewportSize,si=In.readPixels,Pi=In.getContainer,Ei=Pi().getBoundingClientRect(),pa=Ei.width,wi=Ei.height;if(pa*=we.SO.DPR,wi*=we.SO.DPR,wt>(pa-1)*we.SO.DPR/this.pickBufferScale||vr<0||Et>(wi-1)*we.SO.DPR/this.pickBufferScale||Vr<0)return[];var ja,Bo=Math.min(pa/this.pickBufferScale,vr)-wt,Uo=Math.min(wi/this.pickBufferScale,Vr)-Et;ja=si({x:wt,y:Math.floor(wi/this.pickBufferScale-(Vr+1)),width:Bo,height:Uo,data:new Uint8Array(Bo*Uo*4),framebuffer:this.pickingFBO});for(var Yo=[],fo={},Sa=0;Sa<ja.length/4;Sa=Sa+1){var ga=ja.slice(Sa*4,Sa*4+4),wo=(0,we.W0)(ga);if(wo!==-1&&!fo[wo]){var ho=M.getSource().getFeatureById(wo);Yo.push(ho),fo[wo]=!0}}return Yo}},{key:"pickingAllLayer",value:function(){var U=(0,Ga.Z)(oa().mark(function R(ee){return oa().wrap(function(rt){for(;;)switch(rt.prev=rt.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){rt.next=2;break}return rt.abrupt("return");case 2:return this.alreadyInPicking=!0,rt.next=5,this.pickingLayers(ee);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return rt.stop()}},R,this)}));function M(R){return U.apply(this,arguments)}return M}()},{key:"resizePickingFBO",value:function(){var M=this.rendererService.getContainer,R=M().getBoundingClientRect(),ee=R.width,ge=R.height;ee*=we.SO.DPR,ge*=we.SO.DPR,(this.width!==ee||this.height!==ge)&&(this.pickingFBO.resize({width:Math.round(ee/this.pickBufferScale),height:Math.round(ge/this.pickBufferScale)}),this.width=ee,this.height=ge)}},{key:"pickingLayers",value:function(){var U=(0,Ga.Z)(oa().mark(function R(ee){var ge=this,rt,wt,Et,vr,Vr;return oa().wrap(function(Nn){for(;;)switch(Nn.prev=Nn.next){case 0:rt=this.rendererService,wt=rt.getViewportSize,Et=rt.useFramebuffer,vr=rt.clear,Vr=rt.getContainer,this.resizePickingFBO(),Et(this.pickingFBO,function(){var si=ge.layerService.getLayers();si.filter(function(Pi){return Pi.needPick(ee.type)}).reverse().some(function(Pi){vr({framebuffer:ge.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),Pi.hooks.beforePickingEncode.call(),Pi.renderModels(),Pi.hooks.afterPickingEncode.call();var Ei=ge.pickFromPickingFBO(Pi,ee);return Ei&&!Pi.getLayerConfig().enablePropagation})});case 3:case"end":return Nn.stop()}},R,this)}));function M(R){return U.apply(this,arguments)}return M}()},{key:"triggerHoverOnLayer",value:function(M,R){M.emit(R.type,R)}},{key:"isEventCrash",value:function(M){var R=!0;return M.target.path.map(function(ee){ee.classList&&ee.classList.forEach(function(ge){(ge==="l7-marker"||ge==="l7-popup")&&(R=!1)})}),R}},{key:"highlightPickedFeature",value:function(M,R){var ee=(0,hr.Z)(R,3),ge=ee[0],rt=ee[1],wt=ee[2];M.hooks.beforeHighlight.call([ge,rt,wt])}},{key:"selectFeature",value:function(M,R){var ee=(0,hr.Z)(R,3),ge=ee[0],rt=ee[1],wt=ee[2];M.hooks.beforeSelect.call([ge,rt,wt])}}]),B}(),xi),Ke=(0,qr.Z)(pe.prototype,"rendererService",[ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qt=(0,qr.Z)(pe.prototype,"configService",[$a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wr=(0,qr.Z)(pe.prototype,"interactionService",[Ha],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bn=(0,qr.Z)(pe.prototype,"layerService",[la],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pe))||it),ko=function(){function B(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ce.Z)(this,B),this.autoStart=void 0,this.startTime=0,this.oldTime=0,this.running=!1,this.elapsedTime=0,this.autoStart=U}return(0,q.Z)(B,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var M=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var R=(typeof performance=="undefined"?Date:performance).now();M=(R-this.oldTime)/1e3,this.oldTime=R,this.elapsedTime+=M}return M}}]),B}(),yu,_u,Qu,rs,ds,ao,Ds,su,xa=(yu=(0,G.b2)(),_u=(0,G.f3)(F.v.IRendererService),Qu=(0,G.f3)(F.v.IGlobalConfigService),yu(rs=(ds=(su=function(){function B(){(0,ce.Z)(this,B),this.clock=new ko,this.alreadyInRendering=!1,this.layers=[],this.layerRenderID=void 0,this.sceneInited=!1,this.animateInstanceCount=0,(0,yr.Z)(this,"renderService",ao,this),(0,yr.Z)(this,"configService",Ds,this)}return(0,q.Z)(B,[{key:"add",value:function(M){this.sceneInited&&M.init(),this.layers.push(M)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(M){M.inited||M.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(M){return this.layers.find(function(R){return R.id===M})}},{key:"getLayerByName",value:function(M){return this.layers.find(function(R){return R.name===M})}},{key:"remove",value:function(M){var R=this.layers.indexOf(M);R>-1&&this.layers.splice(R,1),M.emit("remove",null),M.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(M){return M.inited}).filter(function(M){return M.isVisible()}).forEach(function(M){M.hooks.beforeRenderData.call(),M.hooks.beforeRender.call(),M.render(),M.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(M,R){return M.zIndex-R.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(M){return M.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),B}(),su),ao=(0,qr.Z)(ds.prototype,"renderService",[_u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ds=(0,qr.Z)(ds.prototype,"configService",[Qu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ds))||rs),bi=y(63309),Ja=y(66156),ba=y(14293),Co=y.n(ba),oo=function(){function B(U){var M=this;(0,ce.Z)(this,B),this.name=void 0,this.type=void 0,this.scale=void 0,this.descriptor=void 0,this.featureBufferLayout=[],this.needRescale=!1,this.needRemapping=!1,this.needRegenerateVertices=!1,this.featureRange={startIndex:0,endIndex:Infinity},this.vertexAttribute=void 0,this.defaultCallback=function(R){if(R.length===0){var ee;return((ee=M.scale)===null||ee===void 0?void 0:ee.defaultValues)||[]}return R.map(function(ge,rt){var wt,Et=(wt=M.scale)===null||wt===void 0?void 0:wt.scalers[rt].func,vr=Et(ge);return vr})},this.setProps(U)}return(0,q.Z)(B,[{key:"setProps",value:function(M){Object.assign(this,M)}},{key:"mapping",value:function(M){var R;if((R=this.scale)!==null&&R!==void 0&&R.callback){var ee,ge=(ee=this.scale)===null||ee===void 0?void 0:ee.callback.apply(ee,(0,Ja.Z)(M));if(!Co()(ge))return[ge]}return this.defaultCallback(M)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),B}(),cl,Ve,Ft,br,Cn,Yi,Aa;function za(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function sa(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?za(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):za(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}function La(B){return new Promise(function(U){return setTimeout(U,B)})}var vs=(cl={},(0,te.Z)(cl,qi.gl.FLOAT,4),(0,te.Z)(cl,qi.gl.UNSIGNED_BYTE,1),(0,te.Z)(cl,qi.gl.UNSIGNED_SHORT,2),cl),ks=(Ve=(0,G.b2)(),Ft=(0,G.f3)(F.v.IRendererService),Ve(br=(Cn=(Aa=function(){function B(){(0,ce.Z)(this,B),this.attributesAndIndices=void 0,(0,yr.Z)(this,"rendererService",Yi,this),this.attributes=[],this.triangulation=void 0,this.featureLayout={sizePerElement:0,elements:[]}}return(0,q.Z)(B,[{key:"registerStyleAttribute",value:function(M){var R=this.getLayerStyleAttribute(M.name||"");return R?R.setProps(M):(R=new oo(M),this.attributes.push(R)),R}},{key:"updateStyleAttribute",value:function(M,R,ee){var ge=this.getLayerStyleAttribute(M);ge||(ge=this.registerStyleAttribute(sa(sa({},R),{},{name:M})));var rt=R.scale;rt&&ge&&(ge.scale=rt,ge.needRescale=!0,ge.needRemapping=!0,ge.needRegenerateVertices=!0,ee&&ee.featureRange&&(ge.featureRange=ee.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(M){return this.attributes.find(function(R){return R.name===M})}},{key:"getLayerAttributeScale",value:function(M){var R,ee=this.getLayerStyleAttribute(M),ge=ee==null||(R=ee.scale)===null||R===void 0?void 0:R.scalers;return ge&&ge[0]?ge[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(M,R){var ee=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,ge=arguments.length>3?arguments[3]:void 0,rt=this.attributes.find(function(Uo){return Uo.name===M});if(rt&&rt.descriptor){var wt=rt.descriptor,Et=wt.update,vr=wt.buffer,Vr=wt.size,In=Vr===void 0?0:Vr,Nn=vs[vr.type||qi.gl.FLOAT];if(Et){var si=this.featureLayout,Pi=si.elements,Ei=si.sizePerElement,pa=Pi.slice(ee,ge);if(!pa.length)return;var wi=pa[0].offset,ja=wi*In*Nn,Bo=pa.map(function(Uo,Yo){for(var fo=Uo.featureIdx,Sa=Uo.vertices,ga=Uo.normals,wo=Sa.length/Ei,ho=[],Za=0;Za<wo;Za++){var $o=ga?ga.slice(Za*3,Za*3+3):[];ho.push.apply(ho,(0,Ja.Z)(Et(R[fo],fo,Sa.slice(Za*Ei,Za*Ei+Ei),Yo,$o)))}return ho}).reduce(function(Uo,Yo){return Uo.push.apply(Uo,(0,Ja.Z)(Yo)),Uo},[]);rt.vertexAttribute.updateBuffer({data:Bo,offset:ja})}}}},{key:"createAttributesAndIndices",value:function(M,R){var ee=this;this.featureLayout={sizePerElement:0,elements:[]},R&&(this.triangulation=R);var ge=this.attributes.map(function(wi){return wi.resetDescriptor(),wi.descriptor}),rt=0,wt=[],Et=[],vr=[],Vr=3;M.forEach(function(wi,ja){var Bo=ee.triangulation(wi),Uo=Bo.indices,Yo=Bo.vertices,fo=Bo.normals,Sa=Bo.size;Uo.forEach(function(Za){Et.push(Za+rt)}),Vr=Sa;var ga=Yo.length/Sa;ee.featureLayout.sizePerElement=Vr,ee.featureLayout.elements.push({featureIdx:ja,vertices:Yo,normals:fo,offset:rt}),rt+=ga;for(var wo=function($o){var Jo=(fo==null?void 0:fo.slice($o*3,$o*3+3))||[],Ic=Yo.slice($o*Sa,$o*Sa+Sa);ge.forEach(function(Kl,_s){if(Kl&&Kl.update){var Bs;(Bs=Kl.buffer.data).push.apply(Bs,(0,Ja.Z)(Kl.update(wi,ja,Ic,$o,Jo)))}})},ho=0;ho<ga;ho++)wo(ho)});var In=this.rendererService,Nn=In.createAttribute,si=In.createBuffer,Pi=In.createElements,Ei={};ge.forEach(function(wi,ja){if(wi){var Bo=wi.buffer,Uo=wi.update,Yo=wi.name,fo=(0,bi.Z)(wi,["buffer","update","name"]),Sa=Nn(sa({buffer:si(Bo)},fo));Ei[wi.name||""]=Sa,ee.attributes[ja].vertexAttribute=Sa}});var pa=Pi({data:Et,type:qi.gl.UNSIGNED_INT,count:Et.length});return this.attributesAndIndices={attributes:Ei,elements:pa},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var M;this.attributes.forEach(function(R){R.vertexAttribute&&R.vertexAttribute.destroy()}),(M=this.attributesAndIndices)===null||M===void 0||M.elements.destroy(),this.attributes=[]}}]),B}(),Aa),Yi=(0,qr.Z)(Cn.prototype,"rendererService",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cn))||br),ha=y(95676),fl=y(82195);function xu(B){if(typeof window!="undefined"&&(0,ha.Z)(window.process)==="object"&&window.process.type==="renderer"||typeof fl!="undefined"&&(0,ha.Z)(fl.versions)==="object"&&Boolean(fl.versions.electron))return!0;var U=(typeof navigator=="undefined"?"undefined":(0,ha.Z)(navigator))==="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,M=B||U;return!!(M&&M.indexOf("Electron")>=0)}var ms=y(82195);function Ml(){var B=(typeof ms=="undefined"?"undefined":(0,ha.Z)(ms))==="object"&&String(ms)==="[object process]"&&!ms.browser;return!B||xu()}function zu(){return Ml()&&typeof document!="undefined"}var qu=typeof __VERSION__!="undefined"?__VERSION__:"untranspiled source",Fs=Ml();function Il(B){try{var U=window[B],M="__storage_test__";return U.setItem(M,M),U.removeItem(M),U}catch(R){return null}}var gs=function(){function B(U,M){var R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";(0,ce.Z)(this,B),this.storage=Il(R),this.id=U,this.config={},Object.assign(this.config,M),this._loadConfiguration()}return(0,q.Z)(B,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(M){return this.config={},this.updateConfiguration(M)}},{key:"updateConfiguration",value:function(M){if(Object.assign(this.config,M),this.storage){var R=JSON.stringify(this.config);this.storage.setItem(this.id,R)}return this}},{key:"_loadConfiguration",value:function(){var M={};if(this.storage){var R=this.storage.getItem(this.id);M=R?JSON.parse(R):{}}return Object.assign(this.config,M),this}}]),B}();function Jl(B){var U;return B<10?U="".concat(B.toFixed(2),"ms"):B<100?U="".concat(B.toFixed(1),"ms"):B<1e3?U="".concat(B.toFixed(0),"ms"):U="".concat((B/1e3).toFixed(2),"s"),U}function Df(B){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,M=Math.max(U-B.length,0);return"".concat(" ".repeat(M)).concat(B)}function Ca(B){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,M=Math.max(U-B.length,0);return"".concat(B).concat(" ".repeat(M))}function $f(B){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},M=1e-16,R=U.isInteger,ee=R===void 0?!1:R;if(Array.isArray(B)||ArrayBuffer.isView(B))return Uc(B,U);if(!Number.isFinite(B))return String(B);if(Math.abs(B)<M)return ee?"0":"0.";if(ee||Math.abs(B)>100&&Math.abs(B)<1e4)return B.toFixed(0);var ge=B.toPrecision(2),rt=ge.indexOf(".0");return rt===ge.length-2?ge.slice(0,-1):ge}function Uc(B,U){for(var M=U.maxElts,R=M===void 0?16:M,ee=U.size,ge=ee===void 0?1:ee,rt="[",wt=0;wt<B.length&&wt<R;++wt)wt>0&&(rt+=",".concat(wt%ge==0?" ":"")),rt+=$f(B[wt],U);var Et=B.length>R?"...":"]";return"".concat(rt).concat(Et)}function af(B,U,M){var R=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600,ee=B.src.replace(/\(/g,"%28").replace(/\)/g,"%29");B.width>R&&(M=Math.min(M,R/B.width));var ge=B.width*M,rt=B.height*M,wt=["font-size:1px;","padding:".concat(Math.floor(rt/2),"px ").concat(Math.floor(ge/2),"px;"),"line-height:".concat(rt,"px;"),"background:url(".concat(ee,");"),"background-size:".concat(ge,"px ").concat(rt,"px;"),"color:transparent;"].join("");return["".concat(U," %c+"),wt]}var Ef={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function of(B){return typeof B=="string"?Ef[B.toUpperCase()]||Ef.WHITE:B}function go(B,U,M){return!Fs&&typeof B=="string"&&(U&&(U=of(U),B="[".concat(U,"m").concat(B,"[39m")),M&&(U=of(M),B="[".concat(M+10,"m").concat(B,"[49m"))),B}function Ol(B){if(typeof Symbol=="undefined"||B[Symbol.iterator]==null){if(Array.isArray(B)||(B=Ll(B))){var U=0,M=function(){};return{s:M,n:function(){return U>=B.length?{done:!0}:{done:!1,value:B[U++]}},e:function(Et){throw Et},f:M}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var R,ee=!0,ge=!1,rt;return{s:function(){R=B[Symbol.iterator]()},n:function(){var Et=R.next();return ee=Et.done,Et},e:function(Et){ge=!0,rt=Et},f:function(){try{!ee&&R.return!=null&&R.return()}finally{if(ge)throw rt}}}}function Ll(B,U){if(!!B){if(typeof B=="string")return Es(B,U);var M=Object.prototype.toString.call(B).slice(8,-1);if(M==="Object"&&B.constructor&&(M=B.constructor.name),M==="Map"||M==="Set")return Array.from(M);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Es(B,U)}}function Es(B,U){(U==null||U>B.length)&&(U=B.length);for(var M=0,R=new Array(U);M<U;M++)R[M]=B[M];return R}function sf(B){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"],M=Object.getPrototypeOf(B),R=Object.getOwnPropertyNames(M),ee=Ol(R),ge;try{var rt=function(){var Et=ge.value;typeof B[Et]=="function"&&(U.find(function(vr){return Et===vr})||(B[Et]=B[Et].bind(B)))};for(ee.s();!(ge=ee.n()).done;)rt()}catch(wt){ee.e(wt)}finally{ee.f()}}function Rl(B,U){if(!B)throw new Error(U||"Assertion failed")}var Bu=y(82195),Po={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof y.g!="undefined"&&y.g,document:typeof document!="undefined"&&document,process:(typeof Bu=="undefined"?"undefined":(0,ha.Z)(Bu))==="object"&&Bu},uf=Po.self||Po.window||Po.global,bu=Po.window||Po.self||Po.global,hl=Po.global||Po.self||Po.window,kf=Po.document||{},Dl=Po.process||{},Ra=console;function uu(){var B;if(Fs&&bu.performance)B=bu.performance.now();else if(Dl.hrtime){var U=Dl.hrtime();B=U[0]*1e3+U[1]/1e6}else B=Date.now();return B}var vc={debug:Fs&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Mo={enabled:!0,level:0};function ns(){}var kl={},Fl={once:!0};function Su(B){for(var U in B)for(var M in B[U])return M||"untitled";return"empty"}var lu=function(){function B(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=U.id;(0,ce.Z)(this,B),this.id=M,this.VERSION=qu,this._startTs=uu(),this._deltaTs=uu(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new gs("__probe-".concat(this.id,"__"),Mo),this.userData={},this.timeStamp("".concat(this.id," started")),sf(this),Object.seal(this)}return(0,q.Z)(B,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((uu()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((uu()-this._deltaTs).toPrecision(10))}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:M}),this}},{key:"setLevel",value:function(M){return this._storage.updateConfiguration({level:M}),this}},{key:"assert",value:function(M,R){Rl(M,R)}},{key:"warn",value:function(M){return this._getLogFunction(0,M,vc.warn,arguments,Fl)}},{key:"error",value:function(M){return this._getLogFunction(0,M,vc.error,arguments)}},{key:"deprecated",value:function(M,R){return this.warn("`".concat(M,"` is deprecated and will be removed in a later version. Use `").concat(R,"` instead"))}},{key:"removed",value:function(M,R){return this.error("`".concat(M,"` has been removed. Use `").concat(R,"` instead"))}},{key:"probe",value:function(M,R){return this._getLogFunction(M,R,vc.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(M,R){return this._getLogFunction(M,R,vc.debug,arguments)}},{key:"info",value:function(M,R){return this._getLogFunction(M,R,console.info,arguments)}},{key:"once",value:function(M,R){return this._getLogFunction(M,R,vc.debug||vc.info,arguments,Fl)}},{key:"table",value:function(M,R,ee){return R?this._getLogFunction(M,R,console.table||ns,ee&&[ee],{tag:Su(R)}):ns}},{key:"image",value:function(M){var R=M.logLevel,ee=M.priority,ge=M.image,rt=M.message,wt=rt===void 0?"":rt,Et=M.scale,vr=Et===void 0?1:Et;return this._shouldLog(R||ee)?Fs?ql({image:ge,message:wt,scale:vr}):pl({image:ge,message:wt,scale:vr}):ns}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(M){return this._storage.config[M]}},{key:"set",value:function(M,R){this._storage.updateConfiguration((0,te.Z)({},M,R))}},{key:"time",value:function(M,R){return this._getLogFunction(M,R,console.time?console.time:console.info)}},{key:"timeEnd",value:function(M,R){return this._getLogFunction(M,R,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(M,R){return this._getLogFunction(M,R,console.timeStamp||ns)}},{key:"group",value:function(M,R){var ee=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};ee=Ql({logLevel:M,message:R,opts:ee});var ge=ee,rt=ge.collapsed;return ee.method=(rt?console.groupCollapsed:console.group)||console.info,this._getLogFunction(ee)}},{key:"groupCollapsed",value:function(M,R){var ee=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(M,R,Object.assign({},ee,{collapsed:!0}))}},{key:"groupEnd",value:function(M){return this._getLogFunction(M,"",console.groupEnd||ns)}},{key:"withGroup",value:function(M,R,ee){this.group(M,R)();try{ee()}finally{this.groupEnd(M)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(M){return this.isEnabled()&&this.getLevel()>=cu(M)}},{key:"_getLogFunction",value:function(M,R,ee){var ge=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],rt=arguments.length>4?arguments[4]:void 0;if(this._shouldLog(M)){var wt;rt=Ql({logLevel:M,message:R,args:ge,opts:rt}),ee=ee||rt.method,Rl(ee),rt.total=this.getTotal(),rt.delta=this.getDelta(),this._deltaTs=uu();var Et=rt.tag||rt.message;if(rt.once)if(!kl[Et])kl[Et]=uu();else return ns;return R=Nl(this.id,rt.message,rt),(wt=ee).bind.apply(wt,[console,R].concat((0,Ja.Z)(rt.args)))}return ns}},{key:"level",set:function(M){this.setLevel(M)},get:function(){return this.getLevel()}},{key:"priority",set:function(M){this.level=M},get:function(){return this.level}}]),B}();lu.VERSION=qu;function cu(B){if(!B)return 0;var U;switch((0,ha.Z)(B)){case"number":U=B;break;case"object":U=B.logLevel||B.priority||0;break;default:return 0}return Rl(Number.isFinite(U)&&U>=0),U}function Ql(B){var U=B.logLevel,M=B.message;B.logLevel=cu(U);for(var R=B.args?Array.from(B.args):[];R.length&&R.shift()!==M;);switch(B.args=R,(0,ha.Z)(U)){case"string":case"function":M!==void 0&&R.unshift(M),B.message=U;break;case"object":Object.assign(B,U);break;default:}typeof B.message=="function"&&(B.message=B.message());var ee=(0,ha.Z)(B.message);return Rl(ee==="string"||ee==="object"),Object.assign(B,B.opts)}function Nl(B,U,M){if(typeof U=="string"){var R=M.time?Df(Jl(M.total)):"";U=M.time?"".concat(B,": ").concat(R,"  ").concat(U):"".concat(B,": ").concat(U),U=go(U,M.color,M.background)}return U}function pl(B){var U=B.image,M=B.message,R=M===void 0?"":M,ee=B.scale,ge=ee===void 0?1:ee,rt=null;try{rt=y(75307)}catch(wt){}return rt?function(){return rt(U,{fit:"box",width:"".concat(Math.round(80*ge),"%")}).then(function(wt){return console.log(wt)})}:ns}function ql(B){var U=B.image,M=B.message,R=M===void 0?"":M,ee=B.scale,ge=ee===void 0?1:ee;if(typeof U=="string"){var rt=new Image;return rt.onload=function(){var Vr,In=af(rt,R,ge);(Vr=console).log.apply(Vr,(0,Ja.Z)(In))},rt.src=U,ns}var wt=U.nodeName||"";if(wt.toLowerCase()==="img"){var Et;return(Et=console).log.apply(Et,(0,Ja.Z)(af(U,R,ge))),ns}if(wt.toLowerCase()==="canvas"){var vr=new Image;return vr.onload=function(){var Vr;return(Vr=console).log.apply(Vr,(0,Ja.Z)(af(vr,R,ge)))},vr.src=U.toDataURL(),ns}return ns}var qs,is,zl=new lu({id:"L7"}).enable(!1);zl.priority=5;var jc=(qs=(0,G.b2)(),qs(is=function(){function B(){(0,ce.Z)(this,B)}return(0,q.Z)(B,[{key:"error",value:function(M){zl.error(M)()}},{key:"warn",value:function(M){zl.probe(1,M)()}},{key:"info",value:function(M){zl.info(3,M)()}},{key:"debug",value:function(M){zl.probe(4,M)()}}]),B}())||is),dl=y(27973),el=y(35708),ec=y.n(el),Zc=window.document.documentElement.style,tl=0;function Bl(B){var U=B;if(typeof B=="string"&&(U=document.getElementById(B)),U){var M=document.createElement("div");return M.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,M.id="l7-scene-".concat(tl++),M.classList.add("l7-scene"),U.appendChild(M),M}return null}var mc,rl,Vc,lf,cf,Ul,Gc,Hc,gc,nl,Wc,Eu,Ia,jl,wu,Uu,zi,Pa,Ma,tc,Zl,rc,wf,Tf,Vl,ju,Zu,Qa,ys,vl,so,Tn,Ns,nc,ml,eu;function Zs(B){var U=gl();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function gl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var en=(mc=(0,G.b2)(),rl=(0,G.f3)(F.v.SceneID),Vc=(0,G.f3)(F.v.IIconService),lf=(0,G.f3)(F.v.IFontService),cf=(0,G.f3)(F.v.IControlService),Ul=(0,G.f3)(F.v.ILogService),Gc=(0,G.f3)(F.v.IGlobalConfigService),Hc=(0,G.f3)(F.v.IMapService),gc=(0,G.f3)(F.v.ICoordinateSystemService),nl=(0,G.f3)(F.v.IRendererService),Wc=(0,G.f3)(F.v.ILayerService),Eu=(0,G.f3)(F.v.ICameraService),Ia=(0,G.f3)(F.v.IInteractionService),jl=(0,G.f3)(F.v.IPickingService),wu=(0,G.f3)(F.v.IShaderModuleService),Uu=(0,G.f3)(F.v.IMarkerService),zi=(0,G.f3)(F.v.IPopupService),mc(Pa=(Ma=(eu=function(B){(0,Rt.Z)(M,B);var U=Zs(M);function M(){var R;return(0,ce.Z)(this,M),R=U.call(this),R.destroyed=!1,R.loaded=!1,R.loadFont=!1,R.fontFamily="",(0,yr.Z)(R,"id",tc,(0,mi.Z)(R)),(0,yr.Z)(R,"iconService",Zl,(0,mi.Z)(R)),(0,yr.Z)(R,"fontService",rc,(0,mi.Z)(R)),(0,yr.Z)(R,"controlService",wf,(0,mi.Z)(R)),(0,yr.Z)(R,"logger",Tf,(0,mi.Z)(R)),(0,yr.Z)(R,"configService",Vl,(0,mi.Z)(R)),(0,yr.Z)(R,"map",ju,(0,mi.Z)(R)),(0,yr.Z)(R,"coordinateSystemService",Zu,(0,mi.Z)(R)),(0,yr.Z)(R,"rendererService",Qa,(0,mi.Z)(R)),(0,yr.Z)(R,"layerService",ys,(0,mi.Z)(R)),(0,yr.Z)(R,"cameraService",vl,(0,mi.Z)(R)),(0,yr.Z)(R,"interactionService",so,(0,mi.Z)(R)),(0,yr.Z)(R,"pickingService",Tn,(0,mi.Z)(R)),(0,yr.Z)(R,"shaderModuleService",Ns,(0,mi.Z)(R)),(0,yr.Z)(R,"markerService",nc,(0,mi.Z)(R)),(0,yr.Z)(R,"popupService",ml,(0,mi.Z)(R)),R.inited=!1,R.initPromise=void 0,R.rendering=!1,R.$container=void 0,R.canvas=void 0,R.markerContainer=void 0,R.hooks=void 0,R.handleWindowResized=function(){R.emit("resize"),R.$container&&(R.initContainer(),we.SO.triggerResize(),R.coordinateSystemService.needRefresh=!0,R.render())},R.handleMapCameraChanged=function(ee){R.cameraService.update(ee),R.render()},R.hooks={init:new dl.zj},R}return(0,q.Z)(M,[{key:"init",value:function(ee){var ge=this;this.configService.setSceneConfig(this.id,ee),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ga.Z)(oa().mark(function rt(){return oa().wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:return Et.next=2,new Promise(function(vr){ge.map.onCameraChanged(function(Vr){ge.cameraService.init(),ge.cameraService.update(Vr),ge.map.version!=="GAODE2.x"&&vr()}),ge.map.version!=="GAODE2.x"?ge.map.init():vr()});case 2:if(!(ge.map.version==="GAODE2.x"&&ge.map.initViewPort)){Et.next=6;break}return Et.next=5,ge.map.init();case 5:ge.map.initViewPort();case 6:ge.map.onCameraChanged(ge.handleMapCameraChanged),ge.map.addMarkerContainer(),ge.markerService.addMarkers(),ge.markerService.addMarkerLayers(),ge.popupService.initPopup(),ge.interactionService.init(),ge.interactionService.on(Zn.s.Drag,ge.addSceneEvent.bind(ge)),ge.logger.debug("map ".concat(ge.id," loaded"));case 14:case"end":return Et.stop()}},rt)}))),this.hooks.init.tapPromise("initRenderer",(0,Ga.Z)(oa().mark(function rt(){var wt;return oa().wrap(function(vr){for(;;)switch(vr.prev=vr.next){case 0:if(wt=Bl(ge.configService.getSceneConfig(ge.id).id||""),ge.$container=wt,!wt){vr.next=11;break}return ge.canvas=we.SO.create("canvas","",wt),ge.setCanvas(),vr.next=7,ge.rendererService.init(ge.canvas,ge.configService.getSceneConfig(ge.id));case 7:ec()(ge.$container,ge.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(ge.handleWindowResized),vr.next=12;break;case 11:ge.logger.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:ge.pickingService.init(ge.id),ge.logger.debug("scene ".concat(ge.id," renderer loaded"));case 14:case"end":return vr.stop()}},rt)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(ee){this.logger.debug("add layer ".concat(ee.name," to scene ").concat(this.id)),this.layerService.add(ee),this.render()}},{key:"render",value:function(){var R=(0,Ga.Z)(oa().mark(function ge(){return oa().wrap(function(wt){for(;;)switch(wt.prev=wt.next){case 0:if(!(this.rendering||this.destroyed)){wt.next=2;break}return wt.abrupt("return");case 2:if(this.rendering=!0,this.inited){wt.next=16;break}return wt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){wt.next=10;break}return wt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.logger.info(" render inited"),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 16:this.layerService.renderLayers(),this.logger.debug("scene ".concat(this.id," render")),this.rendering=!1;case 19:case"end":return wt.stop()}},ge,this)}));function ee(){return R.apply(this,arguments)}return ee}()},{key:"addFontFace",value:function(ee,ge){this.fontFamily=ee;var rt=document.createElement("style");rt.type="text/css",rt.innerText=`
        @font-face{
            font-family: '`.concat(ee,`';
            src: url('`).concat(ge,`') format('woff2'),
            url('`).concat(ge,`') format('woff'),
            url('`).concat(ge,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(rt),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(ee){var ge,rt=(ge=this.$container)===null||ge===void 0?void 0:ge.getElementsByTagName("canvas")[0];this.render();var wt=ee==="jpg"?rt==null?void 0:rt.toDataURL("image/jpeg"):rt==null?void 0:rt.toDataURL("image/png");return wt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var ee=this.$container.parentElement;ee!==null&&(this.markerContainer=we.SO.create("div","l7-marker-container",ee))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,el.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var ee,ge,rt=we.SO.DPR,wt=((ee=this.$container)===null||ee===void 0?void 0:ee.clientWidth)||400,Et=((ge=this.$container)===null||ge===void 0?void 0:ge.clientHeight)||300,vr=this.canvas;vr&&(vr.width=wt*rt,vr.height=Et*rt,vr.style.width="".concat(wt,"px"),vr.style.height="".concat(Et,"px")),this.rendererService.viewport({x:0,y:0,width:rt*wt,height:rt*Et})}},{key:"setCanvas",value:function(){var ee,ge,rt=we.SO.DPR,wt=((ee=this.$container)===null||ee===void 0?void 0:ee.clientWidth)||400,Et=((ge=this.$container)===null||ge===void 0?void 0:ge.clientHeight)||300,vr=this.canvas;vr.width=wt*rt,vr.height=Et*rt,vr.style.width="".concat(wt,"px"),vr.style.height="".concat(Et,"px")}},{key:"addSceneEvent",value:function(ee){this.emit(ee.type,ee)}}]),M}(b.EventEmitter),eu),tc=(0,qr.Z)(Ma.prototype,"id",[rl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zl=(0,qr.Z)(Ma.prototype,"iconService",[Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rc=(0,qr.Z)(Ma.prototype,"fontService",[lf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wf=(0,qr.Z)(Ma.prototype,"controlService",[cf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tf=(0,qr.Z)(Ma.prototype,"logger",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vl=(0,qr.Z)(Ma.prototype,"configService",[Gc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ju=(0,qr.Z)(Ma.prototype,"map",[Hc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zu=(0,qr.Z)(Ma.prototype,"coordinateSystemService",[gc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qa=(0,qr.Z)(Ma.prototype,"rendererService",[nl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ys=(0,qr.Z)(Ma.prototype,"layerService",[Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vl=(0,qr.Z)(Ma.prototype,"cameraService",[Eu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),so=(0,qr.Z)(Ma.prototype,"interactionService",[Ia],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tn=(0,qr.Z)(Ma.prototype,"pickingService",[jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ns=(0,qr.Z)(Ma.prototype,"shaderModuleService",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nc=(0,qr.Z)(Ma.prototype,"markerService",[Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ml=(0,qr.Z)(Ma.prototype,"popupService",[zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ma))||Pa),Xc=y(44908),yc=y.n(Xc);function Vu(B){var U=0;switch(B){case"vec2":case"ivec2":U=2;break;case"vec3":case"ivec3":U=3;break;case"vec4":case"ivec4":case"mat2":U=4;break;case"mat3":U=9;break;case"mat4":U=16;break;default:}return U}var tu=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Ba(B){var U={};return B=B.replace(tu,function(M,R,ee){var ge=ee.split(":"),rt=ge[0].trim(),wt="";switch(ge.length>1&&(wt=ge[1].trim()),R){case"bool":wt=wt==="true";break;case"float":case"int":wt=Number(wt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":wt?wt=wt.replace("[","").replace("]","").split(",").reduce(function(Et,vr){return Et.push(Number(vr.trim())),Et},[]):wt=new Array(Vu(R)).fill(0);break;default:}return U[rt]=wt,"uniform ".concat(R," ").concat(rt,`;
`)}),{content:B,uniforms:U}}var Tu,Au,Wo;function Cu(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function il(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?Cu(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):Cu(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}var yl="#define PI 3.14159265359",Kc=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,_c=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,ws=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Ts=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,Oi=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Pu=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Xo=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Io=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,_l=/precision\s+(high|low|medium)p\s+float/,Gu=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,ru=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,as=(Tu=(0,G.b2)(),Tu(Au=(Wo=function(){function B(){(0,ce.Z)(this,B),this.moduleCache={},this.rawContentCache={}}return(0,q.Z)(B,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:yl,fs:yl}),this.registerModule("decode",{vs:Kc,fs:""}),this.registerModule("projection",{vs:Xo,fs:""}),this.registerModule("project",{vs:Pu,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Io}),this.registerModule("lighting",{vs:ws,fs:""}),this.registerModule("light",{vs:_c,fs:""}),this.registerModule("picking",{vs:Oi,fs:Ts})}},{key:"registerModule",value:function(M,R){if(!this.rawContentCache[M]){var ee=R.vs,ge=R.fs,rt=R.uniforms,wt=Ba(ee),Et=wt.content,vr=wt.uniforms,Vr=Ba(ge),In=Vr.content,Nn=Vr.uniforms;this.rawContentCache[M]={fs:In,uniforms:il(il(il({},vr),Nn),rt),vs:Et}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(M){var R=this;if(this.moduleCache[M])return this.moduleCache[M];var ee=this.rawContentCache[M].vs,ge=this.rawContentCache[M].fs,rt=this.processModule(ee,[],"vs"),wt=rt.content,Et=rt.includeList,vr=this.processModule(ge,[],"fs"),Vr=vr.content,In=vr.includeList,Nn=Vr,si=yc()(Et.concat(In).concat(M)).reduce(function(Pi,Ei){return il(il({},Pi),R.rawContentCache[Ei].uniforms)},{});return _l.test(Vr)||(Nn=Gu+Vr),this.moduleCache[M]={fs:Nn.trim(),uniforms:si,vs:wt.trim()},this.moduleCache[M]}},{key:"processModule",value:function(M,R,ee){var ge=this,rt=M.replace(ru,function(wt,Et){var vr=Et.split(" "),Vr=vr[0].replace(/"/g,"");if(R.indexOf(Vr)>-1)return"";var In=ge.rawContentCache[Vr][ee];R.push(Vr);var Nn=ge.processModule(In,R,ee),si=Nn.content;return si});return{content:rt,includeList:R}}}]),B}(),Wo))||Au),Mu=y(33202),Bn=y(4951),On,xc,os,bo,Fo,Vs,Gs=(On=(0,G.b2)(),xc=(0,G.f3)(F.v.IShaderModuleService),On(os=(bo=(Vs=function(){function B(){(0,ce.Z)(this,B),(0,yr.Z)(this,"shaderModuleService",Fo,this),this.rendererService=void 0,this.cameraService=void 0,this.mapService=void 0,this.interactionService=void 0,this.layerService=void 0,this.config=void 0}return(0,q.Z)(B,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Bn.G.Normal}},{key:"init",value:function(M,R){this.config=R,this.rendererService=M.getContainer().get(F.v.IRendererService),this.cameraService=M.getContainer().get(F.v.ICameraService),this.mapService=M.getContainer().get(F.v.IMapService),this.interactionService=M.getContainer().get(F.v.IInteractionService),this.layerService=M.getContainer().get(F.v.ILayerService)}},{key:"render",value:function(M){}}]),B}(),Vs),Fo=(0,qr.Z)(bo.prototype,"shaderModuleService",[xc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bo))||os),Gl,$i;function So(B){var U=ff();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function ff(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var xl=(Gl=(0,G.b2)(),Gl($i=function(B){(0,Rt.Z)(M,B);var U=So(M);function M(){return(0,ce.Z)(this,M),U.apply(this,arguments)}return(0,q.Z)(M,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(ee,ge){(0,Mu.Z)((0,w.Z)(M.prototype),"init",this).call(this,ee,ge)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),M}(Gs))||$i),bc,Iu,As,bl,Ou,Sc;function ic(B,U){var M;if(typeof Symbol=="undefined"||B[Symbol.iterator]==null){if(Array.isArray(B)||(M=Ec(B))||U&&B&&typeof B.length=="number"){M&&(B=M);var R=0,ee=function(){};return{s:ee,n:function(){return R>=B.length?{done:!0}:{done:!1,value:B[R++]}},e:function(vr){throw vr},f:ee}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ge=!0,rt=!1,wt;return{s:function(){M=B[Symbol.iterator]()},n:function(){var vr=M.next();return ge=vr.done,vr},e:function(vr){rt=!0,wt=vr},f:function(){try{!ge&&M.return!=null&&M.return()}finally{if(rt)throw wt}}}}function Ec(B,U){if(!!B){if(typeof B=="string")return Yc(B,U);var M=Object.prototype.toString.call(B).slice(8,-1);if(M==="Object"&&B.constructor&&(M=B.constructor.name),M==="Map"||M==="Set")return Array.from(B);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Yc(B,U)}}function Yc(B,U){(U==null||U>B.length)&&(U=B.length);for(var M=0,R=new Array(U);M<U;M++)R[M]=B[M];return R}var ac=(bc=(0,G.b2)(),Iu=(0,G.f3)(F.v.IPostProcessor),bc(As=(bl=(Sc=function(){function B(){(0,ce.Z)(this,B),this.passes=[],(0,yr.Z)(this,"postProcessor",Ou,this),this.layer=void 0,this.renderFlag=void 0,this.width=0,this.height=0}return(0,q.Z)(B,[{key:"setLayer",value:function(M){this.layer=M}},{key:"setRenderFlag",value:function(M){this.renderFlag=M}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var U=(0,Ga.Z)(oa().mark(function R(){var ee,ge,rt;return oa().wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:ee=ic(this.passes),Et.prev=1,ee.s();case 3:if((ge=ee.n()).done){Et.next=9;break}return rt=ge.value,Et.next=7,rt.render(this.layer);case 7:Et.next=3;break;case 9:Et.next=14;break;case 11:Et.prev=11,Et.t0=Et.catch(1),ee.e(Et.t0);case 14:return Et.prev=14,ee.f(),Et.finish(14);case 17:this.layer.renderModels();case 18:case"end":return Et.stop()}},R,this,[[1,11,14,17]])}));function M(){return U.apply(this,arguments)}return M}()},{key:"resize",value:function(M,R){(this.width!==M||this.height!==R)&&(this.width=M,this.height=R)}},{key:"add",value:function(M,R){M.getType()===Bn.G.PostProcessing?this.postProcessor.add(M,this.layer,R):(M.init(this.layer,R),this.passes.push(M))}},{key:"insert",value:function(M,R,ee){M.init(this.layer,R),this.passes.splice(ee,0,M)}},{key:"destroy",value:function(){this.passes.length=0}}]),B}(),Sc),Ou=(0,qr.Z)(bl.prototype,"postProcessor",[Iu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bl))||As),al,wc,ma,Hu,Sl,nu;function Hs(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function Tc(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?Hs(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):Hs(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}function oc(B){var U=hf();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function hf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var $c=(al=(0,G.b2)(),wc=(0,G.f3)(F.v.ILogService),al(ma=(Hu=(nu=function(B){(0,Rt.Z)(M,B);var U=oc(M);function M(){var R;(0,ce.Z)(this,M);for(var ee=arguments.length,ge=new Array(ee),rt=0;rt<ee;rt++)ge[rt]=arguments[rt];return R=U.call.apply(U,[this].concat(ge)),(0,yr.Z)(R,"logger",Sl,(0,mi.Z)(R)),R.pickingFBO=void 0,R.layer=void 0,R.width=0,R.height=0,R.alreadyInRendering=!1,R.pickFromPickingFBO=function(wt){var Et=wt.x,vr=wt.y,Vr=wt.lngLat,In=wt.type;if(!(!R.layer.isVisible()||!R.layer.needPick(In))){var Nn=R.rendererService,si=Nn.getViewportSize,Pi=Nn.readPixels,Ei=Nn.useFramebuffer,pa=si(),wi=pa.width,ja=pa.height,Bo=R.layer.getLayerConfig(),Uo=Bo.enableHighlight,Yo=Bo.enableSelect,fo=Et*we.SO.DPR,Sa=vr*we.SO.DPR;if(!(fo>wi||fo<0||Sa>ja||Sa<0)){var ga;Ei(R.pickingFBO,function(){var wo;if(ga=Pi({x:Math.round(fo),y:Math.round(ja-(vr+1)*we.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:R.pickingFBO}),ga[0]!==0||ga[1]!==0||ga[2]!==0){R.logger.debug("picked");var ho=(0,we.W0)(ga),Za=R.layer.getSource().getFeatureById(ho),$o={x:Et,y:vr,type:In,lngLat:Vr,featureId:ho,feature:Za};Za&&(R.layer.setCurrentPickId(ho),R.triggerHoverOnLayer($o))}else{var Jo={x:Et,y:vr,lngLat:Vr,type:R.layer.getCurrentPickId()===null?"un"+In:"mouseout",featureId:null,feature:null};R.triggerHoverOnLayer(Tc(Tc({},Jo),{},{type:"unpick"})),R.triggerHoverOnLayer(Jo),R.layer.setCurrentPickId(null)}Uo&&R.highlightPickedFeature(ga),Yo&&In==="click"&&((wo=ga)===null||wo===void 0?void 0:wo.toString())!==[0,0,0,0].toString()&&R.selectFeature(ga)})}}},R}return(0,q.Z)(M,[{key:"getType",value:function(){return Bn.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(ee,ge){(0,Mu.Z)((0,w.Z)(M.prototype),"init",this).call(this,ee,ge),this.layer=ee;var rt=this.rendererService,wt=rt.createTexture2D,Et=rt.createFramebuffer,vr=rt.getViewportSize,Vr=vr(),In=Vr.width,Nn=Vr.height;this.pickingFBO=Et({color:wt({width:In,height:Nn,wrapS:qi.gl.CLAMP_TO_EDGE,wrapT:qi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(Zn.s.Hover,this.pickFromPickingFBO),this.interactionService.on(Zn.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Zn.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(ee){var ge=this;if(!this.alreadyInRendering){var rt=this.rendererService,wt=rt.getViewportSize,Et=rt.useFramebuffer,vr=rt.clear,Vr=wt(),In=Vr.width,Nn=Vr.height;this.alreadyInRendering=!0,(this.width!==In||this.height!==Nn)&&(this.pickingFBO.resize({width:In,height:Nn}),this.width=In,this.height=Nn),Et(this.pickingFBO,function(){vr({framebuffer:ge.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var si=ge.layer.multiPassRenderer.getRenderFlag();ge.layer.multiPassRenderer.setRenderFlag(!1),ee.hooks.beforePickingEncode.call(),ee.render(),ee.hooks.afterPickingEncode.call(),ge.layer.multiPassRenderer.setRenderFlag(si),ge.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(ee){this.layer.emit(ee.type,ee)}},{key:"highlightPickedFeature",value:function(ee){var ge=(0,hr.Z)(ee,3),rt=ge[0],wt=ge[1],Et=ge[2];this.layer.hooks.beforeHighlight.call([rt,wt,Et]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(ee){var ge=(0,hr.Z)(ee,3),rt=ge[0],wt=ge[1],Et=ge[2];this.layer.hooks.beforeSelect.call([rt,wt,Et]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(ee){var ge=ee.featureId,rt=(0,we.Z6)(ge);this.selectFeature(new Uint8Array(rt))}},{key:"highlightFeatureHandle",value:function(ee){var ge=ee.featureId,rt=(0,we.Z6)(ge);this.highlightPickedFeature(new Uint8Array(rt))}}]),M}(Gs),nu),Sl=(0,qr.Z)(Hu.prototype,"logger",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hu))||ma),c=y(19525),o,i;function h(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function g(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?h(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):h(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}function E(B){var U=C();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var L=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Z=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ne=(o=(0,G.b2)(),o(i=function(B){(0,Rt.Z)(M,B);var U=E(M);function M(){return(0,ce.Z)(this,M),U.apply(this,arguments)}return(0,q.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Z,fs:L});var ee=this.shaderModuleService.getModule("blur-pass"),ge=ee.vs,rt=ee.fs,wt=ee.uniforms,Et=this.rendererService.getViewportSize(),vr=Et.width,Vr=Et.height;return{vs:ge,fs:rt,uniforms:g(g({},wt),{},{u_ViewportSize:[vr,Vr]})}}},{key:"convertOptionsToUniforms",value:function(ee){var ge={};return Co()(ee.blurRadius)||(ge.u_BlurDir=[ee.blurRadius,0]),ge}}]),M}(c.Z))||i),me,ye;function Se(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function Ye(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?Se(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):Se(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}function Xe(B){var U=ct();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function ct(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var $e=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,tt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,It=(me=(0,G.b2)(),me(ye=function(B){(0,Rt.Z)(M,B);var U=Xe(M);function M(){return(0,ce.Z)(this,M),U.apply(this,arguments)}return(0,q.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:tt,fs:$e});var ee=this.shaderModuleService.getModule("blur-pass"),ge=ee.vs,rt=ee.fs,wt=ee.uniforms,Et=this.rendererService.getViewportSize(),vr=Et.width,Vr=Et.height;return{vs:ge,fs:rt,uniforms:Ye(Ye({},wt),{},{u_ViewportSize:[vr,Vr]})}}},{key:"convertOptionsToUniforms",value:function(ee){var ge={};return Co()(ee.blurRadius)||(ge.u_BlurDir=[0,ee.blurRadius]),ge}}]),M}(c.Z))||ye),Mt,Sr;function nr(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function xr(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?nr(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):nr(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}function Cr(B){var U=an();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function an(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var Xr=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,vn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,An=(Mt=(0,G.b2)(),Mt(Sr=function(B){(0,Rt.Z)(M,B);var U=Cr(M);function M(){return(0,ce.Z)(this,M),U.apply(this,arguments)}return(0,q.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:vn,fs:Xr});var ee=this.shaderModuleService.getModule("colorhalftone-pass"),ge=ee.vs,rt=ee.fs,wt=ee.uniforms,Et=this.rendererService.getViewportSize(),vr=Et.width,Vr=Et.height;return{vs:ge,fs:rt,uniforms:xr(xr({},wt),{},{u_ViewportSize:[vr,Vr]})}}}]),M}(c.Z))||Sr),Xn,Qn;function Ci(B){var U=Ji();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function Ji(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var Sn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,fi=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gi=(Xn=(0,G.b2)(),Xn(Qn=function(B){(0,Rt.Z)(M,B);var U=Ci(M);function M(){return(0,ce.Z)(this,M),U.apply(this,arguments)}return(0,q.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:fi,fs:Sn}),this.shaderModuleService.getModule("copy-pass")}}]),M}(c.Z))||Qn),Un,di;function Kn(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function Si(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?Kn(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):Kn(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}function Gi(B){var U=yo();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function yo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var uo=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Oo=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ua=(Un=(0,G.b2)(),Un(di=function(B){(0,Rt.Z)(M,B);var U=Gi(M);function M(){return(0,ce.Z)(this,M),U.apply(this,arguments)}return(0,q.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Oo,fs:uo});var ee=this.shaderModuleService.getModule("hexagonalpixelate-pass"),ge=ee.vs,rt=ee.fs,wt=ee.uniforms,Et=this.rendererService.getViewportSize(),vr=Et.width,Vr=Et.height;return{vs:ge,fs:rt,uniforms:Si(Si({},wt),{},{u_ViewportSize:[vr,Vr]})}}}]),M}(c.Z))||di),Xa,Cs;function Ko(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function Wu(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?Ko(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):Ko(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}function Lu(B){var U=ss();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function ss(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var zs=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,El=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ac=(Xa=(0,G.b2)(),Xa(Cs=function(B){(0,Rt.Z)(M,B);var U=Lu(M);function M(){return(0,ce.Z)(this,M),U.apply(this,arguments)}return(0,q.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:El,fs:zs});var ee=this.shaderModuleService.getModule("ink-pass"),ge=ee.vs,rt=ee.fs,wt=ee.uniforms,Et=this.rendererService.getViewportSize(),vr=Et.width,Vr=Et.height;return{vs:ge,fs:rt,uniforms:Wu(Wu({},wt),{},{u_ViewportSize:[vr,Vr]})}}}]),M}(c.Z))||Cs),Ru,ol;function Hl(B){var U=Du();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function Du(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var sc=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,fu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lo=(Ru=(0,G.b2)(),Ru(ol=function(B){(0,Rt.Z)(M,B);var U=Hl(M);function M(){return(0,ce.Z)(this,M),U.apply(this,arguments)}return(0,q.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:fu,fs:sc}),this.shaderModuleService.getModule("noise-pass")}}]),M}(c.Z))||ol),hu,wl;function Ps(B){var U=Eo();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function Eo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var No=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Lo=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,us=(hu=(0,G.b2)(),hu(wl=function(B){(0,Rt.Z)(M,B);var U=Ps(M);function M(){return(0,ce.Z)(this,M),U.apply(this,arguments)}return(0,q.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:No,fs:Lo}),this.shaderModuleService.getModule("sepia-pass")}}]),M}(c.Z))||wl),Ro,Ws,Tl,uc,Xu,ku,Cc,Al=(Ro=(0,G.b2)(),Ws=(0,G.f3)(F.v.IRendererService),Tl=(0,G.zY)(),Ro(uc=(Xu=(Cc=function(){function B(){(0,ce.Z)(this,B),(0,yr.Z)(this,"rendererService",ku,this),this.passes=[],this.readFBO=void 0,this.writeFBO=void 0}return(0,q.Z)(B,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var U=(0,Ga.Z)(oa().mark(function R(ee){var ge,rt;return oa().wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:ge=0;case 1:if(!(ge<this.passes.length)){Et.next=10;break}return rt=this.passes[ge],rt.setRenderToScreen(this.isLastEnabledPass(ge)),Et.next=6,rt.render(ee);case 6:ge!==this.passes.length-1&&this.swap();case 7:ge++,Et.next=1;break;case 10:case"end":return Et.stop()}},R,this)}));function M(R){return U.apply(this,arguments)}return M}()},{key:"resize",value:function(M,R){this.readFBO.resize({width:M,height:R}),this.writeFBO.resize({width:M,height:R})}},{key:"add",value:function(M,R,ee){M.init(R,ee),this.passes.push(M)}},{key:"insert",value:function(M,R,ee,ge){M.init(ee,ge),this.passes.splice(R,0,M)}},{key:"getPostProcessingPassByName",value:function(M){return this.passes.find(function(R){return R.getName()===M})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(M){for(var R=M+1;R<this.passes.length;R++)if(this.passes[R].isEnabled())return!1;return!0}},{key:"swap",value:function(){var M=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=M}}]),B}(),Cc),ku=(0,qr.Z)(Xu.prototype,"rendererService",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,qr.Z)(Xu.prototype,"init",[Tl],Object.getOwnPropertyDescriptor(Xu.prototype,"init"),Xu.prototype),Xu))||uc),Ms,zo;function xh(B){var U=Jf();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function Jf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var Qf=(Ms=(0,G.b2)(),Ms(zo=function(B){(0,Rt.Z)(M,B);var U=xh(M);function M(){return(0,ce.Z)(this,M),U.apply(this,arguments)}return(0,q.Z)(M,[{key:"getType",value:function(){return Bn.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(ee,ge){(0,Mu.Z)((0,w.Z)(M.prototype),"init",this).call(this,ee,ge)}},{key:"render",value:function(ee){var ge=this.rendererService,rt=ge.useFramebuffer,wt=ge.clear;rt(null,function(){wt({color:[0,0,0,0],depth:1,stencil:0}),ee.multiPassRenderer.setRenderFlag(!1),ee.render(),ee.multiPassRenderer.setRenderFlag(!0)})}}]),M}(Gs))||zo),Ff,Af,Jc,Wl,Cf,Qc,Nf,Cl;function qc(B,U){var M=Object.keys(B);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(B);U&&(R=R.filter(function(ee){return Object.getOwnPropertyDescriptor(B,ee).enumerable})),M.push.apply(M,R)}return M}function zf(B){for(var U=1;U<arguments.length;U++){var M=arguments[U]!=null?arguments[U]:{};U%2?qc(Object(M),!0).forEach(function(R){(0,te.Z)(B,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(M)):qc(Object(M)).forEach(function(R){Object.defineProperty(B,R,Object.getOwnPropertyDescriptor(M,R))})}return B}function bh(B){var U=qf();return function(){var R=(0,w.Z)(B),ee;if(U){var ge=(0,w.Z)(this).constructor;ee=Reflect.construct(R,arguments,ge)}else ee=R.apply(this,arguments);return(0,jt.Z)(this,ee)}}function qf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var eh=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Bf=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,th=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function rh(B,U){for(var M=0,R=1/U,ee=B;ee>0;)M=M+R*(ee%U),ee=Math.floor(ee/U),R=R/U;return M}var Uf=1,Sh=(Ff=(0,G.b2)(),Af=(0,G.f3)(F.v.IShaderModuleService),Jc=(0,G.f3)(F.v.ILogService),Ff(Wl=(Cf=(Cl=function(B){(0,Rt.Z)(M,B);var U=bh(M);function M(){var R;(0,ce.Z)(this,M);for(var ee=arguments.length,ge=new Array(ee),rt=0;rt<ee;rt++)ge[rt]=arguments[rt];return R=U.call.apply(U,[this].concat(ge)),(0,yr.Z)(R,"shaderModuleService",Qc,(0,mi.Z)(R)),(0,yr.Z)(R,"logger",Nf,(0,mi.Z)(R)),R.haltonSequence=[],R.accumulatingId=0,R.frame=0,R.timer=void 0,R.sampleRenderTarget=void 0,R.prevRenderTarget=void 0,R.outputRenderTarget=void 0,R.copyRenderTarget=void 0,R.blendModel=void 0,R.outputModel=void 0,R.copyModel=void 0,R}return(0,q.Z)(M,[{key:"getType",value:function(){return Bn.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(ee,ge){(0,Mu.Z)((0,w.Z)(M.prototype),"init",this).call(this,ee,ge);var rt=this.rendererService,wt=rt.createFramebuffer,Et=rt.createTexture2D;this.sampleRenderTarget=wt({color:Et({width:1,height:1,wrapS:qi.gl.CLAMP_TO_EDGE,wrapT:qi.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=wt({color:Et({width:1,height:1,wrapS:qi.gl.CLAMP_TO_EDGE,wrapT:qi.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=wt({color:Et({width:1,height:1,wrapS:qi.gl.CLAMP_TO_EDGE,wrapT:qi.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=wt({color:Et({width:1,height:1,wrapS:qi.gl.CLAMP_TO_EDGE,wrapT:qi.gl.CLAMP_TO_EDGE})});for(var vr=0;vr<30;vr++)this.haltonSequence.push([rh(vr,2),rh(vr,3)]);this.blendModel=this.createTriangleModel("blend-pass",eh),this.outputModel=this.createTriangleModel("copy-pass",Bf,{blend:{enable:!0,func:{srcRGB:qi.gl.ONE,dstRGB:qi.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:qi.gl.ONE,dstAlpha:qi.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:qi.gl.FUNC_ADD,alpha:qi.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Bf)}},{key:"render",value:function(ee){var ge=this,rt=this.rendererService,wt=rt.clear,Et=rt.getViewportSize,vr=rt.useFramebuffer,Vr=Et(),In=Vr.width,Nn=Vr.height;this.sampleRenderTarget.resize({width:In,height:Nn}),this.prevRenderTarget.resize({width:In,height:Nn}),this.outputRenderTarget.resize({width:In,height:Nn}),this.copyRenderTarget.resize({width:In,height:Nn}),this.resetFrame(),this.stopAccumulating();var si=ee.multiPassRenderer.getPostProcessor().getReadFBO();vr(si,function(){wt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:si}),ee.multiPassRenderer.setRenderFlag(!1),ee.render(),ee.multiPassRenderer.setRenderFlag(!0)});var Pi=function Ei(pa){!ge.accumulatingId||pa!==ge.accumulatingId||ge.isFinished()||(ge.doRender(ee),requestAnimationFrame(function(){Ei(pa)}))};this.accumulatingId=Uf++,this.timer=window.setTimeout(function(){Pi(ge.accumulatingId)},50)}},{key:"doRender",value:function(ee){var ge=this;this.logger.debug("accumulatingId: ".concat(this.accumulatingId));var rt=this.rendererService,wt=rt.clear,Et=rt.getViewportSize,vr=rt.useFramebuffer,Vr=Et(),In=Vr.width,Nn=Vr.height,si=ee.getLayerConfig(),Pi=si.jitterScale,Ei=Pi===void 0?1:Pi,pa=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((pa[0]*2-1)/In*Ei,(pa[1]*2-1)/Nn*Ei),ee.multiPassRenderer.setRenderFlag(!1),ee.hooks.beforeRender.call(),vr(this.sampleRenderTarget,function(){wt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:ge.sampleRenderTarget}),ee.render()}),ee.hooks.afterRender.call(),ee.multiPassRenderer.setRenderFlag(!0);var wi=ee.getLayerConfig();vr(this.outputRenderTarget,function(){ge.blendModel.draw({uniforms:{u_opacity:wi.opacity||1,u_MixRatio:ge.frame===0?1:.9,u_Diffuse1:ge.sampleRenderTarget,u_Diffuse2:ge.frame===0?ee.multiPassRenderer.getPostProcessor().getReadFBO():ge.prevRenderTarget}})}),this.frame===0&&wt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(vr(this.copyRenderTarget,function(){ge.outputModel.draw({uniforms:{u_Texture:ge.outputRenderTarget}})}),vr(ee.multiPassRenderer.getPostProcessor().getReadFBO(),function(){ge.copyModel.draw({uniforms:{u_Texture:ge.copyRenderTarget}})}),ee.multiPassRenderer.getPostProcessor().render(ee));var ja=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ja,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(ee,ge,rt){this.shaderModuleService.registerModule(ee,{vs:th,fs:ge});var wt=this.shaderModuleService.getModule(ee),Et=wt.vs,vr=wt.fs,Vr=wt.uniforms,In=this.rendererService,Nn=In.createAttribute,si=In.createBuffer,Pi=In.createModel;return Pi(zf({vs:Et,fs:vr,attributes:{a_Position:Nn({buffer:si({data:[-4,-4,4,-4,0,4],type:qi.gl.FLOAT}),size:2})},uniforms:zf({},Vr),depth:{enable:!1},count:3},rt))}}]),M}(Gs),Cl),Qc=(0,qr.Z)(Cf.prototype,"shaderModuleService",[Af],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nf=(0,qr.Z)(Cf.prototype,"logger",[Jc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cf))||Wl),pu=new G.W2;pu.bind(F.v.IGlobalConfigService).to($t).inSingletonScope(),pu.bind(F.v.IShaderModuleService).to(as).inSingletonScope(),pu.bind(F.v.ILogService).to(jc).inSingletonScope(),(0,G.GW)((0,G.b2)(),b.EventEmitter),pu.bind(F.v.IEventEmitter).to(b.EventEmitter);var pf=(0,S.Z)(pu,!1),co=function(U){var M=pf.lazyInject(U);return function(R,ee,ge){M.call(this,R,ee),ge&&(ge.initializer=function(){return R[ee]})}},Pc=function(U){var M=pf.lazyMultiInject(U);return function(R,ee,ge){M.call(this,R,ee),ge&&(ge.initializer=function(){return R[ee]})}},Pf=pu,Mc=0;function lc(){var B=new G.W2;return B.parent=pu,B.bind(F.v.SceneID).toConstantValue("".concat(Mc++)),B.bind(F.v.ILayerService).to(xa).inSingletonScope(),B.bind(F.v.ISceneService).to(en).inSingletonScope(),B.bind(F.v.ICameraService).to(gt).inSingletonScope(),B.bind(F.v.ICoordinateSystemService).to(Wi).inSingletonScope(),B.bind(F.v.IInteractionService).to(aa).inSingletonScope(),B.bind(F.v.IPickingService).to(Wa).inSingletonScope(),B.bind(F.v.IControlService).to(sr).inSingletonScope(),B.bind(F.v.IMarkerService).to(vi).inSingletonScope(),B.bind(F.v.IIconService).to(Kt).inSingletonScope(),B.bind(F.v.IFontService).to(ot).inSingletonScope(),B.bind(F.v.IPopupService).to($).inSingletonScope(),B.bind(F.v.INormalPass).to(xl).whenTargetNamed("clear"),B.bind(F.v.INormalPass).to($c).whenTargetNamed("pixelPicking"),B.bind(F.v.INormalPass).to(Qf).whenTargetNamed("render"),B.bind(F.v.INormalPass).to(Sh).whenTargetNamed("taa"),B.bind(F.v.IFactoryNormalPass).toFactory(function(U){return function(M){return U.container.getNamed(F.v.INormalPass,M)}}),B.bind(F.v.IPostProcessingPass).to(gi).whenTargetNamed("copy"),B.bind(F.v.IPostProcessingPass).to(ne).whenTargetNamed("blurH"),B.bind(F.v.IPostProcessingPass).to(It).whenTargetNamed("blurV"),B.bind(F.v.IPostProcessingPass).to(lo).whenTargetNamed("noise"),B.bind(F.v.IPostProcessingPass).to(us).whenTargetNamed("sepia"),B.bind(F.v.IPostProcessingPass).to(An).whenTargetNamed("colorHalftone"),B.bind(F.v.IPostProcessingPass).to(Ua).whenTargetNamed("hexagonalPixelate"),B.bind(F.v.IPostProcessingPass).to(Ac).whenTargetNamed("ink"),B.bind(F.v.IFactoryPostProcessingPass).toFactory(function(U){return function(M){var R=U.container.getNamed(F.v.IPostProcessingPass,M);return R.setName(M),R}}),B}function Xl(B){var U=new G.W2;return U.parent=B,U.bind(F.v.IStyleAttributeService).to(ks).inSingletonScope(),U.bind(F.v.IMultiPassRenderer).to(ac).inSingletonScope(),U.bind(F.v.IPostProcessor).to(Al).inSingletonScope(),U}},48700:function(){},16488:function(){},3244:function(_t,O,y){"use strict";y.d(O,{l:function(){return V}});var V={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},10273:function(_t,O,y){"use strict";y.d(O,{d:function(){return V}});var V;(function(b){b.TOPRIGHT="topright",b.TOPLEFT="topleft",b.BOTTOMRIGHT="bottomright",b.BOTTOMLEFT="bottomleft"})(V||(V={}))},98810:function(){},23990:function(){},64906:function(){},45953:function(_t,O,y){"use strict";y.d(O,{l:function(){return V},k:function(){return b}});var V;(function(p){p[p.LNGLAT=1]="LNGLAT",p[p.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",p[p.VECTOR_TILE=3]="VECTOR_TILE",p[p.IDENTITY=4]="IDENTITY",p[p.P20=5]="P20",p[p.P20_OFFSET=6]="P20_OFFSET",p[p.METER_OFFSET=7]="METER_OFFSET",p[p.P20_2=8]="P20_2"})(V||(V={}));var b={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},15211:function(_t,O,y){"use strict";y.d(O,{s:function(){return V}});var V;(function(b){b.Hover="hover",b.Click="click",b.Select="select",b.Active="active",b.Drag="drag"})(V||(V={}))},90671:function(){},28095:function(_t,O,y){"use strict";y.d(O,{h:function(){return V}});var V;(function(b){b.normal="normal",b.additive="additive",b.subtractive="subtractive",b.min="min",b.max="max",b.none="none"})(V||(V={}))},98842:function(_t,O,y){"use strict";y.d(O,{vY:function(){return V},ee:function(){return b},GC:function(){return p}});var V;(function(G){G.LINEAR="linear",G.POWER="power",G.LOG="log",G.IDENTITY="identity",G.TIME="time",G.QUANTILE="quantile",G.QUANTIZE="quantize",G.THRESHOLD="threshold",G.CAT="cat"})(V||(V={}));var b;(function(G){G.CONSTANT="constant",G.VARIABLE="variable"})(b||(b={}));var p;(function(G){G[G.Attribute=0]="Attribute",G[G.InstancedAttribute=1]="InstancedAttribute",G[G.Uniform=2]="Uniform"})(p||(p={}))},47822:function(){},53848:function(_t,O,y){"use strict";y.d(O,{I:function(){return V}});var V=["mapload"]},77869:function(){},17239:function(){},79357:function(){},24054:function(){},41139:function(){},4951:function(_t,O,y){"use strict";y.d(O,{G:function(){return V}});var V;(function(b){b.Normal="normal",b.PostProcessing="post-processing"})(V||(V={}))},74173:function(){},66388:function(){},62188:function(){},75613:function(){},28725:function(_t,O,y){"use strict";y.d(O,{gl:function(){return V}});var V;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",b[b.POINTS=0]="POINTS",b[b.LINES=1]="LINES",b[b.LINE_LOOP=2]="LINE_LOOP",b[b.LINE_STRIP=3]="LINE_STRIP",b[b.TRIANGLES=4]="TRIANGLES",b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN",b[b.ZERO=0]="ZERO",b[b.ONE=1]="ONE",b[b.SRC_COLOR=768]="SRC_COLOR",b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",b[b.SRC_ALPHA=770]="SRC_ALPHA",b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",b[b.DST_ALPHA=772]="DST_ALPHA",b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",b[b.DST_COLOR=774]="DST_COLOR",b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",b[b.FUNC_ADD=32774]="FUNC_ADD",b[b.BLEND_EQUATION=32777]="BLEND_EQUATION",b[b.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",b[b.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",b[b.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",b[b.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",b[b.MAX_EXT=32776]="MAX_EXT",b[b.MIN_EXT=32775]="MIN_EXT",b[b.BLEND_DST_RGB=32968]="BLEND_DST_RGB",b[b.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",b[b.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",b[b.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR",b[b.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",b[b.BLEND_COLOR=32773]="BLEND_COLOR",b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER",b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",b[b.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",b[b.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",b[b.STREAM_DRAW=35040]="STREAM_DRAW",b[b.STATIC_DRAW=35044]="STATIC_DRAW",b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",b[b.BUFFER_SIZE=34660]="BUFFER_SIZE",b[b.BUFFER_USAGE=34661]="BUFFER_USAGE",b[b.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",b[b.FRONT=1028]="FRONT",b[b.BACK=1029]="BACK",b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK",b[b.CULL_FACE=2884]="CULL_FACE",b[b.BLEND=3042]="BLEND",b[b.DITHER=3024]="DITHER",b[b.STENCIL_TEST=2960]="STENCIL_TEST",b[b.DEPTH_TEST=2929]="DEPTH_TEST",b[b.SCISSOR_TEST=3089]="SCISSOR_TEST",b[b.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",b[b.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",b[b.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",b[b.NO_ERROR=0]="NO_ERROR",b[b.INVALID_ENUM=1280]="INVALID_ENUM",b[b.INVALID_VALUE=1281]="INVALID_VALUE",b[b.INVALID_OPERATION=1282]="INVALID_OPERATION",b[b.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",b[b.CW=2304]="CW",b[b.CCW=2305]="CCW",b[b.LINE_WIDTH=2849]="LINE_WIDTH",b[b.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",b[b.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",b[b.CULL_FACE_MODE=2885]="CULL_FACE_MODE",b[b.FRONT_FACE=2886]="FRONT_FACE",b[b.DEPTH_RANGE=2928]="DEPTH_RANGE",b[b.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",b[b.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",b[b.DEPTH_FUNC=2932]="DEPTH_FUNC",b[b.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",b[b.STENCIL_FUNC=2962]="STENCIL_FUNC",b[b.STENCIL_FAIL=2964]="STENCIL_FAIL",b[b.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",b[b.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",b[b.STENCIL_REF=2967]="STENCIL_REF",b[b.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",b[b.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",b[b.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",b[b.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",b[b.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",b[b.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",b[b.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",b[b.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",b[b.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",b[b.VIEWPORT=2978]="VIEWPORT",b[b.SCISSOR_BOX=3088]="SCISSOR_BOX",b[b.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",b[b.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",b[b.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",b[b.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",b[b.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",b[b.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",b[b.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",b[b.RED_BITS=3410]="RED_BITS",b[b.GREEN_BITS=3411]="GREEN_BITS",b[b.BLUE_BITS=3412]="BLUE_BITS",b[b.ALPHA_BITS=3413]="ALPHA_BITS",b[b.DEPTH_BITS=3414]="DEPTH_BITS",b[b.STENCIL_BITS=3415]="STENCIL_BITS",b[b.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",b[b.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",b[b.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",b[b.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",b[b.SAMPLES=32937]="SAMPLES",b[b.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",b[b.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",b[b.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",b[b.DONT_CARE=4352]="DONT_CARE",b[b.FASTEST=4353]="FASTEST",b[b.NICEST=4354]="NICEST",b[b.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",b[b.BYTE=5120]="BYTE",b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",b[b.SHORT=5122]="SHORT",b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",b[b.INT=5124]="INT",b[b.UNSIGNED_INT=5125]="UNSIGNED_INT",b[b.FLOAT=5126]="FLOAT",b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",b[b.ALPHA=6406]="ALPHA",b[b.RGB=6407]="RGB",b[b.RGBA=6408]="RGBA",b[b.LUMINANCE=6409]="LUMINANCE",b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",b[b.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",b[b.VERTEX_SHADER=35633]="VERTEX_SHADER",b[b.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",b[b.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",b[b.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",b[b.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",b[b.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",b[b.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",b[b.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",b[b.SHADER_TYPE=35663]="SHADER_TYPE",b[b.DELETE_STATUS=35712]="DELETE_STATUS",b[b.LINK_STATUS=35714]="LINK_STATUS",b[b.VALIDATE_STATUS=35715]="VALIDATE_STATUS",b[b.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",b[b.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",b[b.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",b[b.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",b[b.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",b[b.NEVER=512]="NEVER",b[b.LESS=513]="LESS",b[b.EQUAL=514]="EQUAL",b[b.LEQUAL=515]="LEQUAL",b[b.GREATER=516]="GREATER",b[b.NOTEQUAL=517]="NOTEQUAL",b[b.GEQUAL=518]="GEQUAL",b[b.ALWAYS=519]="ALWAYS",b[b.KEEP=7680]="KEEP",b[b.REPLACE=7681]="REPLACE",b[b.INCR=7682]="INCR",b[b.DECR=7683]="DECR",b[b.INVERT=5386]="INVERT",b[b.INCR_WRAP=34055]="INCR_WRAP",b[b.DECR_WRAP=34056]="DECR_WRAP",b[b.VENDOR=7936]="VENDOR",b[b.RENDERER=7937]="RENDERER",b[b.VERSION=7938]="VERSION",b[b.NEAREST=9728]="NEAREST",b[b.LINEAR=9729]="LINEAR",b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",b[b.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",b[b.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",b[b.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",b[b.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",b[b.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",b[b.TEXTURE_2D=3553]="TEXTURE_2D",b[b.TEXTURE=5890]="TEXTURE",b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",b[b.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",b[b.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",b[b.TEXTURE0=33984]="TEXTURE0",b[b.TEXTURE1=33985]="TEXTURE1",b[b.TEXTURE2=33986]="TEXTURE2",b[b.TEXTURE3=33987]="TEXTURE3",b[b.TEXTURE4=33988]="TEXTURE4",b[b.TEXTURE5=33989]="TEXTURE5",b[b.TEXTURE6=33990]="TEXTURE6",b[b.TEXTURE7=33991]="TEXTURE7",b[b.TEXTURE8=33992]="TEXTURE8",b[b.TEXTURE9=33993]="TEXTURE9",b[b.TEXTURE10=33994]="TEXTURE10",b[b.TEXTURE11=33995]="TEXTURE11",b[b.TEXTURE12=33996]="TEXTURE12",b[b.TEXTURE13=33997]="TEXTURE13",b[b.TEXTURE14=33998]="TEXTURE14",b[b.TEXTURE15=33999]="TEXTURE15",b[b.TEXTURE16=34e3]="TEXTURE16",b[b.TEXTURE17=34001]="TEXTURE17",b[b.TEXTURE18=34002]="TEXTURE18",b[b.TEXTURE19=34003]="TEXTURE19",b[b.TEXTURE20=34004]="TEXTURE20",b[b.TEXTURE21=34005]="TEXTURE21",b[b.TEXTURE22=34006]="TEXTURE22",b[b.TEXTURE23=34007]="TEXTURE23",b[b.TEXTURE24=34008]="TEXTURE24",b[b.TEXTURE25=34009]="TEXTURE25",b[b.TEXTURE26=34010]="TEXTURE26",b[b.TEXTURE27=34011]="TEXTURE27",b[b.TEXTURE28=34012]="TEXTURE28",b[b.TEXTURE29=34013]="TEXTURE29",b[b.TEXTURE30=34014]="TEXTURE30",b[b.TEXTURE31=34015]="TEXTURE31",b[b.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",b[b.REPEAT=10497]="REPEAT",b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",b[b.FLOAT_VEC2=35664]="FLOAT_VEC2",b[b.FLOAT_VEC3=35665]="FLOAT_VEC3",b[b.FLOAT_VEC4=35666]="FLOAT_VEC4",b[b.INT_VEC2=35667]="INT_VEC2",b[b.INT_VEC3=35668]="INT_VEC3",b[b.INT_VEC4=35669]="INT_VEC4",b[b.BOOL=35670]="BOOL",b[b.BOOL_VEC2=35671]="BOOL_VEC2",b[b.BOOL_VEC3=35672]="BOOL_VEC3",b[b.BOOL_VEC4=35673]="BOOL_VEC4",b[b.FLOAT_MAT2=35674]="FLOAT_MAT2",b[b.FLOAT_MAT3=35675]="FLOAT_MAT3",b[b.FLOAT_MAT4=35676]="FLOAT_MAT4",b[b.SAMPLER_2D=35678]="SAMPLER_2D",b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE",b[b.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",b[b.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",b[b.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",b[b.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",b[b.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",b[b.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",b[b.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",b[b.COMPILE_STATUS=35713]="COMPILE_STATUS",b[b.LOW_FLOAT=36336]="LOW_FLOAT",b[b.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",b[b.HIGH_FLOAT=36338]="HIGH_FLOAT",b[b.LOW_INT=36339]="LOW_INT",b[b.MEDIUM_INT=36340]="MEDIUM_INT",b[b.HIGH_INT=36341]="HIGH_INT",b[b.FRAMEBUFFER=36160]="FRAMEBUFFER",b[b.RENDERBUFFER=36161]="RENDERBUFFER",b[b.RGBA4=32854]="RGBA4",b[b.RGB5_A1=32855]="RGB5_A1",b[b.RGB565=36194]="RGB565",b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",b[b.STENCIL_INDEX=6401]="STENCIL_INDEX",b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8",b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL",b[b.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",b[b.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",b[b.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",b[b.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",b[b.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",b[b.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",b[b.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",b[b.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",b[b.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",b[b.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",b[b.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",b[b.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",b[b.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",b[b.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",b[b.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",b[b.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",b[b.NONE=0]="NONE",b[b.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",b[b.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",b[b.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",b[b.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",b[b.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",b[b.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",b[b.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",b[b.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",b[b.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",b[b.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",b[b.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",b[b.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",b[b.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",b[b.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(V||(V={}))},19525:function(_t,O,y){"use strict";y.d(O,{Z:function(){return yt}});var V=y(4763),b=y(17912),p=y(96285),G=y(76553),S=y(25882),F=y(11700),te=y.n(F),ce=y(14293),q=y.n(ce),we=y(68929),Pe=y.n(we),Be=y(62141),Oe=y(13252),Nt=y(90200),Xt=y(4951),Bt,Qe,xt,nt,cr,At;function Gt(Me,Te){var Ie=Object.keys(Me);if(Object.getOwnPropertySymbols){var bt=Object.getOwnPropertySymbols(Me);Te&&(bt=bt.filter(function(tr){return Object.getOwnPropertyDescriptor(Me,tr).enumerable})),Ie.push.apply(Ie,bt)}return Ie}function St(Me){for(var Te=1;Te<arguments.length;Te++){var Ie=arguments[Te]!=null?arguments[Te]:{};Te%2?Gt(Object(Ie),!0).forEach(function(bt){(0,V.Z)(Me,bt,Ie[bt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Me,Object.getOwnPropertyDescriptors(Ie)):Gt(Object(Ie)).forEach(function(bt){Object.defineProperty(Me,bt,Object.getOwnPropertyDescriptor(Ie,bt))})}return Me}var Ze=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yt=(Bt=(0,Be.b2)(),Qe=(0,Be.f3)(Nt.v.IShaderModuleService),Bt(xt=(nt=(At=function(){function Me(){(0,p.Z)(this,Me),(0,b.Z)(this,"shaderModuleService",cr,this),this.rendererService=void 0,this.config=void 0,this.quad=Ze,this.enabled=!0,this.renderToScreen=!1,this.model=void 0,this.name=void 0,this.optionsToUpdate={}}return(0,G.Z)(Me,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(Ie){this.name=Ie}},{key:"getType",value:function(){return Xt.G.PostProcessing}},{key:"init",value:function(Ie,bt){this.config=bt,this.rendererService=Ie.getContainer().get(Nt.v.IRendererService);var tr=this.rendererService,ae=tr.createAttribute,Ee=tr.createBuffer,le=tr.createModel,Q=this.setupShaders(),re=Q.vs,ke=Q.fs,qe=Q.uniforms;this.model=le({vs:re,fs:ke,attributes:{a_Position:ae({buffer:Ee({data:[-4,-4,4,-4,0,4],type:Oe.gl.FLOAT}),size:2})},uniforms:St(St({u_Texture:null},qe),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(Ie){var bt=this,tr=Ie.multiPassRenderer.getPostProcessor(),ae=this.rendererService,Ee=ae.useFramebuffer,le=ae.getViewportSize,Q=ae.clear,re=le(),ke=re.width,qe=re.height;Ee(this.renderToScreen?null:tr.getWriteFBO(),function(){Q({framebuffer:tr.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),bt.model.draw({uniforms:St({u_Texture:tr.getReadFBO(),u_ViewportSize:[ke,qe]},bt.convertOptionsToUniforms(bt.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(Ie){this.enabled=Ie}},{key:"setRenderToScreen",value:function(Ie){this.renderToScreen=Ie}},{key:"updateOptions",value:function(Ie){this.optionsToUpdate=St(St({},this.optionsToUpdate),Ie)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(Ie){var bt={};return Object.keys(Ie).forEach(function(tr){q()(Ie[tr])||(bt["u_".concat(te()(Pe()(tr)))]=Ie[tr])}),bt}}]),Me}(),At),cr=(0,S.Z)(nt.prototype,"shaderModuleService",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nt))||xt)},13199:function(_t,O,y){"use strict";y.d(O,{P:function(){return V}});var V=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},26494:function(){},47926:function(){},90200:function(_t,O,y){"use strict";y.d(O,{v:function(){return V}});var V={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),ILogService:Symbol.for("ILogService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},98886:function(_t,O,y){"use strict";var V=y(74691),b=null;function p(Me){return b.indexOf(Me)}var G=2,S=4,F=64,te=128,ce=256,q=512,we=8192,Pe=16384,Be=32768,Oe=null,Nt=131072,Xt=262144,Bt=524288,Qe=1048576,xt=2097152,nt=4194304,cr=8388608,At=16777216,Gt=null;function St(Me,Te){return Me=_clamp(Math.floor(Me),0,255),Te=_clamp(Math.floor(Te),0,255),256*Me+Te}function Ze(Me){var Te=Me.color,Ie=Me.radius,bt=Me.tileX,tr=Me.tileY,ae=Me.shape,Ee=Me.opacity,le=Me.stroke,Q=Me.strokeWidth,re=Me.strokeOpacity,ke=[],qe=[],Wt=[],Or=[St(Te[0],Te[1]),St(Te[2],Te[3])],wr=[St(le[0],le[1]),St(le[2],le[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Nr){var Vt=_slicedToArray(Nr,2),se=Vt[0],_e=Vt[1];ke.push([].concat(Or,[(se+1)*cr+(_e+1)*xt+getShapeIndex(ae)*Nt+Ie,(bt+512)*Bt+(tr+512)*F])),qe.push([].concat(wr,[Q,re])),Wt.push([Ee,0,0,0])}),{packedBuffer:ke,packedBuffer2:qe,packedBuffer3:Wt}}function yt(Me,Te){if(Me===0&&!Te)return 0;if(Me===1&&Te)return 4294967295;var Ie=Te?1:0,bt=Math.floor(Me*127);return bt*Gt+Ie*At+bt*Nt+Ie*Oe+bt*q+Ie*ce+bt*G+Ie}},48209:function(_t,O,y){"use strict";y.d(O,{zP:function(){return P1},JE:function(){return R0},ns:function(){return C1}});var V={};y.r(V),y.d(V,{add:function(){return Zc},angle:function(){return Zu},bezier:function(){return Ma},ceil:function(){return rl},clone:function(){return zl},copy:function(){return el},create:function(){return is},cross:function(){return Uu},dist:function(){return ml},distance:function(){return gc},div:function(){return nc},divide:function(){return mc},dot:function(){return wu},equals:function(){return so},exactEquals:function(){return vl},floor:function(){return Vc},forEach:function(){return en},fromValues:function(){return dl},hermite:function(){return Pa},inverse:function(){return Ia},len:function(){return Zs},length:function(){return jc},lerp:function(){return zi},max:function(){return cf},min:function(){return lf},mul:function(){return Ns},multiply:function(){return Bl},negate:function(){return Eu},normalize:function(){return jl},random:function(){return tc},rotateX:function(){return Tf},rotateY:function(){return Vl},rotateZ:function(){return ju},round:function(){return Ul},scale:function(){return Gc},scaleAndAdd:function(){return Hc},set:function(){return ec},sqrDist:function(){return eu},sqrLen:function(){return gl},squaredDistance:function(){return nl},squaredLength:function(){return Wc},str:function(){return ys},sub:function(){return Tn},subtract:function(){return tl},transformMat3:function(){return rc},transformMat4:function(){return Zl},transformQuat:function(){return wf},zero:function(){return Qa}});var b=y(67294),p=(0,b.createContext)({});function G(){return(0,b.useContext)(p)}var S=y(13252),F=y(4763),te=y(19877),ce=y(96285),q=y(76553),we=y(75304),Pe=y(77071),Be=y(34521),Oe=y(33692),Nt=y(85910);function Xt(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Bt(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?Xt(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Xt(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Qe(n){var u=xt();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function xt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var nt;(function(n){n.TOPRIGHT="topright",n.TOPLEFT="topleft",n.BOTTOMRIGHT="bottomright",n.BOTTOMLEFT="bottomleft"})(nt||(nt={}));var cr=0,At=function(n){(0,we.Z)(a,n);var u=Qe(a);function a(s){var l;return(0,ce.Z)(this,a),l=u.call(this),l.controlOption=void 0,l.container=void 0,l.sceneContainer=void 0,l.mapsService=void 0,l.renderService=void 0,l.layerService=void 0,l.controlService=void 0,l.isShow=void 0,l.controlOption=Bt(Bt({},l.getDefault()),s||{}),l}return(0,q.Z)(a,[{key:"getDefault",value:function(){return{position:nt.TOPRIGHT,name:"".concat(cr++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",d=this.controlService;return d&&d.removeControl(this),this.controlOption.position=l,d&&d.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(S.vK.IMapService),this.renderService=l.get(S.vK.IRendererService),this.layerService=l.get(S.vK.ILayerService),this.controlService=l.get(S.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var d=this.container,_=this.controlOption.position,T=this.controlService.controlCorners[_];return Oe.SO.addClass(d,"l7-control"),_.indexOf("bottom")!==-1?T.insertBefore(d,T.firstChild):T.appendChild(d),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;Oe.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;Oe.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Oe.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var d=this.mapsService.getContainer();d!==null&&d.focus()}}}]),a}(Nt.EventEmitter),Gt=y(26306);function St(n){var u=Ze();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Ze(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var yt=function(n){(0,we.Z)(a,n);var u=St(a);function a(s){var l;return(0,ce.Z)(this,a),l=u.call(this,s),l.layerControlInputs=void 0,l.layers=void 0,l.lastZIndex=void 0,l.handlingClick=void 0,l.layersLink=void 0,l.baseLayersList=void 0,l.separator=void 0,l.overlaysList=void 0,l.form=void 0,l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,Oe.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,Gt.Z)(l)),l}return(0,q.Z)(a,[{key:"getDefault",value:function(){return{collapsed:!0,position:S.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(d){d.layer.on("remove",l.onLayerChange),d.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,d){return this.addLayer(l,d,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),d=l.height;Oe.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var _=d-(this.container.offsetTop+50);return _<this.form.clientHeight?(Oe.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=_+"px"):Oe.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Oe.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(d){d.layer.off("remove",l.onLayerChange),d.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",d=this.container=Oe.SO.create("div",l),_=this.controlOption.collapsed;d.setAttribute("aria-haspopup","true");var T=this.form=Oe.SO.create("form",l+"-list");_&&(this.mapsService.on("click",this.collapse),d.addEventListener("mouseenter",this.expand),d.addEventListener("mouseleave",this.collapse)),this.layersLink=Oe.SO.create("a",l+"-toggle",d);var P=this.layersLink;P.title="Layers",_||this.expand(),this.baseLayersList=Oe.SO.create("div",l+"-base",T),this.separator=Oe.SO.create("div",l+"-separator",T),this.overlaysList=Oe.SO.create("div",l+"-overlays",T),d.appendChild(T)}},{key:"initLayers",value:function(){var l=this,d=this.controlOption,_=d.baseLayers,T=_===void 0?{}:_,P=d.overlayers,k=P===void 0?{}:P;Object.keys(T).forEach(function(K,H){l.addLayer(T[K],K,!1)}),Object.keys(k).forEach(function(K,H){l.addLayer(k[K],K,!0)})}},{key:"update",value:function(){if(!this.container)return this;Oe.SO.empty(this.baseLayersList),Oe.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,d,_,T,P=0;for(_=0;_<this.layers.length;_++)T=this.layers[_],this.addItem(T),d=d||T.overlay,l=l||!T.overlay,P+=T.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&P>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=d&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,d,_,T=this.mapsService.getZoom(),P=l.length-1;P>=0;P--)if(d=l[P],_=this.layerService.getLayer(d.layerId),_&&_.inited){var k=_.getMinZoom(),K=_.getMaxZoom();d.disabled=T<k||T>K}}},{key:"addLayer",value:function(l,d,_){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:d,overlay:_});var T=this.controlOption,P=T.sortLayers,k=T.sortFunction,K=T.autoZIndex;P&&this.layers.sort(function(H,de){return k(H.layer,de.layer,H.name,de.name)}),K&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var d=this.layerService.getLayer(l.target.layerId),_=d!=null&&d.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;_&&this.emit(_,d)}},{key:"createRadioElement",value:function(l,d){var _='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(d?' checked="checked"':"")+"/>",T=document.createElement("div");return T.innerHTML=_,T.firstChild}},{key:"addItem",value:function(l){var d=document.createElement("label"),_=this.layerService.getLayer(l.layer.id),T=_&&_.inited&&l.layer.isVisible(),P;l.overlay?(P=document.createElement("input"),P.type="checkbox",P.className="l7-control-layers-selector",P.defaultChecked=T):P=this.createRadioElement("l7-base-layers",T),this.layerControlInputs.push(P),P.layerId=l.layer.id,P.addEventListener("click",this.onInputClick);var k=document.createElement("span");k.innerHTML=" "+l.name;var K=document.createElement("div");d.appendChild(K),K.appendChild(P),K.appendChild(k);var H=l.overlay?this.overlaysList:this.baseLayersList;return H.appendChild(d),this.checkDisabledLayers(),d}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,d,_,T=[],P=[];this.handlingClick=!0;for(var k=l.length-1;k>=0;k--)d=l[k],_=this.layerService.getLayer(d.layerId),d.checked?T.push(_):d.checked||P.push(_);P.forEach(function(K){K.hide()}),T.forEach(function(K){K.show()}),this.handlingClick=!1}}]),a}(At);function Me(n){var u=Te();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Te(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ie=function(n){(0,we.Z)(a,n);var u=Me(a);function a(){return(0,ce.Z)(this,a),u.apply(this,arguments)}return(0,q.Z)(a,[{key:"getDefault",value:function(){return{position:nt.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",d=Oe.SO.create("div",l),_=Oe.SO.create("a","l7-ctrl-logo");return _.target="_blank",_.rel="noopener nofollow",_.href="https://antv.alipay.com/l7",_.setAttribute("aria-label","AntV logo"),_.setAttribute("rel","noopener nofollow"),d.appendChild(_),d}},{key:"onRemove",value:function(){return null}}]),a}(At);function bt(n){var u=tr();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function tr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ae=function(n){(0,we.Z)(a,n);var u=bt(a);function a(s){var l;return(0,ce.Z)(this,a),l=u.call(this,s),l.mScale=void 0,l.iScale=void 0,(0,Oe.Ev)(["update"],(0,Gt.Z)(l)),l}return(0,q.Z)(a,[{key:"getDefault",value:function(){return{position:nt.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",d=Oe.SO.create("div",l);this.addScales(l+"-line",d);var _=this.controlOption.updateWhenIdle;return this.mapsService.on(_?"moveend":"mapmove",this.update),this.mapsService.on(_?"zoomend":"zoomchange",this.update),this.update(),d}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,d=this.controlOption.maxWidth,_=l.getSize()[1]/2,T=l.containerToLngLat([0,_]),P=l.containerToLngLat([d,_]),k=(0,Oe.yM)([T.lng,T.lat],[P.lng,P.lat]);this.updateScales(k)}},{key:"updateScales",value:function(l){var d=this.controlOption,_=d.metric,T=d.imperial;_&&l&&this.updateMetric(l),T&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var d=this.getRoundNum(l),_=d<1e3?d+" m":d/1e3+" km";this.updateScale(this.mScale,_,d/l)}},{key:"updateImperial",value:function(l){var d=l*3.2808399,_,T,P;d>5280?(_=d/5280,T=this.getRoundNum(_),this.updateScale(this.iScale,T+" mi",T/_)):(P=this.getRoundNum(d),this.updateScale(this.iScale,P+" ft",P/d))}},{key:"updateScale",value:function(l,d,_){var T=this.controlOption.maxWidth;l.style.width=Math.round(T*_)+"px",l.innerHTML=d}},{key:"getRoundNum",value:function(l){var d=Math.pow(10,(Math.floor(l)+"").length-1),_=l/d;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:1,d*_}},{key:"addScales",value:function(l,d){var _=this.controlOption,T=_.metric,P=_.imperial;T&&(this.mScale=Oe.SO.create("div",l,d)),P&&(this.iScale=Oe.SO.create("div",l,d))}}]),a}(At);function Ee(n){var u=le();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function le(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Q=function(n){(0,we.Z)(a,n);var u=Ee(a);function a(s){var l;return(0,ce.Z)(this,a),l=u.call(this,s),l.disabled=void 0,l.zoomInButton=void 0,l.zoomOutButton=void 0,(0,Oe.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,Gt.Z)(l)),l}return(0,q.Z)(a,[{key:"getDefault",value:function(){return{position:nt.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",d=Oe.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",d,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",d,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),d}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,d,_,T,P){var k=Oe.SO.create("a",_,T);return k.innerHTML=l,k.title=d,k.href="javascript:void(0)",k.addEventListener("click",P),k}},{key:"updateDisabled",value:function(){var l=this.mapsService,d="l7-disabled";Oe.SO.removeClass(this.zoomInButton,d),Oe.SO.removeClass(this.zoomOutButton,d),(this.disabled||l.getZoom()<=l.getMinZoom())&&Oe.SO.addClass(this.zoomOutButton,d),(this.disabled||l.getZoom()>=l.getMaxZoom())&&Oe.SO.addClass(this.zoomInButton,d)}}]),a}(At);function re(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ke(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?re(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):re(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function qe(n){var u=Wt();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Wt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Or=function(n){(0,we.Z)(a,n);var u=qe(a);function a(s){var l;return(0,ce.Z)(this,a),l=u.call(this),l.markerOption=void 0,l.defaultMarker=void 0,l.popup=void 0,l.mapsService=void 0,l.sceneSerive=void 0,l.lngLat=void 0,l.scene=void 0,l.added=!1,l.eventHandle=function(d){l.emit(d.type,{target:d,data:l.markerOption.extData,lngLat:l.lngLat})},l.markerOption=ke(ke({},l.getDefault()),s),(0,Oe.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,Gt.Z)(l)),l.init(),l}return(0,q.Z)(a,[{key:"getDefault",value:function(){return{element:void 0,anchor:Oe.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(S.vK.IMapService),this.sceneSerive=l.get(S.vK.ISceneService);var d=this.markerOption,_=d.element,T=d.draggable;return this.mapsService.getMarkerContainer().appendChild(_),this.registerMarkerEvent(_),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&Oe.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var d=this;if(!this.added)return this.once("added",function(){d.setElement(l)}),this;var _=this.markerOption.element;return _&&Oe.SO.remove(_),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var d=this.popup;return d?(d.isOpen()||d.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var d=this.popup;return d&&d.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,_=l.anchor;this.updatePosition(),Oe.SO.setTransform(d,"".concat(Oe.rQ[_]))}}},{key:"onMapClick",value:function(l){var d=this.markerOption.element;this.popup&&d&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,_=l.offsets,T=this.lngLat,P=T.lng,k=T.lat,K=this.mapsService.getBounds(),H=this.mapsService.lngLatToContainer([P,k]);if(d){d.style.display="block";var de=this.mapsService.getContainer(),Ge=0,ft=0;if(de&&(Ge=de.scrollWidth,ft=de.scrollHeight),Math.abs(K[0][0])>180||Math.abs(K[1][0])>180){if(H.x>Ge){var Ut=this.mapsService.lngLatToContainer([P-360,k]);H.x=Ut.x}if(H.x<0){var gr=this.mapsService.lngLatToContainer([P+360,k]);H.x=gr.x}}(H.x>Ge||H.x<0||H.y>ft||H.y<0)&&(d.style.display="none"),d.style.left=H.x+_[0]+"px",d.style.top=H.y-_[1]+"px"}}}},{key:"init",value:function(){var l=this,d=this.markerOption.element,_=this.markerOption,T=_.color,P=_.anchor;if(!d){this.defaultMarker=!0,d=Oe.SO.create("div"),this.markerOption.element=d;var k=document.createElementNS("http://www.w3.org/2000/svg","svg");k.setAttributeNS(null,"display","block"),k.setAttributeNS(null,"height","48px"),k.setAttributeNS(null,"width","48px"),k.setAttributeNS(null,"viewBox","0 0 1024 1024");var K=document.createElementNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),K.setAttributeNS(null,"fill",T),k.appendChild(K),d.appendChild(k)}Oe.SO.addClass(d,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(H){var de,Ge,ft=((de=l.markerOption)===null||de===void 0?void 0:de.style)&&((Ge=l.markerOption)===null||Ge===void 0?void 0:Ge.style[H]);d&&(d.style[H]=ft)}),d.addEventListener("click",function(H){l.onMapClick(H)}),d.addEventListener("click",this.eventHandle),(0,Oe.zi)(d,P,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),a}(Nt.EventEmitter),wr=y(82492),Nr=y.n(wr),Vt=y(92249),se=y.n(Vt);function _e(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Le(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?_e(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):_e(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function ot(n){var u=Rt();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Rt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var jt=function(n){(0,we.Z)(a,n);var u=ot(a);function a(s){var l,d;return(0,ce.Z)(this,a),d=u.call(this),d.markers=[],d.markerLayerOption=void 0,d.clusterIndex=void 0,d.points=[],d.clusterMarkers=[],d.mapsService=void 0,d.scene=void 0,d.zoom=void 0,d.bbox=void 0,d.markerLayerOption=Nr()(d.getDefault(),s),(0,Oe.Ev)(["update"],(0,Gt.Z)(d)),d.zoom=((l=d.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,d}return(0,q.Z)(a,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(S.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var d=this.markerLayerOption.cluster;d&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var d=this.markers.indexOf(l);d>-1&&this.markers.splice(d,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(d){d.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,d){var _=l.getLnglat(),T=_.lng,P=_.lat,k={geometry:{type:"Point",coordinates:[T,P]},properties:Le(Le({},l.getExtData()),{},{marker_id:d})};this.points.push(k)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,d=l.radius,_=l.minZoom,T=_===void 0?0:_,P=l.maxZoom;this.clusterIndex=new(se())({radius:d,minZoom:T,maxZoom:P}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,d){var _=this,T=l[0].concat(l[1]),P=this.clusterIndex.getClusters(T,d);this.clusterMarkers.forEach(function(k){k.remove()}),this.clusterMarkers=[],P.forEach(function(k){var K,H=_.markerLayerOption.clusterOption,de=H.field,Ge=H.method;if(k.properties&&(K=k.properties)!==null&&K!==void 0&&K.cluster_id){var ft,Ut=_.getLeaves((ft=k.properties)===null||ft===void 0?void 0:ft.cluster_id);if(k.properties.clusterData=Ut,de&&Ge){var gr=Ut==null?void 0:Ut.map(function(Wn){var Ii=(0,F.Z)({},de,Wn.properties[de]);return Ii}),Ir=Oe.a5.getColumn(gr,de),Hr=Oe.a5.getSatByColumn(Ge,Ir),pn="point_"+Ge;k.properties[pn]=Hr.toFixed(2)}}var wn=_.clusterMarker(k);_.clusterMarkers.push(wn),wn.addTo(_.scene)})}},{key:"getLeaves",value:function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,d,_):null}},{key:"clusterMarker",value:function(l){var d=this.markerLayerOption.clusterOption,_=d,T=_.element,P=T===void 0?this.generateElement.bind(this):T,k=new Or({element:P(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return k}},{key:"normalMarker",value:function(l){var d=l.properties.marker_id;return this.markers[d]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),d=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,Oe.oO)(this.bbox,d))&&(this.bbox=(0,Oe.yA)(d,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var d=Oe.SO.create("div","l7-marker-cluster"),_=Oe.SO.create("div","",d),T=Oe.SO.create("span","",_),P=this.markerLayerOption.clusterOption,k=P.field,K=P.method;l.properties.point_count=l.properties.point_count||1;var H=k&&K?l.properties["point_"+K]||l.properties[k]:l.properties.point_count;return T.textContent=H,d}}]),a}(Nt.EventEmitter);function w(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function N(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?w(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):w(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function ve(n){var u=Ae();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Ae(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Je=function(n){(0,we.Z)(a,n);var u=ve(a);function a(s){var l;return(0,ce.Z)(this,a),l=u.call(this),l.popupOption=void 0,l.mapsService=void 0,l.sceneSerive=void 0,l.lngLat=void 0,l.content=void 0,l.closeButton=void 0,l.timeoutInstance=void 0,l.container=void 0,l.tip=void 0,l.scene=void 0,l.popupOption=N(N({},l.getdefault()),s),(0,Oe.Ev)(["update","onClickClose","remove"],(0,Gt.Z)(l)),l}return(0,q.Z)(a,[{key:"addTo",value:function(l){var d=this;return this.mapsService=l.get(S.vK.IMapService),this.sceneSerive=l.get(S.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){d.mapsService.on("click",d.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var d=window.document.createDocumentFragment(),_=window.document.createElement("body"),T;for(_.innerHTML=l;T=_.firstChild,!!T;)d.appendChild(T);return this.setDOMContent(d)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Oe.SO.remove(this.content),this.content=Oe.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Oe.SO.create("button","l7-popup-close-button",this.content),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,d,_){var T=window.document.createElement(l);return d!==void 0&&(T.className=d),_&&_.appendChild(T),T}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Oe.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,d=this.lngLat,_=this.popupOption,T=_.className,P=_.maxWidth,k=_.anchor;if(!(!this.mapsService||!d||!this.content)){var K=this.mapsService.getMarkerContainer();if(!this.container&&K){this.container=this.creatDom("div","l7-popup",K),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),T&&T.split(" ").forEach(function(de){return l.container.classList.add(de)});var H=this.popupOption.stopPropagation;H&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(de){l.container.addEventListener(de,function(Ge){Ge.stopPropagation()})})}P&&this.container.style.maxWidth!==P&&(this.container.style.maxWidth=P),this.updatePosition(),Oe.SO.setTransform(this.container,"".concat(Oe.rQ[k])),(0,Oe.zi)(this.container,k,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,d=l.lng,_=l.lat,T=this.popupOption.offsets,P=this.mapsService.lngLatToContainer([d,_]);this.container.style.left=P.x+T[0]+"px",this.container.style.top=P.y-T[1]+"px"}}}]),a}(Nt.EventEmitter);y(63414)(`/* @antv/l7-component */
.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-flex-direction: column-reverse;
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-flex-direction: column;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-flex-direction: row;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-flex-direction: row-reverse;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-flex;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -webkit-flex;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`);var st=y(78864),Lt=y(87757),X=y.n(Lt),Tt=y(62141),Kt=y(66164),hr=y.n(Kt),_r=function(){function n(u,a){(0,ce.Z)(this,n),this.attribute=void 0,this.buffer=void 0;var s=a.buffer,l=a.offset,d=a.stride,_=a.normalized,T=a.size,P=a.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:d||0,normalized:_||!1,divisor:P||0},T&&(this.attribute.size=T)}return(0,q.Z)(n,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(a){this.buffer.subData(a)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),n}(),Ar,Rr,et,gt,dt,fr,$r,mt,Dt,ar,sr,yn,_n,ai,vi=(Ar={},(0,F.Z)(Ar,S.gl.POINTS,"points"),(0,F.Z)(Ar,S.gl.LINES,"lines"),(0,F.Z)(Ar,S.gl.LINE_LOOP,"line loop"),(0,F.Z)(Ar,S.gl.LINE_STRIP,"line strip"),(0,F.Z)(Ar,S.gl.TRIANGLES,"triangles"),(0,F.Z)(Ar,S.gl.TRIANGLE_FAN,"triangle fan"),(0,F.Z)(Ar,S.gl.TRIANGLE_STRIP,"triangle strip"),Ar),Di=(Rr={},(0,F.Z)(Rr,S.gl.STATIC_DRAW,"static"),(0,F.Z)(Rr,S.gl.DYNAMIC_DRAW,"dynamic"),(0,F.Z)(Rr,S.gl.STREAM_DRAW,"stream"),Rr),Zi=(et={},(0,F.Z)(et,S.gl.BYTE,"int8"),(0,F.Z)(et,S.gl.UNSIGNED_INT,"int16"),(0,F.Z)(et,S.gl.INT,"int32"),(0,F.Z)(et,S.gl.UNSIGNED_BYTE,"uint8"),(0,F.Z)(et,S.gl.UNSIGNED_SHORT,"uint16"),(0,F.Z)(et,S.gl.UNSIGNED_INT,"uint32"),(0,F.Z)(et,S.gl.FLOAT,"float"),et),oi=(gt={},(0,F.Z)(gt,S.gl.ALPHA,"alpha"),(0,F.Z)(gt,S.gl.LUMINANCE,"luminance"),(0,F.Z)(gt,S.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,F.Z)(gt,S.gl.RGB,"rgb"),(0,F.Z)(gt,S.gl.RGBA,"rgba"),(0,F.Z)(gt,S.gl.RGBA4,"rgba4"),(0,F.Z)(gt,S.gl.RGB5_A1,"rgb5 a1"),(0,F.Z)(gt,S.gl.RGB565,"rgb565"),(0,F.Z)(gt,S.gl.DEPTH_COMPONENT,"depth"),(0,F.Z)(gt,S.gl.DEPTH_STENCIL,"depth stencil"),gt),$=(dt={},(0,F.Z)(dt,S.gl.DONT_CARE,"dont care"),(0,F.Z)(dt,S.gl.NICEST,"nice"),(0,F.Z)(dt,S.gl.FASTEST,"fast"),dt),I=(fr={},(0,F.Z)(fr,S.gl.NEAREST,"nearest"),(0,F.Z)(fr,S.gl.LINEAR,"linear"),(0,F.Z)(fr,S.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,F.Z)(fr,S.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,F.Z)(fr,S.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,F.Z)(fr,S.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),fr),j=($r={},(0,F.Z)($r,S.gl.REPEAT,"repeat"),(0,F.Z)($r,S.gl.CLAMP_TO_EDGE,"clamp"),(0,F.Z)($r,S.gl.MIRRORED_REPEAT,"mirror"),$r),Y=(mt={},(0,F.Z)(mt,S.gl.NONE,"none"),(0,F.Z)(mt,S.gl.BROWSER_DEFAULT_WEBGL,"browser"),mt),ue=(Dt={},(0,F.Z)(Dt,S.gl.NEVER,"never"),(0,F.Z)(Dt,S.gl.ALWAYS,"always"),(0,F.Z)(Dt,S.gl.LESS,"less"),(0,F.Z)(Dt,S.gl.LEQUAL,"lequal"),(0,F.Z)(Dt,S.gl.GREATER,"greater"),(0,F.Z)(Dt,S.gl.GEQUAL,"gequal"),(0,F.Z)(Dt,S.gl.EQUAL,"equal"),(0,F.Z)(Dt,S.gl.NOTEQUAL,"notequal"),Dt),De=(ar={},(0,F.Z)(ar,S.gl.FUNC_ADD,"add"),(0,F.Z)(ar,S.gl.MIN_EXT,"min"),(0,F.Z)(ar,S.gl.MAX_EXT,"max"),(0,F.Z)(ar,S.gl.FUNC_SUBTRACT,"subtract"),(0,F.Z)(ar,S.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),ar),He=(sr={},(0,F.Z)(sr,S.gl.ZERO,"zero"),(0,F.Z)(sr,S.gl.ONE,"one"),(0,F.Z)(sr,S.gl.SRC_COLOR,"src color"),(0,F.Z)(sr,S.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,F.Z)(sr,S.gl.SRC_ALPHA,"src alpha"),(0,F.Z)(sr,S.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,F.Z)(sr,S.gl.DST_COLOR,"dst color"),(0,F.Z)(sr,S.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,F.Z)(sr,S.gl.DST_ALPHA,"dst alpha"),(0,F.Z)(sr,S.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,F.Z)(sr,S.gl.CONSTANT_COLOR,"constant color"),(0,F.Z)(sr,S.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,F.Z)(sr,S.gl.CONSTANT_ALPHA,"constant alpha"),(0,F.Z)(sr,S.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,F.Z)(sr,S.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),sr),he=(yn={},(0,F.Z)(yn,S.gl.NEVER,"never"),(0,F.Z)(yn,S.gl.ALWAYS,"always"),(0,F.Z)(yn,S.gl.LESS,"less"),(0,F.Z)(yn,S.gl.LEQUAL,"lequal"),(0,F.Z)(yn,S.gl.GREATER,"greater"),(0,F.Z)(yn,S.gl.GEQUAL,"gequal"),(0,F.Z)(yn,S.gl.EQUAL,"equal"),(0,F.Z)(yn,S.gl.NOTEQUAL,"notequal"),yn),Ne=(_n={},(0,F.Z)(_n,S.gl.ZERO,"zero"),(0,F.Z)(_n,S.gl.KEEP,"keep"),(0,F.Z)(_n,S.gl.REPLACE,"replace"),(0,F.Z)(_n,S.gl.INVERT,"invert"),(0,F.Z)(_n,S.gl.INCR,"increment"),(0,F.Z)(_n,S.gl.DECR,"decrement"),(0,F.Z)(_n,S.gl.INCR_WRAP,"increment wrap"),(0,F.Z)(_n,S.gl.DECR_WRAP,"decrement wrap"),_n),Ct=(ai={},(0,F.Z)(ai,S.gl.FRONT,"front"),(0,F.Z)(ai,S.gl.BACK,"back"),ai),kr=function(){function n(u,a){(0,ce.Z)(this,n),this.buffer=void 0;var s=a.data,l=a.usage,d=a.type;this.buffer=u.buffer({data:s,usage:Di[l||S.gl.STATIC_DRAW],type:Zi[d||S.gl.UNSIGNED_BYTE]})}return(0,q.Z)(n,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(a){var s=a.data,l=a.offset;this.buffer.subdata(s,l)}}]),n}(),jr=function(){function n(u,a){(0,ce.Z)(this,n),this.elements=void 0;var s=a.data,l=a.usage,d=a.type,_=a.count;this.elements=u.elements({data:s,usage:Di[l||S.gl.STATIC_DRAW],type:Zi[d||S.gl.UNSIGNED_BYTE],count:_})}return(0,q.Z)(n,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(a){var s=a.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),n}(),$t=function(){function n(u,a){(0,ce.Z)(this,n),this.framebuffer=void 0;var s=a.width,l=a.height,d=a.color,_=a.colors,T=a.depth,P=a.stencil,k={width:s,height:l};Array.isArray(_)&&(k.colors=_.map(function(K){return K.get()})),d&&typeof d!="boolean"&&(k.color=d.get()),this.framebuffer=u.framebuffer(k)}return(0,q.Z)(n,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.framebuffer.resize(s,l)}}]),n}(),yr=y(95676),qr=y(36719),gn=y.n(qr),dr=y(68630),hn=y.n(dr);function ln(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function fn(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?ln(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ln(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var ri=function(){function n(u,a){(0,ce.Z)(this,n),this.reGl=void 0,this.destroyed=!1,this.drawCommand=void 0,this.drawParams=void 0,this.options=void 0,this.uniforms={},this.reGl=u;var s=a.vs,l=a.fs,d=a.attributes,_=a.uniforms,T=a.primitive,P=a.count,k=a.elements,K=a.depth,H=a.blend,de=a.stencil,Ge=a.cull,ft=a.instances,Ut={};this.options=a,_&&(this.uniforms=this.extractUniforms(_),Object.keys(_).forEach(function(Hr){Ut[Hr]=u.prop(Hr)}));var gr={};Object.keys(d).forEach(function(Hr){gr[Hr]=d[Hr].get()});var Ir={attributes:gr,frag:l,uniforms:Ut,vert:s,primitive:vi[T===void 0?S.gl.TRIANGLES:T]};ft&&(Ir.instances=ft),P&&(Ir.count=P),k&&(Ir.elements=k.get()),this.initDepthDrawParams({depth:K},Ir),this.initBlendDrawParams({blend:H},Ir),this.initStencilDrawParams({stencil:de},Ir),this.initCullDrawParams({cull:Ge},Ir),this.drawCommand=u(Ir),this.drawParams=Ir}return(0,q.Z)(n,[{key:"addUniforms",value:function(a){this.uniforms=fn(fn({},this.uniforms),this.extractUniforms(a))}},{key:"draw",value:function(a){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=fn(fn({},this.uniforms),this.extractUniforms(a.uniforms||{})),l={};Object.keys(s).forEach(function(d){var _=(0,yr.Z)(s[d]);_==="boolean"||_==="number"||Array.isArray(s[d])||s[d].BYTES_PER_ELEMENT?l[d]=s[d]:l[d]=s[d].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(a){a.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(a,s){var l=a.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:ue[l.func||S.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(a,s){var l=a.blend;if(l){var d=l.enable,_=l.func,T=l.equation,P=l.color,k=P===void 0?[0,0,0,0]:P;s.blend={enable:!!d,func:{srcRGB:He[_&&_.srcRGB||S.gl.SRC_ALPHA],srcAlpha:He[_&&_.srcAlpha||S.gl.SRC_ALPHA],dstRGB:He[_&&_.dstRGB||S.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:He[_&&_.dstAlpha||S.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:De[T&&T.rgb||S.gl.FUNC_ADD],alpha:De[T&&T.alpha||S.gl.FUNC_ADD]},color:k}}}},{key:"initStencilDrawParams",value:function(a,s){var l=a.stencil;if(l){var d=l.enable,_=l.mask,T=_===void 0?-1:_,P=l.func,k=P===void 0?{cmp:S.gl.ALWAYS,ref:0,mask:-1}:P,K=l.opFront,H=K===void 0?{fail:S.gl.KEEP,zfail:S.gl.KEEP,zpass:S.gl.KEEP}:K,de=l.opBack,Ge=de===void 0?{fail:S.gl.KEEP,zfail:S.gl.KEEP,zpass:S.gl.KEEP}:de;s.stencil={enable:!!d,mask:T,func:fn(fn({},k),{},{cmp:he[k.cmp]}),opFront:{fail:Ne[H.fail],zfail:Ne[H.zfail],zpass:Ne[H.zpass]},opBack:{fail:Ne[Ge.fail],zfail:Ne[Ge.zfail],zpass:Ne[Ge.zpass]}}}}},{key:"initCullDrawParams",value:function(a,s){var l=a.cull;if(l){var d=l.enable,_=l.face,T=_===void 0?S.gl.BACK:_;s.cull={enable:!!d,face:Ct[T]}}}},{key:"extractUniforms",value:function(a){var s=this,l={};return Object.keys(a).forEach(function(d){s.extractUniformsRecursively(d,a[d],l,"")}),l}},{key:"extractUniformsRecursively",value:function(a,s,l,d){var _=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||gn()(s)||s===""||"resize"in s){l["".concat(d&&d+".").concat(a)]=s;return}hn()(s)&&Object.keys(s).forEach(function(T){_.extractUniformsRecursively(T,s[T],l,"".concat(d&&d+".").concat(a))}),Array.isArray(s)&&s.forEach(function(T,P){Object.keys(T).forEach(function(k){_.extractUniformsRecursively(k,T[k],l,"".concat(d&&d+".").concat(a,"[").concat(P,"]"))})})}}]),n}(),dn=function(){function n(u,a){(0,ce.Z)(this,n),this.texture=void 0,this.width=void 0,this.height=void 0;var s=a.data,l=a.type,d=l===void 0?S.gl.UNSIGNED_BYTE:l,_=a.width,T=a.height,P=a.flipY,k=P===void 0?!1:P,K=a.format,H=K===void 0?S.gl.RGBA:K,de=a.mipmap,Ge=de===void 0?!1:de,ft=a.wrapS,Ut=ft===void 0?S.gl.CLAMP_TO_EDGE:ft,gr=a.wrapT,Ir=gr===void 0?S.gl.CLAMP_TO_EDGE:gr,Hr=a.aniso,pn=Hr===void 0?0:Hr,wn=a.alignment,Wn=wn===void 0?1:wn,Ii=a.premultiplyAlpha,qn=Ii===void 0?!1:Ii,Qi=a.mag,Oa=Qi===void 0?S.gl.NEAREST:Qi,ka=a.min,hi=ka===void 0?S.gl.NEAREST:ka,Ta=a.colorSpace,ro=Ta===void 0?S.gl.BROWSER_DEFAULT_WEBGL:Ta;this.width=_,this.height=T;var Ju={width:_,height:T,type:Zi[d],format:oi[H],wrapS:j[Ut],wrapT:j[Ir],mag:I[Oa],min:I[hi],alignment:Wn,flipY:k,colorSpace:Y[ro],premultiplyAlpha:qn,aniso:pn};s&&(Ju.data=s),typeof Ge=="number"?Ju.mipmap=$[Ge]:typeof Ge=="boolean"&&(Ju.mipmap=Ge),this.texture=u.texture(Ju)}return(0,q.Z)(n,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(a)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),n}(),ci,Bi,pi,_i=(ci=(0,Tt.b2)(),ci(Bi=(pi=function(){function n(){var u=this;(0,ce.Z)(this,n),this.gl=void 0,this.$container=void 0,this.canvas=void 0,this.width=void 0,this.height=void 0,this.isDirty=void 0,this.createModel=function(a){return new ri(u.gl,a)},this.createAttribute=function(a){return new _r(u.gl,a)},this.createBuffer=function(a){return new kr(u.gl,a)},this.createElements=function(a){return new jr(u.gl,a)},this.createTexture2D=function(a){return new dn(u.gl,a)},this.createFramebuffer=function(a){return new $t(u.gl,a)},this.useFramebuffer=function(a,s){u.gl({framebuffer:a?a.get():null})(s)},this.clear=function(a){var s=a.color,l=a.depth,d=a.stencil,_=a.framebuffer,T=_===void 0?null:_,P={color:s,depth:l,stencil:d};P.framebuffer=T===null?T:T.get(),u.gl.clear(P)},this.viewport=function(a){var s=a.x,l=a.y,d=a.width,_=a.height;u.gl._gl.viewport(s,l,d,_),u.width=d,u.height=_,u.gl._refresh()},this.readPixels=function(a){var s=a.framebuffer,l=a.x,d=a.y,_=a.width,T=a.height,P={x:l,y:d,width:_,height:T};return s&&(P.framebuffer=s.get()),u.gl.read(P)},this.getViewportSize=function(){return{width:u.gl._gl.drawingBufferWidth,height:u.gl._gl.drawingBufferHeight}},this.getContainer=function(){var a;return(a=u.canvas)===null||a===void 0?void 0:a.parentElement},this.getCanvas=function(){return u.canvas},this.getGLContext=function(){return u.gl._gl},this.destroy=function(){u.gl.destroy()}}return(0,q.Z)(n,[{key:"init",value:function(){var u=(0,st.Z)(X().mark(function s(l,d){var _=this;return X().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this.canvas=l,P.next=3,new Promise(function(k,K){hr()({canvas:_.canvas,attributes:{alpha:!0,antialias:d.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(de,Ge){(de||!Ge)&&K(de),k(Ge)}})});case 3:this.gl=P.sent;case 4:case"end":return P.stop()}},s,this)}));function a(s,l){return u.apply(this,arguments)}return a}()},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var a=this.getGLContext();a.disable(a.CULL_FACE)}},{key:"setDirty",value:function(a){this.isDirty=a}},{key:"getDirty",value:function(){return this.isDirty}}]),n}(),pi))||Bi);function Ai(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function xo(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?Ai(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Ai(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Wi=function(){function n(u){(0,ce.Z)(this,n),this.sceneService=void 0,this.mapService=void 0,this.controlService=void 0,this.layerService=void 0,this.iconService=void 0,this.markerService=void 0,this.popupService=void 0,this.fontService=void 0,this.interactionService=void 0,this.container=void 0;var a=u.id,s=u.map,l=(0,S.Hp)();this.container=l,s.setContainer(l,a),l.bind(S.vK.IRendererService).to(_i).inSingletonScope(),this.sceneService=l.get(S.vK.ISceneService),this.mapService=l.get(S.vK.IMapService),this.iconService=l.get(S.vK.IIconService),this.fontService=l.get(S.vK.IFontService),this.controlService=l.get(S.vK.IControlService),this.layerService=l.get(S.vK.ILayerService),this.markerService=l.get(S.vK.IMarkerService),this.interactionService=l.get(S.vK.IInteractionService),this.popupService=l.get(S.vK.IPopupService),this.initComponent(a),this.sceneService.init(u),this.initControl()}return(0,q.Z)(n,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(a){return this.sceneService.exportPng(a)}},{key:"exportMap",value:function(a){return this.sceneService.exportPng(a)}},{key:"registerRenderService",value:function(a){var s=this;if(this.sceneService.loaded){var l=new a(this);l.init()}else this.on("loaded",function(){var d=new a(s);d.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(a){var s=(0,S.e7)(this.container);a.setContainer(s),this.sceneService.addLayer(a)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(a){return this.layerService.getLayer(a)}},{key:"getLayerByName",value:function(a){return this.layerService.getLayerByName(a)}},{key:"removeLayer",value:function(a){this.layerService.remove(a)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(a,s){this.fontService.addIconFont(a,s)}},{key:"addIconFonts",value:function(a){var s=this;a.forEach(function(l){var d=(0,te.Z)(l,2),_=d[0],T=d[1];s.fontService.addIconFont(_,T)})}},{key:"addFontFace",value:function(a,s){this.sceneService.addFontFace(a,s)}},{key:"addImage",value:function(a,s){this.iconService.addImage(a,s)}},{key:"hasImage",value:function(a){return this.iconService.hasImage(a)}},{key:"removeImage",value:function(a){this.iconService.removeImage(a)}},{key:"addIconFontGlyphs",value:function(a,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(a){this.controlService.addControl(a,this.container)}},{key:"removeControl",value:function(a){this.controlService.removeControl(a)}},{key:"getControlByName",value:function(a){return this.controlService.getControlByName(a)}},{key:"addMarker",value:function(a){this.markerService.addMarker(a)}},{key:"addMarkerLayer",value:function(a){this.markerService.addMarkerLayer(a)}},{key:"removeMarkerLayer",value:function(a){this.markerService.removeMarkerLayer(a)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(a){this.popupService.addPopup(a)}},{key:"on",value:function(a,s){S.SceneEventList.indexOf(a)===-1?this.mapService.on(a,s):this.sceneService.on(a,s)}},{key:"off",value:function(a,s){S.SceneEventList.indexOf(a)===-1?this.mapService.off(a,s):this.sceneService.off(a,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(a){return this.mapService.getCenter(a)}},{key:"setCenter",value:function(a,s){return this.mapService.setCenter(a,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(a){return this.mapService.setPitch(a)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(a){this.mapService.setRotation(a)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(a){this.mapService.panTo(a)}},{key:"panBy",value:function(a){this.mapService.panBy(a)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(a){this.mapService.setZoom(a)}},{key:"fitBounds",value:function(a,s){var l=this.sceneService.getSceneConfig(),d=l.fitBoundsOptions,_=l.animate;this.mapService.fitBounds(a,s||xo(xo({},d),{},{animate:_}))}},{key:"setZoomAndCenter",value:function(a,s){this.mapService.setZoomAndCenter(a,s)}},{key:"setMapStyle",value:function(a){this.mapService.setMapStyle(a)}},{key:"setMapStatus",value:function(a){this.mapService.setMapStatus(a)}},{key:"pixelToLngLat",value:function(a){return this.mapService.pixelToLngLat(a)}},{key:"lngLatToPixel",value:function(a){return this.mapService.lngLatToPixel(a)}},{key:"containerToLngLat",value:function(a){return this.mapService.containerToLngLat(a)}},{key:"lngLatToContainer",value:function(a){return this.mapService.lngLatToContainer(a)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(a,s){this.container.bind(S.vK.IPostProcessingPass).to(a).whenTargetNamed(s)}},{key:"initComponent",value:function(a){this.controlService.init({container:Oe.SO.getContainer(a)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var a=this.sceneService.getSceneConfig(),s=a.logoVisible,l=a.logoPosition;s&&this.addControl(new Ie({position:l}))}}]),n}(),mi=y(63309),Fn=y(17912),kn=y(25882),Zn=y(13218),ra=y.n(Zn),js=y(23560),ua=y.n(js),Ki=y(27973),mu=y(30264),gu=y.n(mu),ya,no,Ya,Na,Ho,aa;function Ga(n){return n.map(function(u){return typeof u=="string"&&(u=[u,{}]),u})}var io=(ya=(0,Tt.b2)(),no=(0,Tt.f3)(S.vK.IGlobalConfigService),ya(Ya=(Na=(aa=function(){function n(){(0,ce.Z)(this,n),(0,Fn.Z)(this,"configService",Ho,this),this.enabled=void 0}return(0,q.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.rendererService,_=s.postProcessingPassFactory,T=s.normalPassFactory;a.hooks.init.tap("MultiPassRendererPlugin",function(){var P=a.getLayerConfig(),k=P.enableMultiPassRenderer,K=P.passes,H=K===void 0?[]:K;l.enabled=!!k&&a.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(a.multiPassRenderer=l.createMultiPassRenderer(a,H,_,T),a.multiPassRenderer.setRenderFlag(!0))}),a.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(a,s,l,d){var _=a.multiPassRenderer,T=a.getLayerConfig(),P=T.enablePicking,k=T.enableTAA;return P&&_.add(d("pixelPicking")),_}}]),n}(),aa),Ho=(0,kn.Z)(Na.prototype,"configService",[no],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Na))||Ya),oa,qi=(oa={},(0,F.Z)(oa,S.BlendType.additive,{enable:!0,func:{srcRGB:S.gl.ONE,dstRGB:S.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(oa,S.BlendType.none,{enable:!1}),(0,F.Z)(oa,S.BlendType.normal,{enable:!0,func:{srcRGB:S.gl.SRC_ALPHA,dstRGB:S.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(oa,S.BlendType.subtractive,{enable:!0,func:{srcRGB:S.gl.ONE,dstRGB:S.gl.ONE,srcAlpha:S.gl.ZERO,dstAlpha:S.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:S.gl.FUNC_SUBTRACT,alpha:S.gl.FUNC_SUBTRACT}}),(0,F.Z)(oa,S.BlendType.max,{enable:!0,func:{srcRGB:S.gl.ONE,dstRGB:S.gl.ONE},equation:{rgb:S.gl.MAX_EXT}}),(0,F.Z)(oa,S.BlendType.min,{enable:!0,func:{srcRGB:S.gl.ONE,dstRGB:S.gl.ONE},equation:{rgb:S.gl.MIN_EXT}}),oa),Pl={properties:{enablePicking:{type:"boolean"},enableHighlight:{type:"boolean"},highlightColor:{oneOf:[{type:"array",items:{type:"number",minimum:0,maximum:1}},{type:"string"}]}}},ts,$a,Ha,la,it,pe,Ke,qt;function Wr(n,u){var a;if(typeof Symbol=="undefined"||n[Symbol.iterator]==null){if(Array.isArray(n)||(a=bn(n))||u&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){a=n[Symbol.iterator]()},n:function(){var k=a.next();return d=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function bn(n,u){if(!!n){if(typeof n=="string")return xi(n,u);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xi(n,u)}}function xi(n,u){(u==null||u>n.length)&&(u=n.length);for(var a=0,s=new Array(u);a<u;a++)s[a]=n[a];return s}function _a(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Vi(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?_a(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):_a(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Wa(n){var u=ko();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var yu=0,_u=(ts=(0,S.yT)(S.vK.ILogService),$a=(0,S.yT)(S.vK.IGlobalConfigService),Ha=(0,S.yT)(S.vK.IShaderModuleService),la=(qt=function(n){(0,we.Z)(a,n);var u=Wa(a);function a(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ce.Z)(this,a),s=u.call(this),s.id="".concat(yu++),s.name="".concat(yu),s.type=void 0,s.visible=!0,s.zIndex=0,s.minZoom=void 0,s.maxZoom=void 0,s.inited=!1,s.layerModelNeedUpdate=!1,s.pickedFeatureID=null,s.selectedFeatureID=null,s.styleNeedUpdate=!1,s.dataState={dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1},s.hooks={init:new Ki.oI,afterInit:new Ki.oI,beforeRender:new Ki.oI,beforeRenderData:new Ki.gg,afterRender:new Ki.ni,beforePickingEncode:new Ki.ni,afterPickingEncode:new Ki.ni,beforeHighlight:new Ki.ni(["pickedColor"]),afterHighlight:new Ki.ni,beforeSelect:new Ki.ni(["pickedColor"]),afterSelect:new Ki.ni,beforeDestroy:new Ki.ni,afterDestroy:new Ki.ni},s.models=[],s.multiPassRenderer=void 0,s.plugins=void 0,s.sourceOption=void 0,s.layerModel=void 0,(0,Fn.Z)(s,"logger",it,(0,Gt.Z)(s)),(0,Fn.Z)(s,"configService",pe,(0,Gt.Z)(s)),(0,Fn.Z)(s,"shaderModuleService",Ke,(0,Gt.Z)(s)),s.cameraService=void 0,s.coordinateService=void 0,s.iconService=void 0,s.fontService=void 0,s.pickingService=void 0,s.rendererService=void 0,s.layerService=void 0,s.interactionService=void 0,s.mapService=void 0,s.styleAttributeService=void 0,s.layerSource=void 0,s.postProcessingPassFactory=void 0,s.normalPassFactory=void 0,s.animateOptions={enable:!1},s.container=void 0,s.encodedData=void 0,s.configSchema=void 0,s.currentPickId=null,s.rawConfig=void 0,s.needUpdateConfig=void 0,s.pendingStyleAttributes=[],s.scaleOptions={},s.animateStartTime=void 0,s.aniamateStatus=!1,s.sourceEvent=function(){s.dataState.dataSourceNeedUpdate=!0;var d=s.getLayerConfig(),_=d.autoFit,T=d.fitBoundsOptions;_&&s.fitBounds(T),s.emit("dataUpdate"),s.reRender()},s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,q.Z)(a,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=Vi(Vi({},this.needUpdateConfig),l);else{var d=this.container.get(S.vK.SceneID);this.configService.setLayerConfig(d,this.id,Vi(Vi(Vi({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,d=this.container.get(S.vK.SceneID),_=this.rawConfig.enableMultiPassRenderer,T=_===void 0?!1:_;this.configService.setLayerConfig(d,this.id,{enableMultiPassRenderer:T}),this.iconService=this.container.get(S.vK.IIconService),this.fontService=this.container.get(S.vK.IFontService),this.rendererService=this.container.get(S.vK.IRendererService),this.layerService=this.container.get(S.vK.ILayerService),this.interactionService=this.container.get(S.vK.IInteractionService),this.pickingService=this.container.get(S.vK.IPickingService),this.mapService=this.container.get(S.vK.IMapService),this.cameraService=this.container.get(S.vK.ICameraService),this.coordinateService=this.container.get(S.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(S.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(S.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(S.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(S.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(H){var de=H.attributeName,Ge=H.attributeField,ft=H.attributeValues,Ut=H.updateOptions;l.styleAttributeService.updateStyleAttribute(de,{scale:Vi({field:Ge},l.splitValuesAndCallbackInAttribute(ft,l.getLayerConfig()[de]))},Ut)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(S.vK.ILayerPlugin);var P=Wr(this.plugins),k;try{for(P.s();!(k=P.n()).done;){var K=k.value;K.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(H){P.e(H)}finally{P.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Vi(Vi({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),d=l.animateOption;d!=null&&d.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,d,_){return this.updateStyleAttribute("color",l,d,_),this}},{key:"texture",value:function(l,d,_){return this.updateStyleAttribute("texture",l,d,_),this}},{key:"rotate",value:function(l,d,_){return this.updateStyleAttribute("rotate",l,d,_),this}},{key:"size",value:function(l,d,_){return this.updateStyleAttribute("size",l,d,_),this}},{key:"filter",value:function(l,d,_){return this.updateStyleAttribute("filter",l,d,_),this}},{key:"shape",value:function(l,d,_){return this.updateStyleAttribute("shape",l,d,_),this}},{key:"label",value:function(l,d,_){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:d,updateOptions:_}),this}},{key:"animate",value:function(l){var d={};return ra()(l)?(d.enable=!0,d=Vi(Vi({},d),l)):d.enable=l,this.updateLayerConfig({animateOption:d}),this}},{key:"source",value:function(l,d){return this.sourceOption={data:l,options:d},this}},{key:"setData",value:function(l,d){var _=this;return this.inited?this.layerSource.setData(l,d):this.on("inited",function(){_.layerSource.setData(l,d)}),this}},{key:"style",value:function(l){var d=this,_=l.passes,T=(0,mi.Z)(l,["passes"]);return _&&Ga(_).forEach(function(P){var k=d.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(P[0]);k&&k.updateOptions(P[1])}),this.rawConfig=Vi(Vi({},this.rawConfig),T),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,d){return ra()(l)?this.scaleOptions=Vi(Vi({},this.scaleOptions),l):this.scaleOptions[l]=d,this}},{key:"render",value:function(){return this.renderModels(),this}},{key:"active",value:function(l){var d={};return d.enableHighlight=ra()(l)?!0:l,ra()(l)?(d.enableHighlight=!0,l.color&&(d.highlightColor=l.color)):d.enableHighlight=!!l,this.updateLayerConfig(d),this}},{key:"setActive",value:function(l,d){var _=this;if(ra()(l)){var T=l.x,P=T===void 0?0:T,k=l.y,K=k===void 0?0:k;this.updateLayerConfig({highlightColor:ra()(d)?d.color:this.getLayerConfig().highlightColor}),this.pick({x:P,y:K})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:ra()(d)?d.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,Oe.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"select",value:function(l){var d={};return d.enableSelect=ra()(l)?!0:l,ra()(l)?(d.enableSelect=!0,l.color&&(d.selectColor=l.color)):d.enableSelect=!!l,this.updateLayerConfig(d),this}},{key:"setSelect",value:function(l,d){var _=this;if(ra()(l)){var T=l.x,P=T===void 0?0:T,k=l.y,K=k===void 0?0:k;this.updateLayerConfig({selectColor:ra()(d)?d.color:this.getLayerConfig().selectColor}),this.pick({x:P,y:K})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:ra()(d)?d.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,Oe.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),d=this.getLayerConfig(),_=d.visible,T=d.minZoom,P=T===void 0?-Infinity:T,k=d.maxZoom,K=k===void 0?Infinity:k;return!!_&&l>=P&&l<=K}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),d=l.minZoom;return d}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),d=l.maxZoom;return d}},{key:"get",value:function(l){var d=this.getLayerConfig();return d[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var d=this.getSource(),_=d.extent,T=_.some(function(P){return Math.abs(P)===Infinity});return T?this:(this.mapService.fitBounds([[_[0],_[1]],[_[2],_[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var d=this.mapService.getZoom();this.layerSource.updateClusterData(d)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getConfigSchemaForValidation",value:function(){return this.configSchema||(this.configSchema=gu()([Pl,this.getConfigSchema()])),this.configSchema}},{key:"getLegendItems",value:function(l){var d=this.styleAttributeService.getLayerAttributeScale(l);if(d){if(d.ticks){var _=d.ticks().map(function(P){return(0,F.Z)({value:P},l,d(P))});return _}else if(d.invertExtent){var T=d.range().map(function(P){return(0,F.Z)({value:d.invertExtent(P)},l,P)});return T}}else return[]}},{key:"pick",value:function(l){var d=l.x,_=l.y;this.interactionService.triggerHover({x:d,y:_})}},{key:"boxSelect",value:function(l,d){this.pickingService.boxPickLayer(this,l,d)}},{key:"buildLayerModel",value:function(l){var d=l.moduleName,_=l.vertexShader,T=l.fragmentShader,P=l.triangulation,k=(0,mi.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation"]);this.shaderModuleService.registerModule(d,{vs:_,fs:T});var K=this.shaderModuleService.getModule(d),H=K.vs,de=K.fs,Ge=K.uniforms,ft=this.rendererService.createModel,Ut=this.styleAttributeService.createAttributesAndIndices(this.encodedData,P),gr=Ut.attributes,Ir=Ut.elements;return ft(Vi({attributes:gr,uniforms:Ge,fs:de,vs:H,elements:Ir,blend:qi[S.BlendType.normal]},k))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var d=this.getLayerConfig(),_=d.enableHighlight,T=_===void 0?!0:_,P=d.enableSelect,k=P===void 0?!0:P,K=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&k&&(K=!0),l==="mousemove"&&(T||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(K=!0),this.isVisible()&&K}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:l.layerModel.getUninforms()})}),this}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,d){return{values:ua()(l)?void 0:l||d,callback:ua()(l)?l:void 0}}},{key:"updateStyleAttribute",value:function(l,d,_,T){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:Vi({field:d},this.splitValuesAndCallbackInAttribute(_,this.getLayerConfig()[d]))},T):this.pendingStyleAttributes.push({attributeName:l,attributeField:d,attributeValues:_,updateOptions:T})}}]),a}(Nt.EventEmitter),qt),it=(0,kn.Z)(la.prototype,"logger",[ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pe=(0,kn.Z)(la.prototype,"configService",[$a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ke=(0,kn.Z)(la.prototype,"shaderModuleService",[Ha],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),la),Qu,rs,ds,ao,Ds,su,xa=(Qu=(0,S.yT)(S.vK.IGlobalConfigService),rs=(0,S.yT)(S.vK.IShaderModuleService),ds=(su=function(){function n(u){(0,ce.Z)(this,n),this.triangulation=void 0,this.layer=void 0,(0,Fn.Z)(this,"configService",ao,this),(0,Fn.Z)(this,"shaderModuleService",Ds,this),this.rendererService=void 0,this.iconService=void 0,this.fontService=void 0,this.styleAttributeService=void 0,this.mapService=void 0,this.cameraService=void 0,this.layerService=void 0,this.layer=u,this.rendererService=u.getContainer().get(S.vK.IRendererService),this.styleAttributeService=u.getContainer().get(S.vK.IStyleAttributeService),this.mapService=u.getContainer().get(S.vK.IMapService),this.iconService=u.getContainer().get(S.vK.IIconService),this.fontService=u.getContainer().get(S.vK.IFontService),this.cameraService=u.getContainer().get(S.vK.ICameraService),this.layerService=u.getContainer().get(S.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate()}return(0,q.Z)(n,[{key:"getBlend",value:function(){var a=this.layer.getLayerConfig(),s=a.blend,l=s===void 0?"normal":s;return qi[S.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.duration||4,a.interval||.2,a.trailLength||.1]}},{key:"startModelAnimate",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),n}(),su),ao=(0,kn.Z)(ds.prototype,"configService",[Qu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ds=(0,kn.Z)(ds.prototype,"shaderModuleService",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ds),bi=y(66156),Ja=y(31727),ba=y.n(Ja),Co=y(52371);function oo(){var n=new Co.WT(2);return Co.WT!=Float32Array&&(n[0]=0,n[1]=0),n}function cl(n){var u=new glMatrix.ARRAY_TYPE(2);return u[0]=n[0],u[1]=n[1],u}function Ve(n,u){var a=new Co.WT(2);return a[0]=n,a[1]=u,a}function Ft(n,u){return n[0]=u[0],n[1]=u[1],n}function br(n,u,a){return n[0]=u,n[1]=a,n}function Cn(n,u,a){return n[0]=u[0]+a[0],n[1]=u[1]+a[1],n}function Yi(n,u,a){return n[0]=u[0]-a[0],n[1]=u[1]-a[1],n}function Aa(n,u,a){return n[0]=u[0]*a[0],n[1]=u[1]*a[1],n}function za(n,u,a){return n[0]=u[0]/a[0],n[1]=u[1]/a[1],n}function sa(n,u){return n[0]=Math.ceil(u[0]),n[1]=Math.ceil(u[1]),n}function La(n,u){return n[0]=Math.floor(u[0]),n[1]=Math.floor(u[1]),n}function vs(n,u,a){return n[0]=Math.min(u[0],a[0]),n[1]=Math.min(u[1],a[1]),n}function ks(n,u,a){return n[0]=Math.max(u[0],a[0]),n[1]=Math.max(u[1],a[1]),n}function ha(n,u){return n[0]=Math.round(u[0]),n[1]=Math.round(u[1]),n}function fl(n,u,a){return n[0]=u[0]*a,n[1]=u[1]*a,n}function xu(n,u,a,s){return n[0]=u[0]+a[0]*s,n[1]=u[1]+a[1]*s,n}function ms(n,u){var a=u[0]-n[0],s=u[1]-n[1];return Math.hypot(a,s)}function Ml(n,u){var a=u[0]-n[0],s=u[1]-n[1];return a*a+s*s}function zu(n){var u=n[0],a=n[1];return Math.hypot(u,a)}function qu(n){var u=n[0],a=n[1];return u*u+a*a}function Fs(n,u){return n[0]=-u[0],n[1]=-u[1],n}function Il(n,u){return n[0]=1/u[0],n[1]=1/u[1],n}function gs(n,u){var a=u[0],s=u[1],l=a*a+s*s;return l>0&&(l=1/Math.sqrt(l)),n[0]=u[0]*l,n[1]=u[1]*l,n}function Jl(n,u){return n[0]*u[0]+n[1]*u[1]}function Df(n,u,a){var s=u[0]*a[1]-u[1]*a[0];return n[0]=n[1]=0,n[2]=s,n}function Ca(n,u,a,s){var l=u[0],d=u[1];return n[0]=l+s*(a[0]-l),n[1]=d+s*(a[1]-d),n}function $f(n,u){u=u||1;var a=glMatrix.RANDOM()*2*Math.PI;return n[0]=Math.cos(a)*u,n[1]=Math.sin(a)*u,n}function Uc(n,u,a){var s=u[0],l=u[1];return n[0]=a[0]*s+a[2]*l,n[1]=a[1]*s+a[3]*l,n}function af(n,u,a){var s=u[0],l=u[1];return n[0]=a[0]*s+a[2]*l+a[4],n[1]=a[1]*s+a[3]*l+a[5],n}function Ef(n,u,a){var s=u[0],l=u[1];return n[0]=a[0]*s+a[3]*l+a[6],n[1]=a[1]*s+a[4]*l+a[7],n}function of(n,u,a){var s=u[0],l=u[1];return n[0]=a[0]*s+a[4]*l+a[12],n[1]=a[1]*s+a[5]*l+a[13],n}function go(n,u,a,s){var l=u[0]-a[0],d=u[1]-a[1],_=Math.sin(s),T=Math.cos(s);return n[0]=l*T-d*_+a[0],n[1]=l*_+d*T+a[1],n}function Ol(n,u){var a=n[0],s=n[1],l=u[0],d=u[1],_=Math.sqrt(a*a+s*s)*Math.sqrt(l*l+d*d),T=_&&(a*l+s*d)/_;return Math.acos(Math.min(Math.max(T,-1),1))}function Ll(n){return n[0]=0,n[1]=0,n}function Es(n){return"vec2("+n[0]+", "+n[1]+")"}function sf(n,u){return n[0]===u[0]&&n[1]===u[1]}function Rl(n,u){var a=n[0],s=n[1],l=u[0],d=u[1];return Math.abs(a-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(s-d)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))}var Bu=null,Po=Yi,uf=null,bu=null,hl=null,kf=null,Dl=null,Ra=function(){var n=oo();return function(u,a,s,l,d,_){var T,P;for(a||(a=2),s||(s=0),l?P=Math.min(l*a+s,u.length):P=u.length,T=s;T<P;T+=a)n[0]=u[T],n[1]=u[T+1],d(n,n,_),u[T]=n[0],u[T+1]=n[1];return u}}(),uu=oo(),vc=oo(),Mo=oo(),ns=oo(),kl=oo();function Fl(n,u,a,s,l){Cn(n,a,s),gs(n,n),u=Ve(-n[1],n[0]);var d=Ve(-a[1],a[0]);return[l/Jl(u,d),u]}function Su(n,u){return br(n,-u[1],u[0])}function lu(n,u,a){return Po(n,u,a),gs(n,n),n}function cu(n,u){return n[0]===u[0]&&n[1]===u[1]}function Ql(n){for(var u=new Map,a=0;a<n.length;a++){var s=n[0].toString()+"-"+n[1].toString();u.get(s)?(n.splice(a,1),a++):u.set(s,s)}return n}var Nl=function(){function n(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ce.Z)(this,n),this.complex=void 0,this.join=void 0,this.cap=void 0,this.miterLimit=void 0,this.thickness=void 0,this.normal=void 0,this.lastFlip=-1,this.miter=Ve(0,0),this.started=!1,this.dash=!1,this.totalDistance=0,this.join=u.join||"miter",this.cap=u.cap||"butt",this.miterLimit=u.miterLimit||10,this.thickness=u.thickness||1,this.dash=u.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,q.Z)(n,[{key:"extrude_gaode2",value:function(a,s){var l=this.complex;if(a.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var d=a.length,_=l.startIndex,T=1;T<d;T++){var P=a[T-1],k=s[T-1],K=a[T],H=s[T],de=T<a.length-1?a[T+1]:null,Ge=T<s.length-1?s[T+1]:null,ft=this.segment_gaode2(l,_,P,K,de,k,H,Ge);_+=ft}if(this.dash)for(var Ut=0;Ut<l.positions.length/6;Ut++)l.positions[Ut*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(a){var s=this.complex;if(a.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=a.length,d=s.startIndex,_=1;_<l;_++){var T=a[_-1],P=a[_],k=_<a.length-1?a[_+1]:null,K=this.segment(s,d,T,P,k);d+=K}if(this.dash)for(var H=0;H<s.positions.length/6;H++)s.positions[H*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(a,s,l,d,_,T,P,k){var K=0,H=a.indices,de=a.positions,Ge=a.normals,ft=this.cap==="square",Ut=this.join==="bevel",gr=(0,Oe.Z)([P[0],P[1]]),Ir=(0,Oe.Z)([T[0],T[1]]);lu(Mo,d,l);var Hr=0;if(this.dash&&(Hr=this.lineSegmentDistance(gr,Ir),this.totalDistance+=Hr),this.normal||(this.normal=oo(),Su(this.normal,Mo)),!this.started)if(this.started=!0,ft){var pn=oo(),wn=oo();Cn(pn,this.normal,Mo),Cn(wn,this.normal,Mo),Ge.push(wn[0],wn[1],0),Ge.push(pn[0],pn[1],0),de.push(l[0],l[1],0,this.totalDistance-Hr,-this.thickness,0),de.push(l[0],l[1],0,this.totalDistance-Hr,this.thickness,0)}else this.extrusions(de,Ge,l,this.normal,this.thickness,this.totalDistance-Hr);if(H.push(s+0,s+1,s+2),_){cu(d,_)&&Cn(_,d,gs(_,Yi(_,d,l))),lu(ns,_,d);var qn=Fl(kl,oo(),Mo,ns,this.thickness),Qi=(0,te.Z)(qn,2),Oa=Qi[0],ka=Qi[1],hi=Jl(kl,this.normal)<0?-1:1,Ta=Ut;if(!Ta&&this.join==="miter"){var ro=Oa;ro>this.miterLimit&&(Ta=!0)}Ta?(Ge.push(this.normal[0],this.normal[1],0),Ge.push(ka[0],ka[1],0),de.push(d[0],d[1],0,this.totalDistance,-this.thickness*hi,0),de.push(d[0],d[1],0,this.totalDistance,this.thickness*hi,0),H.push.apply(H,(0,bi.Z)(this.lastFlip!==-hi?[s,s+2,s+3]:[s+2,s+1,s+3])),H.push(s+2,s+3,s+4),Su(uu,ns),Ft(this.normal,uu),Ge.push(this.normal[0],this.normal[1],0),de.push(d[0],d[1],0,this.totalDistance,-this.thickness*hi,0),K+=3):(this.extrusions(de,Ge,d,ka,Oa,this.totalDistance),H.push.apply(H,(0,bi.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),hi=-1,Ft(this.normal,ka),K+=2),this.lastFlip=hi}else{if(Su(this.normal,Mo),ft){var Wn=oo(),Ii=oo();Po(Ii,Mo,this.normal),Cn(Wn,Mo,this.normal),Ge.push(Ii[0],Ii[1],0),Ge.push(Wn[0],Wn[1],0),de.push(d[0],d[1],0,this.totalDistance,this.thickness,0),de.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(de,Ge,d,this.normal,this.thickness,this.totalDistance);H.push.apply(H,(0,bi.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),K+=2}return K}},{key:"segment",value:function(a,s,l,d,_){var T=0,P=a.indices,k=a.positions,K=a.normals,H=this.cap==="square",de=this.join==="bevel",Ge=(0,Oe.Z)([d[0],d[1]]),ft=(0,Oe.Z)([l[0],l[1]]);lu(Mo,Ge,ft);var Ut=0;if(this.dash&&(Ut=this.lineSegmentDistance(Ge,ft),this.totalDistance+=Ut),this.normal||(this.normal=oo(),Su(this.normal,Mo)),!this.started)if(this.started=!0,H){var gr=oo(),Ir=oo();Cn(gr,this.normal,Mo),Cn(Ir,this.normal,Mo),K.push(Ir[0],Ir[1],0),K.push(gr[0],gr[1],0),k.push(l[0],l[1],0,this.totalDistance-Ut,-this.thickness,0),k.push(l[0],l[1],0,this.totalDistance-Ut,this.thickness,0)}else this.extrusions(k,K,l,this.normal,this.thickness,this.totalDistance-Ut);if(P.push(s+0,s+1,s+2),_){var wn=(0,Oe.Z)([_[0],_[1]]);cu(Ge,wn)&&Cn(wn,Ge,gs(wn,Yi(wn,Ge,ft))),lu(ns,wn,Ge);var Wn=Fl(kl,oo(),Mo,ns,this.thickness),Ii=(0,te.Z)(Wn,2),qn=Ii[0],Qi=Ii[1],Oa=Jl(kl,this.normal)<0?-1:1,ka=de;if(!ka&&this.join==="miter"){var hi=qn;hi>this.miterLimit&&(ka=!0)}ka?(K.push(this.normal[0],this.normal[1],0),K.push(Qi[0],Qi[1],0),k.push(d[0],d[1],0,this.totalDistance,-this.thickness*Oa,0),k.push(d[0],d[1],0,this.totalDistance,this.thickness*Oa,0),P.push.apply(P,(0,bi.Z)(this.lastFlip!==-Oa?[s,s+2,s+3]:[s+2,s+1,s+3])),P.push(s+2,s+3,s+4),Su(uu,ns),Ft(this.normal,uu),K.push(this.normal[0],this.normal[1],0),k.push(d[0],d[1],0,this.totalDistance,-this.thickness*Oa,0),T+=3):(this.extrusions(k,K,d,Qi,qn,this.totalDistance),P.push.apply(P,(0,bi.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),Oa=-1,Ft(this.normal,Qi),T+=2),this.lastFlip=Oa}else{if(Su(this.normal,Mo),H){var Hr=oo(),pn=oo();Po(pn,Mo,this.normal),Cn(Hr,Mo,this.normal),K.push(pn[0],pn[1],0),K.push(Hr[0],Hr[1],0),k.push(d[0],d[1],0,this.totalDistance,this.thickness,0),k.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(k,K,d,this.normal,this.thickness,this.totalDistance);P.push.apply(P,(0,bi.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),T+=2}return T}},{key:"extrusions",value:function(a,s,l,d,_,T){s.push(d[0],d[1],0),s.push(d[0],d[1],0),a.push(l[0],l[1],0,T,-_,0),a.push(l[0],l[1],0,T,_,0)}},{key:"lineSegmentDistance",value:function(a,s){var l=s[0]-a[0],d=s[1]-a[1];return Math.sqrt(l*l+d*d)}}]),n}(),pl=y(81763),ql=y.n(pl);function qs(n){if(ql()(n[0]))return n;if(ql()(n[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(ql()(n[0][0][0])){var u=n,a=0,s=0,l=0;return u.forEach(function(d){d.forEach(function(_){a+=_[0],s+=_[1],l++})}),[a/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function is(){var n=new Co.WT(3);return Co.WT!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function zl(n){var u=new Co.WT(3);return u[0]=n[0],u[1]=n[1],u[2]=n[2],u}function jc(n){var u=n[0],a=n[1],s=n[2];return Math.hypot(u,a,s)}function dl(n,u,a){var s=new Co.WT(3);return s[0]=n,s[1]=u,s[2]=a,s}function el(n,u){return n[0]=u[0],n[1]=u[1],n[2]=u[2],n}function ec(n,u,a,s){return n[0]=u,n[1]=a,n[2]=s,n}function Zc(n,u,a){return n[0]=u[0]+a[0],n[1]=u[1]+a[1],n[2]=u[2]+a[2],n}function tl(n,u,a){return n[0]=u[0]-a[0],n[1]=u[1]-a[1],n[2]=u[2]-a[2],n}function Bl(n,u,a){return n[0]=u[0]*a[0],n[1]=u[1]*a[1],n[2]=u[2]*a[2],n}function mc(n,u,a){return n[0]=u[0]/a[0],n[1]=u[1]/a[1],n[2]=u[2]/a[2],n}function rl(n,u){return n[0]=Math.ceil(u[0]),n[1]=Math.ceil(u[1]),n[2]=Math.ceil(u[2]),n}function Vc(n,u){return n[0]=Math.floor(u[0]),n[1]=Math.floor(u[1]),n[2]=Math.floor(u[2]),n}function lf(n,u,a){return n[0]=Math.min(u[0],a[0]),n[1]=Math.min(u[1],a[1]),n[2]=Math.min(u[2],a[2]),n}function cf(n,u,a){return n[0]=Math.max(u[0],a[0]),n[1]=Math.max(u[1],a[1]),n[2]=Math.max(u[2],a[2]),n}function Ul(n,u){return n[0]=Math.round(u[0]),n[1]=Math.round(u[1]),n[2]=Math.round(u[2]),n}function Gc(n,u,a){return n[0]=u[0]*a,n[1]=u[1]*a,n[2]=u[2]*a,n}function Hc(n,u,a,s){return n[0]=u[0]+a[0]*s,n[1]=u[1]+a[1]*s,n[2]=u[2]+a[2]*s,n}function gc(n,u){var a=u[0]-n[0],s=u[1]-n[1],l=u[2]-n[2];return Math.hypot(a,s,l)}function nl(n,u){var a=u[0]-n[0],s=u[1]-n[1],l=u[2]-n[2];return a*a+s*s+l*l}function Wc(n){var u=n[0],a=n[1],s=n[2];return u*u+a*a+s*s}function Eu(n,u){return n[0]=-u[0],n[1]=-u[1],n[2]=-u[2],n}function Ia(n,u){return n[0]=1/u[0],n[1]=1/u[1],n[2]=1/u[2],n}function jl(n,u){var a=u[0],s=u[1],l=u[2],d=a*a+s*s+l*l;return d>0&&(d=1/Math.sqrt(d)),n[0]=u[0]*d,n[1]=u[1]*d,n[2]=u[2]*d,n}function wu(n,u){return n[0]*u[0]+n[1]*u[1]+n[2]*u[2]}function Uu(n,u,a){var s=u[0],l=u[1],d=u[2],_=a[0],T=a[1],P=a[2];return n[0]=l*P-d*T,n[1]=d*_-s*P,n[2]=s*T-l*_,n}function zi(n,u,a,s){var l=u[0],d=u[1],_=u[2];return n[0]=l+s*(a[0]-l),n[1]=d+s*(a[1]-d),n[2]=_+s*(a[2]-_),n}function Pa(n,u,a,s,l,d){var _=d*d,T=_*(2*d-3)+1,P=_*(d-2)+d,k=_*(d-1),K=_*(3-2*d);return n[0]=u[0]*T+a[0]*P+s[0]*k+l[0]*K,n[1]=u[1]*T+a[1]*P+s[1]*k+l[1]*K,n[2]=u[2]*T+a[2]*P+s[2]*k+l[2]*K,n}function Ma(n,u,a,s,l,d){var _=1-d,T=_*_,P=d*d,k=T*_,K=3*d*T,H=3*P*_,de=P*d;return n[0]=u[0]*k+a[0]*K+s[0]*H+l[0]*de,n[1]=u[1]*k+a[1]*K+s[1]*H+l[1]*de,n[2]=u[2]*k+a[2]*K+s[2]*H+l[2]*de,n}function tc(n,u){u=u||1;var a=Co.FD()*2*Math.PI,s=Co.FD()*2-1,l=Math.sqrt(1-s*s)*u;return n[0]=Math.cos(a)*l,n[1]=Math.sin(a)*l,n[2]=s*u,n}function Zl(n,u,a){var s=u[0],l=u[1],d=u[2],_=a[3]*s+a[7]*l+a[11]*d+a[15];return _=_||1,n[0]=(a[0]*s+a[4]*l+a[8]*d+a[12])/_,n[1]=(a[1]*s+a[5]*l+a[9]*d+a[13])/_,n[2]=(a[2]*s+a[6]*l+a[10]*d+a[14])/_,n}function rc(n,u,a){var s=u[0],l=u[1],d=u[2];return n[0]=s*a[0]+l*a[3]+d*a[6],n[1]=s*a[1]+l*a[4]+d*a[7],n[2]=s*a[2]+l*a[5]+d*a[8],n}function wf(n,u,a){var s=a[0],l=a[1],d=a[2],_=a[3],T=u[0],P=u[1],k=u[2],K=l*k-d*P,H=d*T-s*k,de=s*P-l*T,Ge=l*de-d*H,ft=d*K-s*de,Ut=s*H-l*K,gr=_*2;return K*=gr,H*=gr,de*=gr,Ge*=2,ft*=2,Ut*=2,n[0]=T+K+Ge,n[1]=P+H+ft,n[2]=k+de+Ut,n}function Tf(n,u,a,s){var l=[],d=[];return l[0]=u[0]-a[0],l[1]=u[1]-a[1],l[2]=u[2]-a[2],d[0]=l[0],d[1]=l[1]*Math.cos(s)-l[2]*Math.sin(s),d[2]=l[1]*Math.sin(s)+l[2]*Math.cos(s),n[0]=d[0]+a[0],n[1]=d[1]+a[1],n[2]=d[2]+a[2],n}function Vl(n,u,a,s){var l=[],d=[];return l[0]=u[0]-a[0],l[1]=u[1]-a[1],l[2]=u[2]-a[2],d[0]=l[2]*Math.sin(s)+l[0]*Math.cos(s),d[1]=l[1],d[2]=l[2]*Math.cos(s)-l[0]*Math.sin(s),n[0]=d[0]+a[0],n[1]=d[1]+a[1],n[2]=d[2]+a[2],n}function ju(n,u,a,s){var l=[],d=[];return l[0]=u[0]-a[0],l[1]=u[1]-a[1],l[2]=u[2]-a[2],d[0]=l[0]*Math.cos(s)-l[1]*Math.sin(s),d[1]=l[0]*Math.sin(s)+l[1]*Math.cos(s),d[2]=l[2],n[0]=d[0]+a[0],n[1]=d[1]+a[1],n[2]=d[2]+a[2],n}function Zu(n,u){var a=n[0],s=n[1],l=n[2],d=u[0],_=u[1],T=u[2],P=Math.sqrt(a*a+s*s+l*l),k=Math.sqrt(d*d+_*_+T*T),K=P*k,H=K&&wu(n,u)/K;return Math.acos(Math.min(Math.max(H,-1),1))}function Qa(n){return n[0]=0,n[1]=0,n[2]=0,n}function ys(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function vl(n,u){return n[0]===u[0]&&n[1]===u[1]&&n[2]===u[2]}function so(n,u){var a=n[0],s=n[1],l=n[2],d=u[0],_=u[1],T=u[2];return Math.abs(a-d)<=Co.Ib*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-_)<=Co.Ib*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(l-T)<=Co.Ib*Math.max(1,Math.abs(l),Math.abs(T))}var Tn=tl,Ns=Bl,nc=mc,ml=gc,eu=nl,Zs=jc,gl=Wc,en=function(){var n=is();return function(u,a,s,l,d,_){var T,P;for(a||(a=3),s||(s=0),l?P=Math.min(l*a+s,u.length):P=u.length,T=s;T<P;T+=a)n[0]=u[T],n[1]=u[T+1],n[2]=u[T+2],d(n,n,_),u[T]=n[0],u[T+1]=n[1],u[T+2]=n[2];return u}}();function Xc(n){var u=n[0][0],a=n[0][n[0].length-1];u[0]===a[0]&&u[1]===a[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var s=n[0].length,l=ba().flatten(n),d=l.vertices,_=l.dimensions,T=[],P=[],k=0;k<d.length/_;k++)_===2?T.push(d[k*2],d[k*2+1],1):T.push(d[k*3],d[k*3+1],1);var K=ba()(l.vertices,l.holes,l.dimensions);P.push.apply(P,(0,bi.Z)(K));for(var H=function(ft){var Ut=l.vertices.slice(ft*_,(ft+1)*_),gr=l.vertices.slice((ft+1)*_,(ft+2)*_);gr.length===0&&(gr=l.vertices.slice(0,_));var Ir=T.length/3;T.push(Ut[0],Ut[1],1,gr[0],gr[1],1,Ut[0],Ut[1],0,gr[0],gr[1],0),P.push.apply(P,(0,bi.Z)([0,2,1,2,3,1].map(function(Hr){return Hr+Ir})))},de=0;de<s;de++)H(de);return{positions:T,index:P}}function yc(n){var u=ba().flatten(n),a=ba()(u.vertices,u.holes,u.dimensions);return{positions:u.vertices,index:a}}function Vu(n){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=n[0][0],s=n[0][n[0].length-1];a[0]===s[0]&&a[1]===s[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var l=n[0].length,d=ba().flatten(n),_=d.vertices,T=d.dimensions,P=[],k=[],K=[],H=0;H<_.length/T;H++)T===2?P.push(_[H*2],_[H*2+1],1,-1,-1):P.push(_[H*3],_[H*3+1],1,-1,-1),K.push(0,0,1);var de=ba()(d.vertices,d.holes,d.dimensions);k.push.apply(k,(0,bi.Z)(de));for(var Ge=function(gr){var Ir=d.vertices.slice(gr*T,(gr+1)*T),Hr=d.vertices.slice((gr+1)*T,(gr+2)*T);Hr.length===0&&(Hr=d.vertices.slice(0,T));var pn=P.length/5;P.push(Ir[0],Ir[1],1,0,0,Hr[0],Hr[1],1,.1,0,Ir[0],Ir[1],0,0,.8,Hr[0],Hr[1],0,.1,.8);var wn=tu([Hr[0],Hr[1],1],[Ir[0],Ir[1],0],[Ir[0],Ir[1],1],u);K.push.apply(K,(0,bi.Z)(wn).concat((0,bi.Z)(wn),(0,bi.Z)(wn),(0,bi.Z)(wn))),k.push.apply(k,(0,bi.Z)([1,2,0,3,2,1].map(function(Wn){return Wn+pn})))},ft=0;ft<l;ft++)Ge(ft);return{positions:P,index:k,normals:K}}function tu(n,u,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=is(),d=is(),_=is();s&&(n=(0,Oe.vP)(n),u=(0,Oe.vP)(u),a=(0,Oe.vP)(a));var T=dl.apply(V,(0,bi.Z)(n)),P=dl.apply(V,(0,bi.Z)(u)),k=dl.apply(V,(0,bi.Z)(a));Tn(l,k,P),Tn(d,T,P),Uu(_,l,d);var K=is();return jl(K,_),K}var Ba,Tu;(function(n){n.CYLINDER="cylinder",n.SQUARECOLUMN="squareColumn",n.TRIANGLECOLUMN="triangleColumn",n.HEXAGONCOLUMN="hexagonColumn",n.PENTAGONCOLUMN="pentagonColumn"})(Tu||(Tu={}));var Au;(function(n){n.CIRCLE="circle",n.SQUARE="square",n.TRIANGLE="triangle",n.HEXAGON="hexagon",n.PENTAGON="pentagon"})(Au||(Au={}));function Wo(n){for(var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=Math.PI*2/n,s=[],l=0;l<n;l++)s.push(a*l+u*Math.PI/12);var d=s.map(function(_){var T=Math.sin(_+Math.PI/4),P=Math.cos(_+Math.PI/4);return[T,P,0]});return d}function Cu(){return Wo(30)}function il(){return Wo(4)}function yl(){return Wo(3)}function Kc(){return Wo(6,1)}function _c(){return Wo(5)}var ws=(Ba={},(0,F.Z)(Ba,Au.CIRCLE,Cu),(0,F.Z)(Ba,Au.HEXAGON,Kc),(0,F.Z)(Ba,Au.TRIANGLE,yl),(0,F.Z)(Ba,Au.SQUARE,il),(0,F.Z)(Ba,Au.PENTAGON,_c),(0,F.Z)(Ba,Tu.CYLINDER,Cu),(0,F.Z)(Ba,Tu.HEXAGONCOLUMN,Kc),(0,F.Z)(Ba,Tu.TRIANGLECOLUMN,yl),(0,F.Z)(Ba,Tu.SQUARECOLUMN,il),(0,F.Z)(Ba,Tu.PENTAGONCOLUMN,_c),Ba),Ts={};function Oi(n){var u=qs(n.coordinates);return{vertices:[].concat((0,bi.Z)(u),(0,bi.Z)(u),(0,bi.Z)(u),(0,bi.Z)(u)),indices:[0,1,2,2,3,0],size:u.length}}function Pu(n){var u=n.shape,a=On(u,!1),s=a.positions,l=a.index,d=a.normals;return{vertices:s,indices:l,normals:d,size:5}}function Xo(n){var u=qs(n.coordinates);return{vertices:(0,bi.Z)(u),indices:[0],size:u.length}}function Io(n){var u=n.coordinates,a=n.originCoordinates,s=n.version,l=new Nl({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var d=u;Array.isArray(d[0][0])||(d=[u]);var _=a;Array.isArray(_[0][0])||(_=[a]);for(var T=0;T<d.length;T++){var P=d[T],k=_[T];l.extrude_gaode2(P,k)}}else{var K=u;Array.isArray(K[0][0])||(K=[u]),K.forEach(function(de){l.extrude(de)})}var H=l.complex;return{vertices:H.positions,indices:H.indices,normals:H.normals,size:6}}function _l(n){var u=n.coordinates,a=ba().flatten(u),s=a.vertices,l=a.dimensions,d=a.holes;return{indices:ba()(s,d,l),vertices:s,size:l}}function Gu(n){var u=n.coordinates,a=Vu(u,!0),s=a.positions,l=a.index,d=a.normals;return{vertices:s,indices:l,normals:d,size:5}}function ru(n){var u=n.shape,a=Fo(u),s=a.positions,l=a.index;return{vertices:s,indices:l,size:3}}function as(n){var u=n.coordinates,a=[].concat((0,bi.Z)(u[0]),[0,0,1,u[1][0],u[0][1],0,1,1],(0,bi.Z)(u[1]),[0,1,0],(0,bi.Z)(u[0]),[0,0,1],(0,bi.Z)(u[1]),[0,1,0,u[0][0],u[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:a,indices:s,size:5}}function Mu(n){for(var u=30,a=n.coordinates,s=[],l=[],d=function(P){s.push(P,1,P,a[0][0],a[0][1],a[1][0],a[1][1],P,-1,P,a[0][0],a[0][1],a[1][0],a[1][1]),P!==u-1&&l.push.apply(l,(0,bi.Z)([0,1,2,1,3,2].map(function(k){return P*2+k})))},_=0;_<u;_++)d(_);return{vertices:s,indices:l,size:7}}function Bn(n){var u=n.coordinates;u.length===2&&u.push(0);var a=n.size,s=Vs(-1,1),l=Vs(1,1),d=Vs(-1,-1),_=Vs(1,-1),T=[].concat((0,bi.Z)(u),(0,bi.Z)(s),(0,bi.Z)(u),(0,bi.Z)(d),(0,bi.Z)(u),(0,bi.Z)(_),(0,bi.Z)(u),(0,bi.Z)(l)),P=[0,1,2,3,0,2];return{vertices:T,indices:P,size:5}}function On(n){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Ts&&Ts[n])return Ts[n];var a=ws[n]?ws[n]():ws.cylinder(),s=Vu([a],u);return Ts[n]=s,s}function xc(n,u){for(var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(n.length/a*3),d,_,T,P=vec3.create(),k=vec3.create(),K=vec3.create(),H=0,de=u.length;H<de;H+=3){d=u[H+0]*3,_=u[H+1]*3,T=u[H+2]*3;var Ge=[n[d],n[d+1]],ft=[n[_],n[_+1]],Ut=[n[T],n[T+1]];s&&(Ge=lngLatToMeters(Ge),ft=lngLatToMeters(ft),Ut=lngLatToMeters(Ut));var gr=Ge,Ir=_slicedToArray(gr,2),Hr=Ir[0],pn=Ir[1],wn=vec3.fromValues(Hr,pn,n[d+2]),Wn=ft,Ii=_slicedToArray(Wn,2),qn=Ii[0],Qi=Ii[1],Oa=vec3.fromValues(qn,Qi,n[_+2]),ka=Ut,hi=_slicedToArray(ka,2),Ta=hi[0],ro=hi[1],Ju=vec3.fromValues(Ta,ro,n[T+2]);vec3.sub(P,Ju,Oa),vec3.sub(k,wn,Oa),vec3.cross(K,P,k),l[d]+=P[0],l[d+1]+=P[1],l[d+2]+=P[2],l[_]+=P[0],l[_+1]+=P[1],l[_+2]+=P[2],l[T]+=P[0],l[T+1]+=P[1],l[T+2]+=P[2]}return os(l),l}function os(n){for(var u=0,a=n.length;u<a;u+=3){var s=vec3.fromValues(n[u],n[u+1],n[u+2]),l=vec3.create();vec3.normalize(l,s),n.set(l,u)}}function bo(n){var u=n[0][0],a=n[0][n[0].length-1];return u[0]===a[0]&&u[1]===a[1]}function Fo(n){var u=["cylinder","triangleColumn","hexagonColumn","squareColumn"],a=ws[n]?ws[n]():ws.circle(),s=u.indexOf(n)===-1?yc([a]):Xc([a]);return s}function Vs(n,u){var a=(n+1)/2,s=(u+1)/2;return[a,s]}function Gs(n){var u=Gl();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Gl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var $i=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,So=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,ff=function(n){(0,we.Z)(a,n);var u=Gs(a);function a(){return(0,ce.Z)(this,a),u.apply(this,arguments)}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.baseColor,P=T===void 0?"rgb(16,16,16)":T,k=l.brightColor,K=k===void 0?"rgb(255,176,38)":k,H=l.windowColor,de=H===void 0?"rgb(30,60,89)":H,Ge=l.time,ft=Ge===void 0?0:Ge;return{u_opacity:_,u_baseColor:(0,Oe.CI)(P),u_brightColor:(0,Oe.CI)(K),u_windowColor:(0,Oe.CI)(de),u_time:this.layer.getLayerAnimateTime()||ft}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:So,fragmentShader:$i,triangulation:Gu})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:S.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_,T,P,k){return k}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,T,P){var k=d.size,K=k===void 0?10:k;return Array.isArray(K)?[K[0]]:[K]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(d,_,T,P){var k=d.size;return[T[3],T[4]]}}})}}]),a}(xa);function xl(n){var u=bc();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function bc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Iu=function(n){(0,we.Z)(a,n);var u=xl(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.type="PolygonLayer",s}return(0,q.Z)(a,[{key:"buildModels",value:function(){this.layerModel=new ff(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),a}(_u);function As(n){var u=bl();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function bl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ou=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Sc=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,ic=function(n){(0,we.Z)(a,n);var u=As(a);function a(){return(0,ce.Z)(this,a),u.apply(this,arguments)}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.coverage,T=l.angle;return{u_opacity:d||1,u_coverage:_||.9,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:Ou,fragmentShader:Sc,triangulation:ru,depth:{enable:!1},primitive:S.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:S.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_){var T=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[T[0],T[1],0]}}})}}]),a}(xa);function Ec(n){var u=Yc();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Yc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ac=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,al=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,wc=function(n){(0,we.Z)(a,n);var u=Ec(a);function a(){return(0,ce.Z)(this,a),u.apply(this,arguments)}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.coverage,T=l.angle;return{u_opacity:d||1,u_coverage:_||1,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:ac,fragmentShader:al,triangulation:Pu,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,T,P){var k=d.size;return Array.isArray(k)?[k[0]]:[k]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:S.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_,T,P,k){return k}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:S.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_){var T=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[T[0],T[1],0]}}})}}]),a}(xa),ma=y(29327);function Hu(n,u){for(var a=[],s=[],l=[],d=n+1,_=u+1,T=n/2,P=u/2,k=0;k<_;k++)for(var K=k-P,H=0;H<d;H++){var de=H-T;s.push(de/T,-K/P,0),l.push(H/n),l.push(1-k/u)}for(var Ge=0;Ge<u;Ge++)for(var ft=0;ft<n;ft++){var Ut=ft+d*Ge,gr=ft+d*(Ge+1),Ir=ft+1+d*(Ge+1),Hr=ft+1+d*Ge;a.push(Ut,gr,Hr),a.push(gr,Ir,Hr)}return{vertices:s,indices:a,uvs:l}}var Sl,nu,Hs;function Tc(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function oc(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?Tc(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Tc(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function hf(n){var u=$c();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function $c(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var c=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,o=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,i=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,h=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,g=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,E=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,C=(Sl=(0,Tt.b2)(),Sl(nu=(Hs=function(n){(0,we.Z)(a,n);var u=hf(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.texture=void 0,s.colorTexture=void 0,s.heatmapFramerBuffer=void 0,s.intensityModel=void 0,s.colorModel=void 0,s.shapeType=void 0,s}return(0,q.Z)(a,[{key:"render",value:function(){var l=this,d=this.rendererService,_=d.clear,T=d.useFramebuffer;T(this.heatmapFramerBuffer,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,d=this.rendererService,_=d.createFramebuffer,T=d.clear,P=d.getViewportSize,k=d.createTexture2D,K=d.useFramebuffer,H=this.styleAttributeService.getLayerStyleAttribute("shape"),de=(H==null||(l=H.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=de,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=de==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Ge=this.layer.getLayerConfig(),ft=Ge.rampColors,Ut=(0,Oe.Cl)(ft),gr=P(),Ir=gr.width,Hr=gr.height;return this.heatmapFramerBuffer=_({color:k({width:Math.floor(Ir/4),height:Math.floor(Hr/4),wrapS:S.gl.CLAMP_TO_EDGE,wrapT:S.gl.CLAMP_TO_EDGE,min:S.gl.LINEAR,mag:S.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:S.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(d,_,T,P){return[T[3],T[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,T,P){var k=d.size,K=k===void 0?1:k;return[K]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:g,fragmentShader:h,triangulation:Bn,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:S.gl.ONE,srcAlpha:1,dstRGB:S.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:E,fs:i});var l=this.shaderModuleService.getModule("heatmapColor"),d=l.vs,_=l.fs,T=l.uniforms,P=this.rendererService,k=P.createAttribute,K=P.createElements,H=P.createBuffer,de=P.createModel;return de({vs:d,fs:_,attributes:{a_Position:k({buffer:H({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:S.gl.FLOAT}),size:3}),a_Uv:k({buffer:H({data:[0,1,1,1,0,0,1,0],type:S.gl.FLOAT}),size:2})},uniforms:oc({},T),depth:{enable:!1},blend:this.getBlend(),count:6,elements:K({data:[0,2,1,2,3,1],type:S.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.intensity,T=_===void 0?10:_,P=l.radius,k=P===void 0?5:P;this.intensityModel.draw({uniforms:{u_opacity:d||1,u_radius:k,u_intensity:T}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=ma.create();ma.invert(_,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,bi.Z)(_)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,d=l(),_=d.width,T=d.height,P=Hu(_/4,T/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:o,fs:c});var k=this.shaderModuleService.getModule("heatmap3dColor"),K=k.vs,H=k.fs,de=k.uniforms,Ge=this.rendererService,ft=Ge.createAttribute,Ut=Ge.createElements,gr=Ge.createBuffer,Ir=Ge.createModel;return Ir({vs:K,fs:H,attributes:{a_Position:ft({buffer:gr({data:P.vertices,type:S.gl.FLOAT}),size:3}),a_Uv:ft({buffer:gr({data:P.uvs,type:S.gl.FLOAT}),size:2})},primitive:S.gl.TRIANGLES,uniforms:oc({},de),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:S.gl.SRC_ALPHA,srcAlpha:1,dstRGB:S.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Ut({data:P.indices,type:S.gl.UNSIGNED_INT,count:P.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var d=this.layer.getLayerConfig(),_=d.rampColors,T=(0,Oe.Cl)(_);this.colorTexture=l({data:new Uint8Array(T.data),width:T.width,height:T.height,wrapS:S.gl.CLAMP_TO_EDGE,wrapT:S.gl.CLAMP_TO_EDGE,min:S.gl.NEAREST,mag:S.gl.NEAREST,flipY:!1})}}]),a}(xa),Hs))||nu);function L(n){var u=Z();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Z(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ne=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,me=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,ye=function(n){(0,we.Z)(a,n);var u=L(a);function a(){return(0,ce.Z)(this,a),u.apply(this,arguments)}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.coverage,T=l.angle;return{u_opacity:d||1,u_coverage:_||.9,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:me,fragmentShader:ne,triangulation:ru,depth:{enable:!1},primitive:S.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:S.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_){var T=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[T[0],T[1],0]}}})}}]),a}(xa),Se={heatmap:C,heatmap3d:C,grid:ic,grid3d:wc,hexagon:ye},Ye=Se;function Xe(n){var u=ct();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function ct(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var $e=function(n){(0,we.Z)(a,n);var u=Xe(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.type="HeatMapLayer",s}return(0,q.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Ye[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,d=this.getModelType();return d==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(_){return _.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=this.getLayerConfig(),T=_.shape3d,P=this.getSource(),k=P.data.type,K=(d==null||(l=d.scale)===null||l===void 0?void 0:l.field)||"heatmap";return K==="heatmap"||K==="heatmap3d"?"heatmap":k==="hexagon"?(T==null?void 0:T.indexOf(K))===-1?"hexagon":"grid3d":k==="grid"?(T==null?void 0:T.indexOf(K))===-1?"grid":"grid3d":"heatmap"}}]),a}(_u);function tt(n){var u=It();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function It(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Mt=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,Sr=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,nr=function(n){(0,we.Z)(a,n);var u=tt(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.texture=void 0,s}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,d=this.layer.getSource(),_=this.rendererService.createTexture2D;return this.texture=_({height:0,width:0}),d.data.images.then(function(T){l.texture=_({data:T[0],width:T[0].width,height:T[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:Sr,fragmentShader:Mt,triangulation:as,primitive:S.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(d,_,T,P){return[T[3],T[4]]}}})}}]),a}(xa),xr={image:nr},Cr=xr;function an(n){var u=Xr();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Xr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var vn=function(n){(0,we.Z)(a,n);var u=an(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.type="ImageLayer",s}return(0,q.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Cr[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={image:{}};return d[l]}},{key:"getModelType",value:function(){return"image"}}]),a}(_u);function An(n){var u=Xn();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Xn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Qn=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // gl_FragColor = v_color;
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= u_opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, v_distance_ratio);
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = 1.0 - fract(arcRadio * count + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/u_opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);

}`,Ci=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  

  vec2 source = a_Instance.rg;
  vec2 target =  a_Instance.ba;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  if(u_line_type == LineTypeDash) {
      v_distance_ratio = segmentIndex / segmentNumber;
      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        v_distance_ratio = 1.0 - v_distance_ratio;
      }
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  v_segmentIndex = a_Position.x + 1.0;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    v_arcDistrance = length(source - target);
    v_iconMapUV = a_iconMapUV;
    v_pixelLen = project_pixel(u_icon_step);
    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Ji={solid:0,dash:1},Sn=function(n){(0,we.Z)(a,n);var u=An(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:S.gl.NEAREST,min:S.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,T=l.targetColor,P=l.textureBlend,k=P===void 0?"normal":P,K=l.lineType,H=K===void 0?"solid":K,de=l.dashArray,Ge=de===void 0?[10,5]:de,ft=l.forward,Ut=ft===void 0?!0:ft,gr=l.lineTexture,Ir=gr===void 0?!1:gr,Hr=l.iconStep,pn=Hr===void 0?100:Hr;Ge.length===2&&Ge.push(0,0);var wn=0,Wn=[0,0,0,0],Ii=[0,0,0,0];return _&&T&&(Wn=(0,Oe.CI)(_),Ii=(0,Oe.CI)(T),wn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_opacity:d===void 0?1:d,u_textureBlend:k==="normal"?0:1,segmentNumber:30,u_line_type:Ji[H||"solid"],u_dash_array:Ge,u_blur:.9,u_lineDir:Ut?1:-1,u_texture:this.texture,u_line_texture:Ir?1:0,u_icon_step:pn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:wn,u_sourceColor:Wn,u_targetColor:Ii}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:Ci,fragmentShader:Qn,triangulation:Mu,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,T,P,k){var K=_.size,H=K===void 0?1:K;return Array.isArray(H)?[H[0]]:[H]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:S.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:4,update:function(_,T,P,k){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(_,T,P,k){var K=l.iconService.getIconMap(),H=_.texture,de=K[H]||{x:0,y:0},Ge=de.x,ft=de.y;return[Ge,ft]}}})}}]),a}(xa);function fi(n){var u=gi();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function gi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Un=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= u_opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/u_opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    

    // gl_FragColor = filterColor(gl_FragColor + pattern);

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,di=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;
varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

   if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step);

    vec2 projectOffset = project_pixel(offset);
    v_offset = projectOffset + projectOffset * sign(a_Position.y);
    v_a = project_pixel(a_Size);
    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Kn={solid:0,dash:1},Si=function(n){(0,we.Z)(a,n);var u=fi(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:S.gl.NEAREST,min:S.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,T=l.targetColor,P=l.textureBlend,k=P===void 0?"normal":P,K=l.lineType,H=K===void 0?"solid":K,de=l.dashArray,Ge=de===void 0?[10,5]:de,ft=l.lineTexture,Ut=ft===void 0?!1:ft,gr=l.iconStep,Ir=gr===void 0?100:gr;Ge.length===2&&Ge.push(0,0);var Hr=0,pn=[0,0,0,0],wn=[0,0,0,0];return _&&T&&(pn=(0,Oe.CI)(_),wn=(0,Oe.CI)(T),Hr=1),this.rendererService.getDirty()&&this.texture.bind(),{u_opacity:d===void 0?1:d,u_textureBlend:k==="normal"?0:1,segmentNumber:30,u_line_type:Kn[H]||0,u_dash_array:Ge,u_texture:this.texture,u_line_texture:Ut?1:0,u_icon_step:Ir,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Hr,u_sourceColor:pn,u_targetColor:wn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:di,fragmentShader:Un,triangulation:Mu,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,T,P,k){var K=_.size,H=K===void 0?1:K;return Array.isArray(H)?[H[0]]:[H]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:S.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:4,update:function(_,T,P,k){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(_,T,P,k){var K=l.iconService.getIconMap(),H=_.texture,de=K[H]||{x:0,y:0},Ge=de.x,ft=de.y;return[Ge,ft]}}})}}]),a}(xa);function Gi(n){var u=yo();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function yo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var uo=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0;
  // gl_FragColor = v_color;
  
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= u_opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
      // float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      // alpha = clamp(alpha, 0.1, 1.0);
      // if(alpha < 0.01) alpha = 0.0;
      gl_FragColor.a *= alpha;
  }

  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);
    // float u = fract(arcRadio * count);
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a;
    }

    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = filterColor(gl_FragColor + pattern);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,Oo=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step)/8.0;

    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,Ua={solid:0,dash:1},Xa=function(n){(0,we.Z)(a,n);var u=Gi(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:S.gl.NEAREST,min:S.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,T=l.targetColor,P=l.textureBlend,k=P===void 0?"normal":P,K=l.lineType,H=K===void 0?"solid":K,de=l.dashArray,Ge=de===void 0?[10,5]:de,ft=l.lineTexture,Ut=ft===void 0?!1:ft,gr=l.iconStep,Ir=gr===void 0?100:gr;Ge.length===2&&Ge.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Hr=0,pn=[0,0,0,0],wn=[0,0,0,0];return _&&T&&(pn=(0,Oe.CI)(_),wn=(0,Oe.CI)(T),Hr=1),{u_opacity:d===void 0?1:d,u_textureBlend:k==="normal"?0:1,segmentNumber:30,u_line_type:Ua[H]||0,u_dash_array:Ge,u_texture:this.texture,u_line_texture:Ut?1:0,u_icon_step:Ir,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Hr,u_sourceColor:pn,u_targetColor:wn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:Oo,fragmentShader:uo,triangulation:Mu,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,T,P,k){var K=_.size,H=K===void 0?1:K;return Array.isArray(H)?[H[0]]:[H]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:S.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:4,update:function(_,T,P,k){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(_,T,P,k){var K=l.iconService.getIconMap(),H=_.texture,de=K[H]||{x:0,y:0},Ge=de.x,ft=de.y;return[Ge,ft]}}})}}]),a}(xa);function Cs(n){var u=Ko();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Wu=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying float v_distance_ratio;
varying vec4 v_dash_array;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
varying float v_strokeWidth;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= u_opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
    // gl_FragColor.a *=(1.0- step(v_dash_array.x, mod(v_distance_ratio, dashLength)));
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);
    float v = length(v_offset)/(v_a*2.0);
    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // float r = max(smoothstep( 0.95, 1.0, v_strokeWidth/(v_a*2.0)), v_strokeWidth/(v_a*2.0));
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // float v = length(v_offset)/(v_a*2.0);
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Lu=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;
varying float v_distance_ratio;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_size;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;
// varying float v_strokeWidth;

void main() {
  
  v_iconMapUV = a_iconMapUV;
  v_distance = a_Distance;
  v_pixelLen = project_pixel(u_icon_step);

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = a_Distance / a_Total_Distance;
    // v_distance_ratio = 0.01;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      v_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;
  v_a = project_pixel(a_Size.x);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);
  // v_strokeWidth = project_pixel(2.0);

  v_offset = offset + offset * sign(a_Miter);

  v_side = a_Miter * a_Size.x;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 10.0, 1.0)); // \u989D\u5916\u9664 10.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,ss={solid:0,dash:1},zs=function(n){(0,we.Z)(a,n);var u=Cs(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:S.gl.NEAREST,min:S.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,T=l.targetColor,P=l.textureBlend,k=P===void 0?"normal":P,K=l.lineType,H=K===void 0?"solid":K,de=l.dashArray,Ge=de===void 0?[10,5,0,0]:de,ft=l.lineTexture,Ut=ft===void 0?!1:ft,gr=l.iconStep,Ir=gr===void 0?100:gr;Ge.length===2&&Ge.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Hr=0,pn=[0,0,0,0],wn=[0,0,0,0];return _&&T&&(pn=(0,Oe.CI)(_),wn=(0,Oe.CI)(T),Hr=1),{u_opacity:d===void 0?1:d,u_textureBlend:k==="normal"?0:1,u_line_type:ss[H],u_dash_array:Ge,u_texture:this.texture,u_line_texture:Ut?1:0,u_icon_step:Ir,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Hr,u_sourceColor:pn,u_targetColor:wn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:Lu,fragmentShader:Wu,triangulation:Io,primitive:S.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.layer.getLayerConfig(),_=d.lineType,T=_===void 0?"solid":_;this.styleAttributeService.registerStyleAttribute({name:"distance",type:S.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(k,K,H,de){return[H[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:S.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(k,K,H,de){return[H[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(k,K,H,de){var Ge=k.size,ft=Ge===void 0?1:Ge;return Array.isArray(ft)?[ft[0],ft[1]]:[ft,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:S.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(k,K,H,de,Ge){return Ge}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:S.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(k,K,H,de){return[H[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(k,K,H,de){var Ge=l.iconService.getIconMap(),ft=k.texture,Ut=Ge[ft]||{x:0,y:0},gr=Ut.x,Ir=Ut.y;return[gr,Ir]}}})}},{key:"loadImage",value:function(l){return new Promise(function(d,_){if(l instanceof HTMLImageElement){d(l);return}var T=new Image;T.crossOrigin="anonymous",T.onload=function(){d(T)},T.onerror=function(){_(new Error("Could not load image at "+l))},T.src=l instanceof File?URL.createObjectURL(l):l})}}]),a}(xa),El={arc:Sn,arc3d:Si,greatcircle:Xa,line:zs},Ac=El;function Ru(n){var u=ol();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function ol(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Hl=function(n){(0,we.Z)(a,n);var u=Ru(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.type="LineLayer",s}return(0,q.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Ac[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return d[l]}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return _||"line"}}]),a}(_u);function Du(n){var u=sc();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function sc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var fu=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,lo=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;
varying vec4 v_color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,hu=function(n){(0,we.Z)(a,n);var u=Du(a);function a(){return(0,ce.Z)(this,a),u.apply(this,arguments)}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.offsets;return{u_opacity:d||1,u_offsets:_||[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:lo,fragmentShader:fu,triangulation:Pu,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_,T,P){var k=d.size;if(k){var K=[];return Array.isArray(k)&&(K=k.length===2?[k[0],k[0],k[1]]:k),Array.isArray(k)||(K=[k]),K}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:S.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_,T,P,k){return k}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:S.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_){var T=qs(d.coordinates);return[T[0],T[1],0]}}})}}]),a}(xa);function wl(n){var u=Ps();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Eo=`#define Animate 0.0

uniform float u_blur : 0;
uniform float u_opacity : 1;
uniform float u_stroke_width : 1;
uniform vec4 u_stroke_color : [0, 0, 0, 0];
uniform float u_stroke_opacity : 1;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  vec4 strokeColor = u_stroke_color == vec4(0) ? v_color : u_stroke_color;
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  // gl_FragColor = v_color * color_t;
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,No=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_stroke_width : 2;
uniform vec2 u_offsets;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Lo=function(n){(0,we.Z)(a,n);var u=wl(a);function a(){return(0,ce.Z)(this,a),u.apply(this,arguments)}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.stroke,P=T===void 0?"rgb(0,0,0,0)":T,k=l.strokeWidth,K=k===void 0?1:k,H=l.strokeOpacity,de=H===void 0?1:H,Ge=l.offsets,ft=Ge===void 0?[0,0]:Ge;return{u_opacity:_,u_stroke_width:K,u_stroke_color:(0,Oe.CI)(P),u_stroke_opacity:de,u_offsets:[-ft[0],ft[1]]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Oi)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:No,fragmentShader:Eo,triangulation:Oi,depth:{enable:!1},blend:this.getBlend()})]}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:S.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(_,T,P,k){var K=[1,1,-1,1,-1,-1,1,-1],H=k%4*2;return[K[H],K[H+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,T,P,k){var K=_.size,H=K===void 0?5:K;return Array.isArray(H)?[H[0]]:[H]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:S.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,T,P,k){var K=_.shape,H=K===void 0?2:K,de=l.layer.getLayerConfig().shape2d,Ge=de.indexOf(H);return[Ge]}}})}}]),a}(xa);function us(n){var u=Ro();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Ro(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ws=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_stroke_width : 1;
uniform vec4 u_stroke_color : [1, 1, 1, 1];
uniform float u_stroke_opacity : 1;
uniform float u_opacity : 1;

varying float v_size;
#pragma include "picking"
void main(){
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Tl=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

#pragma include "projection"
#pragma include "picking"

void main() {
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
   vec2 offset = project_pixel(u_offsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,uc=function(n){(0,we.Z)(a,n);var u=us(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.texture=void 0,s}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:Tl,fragmentShader:Ws,triangulation:Xo,primitive:S.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,T,P,k){var K=_.size;return Array.isArray(K)?[K[0]]:[K]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(_,T,P,k){var K=l.fontService.mapping,H=_.shape,de=l.fontService.getGlyph(H),Ge=K[de],ft=Ge.x,Ut=Ge.y;return[ft,Ut]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.texture=l({data:d,mag:S.gl.LINEAR,min:S.gl.LINEAR,width:d.width,height:d.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),_=d.fontWeight,T=_===void 0?"normal":_,P=d.fontFamily,k=P===void 0?"sans-serif":P,K=this.layer.getEncodedData(),H=[];K.forEach(function(de){var Ge=de.shape,ft=Ge===void 0?"":Ge;ft=ft.toString();var Ut=l.fontService.getGlyph(ft);H.indexOf(Ut)===-1&&H.push(Ut)}),this.fontService.setFontOptions({characterSet:H,fontWeight:T,fontFamily:k,fontSize:48})}}]),a}(xa);function Xu(n){var u=ku();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function ku(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Cc=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_stroke_width : 1;
uniform vec4 u_stroke_color : [1, 1, 1, 1];
uniform float u_stroke_opacity : 1;
uniform float u_opacity : 1;

varying float v_size;
#pragma include "picking"
void main(){
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Al=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

#pragma include "projection"
#pragma include "picking"

void main() {
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
   vec2 offset = project_pixel(u_offsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Ms=function(n){(0,we.Z)(a,n);var u=Xu(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:S.gl.NEAREST,min:S.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.offsets,T=_===void 0?[0,0]:_;return this.rendererService.getDirty()&&this.texture.bind(),{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_offsets:[-T[0],T[1]]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:Al,fragmentShader:Cc,triangulation:Xo,primitive:S.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,T,P,k){var K=_.size,H=K===void 0?5:K;return Array.isArray(H)?[H[0]]:[H]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(_,T,P,k){var K=l.iconService.getIconMap(),H=_.shape,de=K[H]||{x:0,y:0},Ge=de.x,ft=de.y;return[Ge,ft]}}})}}]),a}(xa);function zo(n){var u=xh();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function xh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Jf=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;

#pragma include "picking"
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a =gl_FragColor.a * u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Qf=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform vec2 u_offsets;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  // vec2 offset = project_pixel(u_offsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Ff(n){var u=n.coordinates;return{vertices:(0,bi.Z)(u),indices:[0],size:u.length}}var Af=function(n){(0,we.Z)(a,n);var u=zo(a);function a(){return(0,ce.Z)(this,a),u.apply(this,arguments)}return(0,q.Z)(a,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.stroke,P=T===void 0?"rgb(0,0,0,0)":T,k=l.strokeWidth,K=k===void 0?1:k,H=l.offsets,de=H===void 0?[0,0]:H;return{u_opacity:_,u_stroke_width:K,u_stroke_color:(0,Oe.CI)(P),u_offsets:[-de[0],de[1]]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:Qf,fragmentShader:Jf,triangulation:Ff,depth:{enable:!1},primitive:S.gl.POINTS,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,T,P){var k=d.size,K=k===void 0?1:k;return Array.isArray(K)?[K[0]]:[K]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:S.BlendType.additive}}}]),a}(xa),Jc=y(85263);function Wl(n,u){var a;if(typeof Symbol=="undefined"||n[Symbol.iterator]==null){if(Array.isArray(n)||(a=Cf(n))||u&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){a=n[Symbol.iterator]()},n:function(){var k=a.next();return d=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function Cf(n,u){if(!!n){if(typeof n=="string")return Qc(n,u);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Qc(n,u)}}function Qc(n,u){(u==null||u>n.length)&&(u=n.length);for(var a=0,s=new Array(u);a<u;a++)s[a]=n[a];return s}var Nf=function(){function n(u,a,s){(0,ce.Z)(this,n),this.boxCells=[],this.xCellCount=void 0,this.yCellCount=void 0,this.boxKeys=void 0,this.bboxes=void 0,this.width=void 0,this.height=void 0,this.xScale=void 0,this.yScale=void 0,this.boxUid=void 0;var l=this.boxCells;this.xCellCount=Math.ceil(u/s),this.yCellCount=Math.ceil(a/s);for(var d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=u,this.height=a,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/a,this.boxUid=0}return(0,q.Z)(n,[{key:"insert",value:function(a,s,l,d,_){this.forEachCell(s,l,d,_,this.insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(_)}},{key:"query",value:function(a,s,l,d,_){return this.queryHitTest(a,s,l,d,!1,_)}},{key:"hitTest",value:function(a,s,l,d,_){return this.queryHitTest(a,s,l,d,!0,_)}},{key:"insertBoxCell",value:function(a,s,l,d,_,T){this.boxCells[_].push(T)}},{key:"queryHitTest",value:function(a,s,l,d,_,T){if(l<0||a>this.width||d<0||s>this.height)return _?!1:[];var P=[];if(a<=0&&s<=0&&this.width<=l&&this.height<=d){if(_)return!0;for(var k=0;k<this.boxKeys.length;k++)P.push({key:this.boxKeys[k],x1:this.bboxes[k*4],y1:this.bboxes[k*4+1],x2:this.bboxes[k*4+2],y2:this.bboxes[k*4+3]});return T?P.filter(T):P}var K={hitTest:_,seenUids:{box:{},circle:{}}};return this.forEachCell(a,s,l,d,this.queryCell,P,K,T),_?P.length>0:P}},{key:"queryCell",value:function(a,s,l,d,_,T,P,k){var K=P.seenUids,H=this.boxCells[_];if(H!==null){var de=this.bboxes,Ge=Wl(H),ft;try{for(Ge.s();!(ft=Ge.n()).done;){var Ut=ft.value;if(!K.box[Ut]){K.box[Ut]=!0;var gr=Ut*4;if(a<=de[gr+2]&&s<=de[gr+3]&&l>=de[gr+0]&&d>=de[gr+1]&&(!k||k(this.boxKeys[Ut]))){if(P.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Ut],x1:de[gr],y1:de[gr+1],x2:de[gr+2],y2:de[gr+3]})}}}}catch(Ir){Ge.e(Ir)}finally{Ge.f()}}return!1}},{key:"forEachCell",value:function(a,s,l,d,_,T,P,k){for(var K=this.convertToXCellCoord(a),H=this.convertToYCellCoord(s),de=this.convertToXCellCoord(l),Ge=this.convertToYCellCoord(d),ft=K;ft<=de;ft++)for(var Ut=H;Ut<=Ge;Ut++){var gr=this.xCellCount*Ut+ft;if(_.call(this,a,s,l,d,gr,T,P,k))return}}},{key:"convertToXCellCoord",value:function(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}},{key:"convertToYCellCoord",value:function(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}}]),n}(),Cl=Nf,qc=function(){function n(u,a){(0,ce.Z)(this,n),this.width=void 0,this.height=void 0,this.grid=void 0,this.viewportPadding=100,this.screenRightBoundary=void 0,this.screenBottomBoundary=void 0,this.gridRightBoundary=void 0,this.gridBottomBoundary=void 0,this.width=u,this.height=a,this.viewportPadding=Math.max(u,a),this.grid=new Cl(u+this.viewportPadding,a+this.viewportPadding,25),this.screenRightBoundary=u+this.viewportPadding,this.screenBottomBoundary=a+this.viewportPadding,this.gridRightBoundary=u+2*this.viewportPadding,this.gridBottomBoundary=a+2*this.viewportPadding}return(0,q.Z)(n,[{key:"placeCollisionBox",value:function(a){var s=a.x1+a.anchorPointX+this.viewportPadding,l=a.y1+a.anchorPointY+this.viewportPadding,d=a.x2+a.anchorPointX+this.viewportPadding,_=a.y2+a.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,d,_)||this.grid.hitTest(s,l,d,_)?{box:[]}:{box:[s,l,d,_]}}},{key:"insertCollisionBox",value:function(a,s){var l={featureIndex:s};this.grid.insert(l,a[0],a[1],a[2],a[3])}},{key:"project",value:function(a,s,l){var d=Jc.al(s,l,0,1),_=Jc.Ue(),T=ma.fromValues.apply(ma,(0,bi.Z)(a));return Jc.fF(_,d,T),{x:(_[0]/_[3]+1)/2*this.width+this.viewportPadding,y:(-_[1]/_[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(a,s,l,d){return l>=0&&a<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}}]),n}();function zf(n,u){var a;if(typeof Symbol=="undefined"||n[Symbol.iterator]==null){if(Array.isArray(n)||(a=bh(n))||u&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){a=n[Symbol.iterator]()},n:function(){var k=a.next();return d=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function bh(n,u){if(!!n){if(typeof n=="string")return qf(n,u);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return qf(n,u)}}function qf(n,u){(u==null||u>n.length)&&(u=n.length);for(var a=0,s=new Array(u);a<u;a++)s[a]=n[a];return s}function eh(n){var u=.5,a=.5;switch(n){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0;break;default:u=.5}switch(n){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0;break;default:a=.5}return{horizontalAlign:u,verticalAlign:a}}function Bf(n,u,a,s,l){if(!!l){var d=n[s],_=d.glyph;if(_)for(var T=u[_].advance*d.scale,P=(n[s].x+T)*l,k=a;k<=s;k++)n[k].x-=P}}function th(n,u,a,s,l,d,_){var T=(u-a)*l,P=(-s*_+.5)*d,k=zf(n),K;try{for(k.s();!(K=k.n()).done;){var H=K.value;H.x+=T,H.y+=P}}catch(de){k.e(de)}finally{k.f()}}function rh(n,u,a,s,l,d,_){var T=-8,P=0,k=T,K=0,H=n.positionedGlyphs,de=d==="right"?1:d==="left"?0:.5,Ge=H.length;a.forEach(function(Hr){if(Hr.split("").forEach(function(wn){var Wn=u[wn],Ii=0;Wn&&(H.push({glyph:wn,x:P,y:k+Ii,vertical:!1,scale:1,metrics:Wn}),P+=Wn.advance+_)}),H.length!==Ge){var pn=P-_;K=Math.max(pn,K),Bf(H,u,Ge,H.length-1,de)}P=0,k+=s});var ft=eh(l),Ut=ft.horizontalAlign,gr=ft.verticalAlign;th(H,de,Ut,gr,K,s,a.length);var Ir=k-T;n.top+=-gr*Ir,n.bottom=n.top+Ir,n.left+=-Ut*K,n.right=n.left+K}function Uf(n,u,a,s,l,d,_){var T=-8,P=0,k=T,K=0,H=n.positionedGlyphs,de=d==="right"?1:d==="left"?0:.5,Ge=H.length;a.forEach(function(Hr){var pn=u[Hr],wn=0;if(pn&&(H.push({glyph:Hr,x:P,y:k+wn,vertical:!1,scale:1,metrics:pn}),P+=pn.advance+_),H.length!==Ge){var Wn=P-_;K=Math.max(Wn,K),Bf(H,u,Ge,H.length-1,de)}P=0,k+=s});var ft=eh(l),Ut=ft.horizontalAlign,gr=ft.verticalAlign;th(H,de,Ut,gr,K,s,a.length);var Ir=k-T;n.top+=-gr*Ir,n.bottom=n.top+Ir,n.left+=-Ut*K,n.right=n.left+K}function Sh(n,u,a,s,l,d){var _=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],T=arguments.length>7?arguments[7]:void 0,P=n.split(`
`),k=[],K={positionedGlyphs:k,top:_[1],bottom:_[1],left:_[0],right:_[0],lineCount:P.length,text:n};return T?Uf(K,u,P,a,s,l,d):rh(K,u,P,a,s,l,d),k.length?K:!1}function pu(n){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],a=arguments.length>2?arguments[2]:void 0,s=n.positionedGlyphs,l=s===void 0?[]:s,d=[],_=zf(l),T;try{for(_.s();!(T=_.n()).done;){var P=T.value,k=P.metrics,K=4,H=k.advance*P.scale/2,de=a?[P.x+H,P.y]:[0,0],Ge=a?[0,0]:[P.x+H+u[0],P.y+u[1]],ft=(0-K)*P.scale-H+Ge[0],Ut=(0-K)*P.scale+Ge[1],gr=ft+k.width*P.scale,Ir=Ut+k.height*P.scale,Hr={x:ft,y:Ut},pn={x:gr,y:Ut},wn={x:ft,y:Ir},Wn={x:gr,y:Ir};d.push({tl:Hr,tr:pn,bl:wn,br:Wn,tex:k,glyphOffset:de})}}catch(Ii){_.e(Ii)}finally{_.f()}return d}function pf(n,u){var a;if(typeof Symbol=="undefined"||n[Symbol.iterator]==null){if(Array.isArray(n)||(a=co(n))||u&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){a=n[Symbol.iterator]()},n:function(){var k=a.next();return d=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function co(n,u){if(!!n){if(typeof n=="string")return Pc(n,u);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Pc(n,u)}}function Pc(n,u){(u==null||u>n.length)&&(u=n.length);for(var a=0,s=new Array(u);a<u;a++)s[a]=n[a];return s}function Pf(n){var u=Mc();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Mc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var lc=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform float u_stroke_opacity: 1.0;
uniform vec4 u_stroke : [0, 0, 0, 1];
uniform float u_strokeWidth : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "picking"
void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  lowp float buff = (6.0 - u_strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke.rgb, u_stroke.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Xl=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function B(n){var u=this,a=n.id,s=[],l=[];if(!u.glyphInfoMap||!u.glyphInfoMap[a])return{vertices:[],indices:[],size:7};var d=u.glyphInfoMap[a].centroid,_=d.length===2?[d[0],d[1],0]:d;return u.glyphInfoMap[a].glyphQuads.forEach(function(T,P){s.push.apply(s,(0,bi.Z)(_).concat([T.tex.x,T.tex.y+T.tex.height,T.tl.x,T.tl.y],(0,bi.Z)(_),[T.tex.x+T.tex.width,T.tex.y+T.tex.height,T.tr.x,T.tr.y],(0,bi.Z)(_),[T.tex.x+T.tex.width,T.tex.y,T.br.x,T.br.y],(0,bi.Z)(_),[T.tex.x,T.tex.y,T.bl.x,T.bl.y])),l.push(0+P*4,1+P*4,2+P*4,2+P*4,3+P*4,0+P*4)}),{vertices:s,indices:l,size:7}}var U=function(n){(0,we.Z)(a,n);var u=Pf(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.glyphInfo=void 0,s.glyphInfoMap={},s.texture=void 0,s.currentZoom=-1,s.extent=void 0,s.textureHeight=0,s.textCount=0,s.preTextStyle={},s.buildModels=function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:Xl,fragmentShader:lc,triangulation:B.bind((0,Gt.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]},s}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.stroke,P=T===void 0?"#fff":T,k=l.strokeWidth,K=k===void 0?0:k,H=l.strokeOpacity,de=H===void 0?1:H,Ge=l.textAnchor,ft=Ge===void 0?"center":Ge,Ut=l.textAllowOverlap,gr=Ut===void 0?!1:Ut,Ir=l.halo,Hr=Ir===void 0?.5:Ir,pn=l.gamma,wn=pn===void 0?2:pn,Wn=this.fontService,Ii=Wn.canvas,qn=Wn.mapping;return Object.keys(qn).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(qn).length),this.preTextStyle={textAnchor:ft,textAllowOverlap:gr},{u_opacity:_,u_stroke_opacity:de,u_sdf_map:this.texture,u_stroke:(0,Oe.CI)(P),u_halo_blur:Hr,u_gamma_scale:wn,u_sdf_map_size:[Ii.width,Ii.height],u_strokeWidth:K}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),d=l.textAnchor,_=d===void 0?"center":d,T=l.textAllowOverlap,P=T===void 0?!0:T;return this.preTextStyle={textAnchor:_,textAllowOverlap:P},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),d=l.textAllowOverlap,_=d===void 0?!1:d,T=this.mapService.getZoom(),P=this.mapService.getBounds(),k=(0,Oe.oO)(this.extent,P);return!_&&(Math.abs(this.currentZoom-T)>1||!k)||_!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:S.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,T,P){var k=d.rotate,K=k===void 0?0:k;return Array.isArray(K)?[K[0]]:[K]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:S.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(d,_,T,P){return[T[5],T[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,T,P){var k=d.size,K=k===void 0?12:k;return Array.isArray(K)?[K[0]]:[K]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:S.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(d,_,T,P){return[T[3],T[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,Oe.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,_=d===void 0?"400":d,T=l.fontFamily,P=T===void 0?"sans-serif":T,k=this.layer.getEncodedData(),K=[];k.forEach(function(H){var de=H.shape,Ge=de===void 0?"":de;Ge=Ge.toString();var ft=pf(Ge),Ut;try{for(ft.s();!(Ut=ft.n()).done;){var gr=Ut.value;K.indexOf(gr)===-1&&K.push(gr)}}catch(Ir){ft.e(Ir)}finally{ft.f()}}),this.fontService.setFontOptions({characterSet:K,fontWeight:_,fontFamily:P,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,_=d===void 0?"400":d,T=l.fontFamily,P=T===void 0?"sans-serif":T,k=this.layer.getEncodedData(),K=[];k.forEach(function(H){var de=H.shape,Ge=de===void 0?"":de;Ge=Ge.toString(),K.indexOf(Ge)===-1&&K.push(Ge)}),this.fontService.setFontOptions({characterSet:K,fontWeight:_,fontFamily:P,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var d=this,_=this.fontService.mapping,T=this.layer.getLayerConfig(),P=T.spacing,k=P===void 0?2:P,K=T.textAnchor,H=K===void 0?"center":K,de=T.textOffset,Ge=this.layer.getEncodedData();this.glyphInfo=Ge.map(function(ft){var Ut=ft.shape,gr=Ut===void 0?"":Ut,Ir=ft.id,Hr=ft.size,pn=Hr===void 0?1:Hr,wn=Sh(gr.toString(),_,pn,H,"center",k,de,l),Wn=pu(wn,de,!1);return ft.shaping=wn,ft.glyphQuads=Wn,ft.centroid=qs(ft.coordinates),ft.originCentroid=ft.version==="GAODE2.x"?qs(ft.originCoordinates):ft.originCentroid=ft.centroid,d.glyphInfoMap[Ir]={shaping:wn,glyphQuads:Wn,centroid:qs(ft.coordinates)},ft})}},{key:"filterGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),_=d.padding,T=_===void 0?[4,4]:_,P=d.textAllowOverlap,k=P===void 0?!1:P;if(!k){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var K=this.rendererService.getViewportSize(),H=K.width,de=K.height,Ge=new qc(H,de),ft=this.glyphInfo.filter(function(Ut){var gr=Ut.shaping,Ir=Ut.id,Hr=Ir===void 0?0:Ir,pn=Ut.version==="GAODE2.x"?Ut.originCentroid:Ut.centroid,wn=Ut.size,Wn=wn/24,Ii=l.mapService.lngLatToContainer(pn),qn=Ge.placeCollisionBox({x1:gr.left*Wn-T[0],x2:gr.right*Wn+T[0],y1:gr.top*Wn-T[1],y2:gr.bottom*Wn+T[1],anchorPointX:Ii.x,anchorPointY:Ii.y}),Qi=qn.box;return Qi&&Qi.length?(Ge.insertCollisionBox(Qi,Hr),!0):!1});ft.forEach(function(Ut){l.glyphInfoMap[Ut.id]=Ut})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),d=l.iconfont,_=d===void 0?!1:d;_?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(_)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.textureHeight=d.height,this.texture&&this.texture.destroy(),this.texture=l({data:d,mag:S.gl.LINEAR,min:S.gl.LINEAR,width:d.width,height:d.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Xl,fragmentShader:lc,triangulation:B.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),a}(xa),M={fill:Lo,image:Ms,normal:Af,extrude:hu,text:U,icon:uc},R=M;function ee(n){var u=ge();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function ge(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var rt=function(n){(0,we.Z)(a,n);var u=ee(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.type="PointLayer",s}return(0,q.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new R[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return d[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),_=d.shape2d,T=d.shape3d,P=this.iconService.getIconMap(),k=l.find(function(H){return H.hasOwnProperty("shape")});if(k){var K=k.shape;return K==="dot"?"normal":(_==null?void 0:_.indexOf(K))!==-1?"fill":(T==null?void 0:T.indexOf(K))!==-1?"extrude":P.hasOwnProperty(K)?"image":this.fontService.getGlyph(K)!==""?"icon":"text"}else return"normal"}}]),a}(_u);function wt(n){var u=Et();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Et(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var vr=`uniform float u_opacity: 1.0;
varying vec4 v_Color;

#pragma include "picking"

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Vr=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,In=function(n){(0,we.Z)(a,n);var u=wt(a);function a(){return(0,ce.Z)(this,a),u.apply(this,arguments)}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d;return{u_opacity:_}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:Vr,fragmentShader:vr,triangulation:Gu})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:S.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_,T,P,k){return k}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,T,P){var k=d.size,K=k===void 0?10:k;return Array.isArray(K)?[K[0]]:[K]}}})}}]),a}(xa);function Nn(n){var u=si();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function si(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Pi=`uniform float u_opacity: 1.0;
varying vec4 v_Color;

#pragma include "picking"

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ei=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,pa=function(n){(0,we.Z)(a,n);var u=Nn(a);function a(){return(0,ce.Z)(this,a),u.apply(this,arguments)}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d;return{u_opacity:_}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:Ei,fragmentShader:Pi,triangulation:_l,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){}}]),a}(xa),wi={fill:pa,line:zs,extrude:In,text:U,point_fill:Lo,point_image:Ms,point_normal:Af,point_extrude:hu},ja=wi;function Bo(n){var u=Uo();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Uo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Yo=function(n){(0,we.Z)(a,n);var u=Bo(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.type="PolygonLayer",s}return(0,q.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new ja[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return _==="fill"?"fill":_==="extrude"?"extrude":_==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),_=d.shape2d,T=d.shape3d,P=this.iconService.getIconMap(),k=l.find(function(H){return H.hasOwnProperty("shape")});if(k){var K=k.shape;return K==="dot"?"point_normal":(_==null?void 0:_.indexOf(K))!==-1?"point_fill":(T==null?void 0:T.indexOf(K))!==-1?"point_extrude":P.hasOwnProperty(K)?"point_image":"text"}else return"fill"}}]),a}(_u);function fo(n){var u=Sa();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Sa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ga=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,wo=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,ho=function(n){(0,we.Z)(a,n);var u=fo(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.texture=void 0,s.colorTexture=void 0,s}return(0,q.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.clampLow,P=T===void 0?!0:T,k=l.clampHigh,K=k===void 0?!0:k,H=l.noDataValue,de=H===void 0?-9999999:H,Ge=l.domain,ft=Ge===void 0?[0,1]:Ge;return this.updateColorTexure(),{u_opacity:_||1,u_texture:this.texture,u_domain:ft,u_clampLow:P,u_clampHigh:typeof K!="undefined"?K:P,u_noDataValue:de,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),d=this.rendererService.createTexture2D,_=l.data.dataArray[0];this.texture=d({data:_.data,width:_.width,height:_.height,format:S.gl.LUMINANCE,type:S.gl.FLOAT});var T=this.layer.getLayerConfig(),P=T.rampColors,k=(0,Oe.Cl)(P);return this.colorTexture=d({data:k.data,width:k.width,height:k.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:wo,fragmentShader:ga,triangulation:as,primitive:S.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(d,_,T,P){return[T[3],T[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,d=this.layer.getLayerConfig(),_=d.rampColors,T=(0,Oe.Cl)(_);this.colorTexture=l({data:T.data,width:T.width,height:T.height,flipY:!1})}}]),a}(xa),Za={raster:ho,raster3d:ho},$o=Za;function Jo(n){var u=Ic();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function Ic(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Kl=function(n){(0,we.Z)(a,n);var u=Jo(a);function a(){var s;(0,ce.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=u.call.apply(u,[this].concat(d)),s.type="RasterLayer",s}return(0,q.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new $o[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={raster:{},raster3d:{}};return d[l]}},{key:"getModelType",value:function(){return"raster"}}]),a}(_u),_s=y(50361),Bs=y.n(_s),jo,Fu,Eh,Jh,Qh,wh,ls,Th,Ah,Ch,qh,Ph;function ep(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function tp(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?ep(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ep(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var rp=(jo=(0,Tt.b2)(),Fu=(0,Tt.f3)(S.vK.IGlobalConfigService),Eh=(0,Tt.f3)(S.vK.ILogService),Jh=(0,Tt.f3)(S.vK.IMapService),Qh=(0,Tt.f3)(S.vK.IFontService),jo(wh=(ls=(Ph=function(){function n(){(0,ce.Z)(this,n),(0,Fn.Z)(this,"configService",Th,this),(0,Fn.Z)(this,"logger",Ah,this),(0,Fn.Z)(this,"mapService",Ch,this),(0,Fn.Z)(this,"fontService",qh,this)}return(0,q.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(a,{styleAttributeService:d})}),a.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return a.dataState.dataMappingNeedUpdate=!1,l.generateMaping(a,{styleAttributeService:d}),!0}),a.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!a.layerModelNeedUpdate){var _=d.getLayerStyleAttributes()||[],T=d.getLayerStyleAttribute("filter"),P=a.getSource().data.dataArray,k=_.filter(function(H){return H.needRemapping}),K=P;T!=null&&T.needRemapping&&T!==null&&T!==void 0&&T.scale&&(K=P.filter(function(H){return l.applyAttributeMapping(T,H)[0]})),k.length&&(T!=null&&T.needRemapping?(a.setEncodedData(l.mapping(_,K)),T.needRemapping=!1):a.setEncodedData(l.mapping(k,K,a.getEncodedData())),l.logger.debug("remapping finished"),a.emit("remapping",null))}})}},{key:"generateMaping",value:function(a,s){var l=this,d=s.styleAttributeService,_=d.getLayerStyleAttributes()||[],T=d.getLayerStyleAttribute("filter"),P=a.getSource().data.dataArray,k=P;T!=null&&T.scale&&(k=P.filter(function(K){return l.applyAttributeMapping(T,K)[0]})),a.setEncodedData(this.mapping(_,k))}},{key:"mapping",value:function(a,s,l){var d=this,_=s.map(function(T,P){var k=l?l[P]:{},K=tp({id:T._id,coordinates:T.coordinates},k);return a.filter(function(H){return H.scale!==void 0}).forEach(function(H){var de=d.applyAttributeMapping(H,T);H.needRemapping=!1,H.name==="color"&&(de=de.map(function(Ge){return(0,Oe.CI)(Ge)})),K[H.name]=Array.isArray(de)&&de.length===1?de[0]:de,H.name==="shape"&&(K.shape=d.fontService.getIconFontKey(K[H.name]))}),K});return _.length>0&&this.mapService.version==="GAODE2.x"&&(typeof _[0].coordinates[0]=="number"?_.map(function(T){T.version="GAODE2.x",T.originCoordinates=Bs()(T.coordinates),T.coordinates=d.mapService.lngLatToCoord(T.coordinates)}):_.map(function(T){T.version="GAODE2.x",T.originCoordinates=Bs()(T.coordinates),T.coordinates=d.mapService.lngLatToCoords(T.coordinates)})),_}},{key:"applyAttributeMapping",value:function(a,s){var l;if(!a.scale)return[];var d=(a==null||(l=a.scale)===null||l===void 0?void 0:l.scalers)||[],_=[];return d.forEach(function(T){var P,k=T.field;(s.hasOwnProperty(k)||((P=a.scale)===null||P===void 0?void 0:P.type)==="variable")&&_.push(s[k])}),a.mapping?a.mapping(_):[]}}]),n}(),Ph),Th=(0,kn.Z)(ls.prototype,"configService",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ah=(0,kn.Z)(ls.prototype,"logger",[Eh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch=(0,kn.Z)(ls.prototype,"mapService",[Jh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qh=(0,kn.Z)(ls.prototype,"fontService",[Qh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ls))||wh),nh={},np={},ip=function(u){return np[u]},cc=function(u,a){np[u]=a},ap=function(u){return nh[u]},J=function(u,a){nh[u]=a},fe={},Ue={},Jt=34,mr=10,pr=13;function rr(n){return new Function("d","return {"+n.map(function(u,a){return JSON.stringify(u)+": d["+a+'] || ""'}).join(",")+"}")}function Zr(n,u){var a=rr(n);return function(s,l){return u(a(s),l,n)}}function nn(n){var u=Object.create(null),a=[];return n.forEach(function(s){for(var l in s)l in u||a.push(u[l]=l)}),a}function zr(n,u){var a=n+"",s=a.length;return s<u?new Array(u-s+1).join(0)+a:a}function Jr(n){return n<0?"-"+zr(-n,6):n>9999?"+"+zr(n,6):zr(n,4)}function sn(n){var u=n.getUTCHours(),a=n.getUTCMinutes(),s=n.getUTCSeconds(),l=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":Jr(n.getUTCFullYear(),4)+"-"+zr(n.getUTCMonth()+1,2)+"-"+zr(n.getUTCDate(),2)+(l?"T"+zr(u,2)+":"+zr(a,2)+":"+zr(s,2)+"."+zr(l,3)+"Z":s?"T"+zr(u,2)+":"+zr(a,2)+":"+zr(s,2)+"Z":a||u?"T"+zr(u,2)+":"+zr(a,2)+"Z":"")}function mn(n){var u=new RegExp('["'+n+`
\r]`),a=n.charCodeAt(0);function s(H,de){var Ge,ft,Ut=l(H,function(gr,Ir){if(Ge)return Ge(gr,Ir-1);ft=gr,Ge=de?Zr(gr,de):rr(gr)});return Ut.columns=ft||[],Ut}function l(H,de){var Ge=[],ft=H.length,Ut=0,gr=0,Ir,Hr=ft<=0,pn=!1;H.charCodeAt(ft-1)===mr&&--ft,H.charCodeAt(ft-1)===pr&&--ft;function wn(){if(Hr)return Ue;if(pn)return pn=!1,fe;var Ii,qn=Ut,Qi;if(H.charCodeAt(qn)===Jt){for(;Ut++<ft&&H.charCodeAt(Ut)!==Jt||H.charCodeAt(++Ut)===Jt;);return(Ii=Ut)>=ft?Hr=!0:(Qi=H.charCodeAt(Ut++))===mr?pn=!0:Qi===pr&&(pn=!0,H.charCodeAt(Ut)===mr&&++Ut),H.slice(qn+1,Ii-1).replace(/""/g,'"')}for(;Ut<ft;){if((Qi=H.charCodeAt(Ii=Ut++))===mr)pn=!0;else if(Qi===pr)pn=!0,H.charCodeAt(Ut)===mr&&++Ut;else if(Qi!==a)continue;return H.slice(qn,Ii)}return Hr=!0,H.slice(qn,ft)}for(;(Ir=wn())!==Ue;){for(var Wn=[];Ir!==fe&&Ir!==Ue;)Wn.push(Ir),Ir=wn();de&&(Wn=de(Wn,gr++))==null||Ge.push(Wn)}return Ge}function d(H,de){return H.map(function(Ge){return de.map(function(ft){return K(Ge[ft])}).join(n)})}function _(H,de){return de==null&&(de=nn(H)),[de.map(K).join(n)].concat(d(H,de)).join(`
`)}function T(H,de){return de==null&&(de=nn(H)),d(H,de).join(`
`)}function P(H){return H.map(k).join(`
`)}function k(H){return H.map(K).join(n)}function K(H){return H==null?"":H instanceof Date?sn(H):u.test(H+="")?'"'+H.replace(/"/g,'""')+'"':H}return{parse:s,parseRows:l,format:_,formatBody:T,formatRows:P,formatRow:k,formatValue:K}}var on=mn(","),rn=on.parse,or=on.parseRows,er=on.format,Gr=on.formatBody,En=on.formatRows,Pr=on.formatRow,Yn=on.formatValue,Kr=y(76404),Br=y.n(Kr);function Fr(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Yr(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?Fr(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Fr(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function jn(n,u){var a=u.x,s=u.y,l=u.x1,d=u.y1,_=u.coordinates,T=[];return n.forEach(function(P,k){var K=[];if(a&&s&&(K=[parseFloat(P[a]),parseFloat(P[s])]),a&&s&&l&&d){var H=[parseFloat(P[a]),parseFloat(P[s])],de=[parseFloat(P[l]),parseFloat(P[d])];K=[H,de]}if(_){var Ge="Polygon";Array.isArray(_[0])||(Ge="Point"),Array.isArray(_[0])&&!Array.isArray(_[0][0])&&(Ge="LineString");var ft={type:Ge,coordinates:(0,bi.Z)(P[_])};Br()(ft,!0),K=ft.coordinates}var Ut=Yr(Yr({},P),{},{_id:k,coordinates:K});T.push(Ut)}),{dataArray:T}}function $n(n,u){var a=rn(n);return jn(a,u)}var un=y(19175);function Ur(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Dr(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ni(n){if(n.length>1&&isNumber(n[0])&&isNumber(n[1]))return!0;if(Array.isArray(n[0])&&n[0].length)return ni(n[0]);throw new Error("coordinates must only contain numbers")}function ii(n,u,a){if(!u||!a)throw new Error("type and name required");if(!n||n.type!==u)throw new Error("Invalid input to "+a+": must be a "+u+", given "+n.type)}function Rn(n,u,a){if(!n)throw new Error("No feature passed");if(!a)throw new Error(".featureOf() requires a name");if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!n.geometry||n.geometry.type!==u)throw new Error("Invalid input to "+a+": must be a "+u+", given "+n.geometry.type)}function Ui(n,u,a){if(!n)throw new Error("No featureCollection passed");if(!a)throw new Error(".collectionOf() requires a name");if(!n||n.type!=="FeatureCollection")throw new Error("Invalid input to "+a+", FeatureCollection required");for(var s=0,l=n.features;s<l.length;s++){var d=l[s];if(!d||d.type!=="Feature"||!d.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!d.geometry||d.geometry.type!==u)throw new Error("Invalid input to "+a+": must be a "+u+", given "+d.geometry.type)}}function Mi(n){return n.type==="Feature"?n.geometry:n}function ji(n,u){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function na(n,u,a){if(n!==null)for(var s,l,d,_,T,P,k,K=0,H=0,de,Ge=n.type,ft=Ge==="FeatureCollection",Ut=Ge==="Feature",gr=ft?n.features.length:1,Ir=0;Ir<gr;Ir++){k=ft?n.features[Ir].geometry:Ut?n.geometry:n,de=k?k.type==="GeometryCollection":!1,T=de?k.geometries.length:1;for(var Hr=0;Hr<T;Hr++){var pn=0,wn=0;if(_=de?k.geometries[Hr]:k,_!==null){P=_.coordinates;var Wn=_.type;switch(K=a&&(Wn==="Polygon"||Wn==="MultiPolygon")?1:0,Wn){case null:break;case"Point":if(u(P,H,Ir,pn,wn)===!1)return!1;H++,pn++;break;case"LineString":case"MultiPoint":for(s=0;s<P.length;s++){if(u(P[s],H,Ir,pn,wn)===!1)return!1;H++,Wn==="MultiPoint"&&pn++}Wn==="LineString"&&pn++;break;case"Polygon":case"MultiLineString":for(s=0;s<P.length;s++){for(l=0;l<P[s].length-K;l++){if(u(P[s][l],H,Ir,pn,wn)===!1)return!1;H++}Wn==="MultiLineString"&&pn++,Wn==="Polygon"&&wn++}Wn==="Polygon"&&pn++;break;case"MultiPolygon":for(s=0;s<P.length;s++){for(wn=0,l=0;l<P[s].length;l++){for(d=0;d<P[s][l].length-K;d++){if(u(P[s][l][d],H,Ir,pn,wn)===!1)return!1;H++}wn++}pn++}break;case"GeometryCollection":for(s=0;s<_.geometries.length;s++)if(na(_.geometries[s],u,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Qo(n,u,a,s){var l=a;return na(n,function(d,_,T,P,k){_===0&&a===void 0?l=d:l=u(l,d,_,T,P,k)},s),l}function Is(n,u){var a;switch(n.type){case"FeatureCollection":for(a=0;a<n.features.length&&u(n.features[a].properties,a)!==!1;a++);break;case"Feature":u(n.properties,0);break}}function ea(n,u,a){var s=a;return Is(n,function(l,d){d===0&&a===void 0?s=l:s=u(s,l,d)}),s}function To(n,u){if(n.type==="Feature")u(n,0);else if(n.type==="FeatureCollection")for(var a=0;a<n.features.length&&u(n.features[a],a)!==!1;a++);}function qa(n,u,a){var s=a;return To(n,function(l,d){d===0&&a===void 0?s=l:s=u(s,l,d)}),s}function cs(n){var u=[];return na(n,function(a){u.push(a)}),u}function qo(n,u){var a,s,l,d,_,T,P,k,K,H,de=0,Ge=n.type==="FeatureCollection",ft=n.type==="Feature",Ut=Ge?n.features.length:1;for(a=0;a<Ut;a++){for(T=Ge?n.features[a].geometry:ft?n.geometry:n,k=Ge?n.features[a].properties:ft?n.properties:{},K=Ge?n.features[a].bbox:ft?n.bbox:void 0,H=Ge?n.features[a].id:ft?n.id:void 0,P=T?T.type==="GeometryCollection":!1,_=P?T.geometries.length:1,l=0;l<_;l++){if(d=P?T.geometries[l]:T,d===null){if(u(null,de,k,K,H)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(u(d,de,k,K,H)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<d.geometries.length;s++)if(u(d.geometries[s],de,k,K,H)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}de++}}function Os(n,u,a){var s=a;return qo(n,function(l,d,_,T,P){d===0&&a===void 0?s=l:s=u(s,l,d,_,T,P)}),s}function es(n,u){qo(n,function(a,s,l,d,_){var T=a===null?null:a.type;switch(T){case null:case"Point":case"LineString":case"Polygon":return u((0,un.zL)(a,l,{bbox:d,id:_}),s,0)===!1?!1:void 0}var P;switch(T){case"MultiPoint":P="Point";break;case"MultiLineString":P="LineString";break;case"MultiPolygon":P="Polygon";break}for(var k=0;k<a.coordinates.length;k++){var K=a.coordinates[k],H={type:P,coordinates:K};if(u((0,un.zL)(H,l),s,k)===!1)return!1}})}function Xs(n,u,a){var s=a;return es(n,function(l,d,_){d===0&&_===0&&a===void 0?s=l:s=u(s,l,d,_)}),s}function Zo(n,u){es(n,function(a,s,l){var d=0;if(!!a.geometry){var _=a.geometry.type;if(!(_==="Point"||_==="MultiPoint")){var T,P=0,k=0,K=0;if(na(a,function(H,de,Ge,ft,Ut){if(T===void 0||s>P||ft>k||Ut>K){T=H,P=s,k=ft,K=Ut,d=0;return}var gr=lineString([T,H],a.properties);if(u(gr,s,l,Ut,d)===!1)return!1;d++,T=H})===!1)return!1}}})}function ki(n,u,a){var s=a,l=!1;return Zo(n,function(d,_,T,P,k){l===!1&&a===void 0?s=d:s=u(s,d,_,T,P,k),l=!0}),s}function Ks(n,u){if(!n)throw new Error("geojson is required");es(n,function(a,s,l){if(a.geometry!==null){var d=a.geometry.type,_=a.geometry.coordinates;switch(d){case"LineString":if(u(a,s,l,0,0)===!1)return!1;break;case"Polygon":for(var T=0;T<_.length;T++)if(u(lineString(_[T],a.properties),s,l,T)===!1)return!1;break}}})}function wa(n,u,a){var s=a;return Ks(n,function(l,d,_,T){d===0&&a===void 0?s=l:s=u(s,l,d,_,T)}),s}function ui(n,u){if(u=u||{},!isObject(u))throw new Error("options is invalid");var a=u.featureIndex||0,s=u.multiFeatureIndex||0,l=u.geometryIndex||0,d=u.segmentIndex||0,_=u.properties,T;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),_=_||n.features[a].properties,T=n.features[a].geometry;break;case"Feature":_=_||n.properties,T=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":T=n;break;default:throw new Error("geojson is invalid")}if(T===null)return null;var P=T.coordinates;switch(T.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=P.length+d-1),lineString([P[d],P[d+1]],_,u);case"Polygon":return l<0&&(l=P.length+l),d<0&&(d=P[l].length+d-1),lineString([P[l][d],P[l][d+1]],_,u);case"MultiLineString":return s<0&&(s=P.length+s),d<0&&(d=P[s].length+d-1),lineString([P[s][d],P[s][d+1]],_,u);case"MultiPolygon":return s<0&&(s=P.length+s),l<0&&(l=P[s].length+l),d<0&&(d=P[s][l].length-d-1),lineString([P[s][l][d],P[s][l][d+1]],_,u)}throw new Error("geojson is invalid")}function Li(n,u){if(u=u||{},!isObject(u))throw new Error("options is invalid");var a=u.featureIndex||0,s=u.multiFeatureIndex||0,l=u.geometryIndex||0,d=u.coordIndex||0,_=u.properties,T;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),_=_||n.features[a].properties,T=n.features[a].geometry;break;case"Feature":_=_||n.properties,T=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":T=n;break;default:throw new Error("geojson is invalid")}if(T===null)return null;var P=T.coordinates;switch(T.type){case"Point":return point(P,_,u);case"MultiPoint":return s<0&&(s=P.length+s),point(P[s],_,u);case"LineString":return d<0&&(d=P.length+d),point(P[d],_,u);case"Polygon":return l<0&&(l=P.length+l),d<0&&(d=P[l].length+d),point(P[l][d],_,u);case"MultiLineString":return s<0&&(s=P.length+s),d<0&&(d=P[s].length+d),point(P[s][d],_,u);case"MultiPolygon":return s<0&&(s=P.length+s),l<0&&(l=P[s].length+l),d<0&&(d=P[s][l].length-d),point(P[s][l][d],_,u)}throw new Error("geojson is invalid")}function ta(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function xs(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?ta(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ta(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ys(n,u){var a=[],s={};if(n.features=n.features.filter(function(d){var _=d.geometry;return d!=null&&_&&_.type&&_.coordinates&&_.coordinates.length>0}),Br()(n,!0),n.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return es(n,function(d,_){var T=Dr(d),P=_,k=xs(xs({},d.properties),{},{coordinates:T,_id:P});a.push(k)}),{dataArray:a,featureKeys:s}}function Yl(n,u){var a=u.extent,s=new Promise(function(d){We(n,function(_){d(_)})}),l={images:s,_id:1,dataArray:[{_id:0,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return l}function We(n,u){var a=n,s=[];if(typeof a=="string")(0,Oe.gJ)({url:a},function(_,T){s.push(T),u(s)});else{var l=a.length,d=0;a.forEach(function(_){(0,Oe.gJ)({url:_},function(T,P){d++,s.push(P),d===l&&u(s)})})}return Yl}function lr(n,u){var a=u.extent,s=u.width,l=u.height,d=u.min,_=u.max,T={_id:1,dataArray:[{_id:1,data:Array.from(n),width:s,height:l,min:d,max:_,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return T}var Qt=y(30236),Pn=y.n(Qt),Fi=y(47037),Re=y.n(Fi);function be(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ht(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?be(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):be(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function zt(n,u){var a=u.radius,s=a===void 0?40:a,l=u.maxZoom,d=l===void 0?18:l,_=u.minZoom,T=_===void 0?0:_,P=u.zoom,k=P===void 0?2:P;if(n.pointIndex){var K=n.pointIndex.getClusters(n.extent,Math.floor(k));return n.dataArray=Zt(K),n}var H=new(se())({radius:s,minZoom:T,maxZoom:d}),de={type:"FeatureCollection",features:[]};return de.features=n.dataArray.map(function(Ge){return{type:"Feature",geometry:{type:"Point",coordinates:Ge.coordinates},properties:ht({},Ge)}}),H.load(de.features),H}function Zt(n){return n.map(function(u,a){return ht({coordinates:u.geometry.coordinates,_id:a+1},u.properties)})}function vt(n){if(n.length===0)throw new Error("max requires at least one data point");for(var u=n[0],a=1;a<n.length;a++)n[a]>u&&(u=n[a]);return u}function pt(n){if(n.length===0)throw new Error("min requires at least one data point");for(var u=n[0],a=1;a<n.length;a++)n[a]<u&&(u=n[a]);return u}function Pt(n){if(n.length===0)return 0;for(var u=n[0],a=0,s,l=1;l<n.length;l++)s=u+n[l]*1,Math.abs(u)>=Math.abs(n[l])?a+=u-s+n[l]:a+=n[l]-s+u,u=s;return u+a*1}function Fe(n){if(n.length===0)throw new Error("mean requires at least one data point");return Pt(n)/n.length}var lt={min:pt,max:vt,mean:Fe,sum:Pt};function Ce(n,u){return n.map(function(a){return a[u]*1})}function kt(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ht(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?kt(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):kt(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Mr(n){var u=ur();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function ur(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Tr(n,u){if(Array.isArray(u))return u}var Qr=function(n){(0,we.Z)(a,n);var u=Mr(a);function a(s,l){var d;return(0,ce.Z)(this,a),d=u.call(this),d.data=void 0,d.extent=void 0,d.hooks={init:new Ki.ni},d.parser={type:"geojson"},d.transforms=[],d.cluster=!1,d.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},d.mapService=void 0,d.invalidExtent=!1,d.originData=void 0,d.rawData=void 0,d.cfg={},d.clusterIndex=void 0,d.originData=s,d.initCfg(l),d.hooks.init.tap("parser",function(){d.excuteParser()}),d.hooks.init.tap("cluster",function(){d.initCluster()}),d.hooks.init.tap("transform",function(){d.executeTrans()}),d.init(),d}return(0,q.Z)(a,[{key:"setData",value:function(l,d){this.rawData=l,this.originData=l,this.initCfg(d),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var d=this,_=this.clusterOptions,T=_.method,P=T===void 0?"sum":T,k=_.field,K=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,K.forEach(function(H){H.id||(H.properties.point_count=1)}),(k||ua()(P))&&(K=K.map(function(H){var de=H.id;if(de){var Ge=d.clusterIndex.getLeaves(de,Infinity),ft=Ge.map(function(Ir){return Ir.properties}),Ut;if(Re()(P)&&k){var gr=Ce(ft,k);Ut=lt[P](gr)}ua()(P)&&(Ut=P(ft)),H.properties.stat=Ut}else H.properties.point_count=1;return H})),this.data=ip("geojson")({type:"FeatureCollection",features:K}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var d=this.parser.type,_=d===void 0?"geojson":d;if(_==="geojson"&&!this.cluster){var T=l<this.originData.features.length?this.originData.features[l]:"null",P=Bs()(T);if(this.transforms.length!==0){var k=this.data.dataArray.find(function(K){return K._id===l});P.properties=k}return P}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,d){var _=this.data.dataArray.find(function(T){return T[l]===name});return _==null?void 0:_._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var d=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(d=(0,Oe.yA)((0,Oe.ds)(this.extent),l)),d[0].concat(d[1])}},{key:"initCfg",value:function(l){this.cfg=Pn()(this.cfg,l,Tr);var d=this.cfg;d&&(d.parser&&(this.parser=d.parser),d.transforms&&(this.transforms=d.transforms),this.cluster=d.cluster||!1,d.clusterOptions&&(this.cluster=!0,this.clusterOptions=Ht(Ht({},this.clusterOptions),d.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,d=l.type||"geojson",_=ip(d);this.data=_(this.originData,l),this.extent=(0,Oe.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,d=this.transforms;d.forEach(function(_){var T=_.type,P=ap(T)(l.data,_);Object.assign(l.data,P)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=zt(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),a}(Nt.EventEmitter);function Vn(n,u){var a=u.callback;return a&&(n.dataArray=n.dataArray.filter(a)),n}function Ri(n,u){var a;if(typeof Symbol=="undefined"||n[Symbol.iterator]==null){if(Array.isArray(n)||(a=zn(n))||u&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){a=n[Symbol.iterator]()},n:function(){var k=a.next();return d=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function zn(n,u){if(!!n){if(typeof n=="string")return ti(n,u);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ti(n,u)}}function ti(n,u){(u==null||u>n.length)&&(u=n.length);for(var a=0,s=new Array(u);a<u;a++)s[a]=n[a];return s}var yi=6378e3;function da(n,u){var a=n.dataArray,s=u.size,l=s===void 0?10:s,d=l/(2*Math.PI*yi)*(256<<20)/2,_=Vo(a,l),T=_.gridHash,P=_.gridOffset,k=Mh(T,P,u);return{yOffset:d,xOffset:d,radius:d,type:"grid",dataArray:k}}function Vo(n,u){var a=Infinity,s=-Infinity,l,d=Ri(n),_;try{for(d.s();!(_=d.n()).done;){var T=_.value;l=T.coordinates[1],Number.isFinite(l)&&(a=l<a?l:a,s=l>s?l:s)}}catch(pn){d.e(pn)}finally{d.f()}var P=(a+s)/2,k=Nu(u,P);if(k.xOffset<=0||k.yOffset<=0)return{gridHash:{},gridOffset:k};var K={},H=Ri(n),de;try{for(H.s();!(de=H.n()).done;){var Ge=de.value,ft=Ge.coordinates[1],Ut=Ge.coordinates[0];if(Number.isFinite(ft)&&Number.isFinite(Ut)){var gr=Math.floor((ft+90)/k.yOffset),Ir=Math.floor((Ut+180)/k.xOffset),Hr="".concat(gr,"-").concat(Ir);K[Hr]=K[Hr]||{count:0,points:[]},K[Hr].count+=1,K[Hr].points.push(Ge)}}}catch(pn){H.e(pn)}finally{H.f()}return{gridHash:K,gridOffset:k}}function Nu(n,u){var a=ih(n),s=sl(u,n);return{yOffset:a,xOffset:s}}function ih(n){return n/yi*(180/Math.PI)}function sl(n,u){return u/yi*(180/Math.PI)/Math.cos(n*Math.PI/180)}function Mh(n,u,a){return Object.keys(n).reduce(function(s,l,d){var _=l.split("-"),T=parseInt(_[0],10),P=parseInt(_[1],10),k={};if(a.field&&a.method){var K=Oe.a5.getColumn(n[l].points,a.field);k[a.method]=Oe.a5.statMap[a.method](K)}return Object.assign(k,{_id:d,coordinates:(0,Oe.Z)([-180+u.xOffset*(P+.5),-90+u.yOffset*(T+.5)]),rawData:n[l].points,count:n[l].count}),s.push(k),s},[])}var iu=Math.PI/3,jf=[0,iu,2*iu,3*iu,4*iu,5*iu];function Zf(n){return n[0]}function Cp(n){return n[1]}function ah(){var n=0,u=0,a=1,s=1,l=Zf,d=Cp,_,T,P;function k(H){var de={},Ge=[],ft,Ut=H.length;for(ft=0;ft<Ut;++ft)if(!(isNaN(Ir=+l.call(null,gr=H[ft],ft,H))||isNaN(Hr=+d.call(null,gr,ft,H)))){var gr,Ir,Hr,pn=Math.round(Hr=Hr/P),wn=Math.round(Ir=Ir/T-(pn&1)/2),Wn=Hr-pn;if(Math.abs(Wn)*3>1){var Ii=Ir-wn,qn=wn+(Ir<wn?-1:1)/2,Qi=pn+(Hr<pn?-1:1),Oa=Ir-qn,ka=Hr-Qi;Ii*Ii+Wn*Wn>Oa*Oa+ka*ka&&(wn=qn+(pn&1?1:-1)/2,pn=Qi)}var hi=wn+"-"+pn,Ta=de[hi];Ta?Ta.push(gr):(Ge.push(Ta=de[hi]=[gr]),Ta.x=(wn+(pn&1)/2)*T,Ta.y=pn*P)}return Ge}function K(H){var de=0,Ge=0;return jf.map(function(ft){var Ut=Math.sin(ft)*H,gr=-Math.cos(ft)*H,Ir=Ut-de,Hr=gr-Ge;return de=Ut,Ge=gr,[Ir,Hr]})}return k.hexagon=function(H){return"m"+K(H==null?_:+H).join("l")+"z"},k.centers=function(){for(var H=[],de=Math.round(u/P),Ge=Math.round(n/T),ft=de*P;ft<s+_;ft+=P,++de)for(var Ut=Ge*T+(de&1)*T/2;Ut<a+T/2;Ut+=T)H.push([Ut,ft]);return H},k.mesh=function(){var H=K(_).slice(0,4).join("l");return k.centers().map(function(de){return"M"+de+"m"+H}).join("")},k.x=function(H){return arguments.length?(l=H,k):l},k.y=function(H){return arguments.length?(d=H,k):d},k.radius=function(H){return arguments.length?(_=+H,T=_*2*Math.sin(iu),P=_*1.5,k):_},k.size=function(H){return arguments.length?(n=u=0,a=+H[0],s=+H[1],k):[a-n,s-u]},k.extent=function(H){return arguments.length?(n=+H[0][0],u=+H[0][1],a=+H[1][0],s=+H[1][1],k):[[n,u],[a,s]]},k.radius(1)}function Pp(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function fs(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?Pp(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Pp(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var _o=6378e3;function od(n,u){var a=n.dataArray,s=u.size,l=s===void 0?10:s,d=u.method,_=d===void 0?"sum":d,T=l/(2*Math.PI*_o)*(256<<20)/2,P=a.map(function(de){var Ge=(0,Oe.Z)(de.coordinates),ft=(0,te.Z)(Ge,2),Ut=ft[0],gr=ft[1];return fs(fs({},de),{},{coordinates:[Ut,gr]})}),k=ah().radius(T).x(function(de){return de.coordinates[0]}).y(function(de){return de.coordinates[1]}),K=k(P),H={dataArray:K.map(function(de,Ge){var ft;if(u.field&&_){var Ut=Oe.a5.getColumn(de,u.field);de[_]=Oe.a5.statMap[_](Ut)}return ft={},(0,F.Z)(ft,u.method,de[_]),(0,F.Z)(ft,"count",de.length),(0,F.Z)(ft,"rawData",de),(0,F.Z)(ft,"coordinates",[de.x,de.y]),(0,F.Z)(ft,"_id",Ge),ft}),radius:T,xOffset:T,yOffset:T,type:"hexagon"};return H}function Mp(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ip(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?Mp(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Mp(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function sd(n,u){var a=u.sourceField,s=u.targetField,l=u.data,d={};return l.forEach(function(_){d[_[a]]=_}),n.dataArray=n.dataArray.map(function(_){var T=_[s];return Ip(Ip({},_),d[T])}),n}function ud(n,u){var a=u.callback;return a&&(n.dataArray=n.dataArray.map(a)),n}var ld=y(15054),Vf=Qr;cc("geojson",Ys),cc("image",Yl),cc("csv",$n),cc("json",jn),cc("raster",lr),J("cluster",zt),J("filter",Vn),J("join",sd),J("map",ud),J("grid",da),J("hexagon",od);var Mf,Op,hs,Ih=(Mf=(0,Tt.b2)(),Mf(Op=(hs=function(){function n(){(0,ce.Z)(this,n),this.mapService=void 0}return(0,q.Z)(n,[{key:"apply",value:function(a){var s=this;this.mapService=a.getContainer().get(S.vK.IMapService),a.hooks.init.tap("DataSourcePlugin",function(){var l=a.getSource();if(!l){var d=a.sourceOption,_=d.data,T=d.options;a.setSource(new Vf(_,T))}s.updateClusterData(a)}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(a),d=a.dataState.dataSourceNeedUpdate;return a.dataState.dataSourceNeedUpdate=!1,l||d})}},{key:"updateClusterData",value:function(a){var s=a.getSource(),l=s.cluster,d=s.clusterOptions,_=d.zoom,T=_===void 0?0:_,P=d.maxZoom,k=P===void 0?16:P,K=this.mapService.getZoom()-1,H=a.dataState.dataSourceNeedUpdate;return l&&(H||Math.abs(T-K)>1)&&k>T?(s.updateClusterData(Math.floor(K)),!0):!1}}]),n}(),hs))||Op),df=y(44908),op=y.n(df),sp=y(14293),up=y.n(sp);function If(n,u){return n<u?-1:n>u?1:n>=u?0:NaN}function ef(n){return n.length===1&&(n=cd(n)),{left:function(a,s,l,d){for(l==null&&(l=0),d==null&&(d=a.length);l<d;){var _=l+d>>>1;n(a[_],s)<0?l=_+1:d=_}return l},right:function(a,s,l,d){for(l==null&&(l=0),d==null&&(d=a.length);l<d;){var _=l+d>>>1;n(a[_],s)>0?d=_:l=_+1}return l}}}function cd(n){return function(u,a){return If(n(u),a)}}var Lp=ef(If),Fd=Lp.right,$s=Lp.left,Oc=Fd;function fd(n,u){var a=n.length,s=-1,l,d,_;if(u==null){for(;++s<a;)if((l=n[s])!=null&&l>=l)for(d=_=l;++s<a;)(l=n[s])!=null&&(d>l&&(d=l),_<l&&(_=l))}else for(;++s<a;)if((l=u(n[s],s,n))!=null&&l>=l)for(d=_=l;++s<a;)(l=u(n[s],s,n))!=null&&(d>l&&(d=l),_<l&&(_=l));return[d,_]}var e=Array.prototype,t=e.slice,r=e.map,f=Math.sqrt(50),v=Math.sqrt(10),m=Math.sqrt(2);function x(n,u,a){var s,l=-1,d,_,T;if(u=+u,n=+n,a=+a,n===u&&a>0)return[n];if((s=u<n)&&(d=n,n=u,u=d),(T=A(n,u,a))===0||!isFinite(T))return[];if(T>0)for(n=Math.ceil(n/T),u=Math.floor(u/T),_=new Array(d=Math.ceil(u-n+1));++l<d;)_[l]=(n+l)*T;else for(n=Math.floor(n*T),u=Math.ceil(u*T),_=new Array(d=Math.ceil(n-u+1));++l<d;)_[l]=(n-l)/T;return s&&_.reverse(),_}function A(n,u,a){var s=(u-n)/Math.max(0,a),l=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,l);return l>=0?(d>=f?10:d>=v?5:d>=m?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=f?10:d>=v?5:d>=m?2:1)}function D(n,u,a){var s=Math.abs(u-n)/Math.max(0,a),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/l;return d>=f?l*=10:d>=v?l*=5:d>=m&&(l*=2),u<n?-l:l}function z(){var n=identity,u=extent,a=sturges;function s(l){var d,_=l.length,T,P=new Array(_);for(d=0;d<_;++d)P[d]=n(l[d],d,l);var k=u(P),K=k[0],H=k[1],de=a(P,K,H);Array.isArray(de)||(de=tickStep(K,H,de),de=range(Math.ceil(K/de)*de,H,de));for(var Ge=de.length;de[0]<=K;)de.shift(),--Ge;for(;de[Ge-1]>H;)de.pop(),--Ge;var ft=new Array(Ge+1),Ut;for(d=0;d<=Ge;++d)Ut=ft[d]=[],Ut.x0=d>0?de[d-1]:K,Ut.x1=d<Ge?de[d]:H;for(d=0;d<_;++d)T=P[d],K<=T&&T<=H&&ft[bisect(de,T,0,Ge)].push(l[d]);return ft}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(u=typeof l=="function"?l:constant([l[0],l[1]]),s):u},s.thresholds=function(l){return arguments.length?(a=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):a},s}function W(n,u,a){return n=map.call(n,number).sort(ascending),Math.ceil((a-u)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function ie(n){return n===null?NaN:+n}function oe(n,u,a){if(a==null&&(a=ie),!!(s=n.length)){if((u=+u)<=0||s<2)return+a(n[0],0,n);if(u>=1)return+a(n[s-1],s-1,n);var s,l=(s-1)*u,d=Math.floor(l),_=+a(n[d],d,n),T=+a(n[d+1],d+1,n);return _+(T-_)*(l-d)}}var xe="$";function je(){}je.prototype=ze.prototype={constructor:je,has:function(u){return xe+u in this},get:function(u){return this[xe+u]},set:function(u,a){return this[xe+u]=a,this},remove:function(u){var a=xe+u;return a in this&&delete this[a]},clear:function(){for(var u in this)u[0]===xe&&delete this[u]},keys:function(){var u=[];for(var a in this)a[0]===xe&&u.push(a.slice(1));return u},values:function(){var u=[];for(var a in this)a[0]===xe&&u.push(this[a]);return u},entries:function(){var u=[];for(var a in this)a[0]===xe&&u.push({key:a.slice(1),value:this[a]});return u},size:function(){var u=0;for(var a in this)a[0]===xe&&++u;return u},empty:function(){for(var u in this)if(u[0]===xe)return!1;return!0},each:function(u){for(var a in this)a[0]===xe&&u(this[a],a.slice(1),this)}};function ze(n,u){var a=new je;if(n instanceof je)n.each(function(T,P){a.set(P,T)});else if(Array.isArray(n)){var s=-1,l=n.length,d;if(u==null)for(;++s<l;)a.set(s,n[s]);else for(;++s<l;)a.set(u(d=n[s],s,n),d)}else if(n)for(var _ in n)a.set(_,n[_]);return a}var at=ze;function ut(){var n=[],u=[],a,s,l;function d(T,P,k,K){if(P>=n.length)return a!=null&&T.sort(a),s!=null?s(T):T;for(var H=-1,de=T.length,Ge=n[P++],ft,Ut,gr=map(),Ir,Hr=k();++H<de;)(Ir=gr.get(ft=Ge(Ut=T[H])+""))?Ir.push(Ut):gr.set(ft,[Ut]);return gr.each(function(pn,wn){K(Hr,wn,d(pn,P,k,K))}),Hr}function _(T,P){if(++P>n.length)return T;var k,K=u[P-1];return s!=null&&P>=n.length?k=T.entries():(k=[],T.each(function(H,de){k.push({key:de,values:_(H,P)})})),K!=null?k.sort(function(H,de){return K(H.key,de.key)}):k}return l={object:function(P){return d(P,0,Ot,Yt)},map:function(P){return d(P,0,ir,Lr)},entries:function(P){return _(d(P,0,ir,Lr),0)},key:function(P){return n.push(P),l},sortKeys:function(P){return u[n.length-1]=P,l},sortValues:function(P){return a=P,l},rollup:function(P){return s=P,l}}}function Ot(){return{}}function Yt(n,u,a){n[u]=a}function ir(){return map()}function Lr(n,u,a){n.set(u,a)}function Er(){}var tn=at.prototype;Er.prototype=cn.prototype={constructor:Er,has:tn.has,add:function(u){return u+="",this[xe+u]=u,this},remove:tn.remove,clear:tn.clear,values:tn.keys,size:tn.size,empty:tn.empty,each:tn.each};function cn(n,u){var a=new Er;if(n instanceof Er)n.each(function(d){a.add(d)});else if(n){var s=-1,l=n.length;if(u==null)for(;++s<l;)a.add(n[s]);else for(;++s<l;)a.add(u(n[s],s,n))}return a}var Ln=null,Gn=Array.prototype,Dn=Gn.map,xn=Gn.slice;function ei(n,u){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(u).domain(n);break}return this}function Jn(n,u){switch(arguments.length){case 0:break;case 1:this.interpolator(n);break;default:this.interpolator(u).domain(n);break}return this}var Hn={name:"implicit"};function Hi(){var n=at(),u=[],a=[],s=Hn;function l(d){var _=d+"",T=n.get(_);if(!T){if(s!==Hn)return s;n.set(_,T=u.push(d))}return a[(T-1)%a.length]}return l.domain=function(d){if(!arguments.length)return u.slice();u=[],n=at();for(var _=-1,T=d.length,P,k;++_<T;)n.has(k=(P=d[_])+"")||n.set(k,u.push(P));return l},l.range=function(d){return arguments.length?(a=xn.call(d),l):a.slice()},l.unknown=function(d){return arguments.length?(s=d,l):s},l.copy=function(){return Hi(u,a).unknown(s)},ei.apply(l,arguments),l}function Ti(){var n=ordinal().unknown(void 0),u=n.domain,a=n.range,s=[0,1],l,d,_=!1,T=0,P=0,k=.5;delete n.unknown;function K(){var H=u().length,de=s[1]<s[0],Ge=s[de-0],ft=s[1-de];l=(ft-Ge)/Math.max(1,H-T+P*2),_&&(l=Math.floor(l)),Ge+=(ft-Ge-l*(H-T))*k,d=l*(1-T),_&&(Ge=Math.round(Ge),d=Math.round(d));var Ut=sequence(H).map(function(gr){return Ge+l*gr});return a(de?Ut.reverse():Ut)}return n.domain=function(H){return arguments.length?(u(H),K()):u()},n.range=function(H){return arguments.length?(s=[+H[0],+H[1]],K()):s.slice()},n.rangeRound=function(H){return s=[+H[0],+H[1]],_=!0,K()},n.bandwidth=function(){return d},n.step=function(){return l},n.round=function(H){return arguments.length?(_=!!H,K()):_},n.padding=function(H){return arguments.length?(T=Math.min(1,P=+H),K()):T},n.paddingInner=function(H){return arguments.length?(T=Math.min(1,H),K()):T},n.paddingOuter=function(H){return arguments.length?(P=+H,K()):P},n.align=function(H){return arguments.length?(k=Math.max(0,Math.min(1,H)),K()):k},n.copy=function(){return Ti(u(),s).round(_).paddingInner(T).paddingOuter(P).align(k)},initRange.apply(K(),arguments)}function Ea(n){var u=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return Ea(u())},n}function li(){return Ea(Ti.apply(null,arguments).paddingInner(1))}var Xi=y(10614);function eo(n,u,a,s,l){var d=n*n,_=d*n;return((1-3*n+3*d-_)*u+(4-6*d+3*_)*a+(1+3*n+3*d-3*_)*s+_*l)/6}function to(n){var u=n.length-1;return function(a){var s=a<=0?a=0:a>=1?(a=1,u-1):Math.floor(a*u),l=n[s],d=n[s+1],_=s>0?n[s-1]:2*l-d,T=s<u-1?n[s+2]:2*d-l;return eo((a-s/u)*u,_,l,d,T)}}function Ao(n){var u=n.length;return function(a){var s=Math.floor(((a%=1)<0?++a:a)*u),l=n[(s+u-1)%u],d=n[s%u],_=n[(s+1)%u],T=n[(s+2)%u];return eo((a-s/u)*u,l,d,_,T)}}function po(n){return function(){return n}}function Do(n,u){return function(a){return n+a*u}}function Js(n,u,a){return n=Math.pow(n,a),u=Math.pow(u,a)-n,a=1/a,function(s){return Math.pow(n+s*u,a)}}function bs(n,u){var a=u-n;return a?Do(n,a>180||a<-180?a-360*Math.round(a/360):a):constant(isNaN(n)?u:n)}function du(n){return(n=+n)==1?Ls:function(u,a){return a-u?Js(u,a,n):po(isNaN(u)?a:u)}}function Ls(n,u){var a=u-n;return a?Do(n,a):po(isNaN(n)?u:n)}var au=function n(u){var a=du(u);function s(l,d){var _=a((l=(0,Xi.B8)(l)).r,(d=(0,Xi.B8)(d)).r),T=a(l.g,d.g),P=a(l.b,d.b),k=Ls(l.opacity,d.opacity);return function(K){return l.r=_(K),l.g=T(K),l.b=P(K),l.opacity=k(K),l+""}}return s.gamma=n,s}(1);function Ss(n){return function(u){var a=u.length,s=new Array(a),l=new Array(a),d=new Array(a),_,T;for(_=0;_<a;++_)T=(0,Xi.B8)(u[_]),s[_]=T.r||0,l[_]=T.g||0,d[_]=T.b||0;return s=n(s),l=n(l),d=n(d),T.opacity=1,function(P){return T.r=s(P),T.g=l(P),T.b=d(P),T+""}}}var Rs=Ss(to),Us=Ss(Ao);function va(n,u){return(isNumberArray(u)?numberArray:ia)(n,u)}function ia(n,u){var a=u?u.length:0,s=n?Math.min(a,n.length):0,l=new Array(s),d=new Array(a),_;for(_=0;_<s;++_)l[_]=Ku(n[_],u[_]);for(;_<a;++_)d[_]=u[_];return function(T){for(_=0;_<s;++_)d[_]=l[_](T);return d}}function Va(n,u){var a=new Date;return n=+n,u=+u,function(s){return a.setTime(n*(1-s)+u*s),a}}function Da(n,u){return n=+n,u=+u,function(a){return n*(1-a)+u*a}}function vu(n,u){var a={},s={},l;(n===null||typeof n!="object")&&(n={}),(u===null||typeof u!="object")&&(u={});for(l in u)l in n?a[l]=Ku(n[l],u[l]):s[l]=u[l];return function(d){for(l in a)s[l]=a[l](d);return s}}var Ka=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,vo=new RegExp(Ka.source,"g");function ou(n){return function(){return n}}function ca(n){return function(u){return n(u)+""}}function vf(n,u){var a=Ka.lastIndex=vo.lastIndex=0,s,l,d,_=-1,T=[],P=[];for(n=n+"",u=u+"";(s=Ka.exec(n))&&(l=vo.exec(u));)(d=l.index)>a&&(d=u.slice(a,d),T[_]?T[_]+=d:T[++_]=d),(s=s[0])===(l=l[0])?T[_]?T[_]+=l:T[++_]=l:(T[++_]=null,P.push({i:_,x:Da(s,l)})),a=vo.lastIndex;return a<u.length&&(d=u.slice(a),T[_]?T[_]+=d:T[++_]=d),T.length<2?P[0]?ca(P[0].x):ou(u):(u=P.length,function(k){for(var K=0,H;K<u;++K)T[(H=P[K]).i]=H.x(k);return T.join("")})}function $l(n,u){u||(u=[]);var a=n?Math.min(u.length,n.length):0,s=u.slice(),l;return function(d){for(l=0;l<a;++l)s[l]=n[l]*(1-d)+u[l]*d;return s}}function Lc(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Ku(n,u){var a=typeof u,s;return u==null||a==="boolean"?po(u):(a==="number"?Da:a==="string"?(s=(0,Xi.ZP)(u))?(u=s,au):vf:u instanceof Xi.ZP?au:u instanceof Date?Va:Lc(u)?$l:Array.isArray(u)?ia:typeof u.valueOf!="function"&&typeof u.toString!="function"||isNaN(u)?vu:Da)(n,u)}function Qs(n,u){return n=+n,u=+u,function(a){return Math.round(n*(1-a)+u*a)}}function mf(n){return function(){return n}}function Rc(n){return+n}var tf=[0,1];function Yu(n){return n}function fc(n,u){return(u-=n=+n)?function(a){return(a-n)/u}:mf(isNaN(u)?NaN:.5)}function oh(n){var u=n[0],a=n[n.length-1],s;return u>a&&(s=u,u=a,a=s),function(l){return Math.max(u,Math.min(a,l))}}function Oh(n,u,a){var s=n[0],l=n[1],d=u[0],_=u[1];return l<s?(s=fc(l,s),d=a(_,d)):(s=fc(s,l),d=a(d,_)),function(T){return d(s(T))}}function sh(n,u,a){var s=Math.min(n.length,u.length)-1,l=new Array(s),d=new Array(s),_=-1;for(n[s]<n[0]&&(n=n.slice().reverse(),u=u.slice().reverse());++_<s;)l[_]=fc(n[_],n[_+1]),d[_]=a(u[_],u[_+1]);return function(T){var P=Oc(n,T,1,s)-1;return d[P](l[P](T))}}function Gf(n,u){return u.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Hf(){var n=tf,u=tf,a=Ku,s,l,d,_=Yu,T,P,k;function K(){return T=Math.min(n.length,u.length)>2?sh:Oh,P=k=null,H}function H(de){return isNaN(de=+de)?d:(P||(P=T(n.map(s),u,a)))(s(_(de)))}return H.invert=function(de){return _(l((k||(k=T(u,n.map(s),Da)))(de)))},H.domain=function(de){return arguments.length?(n=Dn.call(de,Rc),_===Yu||(_=oh(n)),K()):n.slice()},H.range=function(de){return arguments.length?(u=xn.call(de),K()):u.slice()},H.rangeRound=function(de){return u=xn.call(de),a=Qs,K()},H.clamp=function(de){return arguments.length?(_=de?oh(n):Yu,H):_!==Yu},H.interpolate=function(de){return arguments.length?(a=de,K()):a},H.unknown=function(de){return arguments.length?(d=de,H):d},function(de,Ge){return s=de,l=Ge,K()}}function Lh(n,u){return Hf()(n,u)}var Of=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function gf(n){if(!(u=Of.exec(n)))throw new Error("invalid format: "+n);var u;return new uh({fill:u[1],align:u[2],sign:u[3],symbol:u[4],zero:u[5],width:u[6],comma:u[7],precision:u[8]&&u[8].slice(1),trim:u[9],type:u[10]})}gf.prototype=uh.prototype;function uh(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}uh.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function lh(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function Dc(n,u){if((a=(n=u?n.toExponential(u-1):n.toExponential()).indexOf("e"))<0)return null;var a,s=n.slice(0,a);return[s.length>1?s[0]+s.slice(2):s,+n.slice(a+1)]}function rf(n){return n=Dc(Math.abs(n)),n?n[1]:NaN}function lp(n,u){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(rf(u)/3)))*3-rf(Math.abs(n)))}function cp(n,u){return function(a,s){for(var l=a.length,d=[],_=0,T=n[0],P=0;l>0&&T>0&&(P+T+1>s&&(T=Math.max(1,s-P)),d.push(a.substring(l-=T,l+T)),!((P+=T+1)>s));)T=n[_=(_+1)%n.length];return d.reverse().join(u)}}function ch(n){return function(u){return u.replace(/[0-9]/g,function(a){return n[+a]})}}function fp(n){e:for(var u=n.length,a=1,s=-1,l;a<u;++a)switch(n[a]){case".":s=l=a;break;case"0":s===0&&(s=a),l=a;break;default:if(!+n[a])break e;s>0&&(s=0);break}return s>0?n.slice(0,s)+n.slice(l+1):n}var Rh;function fh(n,u){var a=Dc(n,u);if(!a)return n+"";var s=a[0],l=a[1],d=l-(Rh=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,_=s.length;return d===_?s:d>_?s+new Array(d-_+1).join("0"):d>0?s.slice(0,d)+"."+s.slice(d):"0."+new Array(1-d).join("0")+Dc(n,Math.max(0,u+d-1))[0]}function Dh(n,u){var a=Dc(n,u);if(!a)return n+"";var s=a[0],l=a[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var hh={"%":function(u,a){return(u*100).toFixed(a)},b:function(u){return Math.round(u).toString(2)},c:function(u){return u+""},d:lh,e:function(u,a){return u.toExponential(a)},f:function(u,a){return u.toFixed(a)},g:function(u,a){return u.toPrecision(a)},o:function(u){return Math.round(u).toString(8)},p:function(u,a){return Dh(u*100,a)},r:Dh,s:fh,X:function(u){return Math.round(u).toString(16).toUpperCase()},x:function(u){return Math.round(u).toString(16)}};function ph(n){return n}var dh=Array.prototype.map,Wf=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function kh(n){var u=n.grouping===void 0||n.thousands===void 0?ph:cp(dh.call(n.grouping,Number),n.thousands+""),a=n.currency===void 0?"":n.currency[0]+"",s=n.currency===void 0?"":n.currency[1]+"",l=n.decimal===void 0?".":n.decimal+"",d=n.numerals===void 0?ph:ch(dh.call(n.numerals,String)),_=n.percent===void 0?"%":n.percent+"",T=n.minus===void 0?"-":n.minus+"",P=n.nan===void 0?"NaN":n.nan+"";function k(H){H=gf(H);var de=H.fill,Ge=H.align,ft=H.sign,Ut=H.symbol,gr=H.zero,Ir=H.width,Hr=H.comma,pn=H.precision,wn=H.trim,Wn=H.type;Wn==="n"?(Hr=!0,Wn="g"):hh[Wn]||(pn===void 0&&(pn=12),wn=!0,Wn="g"),(gr||de==="0"&&Ge==="=")&&(gr=!0,de="0",Ge="=");var Ii=Ut==="$"?a:Ut==="#"&&/[boxX]/.test(Wn)?"0"+Wn.toLowerCase():"",qn=Ut==="$"?s:/[%p]/.test(Wn)?_:"",Qi=hh[Wn],Oa=/[defgprs%]/.test(Wn);pn=pn===void 0?6:/[gprs]/.test(Wn)?Math.max(1,Math.min(21,pn)):Math.max(0,Math.min(20,pn));function ka(hi){var Ta=Ii,ro=qn,Ju,Ep,wp;if(Wn==="c")ro=Qi(hi)+ro,hi="";else{hi=+hi;var Tp=hi<0||1/hi<0;if(hi=isNaN(hi)?P:Qi(Math.abs(hi),pn),wn&&(hi=fp(hi)),Tp&&+hi==0&&ft!=="+"&&(Tp=!1),Ta=(Tp?ft==="("?ft:T:ft==="-"||ft==="("?"":ft)+Ta,ro=(Wn==="s"?Wf[8+Rh/3]:"")+ro+(Tp&&ft==="("?")":""),Oa){for(Ju=-1,Ep=hi.length;++Ju<Ep;)if(wp=hi.charCodeAt(Ju),48>wp||wp>57){ro=(wp===46?l+hi.slice(Ju+1):hi.slice(Ju))+ro,hi=hi.slice(0,Ju);break}}}Hr&&!gr&&(hi=u(hi,Infinity));var Ap=Ta.length+hi.length+ro.length,Sf=Ap<Ir?new Array(Ir-Ap+1).join(de):"";switch(Hr&&gr&&(hi=u(Sf+hi,Sf.length?Ir-ro.length:Infinity),Sf=""),Ge){case"<":hi=Ta+hi+ro+Sf;break;case"=":hi=Ta+Sf+hi+ro;break;case"^":hi=Sf.slice(0,Ap=Sf.length>>1)+Ta+hi+ro+Sf.slice(Ap);break;default:hi=Sf+Ta+hi+ro;break}return d(hi)}return ka.toString=function(){return H+""},ka}function K(H,de){var Ge=k((H=gf(H),H.type="f",H)),ft=Math.max(-8,Math.min(8,Math.floor(rf(de)/3)))*3,Ut=Math.pow(10,-ft),gr=Wf[8+ft/3];return function(Ir){return Ge(Ut*Ir)+gr}}return{format:k,formatPrefix:K}}var yf,Lf,vh;Rp({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Rp(n){return yf=kh(n),Lf=yf.format,vh=yf.formatPrefix,yf}function Dp(n,u){return n=Math.abs(n),u=Math.abs(u)-n,Math.max(0,rf(u)-rf(n))+1}function hd(n){return Math.max(0,-rf(Math.abs(n)))}function kp(n,u,a,s){var l=D(n,u,a),d;switch(s=gf(s==null?",f":s),s.type){case"s":{var _=Math.max(Math.abs(n),Math.abs(u));return s.precision==null&&!isNaN(d=lp(l,_))&&(s.precision=d),vh(s,_)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(d=Dp(l,Math.max(Math.abs(n),Math.abs(u))))&&(s.precision=d-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(d=hd(l))&&(s.precision=d-(s.type==="%")*2);break}}return Lf(s)}function Fh(n){var u=n.domain;return n.ticks=function(a){var s=u();return x(s[0],s[s.length-1],a==null?10:a)},n.tickFormat=function(a,s){var l=u();return kp(l[0],l[l.length-1],a==null?10:a,s)},n.nice=function(a){a==null&&(a=10);var s=u(),l=0,d=s.length-1,_=s[l],T=s[d],P;return T<_&&(P=_,_=T,T=P,P=l,l=d,d=P),P=A(_,T,a),P>0?(_=Math.floor(_/P)*P,T=Math.ceil(T/P)*P,P=A(_,T,a)):P<0&&(_=Math.ceil(_*P)/P,T=Math.floor(T*P)/P,P=A(_,T,a)),P>0?(s[l]=Math.floor(_/P)*P,s[d]=Math.ceil(T/P)*P,u(s)):P<0&&(s[l]=Math.ceil(_*P)/P,s[d]=Math.floor(T*P)/P,u(s)),n},n}function hp(){var n=Lh(Yu,Yu);return n.copy=function(){return Gf(n,hp())},ei.apply(n,arguments),Fh(n)}function Nd(n){var u;function a(s){return isNaN(s=+s)?u:s}return a.invert=a,a.domain=a.range=function(s){return arguments.length?(n=Dn.call(s,Rc),a):n.slice()},a.unknown=function(s){return arguments.length?(u=s,a):u},a.copy=function(){return Nd(n).unknown(u)},n=arguments.length?Dn.call(n,Rc):[0,1],Fh(a)}function pd(n,u){n=n.slice();var a=0,s=n.length-1,l=n[a],d=n[s],_;return d<l&&(_=a,a=s,s=_,_=l,l=d,d=_),n[a]=u.floor(l),n[s]=u.ceil(d),n}function mh(n){return Math.log(n)}function Go(n){return Math.exp(n)}function kc(n){return-Math.log(-n)}function zd(n){return-Math.exp(-n)}function Rf(n){return isFinite(n)?+("1e"+n):n<0?0:n}function Fp(n){return n===10?Rf:n===Math.E?Math.exp:function(u){return Math.pow(n,u)}}function dd(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),function(u){return Math.log(u)/n})}function Nh(n){return function(u){return-n(-u)}}function nf(n){var u=n(mh,Go),a=u.domain,s=10,l,d;function _(){return l=dd(s),d=Fp(s),a()[0]<0?(l=Nh(l),d=Nh(d),n(kc,zd)):n(mh,Go),u}return u.base=function(T){return arguments.length?(s=+T,_()):s},u.domain=function(T){return arguments.length?(a(T),_()):a()},u.ticks=function(T){var P=a(),k=P[0],K=P[P.length-1],H;(H=K<k)&&(de=k,k=K,K=de);var de=l(k),Ge=l(K),ft,Ut,gr,Ir=T==null?10:+T,Hr=[];if(!(s%1)&&Ge-de<Ir){if(de=Math.round(de)-1,Ge=Math.round(Ge)+1,k>0){for(;de<Ge;++de)for(Ut=1,ft=d(de);Ut<s;++Ut)if(gr=ft*Ut,!(gr<k)){if(gr>K)break;Hr.push(gr)}}else for(;de<Ge;++de)for(Ut=s-1,ft=d(de);Ut>=1;--Ut)if(gr=ft*Ut,!(gr<k)){if(gr>K)break;Hr.push(gr)}}else Hr=x(de,Ge,Math.min(Ge-de,Ir)).map(d);return H?Hr.reverse():Hr},u.tickFormat=function(T,P){if(P==null&&(P=s===10?".0e":","),typeof P!="function"&&(P=Lf(P)),T===Infinity)return P;T==null&&(T=10);var k=Math.max(1,s*T/u.ticks().length);return function(K){var H=K/d(Math.round(l(K)));return H*s<s-.5&&(H*=s),H<=k?P(K):""}},u.nice=function(){return a(pd(a(),{floor:function(P){return d(Math.floor(l(P)))},ceil:function(P){return d(Math.ceil(l(P)))}}))},u}function zh(){var n=nf(Hf()).domain([1,10]);return n.copy=function(){return Gf(n,zh()).base(n.base())},ei.apply(n,arguments),n}function gh(n){return function(u){return Math.sign(u)*Math.log1p(Math.abs(u/n))}}function Bh(n){return function(u){return Math.sign(u)*Math.expm1(Math.abs(u))*n}}function pp(n){var u=1,a=n(gh(u),Bh(u));return a.constant=function(s){return arguments.length?n(gh(u=+s),Bh(u)):u},linearish(a)}function Np(){var n=pp(transformer());return n.copy=function(){return copy(n,Np()).constant(n.constant())},initRange.apply(n,arguments)}function zp(n){return function(u){return u<0?-Math.pow(-u,n):Math.pow(u,n)}}function Uh(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function vd(n){return n<0?-n*n:n*n}function md(n){var u=n(Yu,Yu),a=1;function s(){return a===1?n(Yu,Yu):a===.5?n(Uh,vd):n(zp(a),zp(1/a))}return u.exponent=function(l){return arguments.length?(a=+l,s()):a},Fh(u)}function dp(){var n=md(Hf());return n.copy=function(){return Gf(n,dp()).exponent(n.exponent())},ei.apply(n,arguments),n}function Bd(){return dp.apply(null,arguments).exponent(.5)}function Bp(){var n=[],u=[],a=[],s;function l(){var _=0,T=Math.max(1,u.length);for(a=new Array(T-1);++_<T;)a[_-1]=oe(n,_/T);return d}function d(_){return isNaN(_=+_)?s:u[Oc(a,_)]}return d.invertExtent=function(_){var T=u.indexOf(_);return T<0?[NaN,NaN]:[T>0?a[T-1]:n[0],T<a.length?a[T]:n[n.length-1]]},d.domain=function(_){if(!arguments.length)return n.slice();n=[];for(var T=0,P=_.length,k;T<P;++T)k=_[T],k!=null&&!isNaN(k=+k)&&n.push(k);return n.sort(If),l()},d.range=function(_){return arguments.length?(u=xn.call(_),l()):u.slice()},d.unknown=function(_){return arguments.length?(s=_,d):s},d.quantiles=function(){return a.slice()},d.copy=function(){return Bp().domain(n).range(u).unknown(s)},ei.apply(d,arguments)}function ul(){var n=0,u=1,a=1,s=[.5],l=[0,1],d;function _(P){return P<=P?l[Oc(s,P,0,a)]:d}function T(){var P=-1;for(s=new Array(a);++P<a;)s[P]=((P+1)*u-(P-a)*n)/(a+1);return _}return _.domain=function(P){return arguments.length?(n=+P[0],u=+P[1],T()):[n,u]},_.range=function(P){return arguments.length?(a=(l=xn.call(P)).length-1,T()):l.slice()},_.invertExtent=function(P){var k=l.indexOf(P);return k<0?[NaN,NaN]:k<1?[n,s[0]]:k>=a?[s[a-1],u]:[s[k-1],s[k]]},_.unknown=function(P){return arguments.length&&(d=P),_},_.thresholds=function(){return s.slice()},_.copy=function(){return ul().domain([n,u]).range(l).unknown(d)},ei.apply(Fh(_),arguments)}function jh(){var n=[.5],u=[0,1],a,s=1;function l(d){return d<=d?u[Oc(n,d,0,s)]:a}return l.domain=function(d){return arguments.length?(n=xn.call(d),s=Math.min(n.length,u.length-1),l):n.slice()},l.range=function(d){return arguments.length?(u=xn.call(d),s=Math.min(n.length,u.length-1),l):u.slice()},l.invertExtent=function(d){var _=u.indexOf(d);return[n[_-1],n[_]]},l.unknown=function(d){return arguments.length?(a=d,l):a},l.copy=function(){return jh().domain(n).range(u).unknown(a)},ei.apply(l,arguments)}var vp=new Date,hc=new Date;function ll(n,u,a,s){function l(d){return n(d=arguments.length===0?new Date:new Date(+d)),d}return l.floor=function(d){return n(d=new Date(+d)),d},l.ceil=function(d){return n(d=new Date(d-1)),u(d,1),n(d),d},l.round=function(d){var _=l(d),T=l.ceil(d);return d-_<T-d?_:T},l.offset=function(d,_){return u(d=new Date(+d),_==null?1:Math.floor(_)),d},l.range=function(d,_,T){var P=[],k;if(d=l.ceil(d),T=T==null?1:Math.floor(T),!(d<_)||!(T>0))return P;do P.push(k=new Date(+d)),u(d,T),n(d);while(k<d&&d<_);return P},l.filter=function(d){return ll(function(_){if(_>=_)for(;n(_),!d(_);)_.setTime(_-1)},function(_,T){if(_>=_)if(T<0)for(;++T<=0;)for(;u(_,-1),!d(_););else for(;--T>=0;)for(;u(_,1),!d(_););})},a&&(l.count=function(d,_){return vp.setTime(+d),hc.setTime(+_),n(vp),n(hc),Math.floor(a(vp,hc))},l.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?l.filter(s?function(_){return s(_)%d==0}:function(_){return l.count(0,_)%d==0}):l}),l}var mp=ll(function(n){n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,u){n.setFullYear(n.getFullYear()+u)},function(n,u){return u.getFullYear()-n.getFullYear()},function(n){return n.getFullYear()});mp.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:ll(function(u){u.setFullYear(Math.floor(u.getFullYear()/n)*n),u.setMonth(0,1),u.setHours(0,0,0,0)},function(u,a){u.setFullYear(u.getFullYear()+a*n)})};var pc=mp,Zh=mp.range,Xf=ll(function(n){n.setDate(1),n.setHours(0,0,0,0)},function(n,u){n.setMonth(n.getMonth()+u)},function(n,u){return u.getMonth()-n.getMonth()+(u.getFullYear()-n.getFullYear())*12},function(n){return n.getMonth()}),yh=Xf,Vh=Xf.range,Gh=1e3,_h=6e4,Up=36e5,jp=864e5,gp=6048e5;function _f(n){return ll(function(u){u.setDate(u.getDate()-(u.getDay()+7-n)%7),u.setHours(0,0,0,0)},function(u,a){u.setDate(u.getDate()+a*7)},function(u,a){return(a-u-(a.getTimezoneOffset()-u.getTimezoneOffset())*_h)/gp})}var Fc=_f(0),Hh=_f(1),Zp=_f(2),Vp=_f(3),Kf=_f(4),Gp=_f(5),gd=_f(6),Ud=Fc.range,yd=Hh.range,jd=Zp.range,yp=Vp.range,Zd=Kf.range,Hp=Gp.range,av=gd.range,Wp=ll(function(n){n.setHours(0,0,0,0)},function(n,u){n.setDate(n.getDate()+u)},function(n,u){return(u-n-(u.getTimezoneOffset()-n.getTimezoneOffset())*_h)/jp},function(n){return n.getDate()-1}),Xp=Wp,ov=Wp.range,_d=ll(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*Gh-n.getMinutes()*_h)},function(n,u){n.setTime(+n+u*Up)},function(n,u){return(u-n)/Up},function(n){return n.getHours()}),Vd=_d,sv=_d.range,xd=ll(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*Gh)},function(n,u){n.setTime(+n+u*_h)},function(n,u){return(u-n)/_h},function(n){return n.getMinutes()}),Gd=xd,uv=xd.range,Nc=ll(function(n){n.setTime(n-n.getMilliseconds())},function(n,u){n.setTime(+n+u*Gh)},function(n,u){return(u-n)/Gh},function(n){return n.getUTCSeconds()}),_p=Nc,Hd=Nc.range,Wh=ll(function(){},function(n,u){n.setTime(+n+u)},function(n,u){return u-n});Wh.every=function(n){return n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?ll(function(u){u.setTime(Math.floor(u/n)*n)},function(u,a){u.setTime(+u+a*n)},function(u,a){return(a-u)/n}):Wh};var Kp=Wh,Wd=Wh.range;function Xh(n){return ll(function(u){u.setUTCDate(u.getUTCDate()-(u.getUTCDay()+7-n)%7),u.setUTCHours(0,0,0,0)},function(u,a){u.setUTCDate(u.getUTCDate()+a*7)},function(u,a){return(a-u)/gp})}var lv=Xh(0),bd=Xh(1),xg=Xh(2),bg=Xh(3),xp=Xh(4),Sg=Xh(5),Eg=Xh(6),q1=lv.range,e_=bd.range,t_=xg.range,r_=bg.range,n_=xp.range,i_=Sg.range,a_=Eg.range,cv=ll(function(n){n.setUTCHours(0,0,0,0)},function(n,u){n.setUTCDate(n.getUTCDate()+u)},function(n,u){return(u-n)/jp},function(n){return n.getUTCDate()-1}),fv=cv,o_=cv.range,Xd=ll(function(n){n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,u){n.setUTCFullYear(n.getUTCFullYear()+u)},function(n,u){return u.getUTCFullYear()-n.getUTCFullYear()},function(n){return n.getUTCFullYear()});Xd.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:ll(function(u){u.setUTCFullYear(Math.floor(u.getUTCFullYear()/n)*n),u.setUTCMonth(0,1),u.setUTCHours(0,0,0,0)},function(u,a){u.setUTCFullYear(u.getUTCFullYear()+a*n)})};var Yp=Xd,s_=Xd.range;function Kd(n){if(0<=n.y&&n.y<100){var u=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return u.setFullYear(n.y),u}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function Yd(n){if(0<=n.y&&n.y<100){var u=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return u.setUTCFullYear(n.y),u}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function $p(n,u,a){return{y:n,m:u,d:a,H:0,M:0,S:0,L:0}}function wg(n){var u=n.dateTime,a=n.date,s=n.time,l=n.periods,d=n.days,_=n.shortDays,T=n.months,P=n.shortMonths,k=Jp(l),K=Qp(l),H=Jp(d),de=Qp(d),Ge=Jp(_),ft=Qp(_),Ut=Jp(T),gr=Qp(T),Ir=Jp(P),Hr=Qp(P),pn={a:Tp,A:Ap,b:Sf,B:G1,c:null,d:gv,e:gv,f:Xg,g:ny,G:ay,H:Gg,I:Hg,j:Wg,L:yv,m:Kg,M:Yg,p:H1,q:W1,Q:wv,s:Tv,S:$g,u:Jg,U:Qg,V:qg,w:ey,W:ty,x:null,X:null,y:ry,Y:iy,Z:oy,"%":Ev},wn={a:X1,A:K1,b:Y1,B:$1,c:null,d:xv,e:xv,f:cy,g:xy,G:Sy,H:sy,I:uy,j:ly,L:bv,m:fy,M:hy,p:J1,q:Q1,Q:wv,s:Tv,S:py,u:dy,U:vy,V:my,w:gy,W:yy,x:null,X:null,y:_y,Y:by,Z:Ey,"%":Ev},Wn={a:ka,A:hi,b:Ta,B:ro,c:Ju,d:vv,e:vv,f:Ug,g:dv,G:pv,H:mv,I:mv,j:Fg,L:Bg,m:kg,M:Ng,p:Oa,q:Dg,Q:Zg,s:Vg,S:zg,u:Mg,U:Ig,V:Og,w:Pg,W:Lg,x:Ep,X:wp,y:dv,Y:pv,Z:Rg,"%":jg};pn.x=Ii(a,pn),pn.X=Ii(s,pn),pn.c=Ii(u,pn),wn.x=Ii(a,wn),wn.X=Ii(s,wn),wn.c=Ii(u,wn);function Ii(Ni,Fa){return function(fa){var Mn=[],dc=-1,ps=0,zc=Ni.length,Bc,$h,_g;for(fa instanceof Date||(fa=new Date(+fa));++dc<zc;)Ni.charCodeAt(dc)===37&&(Mn.push(Ni.slice(ps,dc)),($h=hv[Bc=Ni.charAt(++dc)])!=null?Bc=Ni.charAt(++dc):$h=Bc==="e"?" ":"0",(_g=Fa[Bc])&&(Bc=_g(fa,$h)),Mn.push(Bc),ps=dc+1);return Mn.push(Ni.slice(ps,dc)),Mn.join("")}}function qn(Ni,Fa){return function(fa){var Mn=$p(1900,void 0,1),dc=Qi(Mn,Ni,fa+="",0),ps,zc;if(dc!=fa.length)return null;if("Q"in Mn)return new Date(Mn.Q);if("s"in Mn)return new Date(Mn.s*1e3+("L"in Mn?Mn.L:0));if(Fa&&!("Z"in Mn)&&(Mn.Z=0),"p"in Mn&&(Mn.H=Mn.H%12+Mn.p*12),Mn.m===void 0&&(Mn.m="q"in Mn?Mn.q:0),"V"in Mn){if(Mn.V<1||Mn.V>53)return null;"w"in Mn||(Mn.w=1),"Z"in Mn?(ps=Yd($p(Mn.y,0,1)),zc=ps.getUTCDay(),ps=zc>4||zc===0?bd.ceil(ps):bd(ps),ps=fv.offset(ps,(Mn.V-1)*7),Mn.y=ps.getUTCFullYear(),Mn.m=ps.getUTCMonth(),Mn.d=ps.getUTCDate()+(Mn.w+6)%7):(ps=Kd($p(Mn.y,0,1)),zc=ps.getDay(),ps=zc>4||zc===0?Hh.ceil(ps):Hh(ps),ps=Xp.offset(ps,(Mn.V-1)*7),Mn.y=ps.getFullYear(),Mn.m=ps.getMonth(),Mn.d=ps.getDate()+(Mn.w+6)%7)}else("W"in Mn||"U"in Mn)&&("w"in Mn||(Mn.w="u"in Mn?Mn.u%7:"W"in Mn?1:0),zc="Z"in Mn?Yd($p(Mn.y,0,1)).getUTCDay():Kd($p(Mn.y,0,1)).getDay(),Mn.m=0,Mn.d="W"in Mn?(Mn.w+6)%7+Mn.W*7-(zc+5)%7:Mn.w+Mn.U*7-(zc+6)%7);return"Z"in Mn?(Mn.H+=Mn.Z/100|0,Mn.M+=Mn.Z%100,Yd(Mn)):Kd(Mn)}}function Qi(Ni,Fa,fa,Mn){for(var dc=0,ps=Fa.length,zc=fa.length,Bc,$h;dc<ps;){if(Mn>=zc)return-1;if(Bc=Fa.charCodeAt(dc++),Bc===37){if(Bc=Fa.charAt(dc++),$h=Wn[Bc in hv?Fa.charAt(dc++):Bc],!$h||(Mn=$h(Ni,fa,Mn))<0)return-1}else if(Bc!=fa.charCodeAt(Mn++))return-1}return Mn}function Oa(Ni,Fa,fa){var Mn=k.exec(Fa.slice(fa));return Mn?(Ni.p=K[Mn[0].toLowerCase()],fa+Mn[0].length):-1}function ka(Ni,Fa,fa){var Mn=Ge.exec(Fa.slice(fa));return Mn?(Ni.w=ft[Mn[0].toLowerCase()],fa+Mn[0].length):-1}function hi(Ni,Fa,fa){var Mn=H.exec(Fa.slice(fa));return Mn?(Ni.w=de[Mn[0].toLowerCase()],fa+Mn[0].length):-1}function Ta(Ni,Fa,fa){var Mn=Ir.exec(Fa.slice(fa));return Mn?(Ni.m=Hr[Mn[0].toLowerCase()],fa+Mn[0].length):-1}function ro(Ni,Fa,fa){var Mn=Ut.exec(Fa.slice(fa));return Mn?(Ni.m=gr[Mn[0].toLowerCase()],fa+Mn[0].length):-1}function Ju(Ni,Fa,fa){return Qi(Ni,u,Fa,fa)}function Ep(Ni,Fa,fa){return Qi(Ni,a,Fa,fa)}function wp(Ni,Fa,fa){return Qi(Ni,s,Fa,fa)}function Tp(Ni){return _[Ni.getDay()]}function Ap(Ni){return d[Ni.getDay()]}function Sf(Ni){return P[Ni.getMonth()]}function G1(Ni){return T[Ni.getMonth()]}function H1(Ni){return l[+(Ni.getHours()>=12)]}function W1(Ni){return 1+~~(Ni.getMonth()/3)}function X1(Ni){return _[Ni.getUTCDay()]}function K1(Ni){return d[Ni.getUTCDay()]}function Y1(Ni){return P[Ni.getUTCMonth()]}function $1(Ni){return T[Ni.getUTCMonth()]}function J1(Ni){return l[+(Ni.getUTCHours()>=12)]}function Q1(Ni){return 1+~~(Ni.getUTCMonth()/3)}return{format:function(Fa){var fa=Ii(Fa+="",pn);return fa.toString=function(){return Fa},fa},parse:function(Fa){var fa=qn(Fa+="",!1);return fa.toString=function(){return Fa},fa},utcFormat:function(Fa){var fa=Ii(Fa+="",wn);return fa.toString=function(){return Fa},fa},utcParse:function(Fa){var fa=qn(Fa+="",!0);return fa.toString=function(){return Fa},fa}}}var hv={"-":"",_:" ","0":"0"},$u=/^\s*\d+/,Tg=/^%/,Ag=/[\\^$*+?|[\]().{}]/g;function mo(n,u,a){var s=n<0?"-":"",l=(s?-n:n)+"",d=l.length;return s+(d<a?new Array(a-d+1).join(u)+l:l)}function Cg(n){return n.replace(Ag,"\\$&")}function Jp(n){return new RegExp("^(?:"+n.map(Cg).join("|")+")","i")}function Qp(n){for(var u={},a=-1,s=n.length;++a<s;)u[n[a].toLowerCase()]=a;return u}function Pg(n,u,a){var s=$u.exec(u.slice(a,a+1));return s?(n.w=+s[0],a+s[0].length):-1}function Mg(n,u,a){var s=$u.exec(u.slice(a,a+1));return s?(n.u=+s[0],a+s[0].length):-1}function Ig(n,u,a){var s=$u.exec(u.slice(a,a+2));return s?(n.U=+s[0],a+s[0].length):-1}function Og(n,u,a){var s=$u.exec(u.slice(a,a+2));return s?(n.V=+s[0],a+s[0].length):-1}function Lg(n,u,a){var s=$u.exec(u.slice(a,a+2));return s?(n.W=+s[0],a+s[0].length):-1}function pv(n,u,a){var s=$u.exec(u.slice(a,a+4));return s?(n.y=+s[0],a+s[0].length):-1}function dv(n,u,a){var s=$u.exec(u.slice(a,a+2));return s?(n.y=+s[0]+(+s[0]>68?1900:2e3),a+s[0].length):-1}function Rg(n,u,a){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(u.slice(a,a+6));return s?(n.Z=s[1]?0:-(s[2]+(s[3]||"00")),a+s[0].length):-1}function Dg(n,u,a){var s=$u.exec(u.slice(a,a+1));return s?(n.q=s[0]*3-3,a+s[0].length):-1}function kg(n,u,a){var s=$u.exec(u.slice(a,a+2));return s?(n.m=s[0]-1,a+s[0].length):-1}function vv(n,u,a){var s=$u.exec(u.slice(a,a+2));return s?(n.d=+s[0],a+s[0].length):-1}function Fg(n,u,a){var s=$u.exec(u.slice(a,a+3));return s?(n.m=0,n.d=+s[0],a+s[0].length):-1}function mv(n,u,a){var s=$u.exec(u.slice(a,a+2));return s?(n.H=+s[0],a+s[0].length):-1}function Ng(n,u,a){var s=$u.exec(u.slice(a,a+2));return s?(n.M=+s[0],a+s[0].length):-1}function zg(n,u,a){var s=$u.exec(u.slice(a,a+2));return s?(n.S=+s[0],a+s[0].length):-1}function Bg(n,u,a){var s=$u.exec(u.slice(a,a+3));return s?(n.L=+s[0],a+s[0].length):-1}function Ug(n,u,a){var s=$u.exec(u.slice(a,a+6));return s?(n.L=Math.floor(s[0]/1e3),a+s[0].length):-1}function jg(n,u,a){var s=Tg.exec(u.slice(a,a+1));return s?a+s[0].length:-1}function Zg(n,u,a){var s=$u.exec(u.slice(a));return s?(n.Q=+s[0],a+s[0].length):-1}function Vg(n,u,a){var s=$u.exec(u.slice(a));return s?(n.s=+s[0],a+s[0].length):-1}function gv(n,u){return mo(n.getDate(),u,2)}function Gg(n,u){return mo(n.getHours(),u,2)}function Hg(n,u){return mo(n.getHours()%12||12,u,2)}function Wg(n,u){return mo(1+Xp.count(pc(n),n),u,3)}function yv(n,u){return mo(n.getMilliseconds(),u,3)}function Xg(n,u){return yv(n,u)+"000"}function Kg(n,u){return mo(n.getMonth()+1,u,2)}function Yg(n,u){return mo(n.getMinutes(),u,2)}function $g(n,u){return mo(n.getSeconds(),u,2)}function Jg(n){var u=n.getDay();return u===0?7:u}function Qg(n,u){return mo(Fc.count(pc(n)-1,n),u,2)}function _v(n){var u=n.getDay();return u>=4||u===0?Kf(n):Kf.ceil(n)}function qg(n,u){return n=_v(n),mo(Kf.count(pc(n),n)+(pc(n).getDay()===4),u,2)}function ey(n){return n.getDay()}function ty(n,u){return mo(Hh.count(pc(n)-1,n),u,2)}function ry(n,u){return mo(n.getFullYear()%100,u,2)}function ny(n,u){return n=_v(n),mo(n.getFullYear()%100,u,2)}function iy(n,u){return mo(n.getFullYear()%1e4,u,4)}function ay(n,u){var a=n.getDay();return n=a>=4||a===0?Kf(n):Kf.ceil(n),mo(n.getFullYear()%1e4,u,4)}function oy(n){var u=n.getTimezoneOffset();return(u>0?"-":(u*=-1,"+"))+mo(u/60|0,"0",2)+mo(u%60,"0",2)}function xv(n,u){return mo(n.getUTCDate(),u,2)}function sy(n,u){return mo(n.getUTCHours(),u,2)}function uy(n,u){return mo(n.getUTCHours()%12||12,u,2)}function ly(n,u){return mo(1+fv.count(Yp(n),n),u,3)}function bv(n,u){return mo(n.getUTCMilliseconds(),u,3)}function cy(n,u){return bv(n,u)+"000"}function fy(n,u){return mo(n.getUTCMonth()+1,u,2)}function hy(n,u){return mo(n.getUTCMinutes(),u,2)}function py(n,u){return mo(n.getUTCSeconds(),u,2)}function dy(n){var u=n.getUTCDay();return u===0?7:u}function vy(n,u){return mo(lv.count(Yp(n)-1,n),u,2)}function Sv(n){var u=n.getUTCDay();return u>=4||u===0?xp(n):xp.ceil(n)}function my(n,u){return n=Sv(n),mo(xp.count(Yp(n),n)+(Yp(n).getUTCDay()===4),u,2)}function gy(n){return n.getUTCDay()}function yy(n,u){return mo(bd.count(Yp(n)-1,n),u,2)}function _y(n,u){return mo(n.getUTCFullYear()%100,u,2)}function xy(n,u){return n=Sv(n),mo(n.getUTCFullYear()%100,u,2)}function by(n,u){return mo(n.getUTCFullYear()%1e4,u,4)}function Sy(n,u){var a=n.getUTCDay();return n=a>=4||a===0?xp(n):xp.ceil(n),mo(n.getUTCFullYear()%1e4,u,4)}function Ey(){return"+0000"}function Ev(){return"%"}function wv(n){return+n}function Tv(n){return Math.floor(+n/1e3)}var bp,Av,wy,Ty,Ay;Cy({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Cy(n){return bp=wg(n),Av=bp.format,wy=bp.parse,Ty=bp.utcFormat,Ay=bp.utcParse,bp}var qp=1e3,ed=qp*60,td=ed*60,rd=td*24,Py=rd*7,Cv=rd*30,$d=rd*365;function My(n){return new Date(n)}function Iy(n){return n instanceof Date?+n:+new Date(+n)}function Pv(n,u,a,s,l,d,_,T,P){var k=Lh(Yu,Yu),K=k.invert,H=k.domain,de=P(".%L"),Ge=P(":%S"),ft=P("%I:%M"),Ut=P("%I %p"),gr=P("%a %d"),Ir=P("%b %d"),Hr=P("%B"),pn=P("%Y"),wn=[[_,1,qp],[_,5,5*qp],[_,15,15*qp],[_,30,30*qp],[d,1,ed],[d,5,5*ed],[d,15,15*ed],[d,30,30*ed],[l,1,td],[l,3,3*td],[l,6,6*td],[l,12,12*td],[s,1,rd],[s,2,2*rd],[a,1,Py],[u,1,Cv],[u,3,3*Cv],[n,1,$d]];function Wn(qn){return(_(qn)<qn?de:d(qn)<qn?Ge:l(qn)<qn?ft:s(qn)<qn?Ut:u(qn)<qn?a(qn)<qn?gr:Ir:n(qn)<qn?Hr:pn)(qn)}function Ii(qn,Qi,Oa,ka){if(qn==null&&(qn=10),typeof qn=="number"){var hi=Math.abs(Oa-Qi)/qn,Ta=ef(function(ro){return ro[2]}).right(wn,hi);Ta===wn.length?(ka=D(Qi/$d,Oa/$d,qn),qn=n):Ta?(Ta=wn[hi/wn[Ta-1][2]<wn[Ta][2]/hi?Ta-1:Ta],ka=Ta[1],qn=Ta[0]):(ka=Math.max(D(Qi,Oa,qn),1),qn=T)}return ka==null?qn:qn.every(ka)}return k.invert=function(qn){return new Date(K(qn))},k.domain=function(qn){return arguments.length?H(Dn.call(qn,Iy)):H().map(My)},k.ticks=function(qn,Qi){var Oa=H(),ka=Oa[0],hi=Oa[Oa.length-1],Ta=hi<ka,ro;return Ta&&(ro=ka,ka=hi,hi=ro),ro=Ii(qn,ka,hi,Qi),ro=ro?ro.range(ka,hi+1):[],Ta?ro.reverse():ro},k.tickFormat=function(qn,Qi){return Qi==null?Wn:P(Qi)},k.nice=function(qn,Qi){var Oa=H();return(qn=Ii(qn,Oa[0],Oa[Oa.length-1],Qi))?H(pd(Oa,qn)):k},k.copy=function(){return Gf(k,Pv(n,u,a,s,l,d,_,T,P))},k}function Oy(){return ei.apply(Pv(pc,yh,Fc,Xp,Vd,Gd,_p,Kp,Av).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function u_(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Sd(){var n=0,u=1,a,s,l,d,_=identity,T=!1,P;function k(K){return isNaN(K=+K)?P:_(l===0?.5:(K=(d(K)-a)*l,T?Math.max(0,Math.min(1,K)):K))}return k.domain=function(K){return arguments.length?(a=d(n=+K[0]),s=d(u=+K[1]),l=a===s?0:1/(s-a),k):[n,u]},k.clamp=function(K){return arguments.length?(T=!!K,k):T},k.interpolator=function(K){return arguments.length?(_=K,k):_},k.unknown=function(K){return arguments.length?(P=K,k):P},function(K){return d=K,a=K(n),s=K(u),l=a===s?0:1/(s-a),k}}function Ed(n,u){return u.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function Ly(){var n=linearish(Sd()(identity));return n.copy=function(){return Ed(n,Ly())},initInterpolator.apply(n,arguments)}function Ry(){var n=loggish(Sd()).domain([1,10]);return n.copy=function(){return Ed(n,Ry()).base(n.base())},initInterpolator.apply(n,arguments)}function Dy(){var n=symlogish(Sd());return n.copy=function(){return Ed(n,Dy()).constant(n.constant())},initInterpolator.apply(n,arguments)}function Mv(){var n=powish(Sd());return n.copy=function(){return Ed(n,Mv()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function l_(){return Mv.apply(null,arguments).exponent(.5)}function ky(){var n=[],u=identity;function a(s){if(!isNaN(s=+s))return u((bisect(n,s)-1)/(n.length-1))}return a.domain=function(s){if(!arguments.length)return n.slice();n=[];for(var l=0,d=s.length,_;l<d;++l)_=s[l],_!=null&&!isNaN(_=+_)&&n.push(_);return n.sort(ascending),a},a.interpolator=function(s){return arguments.length?(u=s,a):u},a.copy=function(){return ky(u).domain(n)},initInterpolator.apply(a,arguments)}function wd(){var n=0,u=.5,a=1,s,l,d,_,T,P=identity,k,K=!1,H;function de(Ge){return isNaN(Ge=+Ge)?H:(Ge=.5+((Ge=+k(Ge))-l)*(Ge<l?_:T),P(K?Math.max(0,Math.min(1,Ge)):Ge))}return de.domain=function(Ge){return arguments.length?(s=k(n=+Ge[0]),l=k(u=+Ge[1]),d=k(a=+Ge[2]),_=s===l?0:.5/(l-s),T=l===d?0:.5/(d-l),de):[n,u,a]},de.clamp=function(Ge){return arguments.length?(K=!!Ge,de):K},de.interpolator=function(Ge){return arguments.length?(P=Ge,de):P},de.unknown=function(Ge){return arguments.length?(H=Ge,de):H},function(Ge){return k=Ge,s=Ge(n),l=Ge(u),d=Ge(a),_=s===l?0:.5/(l-s),T=l===d?0:.5/(d-l),de}}function Fy(){var n=linearish(wd()(identity));return n.copy=function(){return copy(n,Fy())},initInterpolator.apply(n,arguments)}function Ny(){var n=loggish(wd()).domain([.1,1,10]);return n.copy=function(){return copy(n,Ny()).base(n.base())},initInterpolator.apply(n,arguments)}function zy(){var n=symlogish(wd());return n.copy=function(){return copy(n,zy()).constant(n.constant())},initInterpolator.apply(n,arguments)}function Iv(){var n=powish(wd());return n.copy=function(){return copy(n,Iv()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function c_(){return Iv.apply(null,arguments).exponent(.5)}var xf,Ov,Lv,Rv,Dv,Td,kv,Fv,Nv,By=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Uy=(xf={},(0,F.Z)(xf,S.ScaleTypes.LINEAR,hp),(0,F.Z)(xf,S.ScaleTypes.POWER,dp),(0,F.Z)(xf,S.ScaleTypes.LOG,zh),(0,F.Z)(xf,S.ScaleTypes.IDENTITY,Nd),(0,F.Z)(xf,S.ScaleTypes.TIME,Oy),(0,F.Z)(xf,S.ScaleTypes.QUANTILE,Bp),(0,F.Z)(xf,S.ScaleTypes.QUANTIZE,ul),(0,F.Z)(xf,S.ScaleTypes.THRESHOLD,jh),(0,F.Z)(xf,S.ScaleTypes.CAT,Hi),xf),jy=(Ov=(0,Tt.b2)(),Lv=(0,Tt.f3)(S.vK.IGlobalConfigService),Rv=(0,Tt.f3)(S.vK.ILogService),Ov(Dv=(Td=(Nv=function(){function n(){(0,ce.Z)(this,n),(0,Fn.Z)(this,"configService",kv,this),(0,Fn.Z)(this,"logger",Fv,this),this.scaleCache={},this.scaleOptions={}}return(0,q.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var _=d.getLayerStyleAttributes(),T=a.getSource().data.dataArray;T.length!==0&&l.caculateScalesForAttributes(_||[],T)}),a.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var _=d.getLayerStyleAttributes(),T=a.getSource().data.dataArray;return l.caculateScalesForAttributes(_||[],T),a.layerModelNeedUpdate=!0,!0}),a.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!a.layerModelNeedUpdate){l.scaleOptions=a.getScaleOptions();var _=d.getLayerStyleAttributes();if(_){var T=a.getSource().data.dataArray;if(T.length===0)return;var P=_.filter(function(k){return k.needRescale});P.length&&(l.caculateScalesForAttributes(P,T),l.logger.debug("rescale finished"))}}})}},{key:"isNumber",value:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}},{key:"caculateScalesForAttributes",value:function(a,s){var l=this;this.scaleCache={},a.forEach(function(d){if(d.scale){var _=d.scale,T=d.name;_.names=l.parseFields(d.scale.field||[]);var P=[];_.names.forEach(function(k){P.push(l.getOrCreateScale(k,d,s))}),P.some(function(k){return k.type===S.StyleScaleType.VARIABLE})?(_.type=S.StyleScaleType.VARIABLE,P.forEach(function(k){if(!_.callback){var K;if(_.values&&_.values!=="text"){var H;if(((H=k.option)===null||H===void 0?void 0:H.type)==="linear"&&_.values.length>2){var de=k.scale.ticks(_.values.length);T==="color"&&k.scale.domain(de)}k.scale.range(_.values)}else((K=k.option)===null||K===void 0?void 0:K.type)==="cat"&&k.scale.range(k.option.domain)}})):(_.type=S.StyleScaleType.CONSTANT,_.defaultValues=P.map(function(k,K){return k.scale(_.names[K])})),_.scalers=P.map(function(k){return{field:k.field,func:k.scale,option:k.option}}),d.needRescale=!1}})}},{key:"getOrCreateScale",value:function(a,s,l){var d,_=[a,s.name].join("_"),T=(d=s.scale)===null||d===void 0?void 0:d.values,P=this.createScale(a,s.name,T,l);return P}},{key:"parseFields",value:function(a){return Array.isArray(a)?a:Re()(a)?a.split("*"):[a]}},{key:"createScale",value:function(a,s,l,d){var _,T,P=this.scaleOptions[s]&&((_=this.scaleOptions[s])===null||_===void 0?void 0:_.field)===a?this.scaleOptions[s]:this.scaleOptions[a],k={field:a,scale:void 0,type:S.StyleScaleType.VARIABLE,option:P};if(!d||!d.length)return P&&P.type?k.scale=this.createDefaultScale(P):(k.scale=Hi([a]),k.type=S.StyleScaleType.CONSTANT),k;var K=(T=d.find(function(Ge){return!up()(Ge[a])}))===null||T===void 0?void 0:T[a];if(this.isNumber(a)||up()(K)&&!P)k.scale=Hi([a]),k.type=S.StyleScaleType.CONSTANT;else{var H=P&&P.type||this.getDefaultType(K);l==="text"&&(H=S.ScaleTypes.CAT);var de=this.createDefaultScaleConfig(H,a,d);Object.assign(de,P),k.scale=this.createDefaultScale(de),k.option=de}return k}},{key:"getDefaultType",value:function(a){var s=S.ScaleTypes.LINEAR;return typeof a=="string"&&(s=By.test(a)?S.ScaleTypes.TIME:S.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(a,s,l){var d={type:a},_=(l==null?void 0:l.map(function(T){return T[s]}))||[];return a!==S.ScaleTypes.CAT&&a!==S.ScaleTypes.QUANTILE?d.domain=fd(_):a===S.ScaleTypes.CAT?d.domain=op()(_):a===S.ScaleTypes.QUANTILE&&(d.domain=_),d}},{key:"createDefaultScale",value:function(a){var s=a.type,l=a.domain,d=Uy[s]();return l&&d.domain(l),d}}]),n}(),Nv),kv=(0,kn.Z)(Td.prototype,"configService",[Lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fv=(0,kn.Z)(Td.prototype,"logger",[Rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Td))||Dv),zv,Bv,Uv,jv,Ad,Zv,Vv,Gv;function Hv(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Zy(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?Hv(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Hv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Vy=(zv=(0,Tt.b2)(),Bv=(0,Tt.f3)(S.vK.ICameraService),Uv=(0,Tt.f3)(S.vK.IRendererService),zv(jv=(Ad=(Gv=function(){function n(){(0,ce.Z)(this,n),(0,Fn.Z)(this,"cameraService",Zv,this),(0,Fn.Z)(this,"rendererService",Vv,this)}return(0,q.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){a.models.forEach(function(s){s.addUniforms(Zy({},a.layerModel.getAnimateUniforms()))})})}}]),n}(),Gv),Zv=(0,kn.Z)(Ad.prototype,"cameraService",[Bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vv=(0,kn.Z)(Ad.prototype,"rendererService",[Uv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad))||jv),Wv,Xv,Gy=(Wv=(0,Tt.b2)(),Wv(Xv=function(){function n(){(0,ce.Z)(this,n)}return(0,q.Z)(n,[{key:"apply",value:function(a){a.hooks.init.tap("LayerModelPlugin",function(){a.prepareBuildModel(),a.buildModels(),a.styleNeedUpdate=!1}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return a.prepareBuildModel(),a.clearModels(),a.buildModels(),a.layerModelNeedUpdate=!1,!1})}}]),n}())||Xv),Kv,Yv,Hy=(Kv=(0,Tt.b2)(),Kv(Yv=function(){function n(){(0,ce.Z)(this,n)}return(0,q.Z)(n,[{key:"apply",value:function(a){a.hooks.afterInit.tap("LayerStylePlugin",function(){a.updateLayerConfig({});var s=a.getLayerConfig(),l=s.autoFit,d=s.fitBoundsOptions;l&&setTimeout(function(){a.fitBounds(d)},100)})}}]),n}())||Yv),$v,Jv;function Qv(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function nd(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?Qv(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Qv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var qv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Wy={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Xy={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Ky={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},f_=null;function Yy(n){var u={u_DirectionalLights:new Array(3).fill(nd({},Xy)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(nd({},Ky)),u_NumOfSpotLights:0};return(!n||!n.length)&&(n=[Wy]),n.forEach(function(a,s){var l=a.type,d=l===void 0?"directional":l,_=(0,mi.Z)(a,["type"]),T=qv[d].lights,P=qv[d].num,k=u[P];u[T][k]=nd(nd({},u[T][k]),_),u[P]++}),u}var $y=($v=(0,Tt.b2)(),$v(Jv=function(){function n(){(0,ce.Z)(this,n)}return(0,q.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LightingPlugin",function(){var s=a.getLayerConfig(),l=s.enableLighting;l&&a.models.forEach(function(d){return d.addUniforms(nd({},Yy()))})})}}]),n}())||Jv),em,tm,Cd={NONE:0,ENCODE:1,HIGHLIGHT:2},Jy=(em=(0,Tt.b2)(),em(tm=function(){function n(){(0,ce.Z)(this,n)}return(0,q.Z)(n,[{key:"apply",value:function(a,s){var l=s.rendererService,d=s.styleAttributeService;a.hooks.init.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),T=_.enablePicking;d.registerStyleAttribute({name:"pickingColor",type:S.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:S.gl.FLOAT},size:3,update:function(k,K){var H=k.id;return T?(0,Oe.Z6)(H):[0,0,0]}}})}),a.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),T=_.enablePicking;T&&a.isVisible()&&a.models.forEach(function(P){return P.addUniforms({u_PickingStage:Cd.ENCODE})})}),a.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),T=_.enablePicking;T&&a.isVisible()&&a.models.forEach(function(P){return P.addUniforms({u_PickingStage:Cd.HIGHLIGHT})})}),a.hooks.beforeHighlight.tap("PixelPickingPlugin",function(_){var T=a.getLayerConfig(),P=T.highlightColor,k=typeof P=="string"?(0,Oe.CI)(P):P||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,Oe.W0)(new Uint8Array(_))}),a.models.forEach(function(K){return K.addUniforms({u_PickingStage:Cd.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:k.map(function(H){return H*255})})})}),a.hooks.beforeSelect.tap("PixelPickingPlugin",function(_){var T=a.getLayerConfig(),P=T.selectColor,k=typeof P=="string"?(0,Oe.CI)(P):P||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,Oe.W0)(new Uint8Array(_))}),a.models.forEach(function(K){return K.addUniforms({u_PickingStage:Cd.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:k.map(function(H){return H*255})})})})}}]),n}())||tm),rm,nm,im,Jd,am,om,Qy=(rm=(0,Tt.b2)(),nm=(0,Tt.f3)(S.vK.ILogService),rm(im=(Jd=(om=function(){function n(){(0,ce.Z)(this,n),(0,Fn.Z)(this,"logger",am,this)}return(0,q.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(d)})}},{key:"registerBuiltinAttributes",value:function(a){a.registerStyleAttribute({name:"position",type:S.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:S.gl.FLOAT},size:3,update:function(l,d,_){return _.length===2?[_[0],_[1],0]:[_[0],_[1],_[2]]}}}),a.registerStyleAttribute({name:"filter",type:S.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(l,d){var _=l.filter;return _?[1]:[0]}}}),a.registerStyleAttribute({name:"color",type:S.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:4,update:function(l,d){var _=l.color;return!_||!_.length?[1,1,1,1]:_}}})}}]),n}(),om),am=(0,kn.Z)(Jd.prototype,"logger",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jd))||im),sm,um,lm,cm,fm,hm,Sp,pm,dm,vm,mm,gm,qy=(sm=(0,Tt.b2)(),um=(0,Tt.f3)(S.vK.ICameraService),lm=(0,Tt.f3)(S.vK.ICoordinateSystemService),cm=(0,Tt.f3)(S.vK.IRendererService),fm=(0,Tt.f3)(S.vK.IMapService),sm(hm=(Sp=(gm=function(){function n(){(0,ce.Z)(this,n),(0,Fn.Z)(this,"cameraService",pm,this),(0,Fn.Z)(this,"coordinateSystemService",dm,this),(0,Fn.Z)(this,"rendererService",vm,this),(0,Fn.Z)(this,"mapService",mm,this)}return(0,q.Z)(n,[{key:"apply",value:function(a){var s=this,l=this.mapService.version,d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_=[0,0];a.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(d=s.mapService.map.customCoords.getMVPMatrix(),_=s.mapService.getCustomCoordCenter());var T=s.rendererService.getViewportSize(),P=T.width,k=T.height;a.models.forEach(function(K){var H;K.addUniforms((H={},(0,F.Z)(H,S.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,F.Z)(H,S.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,F.Z)(H,S.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,F.Z)(H,S.CameraUniform.Zoom,s.cameraService.getZoom()),(0,F.Z)(H,S.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,F.Z)(H,S.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,F.Z)(H,S.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,F.Z)(H,S.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,F.Z)(H,S.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,F.Z)(H,S.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,F.Z)(H,S.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,F.Z)(H,S.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,F.Z)(H,S.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,F.Z)(H,S.CoordinateUniform.Mvp,d),(0,F.Z)(H,"u_SceneCenterMKT",_),(0,F.Z)(H,"u_ViewportSize",[P,k]),(0,F.Z)(H,"u_DevicePixelRatio",window.devicePixelRatio),(0,F.Z)(H,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,F.Z)(H,"u_PickingBuffer",a.getLayerConfig().pickingBuffer||0),H))})})}}]),n}(),gm),pm=(0,kn.Z)(Sp.prototype,"cameraService",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dm=(0,kn.Z)(Sp.prototype,"coordinateSystemService",[lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm=(0,kn.Z)(Sp.prototype,"rendererService",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mm=(0,kn.Z)(Sp.prototype,"mapService",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sp))||hm),ym,_m,e0=(ym=(0,Tt.b2)(),ym(_m=function(){function n(){(0,ce.Z)(this,n)}return(0,q.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("UpdateModelPlugin",function(){a.layerModel&&a.layerModel.needUpdate()})}}]),n}())||_m),xm,bm,Sm,Qd,Em,wm,t0=(xm=(0,Tt.b2)(),bm=(0,Tt.f3)(S.vK.ILogService),xm(Sm=(Qd=(wm=function(){function n(){(0,ce.Z)(this,n),(0,Fn.Z)(this,"logger",Em,this)}return(0,q.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(a,{styleAttributeService:d})}),a.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){a.layerModelNeedUpdate||l.updateStyleAtrribute(a,{styleAttributeService:d})})}},{key:"updateStyleAtrribute",value:function(a,s){var l=this,d=s.styleAttributeService,_=d.getLayerStyleAttributes()||[],T=d.getLayerStyleAttribute("filter"),P=d.getLayerStyleAttribute("shape");if(T&&T.needRegenerateVertices||P&&P.needRegenerateVertices){a.layerModelNeedUpdate=!0,_.forEach(function(k){return k.needRegenerateVertices=!1});return}_.filter(function(k){return k.needRegenerateVertices}).forEach(function(k){d.updateAttributeByFeatureRange(k.name,a.getEncodedData(),k.featureRange.startIndex,k.featureRange.endIndex),k.needRegenerateVertices=!1,l.logger.debug("regenerate vertex attributes: ".concat(k.name," finished"))})}},{key:"initStyleAttribute",value:function(a,s){var l=this,d=s.styleAttributeService,_=d.getLayerStyleAttributes()||[];_.filter(function(T){return T.needRegenerateVertices}).forEach(function(T){d.updateAttributeByFeatureRange(T.name,a.getEncodedData(),T.featureRange.startIndex,T.featureRange.endIndex),T.needRegenerateVertices=!1,l.logger.debug("init vertex attributes: ".concat(T.name," finished"))})}}]),n}(),wm),Em=(0,kn.Z)(Qd.prototype,"logger",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qd))||Sm);S.nC.bind(S.vK.ILayerPlugin).to(Ih).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(Qy).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(jy).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(rp).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(Hy).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(t0).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(e0).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(io).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(qy).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(Vy).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to($y).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(Jy).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(Gy).inRequestScope();var h_="2.4.2";function Tm(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function p_(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?Tm(Object(a),!0).forEach(function(s){r0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Tm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function r0(n,u,a){return u in n?Object.defineProperty(n,u,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[u]=a,n}function d_(n,u){return o0(n)||a0(n,u)||i0(n,u)||n0()}function n0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i0(n,u){if(!!n){if(typeof n=="string")return Am(n,u);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Am(n,u)}}function Am(n,u){(u==null||u>n.length)&&(u=n.length);for(var a=0,s=new Array(u);a<u;a++)s[a]=n[a];return s}function a0(n,u){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(u&&s.length===u));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function o0(n){if(Array.isArray(n))return n}var v_=null,m_=null,Cm,Pm,Pd,Mm,Im,Om;function Lm(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Rm(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?Lm(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Lm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var s0=(Cm=(0,S.yT)(S.vK.ILogService),Pm=(0,S.yT)(S.vK.IGlobalConfigService),Pd=(Om=function(){function n(u){(0,ce.Z)(this,n),(0,Fn.Z)(this,"logger",Mm,this),(0,Fn.Z)(this,"configService",Im,this),this.config=void 0,this.config=u}return(0,q.Z)(n,[{key:"setContainer",value:function(a,s){a.bind(S.vK.MapConfig).toConstantValue(Rm(Rm({},this.config),{},{id:s})),a.bind(S.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),n}(),Om),Mm=(0,kn.Z)(Pd.prototype,"logger",[Cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Im=(0,kn.Z)(Pd.prototype,"configService",[Pm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pd),u0=y(2614),l0=y.n(u0),qd;(function(n){n["GAODE1.x"]="GAODE1.x",n["GAODE2.x"]="GAODE2.x",n.MAPBOX="MAPBOX",n.L7MAP="L7MAP"})(qd||(qd={}));function id(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Md(n,u){var a=Jc.fF([],u,n);return Jc.bA(a,a,1/a[3]),a}function g_(n,u){var a=n%u;return a<0?u+a:a}function y_(n,u,a){return a*u+(1-a)*n}function Kh(n,u){if(!n)throw new Error(u||"viewport-mercator-project: assertion failed.")}var bf=Math.PI,Dm=bf/4,Yf=bf/180,km=180/bf,ev=512,tv=4003e4,c0=1.5;function Fm(n){return Math.pow(2,n)}function f0(n){return Math.log2(n)}function Id(n,u){var a=(0,te.Z)(n,2),s=a[0],l=a[1];Kh(Number.isFinite(s)&&Number.isFinite(u)),Kh(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),u*=ev;var d=s*Yf,_=l*Yf,T=u*(d+bf)/(2*bf),P=u*(bf-Math.log(Math.tan(Dm+_*.5)))/(2*bf);return[T,P]}function rv(n,u){var a=(0,te.Z)(n,2),s=a[0],l=a[1];u*=ev;var d=s/u*(2*bf)-bf,_=2*(Math.atan(Math.exp(bf-l/u*(2*bf)))-Dm);return[d*km,_*km]}function __(n){var u=n.latitude;assert(Number.isFinite(u));var a=Math.cos(u*Yf);return f0(tv*a)-9}function Nm(n){var u=n.latitude,a=n.longitude,s=n.zoom,l=n.scale,d=n.highPrecision,_=d===void 0?!1:d;l=l!==void 0?l:Fm(s),Kh(Number.isFinite(u)&&Number.isFinite(a)&&Number.isFinite(l));var T={},P=ev*l,k=Math.cos(u*Yf),K=P/360,H=K/k,de=P/tv/k;if(T.pixelsPerMeter=[de,-de,de],T.metersPerPixel=[1/de,-1/de,1/de],T.pixelsPerDegree=[K,-H,de],T.degreesPerPixel=[1/K,-1/H,1/de],_){var Ge=Yf*Math.tan(u*Yf)/k,ft=K*Ge/2,Ut=P/tv*Ge,gr=Ut/H*de;T.pixelsPerDegree2=[0,-ft,Ut],T.pixelsPerMeter2=[gr,0,gr]}return T}function x_(n,u){var a=_slicedToArray(n,3),s=a[0],l=a[1],d=a[2],_=_slicedToArray(u,3),T=_[0],P=_[1],k=_[2],K=1,H=Nm({longitude:s,latitude:l,scale:K,highPrecision:!0}),de=H.pixelsPerMeter,Ge=H.pixelsPerMeter2,ft=Id(n,K);ft[0]+=T*(de[0]+Ge[0]*P),ft[1]+=P*(de[1]+Ge[1]*P);var Ut=rv(ft,K),gr=(d||0)+(k||0);return Number.isFinite(d)||Number.isFinite(k)?[Ut[0],Ut[1],gr]:Ut}function h0(n){var u=n.height,a=n.pitch,s=n.bearing,l=n.altitude,d=n.center,_=d===void 0?null:d,T=n.flipY,P=T===void 0?!1:T,k=id();return ma.translate(k,k,[0,0,-l]),ma.scale(k,k,[1,1,1/u]),ma.rotateX(k,k,-a*Yf),ma.rotateZ(k,k,s*Yf),P&&ma.scale(k,k,[1,-1,1]),_&&ma.translate(k,k,Eu([],_)),k}function p0(n){var u=n.width,a=n.height,s=n.altitude,l=s===void 0?c0:s,d=n.pitch,_=d===void 0?0:d,T=n.nearZMultiplier,P=T===void 0?1:T,k=n.farZMultiplier,K=k===void 0?1:k,H=_*Yf,de=Math.atan(.5/l),Ge=Math.sin(de)*l/Math.sin(Math.PI/2-H-de),ft=Math.cos(Math.PI/2-H)*Ge+l;return{fov:2*Math.atan(a/2/l),aspect:u/a,focalDistance:l,near:P,far:ft*K}}function d0(n){var u=n.width,a=n.height,s=n.pitch,l=n.altitude,d=n.nearZMultiplier,_=n.farZMultiplier,T=p0({width:u,height:a,altitude:l,pitch:s,nearZMultiplier:d,farZMultiplier:_}),P=T.fov,k=T.aspect,K=T.near,H=T.far,de=ma.perspective([],P,k,K,H);return de}function v0(n,u){var a=(0,te.Z)(n,3),s=a[0],l=a[1],d=a[2],_=d===void 0?0:d;return Kh(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(_)),Md(u,[s,l,_,1])}function zm(n,u){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,te.Z)(n,3),l=s[0],d=s[1],_=s[2];if(Kh(Number.isFinite(l)&&Number.isFinite(d),"invalid pixel coordinate"),Number.isFinite(_)){var T=Md(u,[l,d,_,1]);return T}var P=Md(u,[l,d,0,1]),k=Md(u,[l,d,1,1]),K=P[2],H=k[2],de=K===H?0:((a||0)-K)/(H-K);return Ca([],P,k,de)}var Bm=id(),m0=function(){function n(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=u.width,s=u.height,l=u.viewMatrix,d=l===void 0?Bm:l,_=u.projectionMatrix,T=_===void 0?Bm:_;(0,ce.Z)(this,n),this.width=a||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=d,this.projectionMatrix=T;var P=id();ma.multiply(P,P,this.projectionMatrix),ma.multiply(P,P,this.viewMatrix),this.viewProjectionMatrix=P;var k=id();ma.scale(k,k,[this.width/2,-this.height/2,1]),ma.translate(k,k,[1,-1,0]),ma.multiply(k,k,this.viewProjectionMatrix);var K=ma.invert(id(),k);if(!K)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=k,this.pixelUnprojectionMatrix=K,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,q.Z)(n,[{key:"equals",value:function(a){return a instanceof n?a.width===this.width&&a.height===this.height&&ma.equals(a.projectionMatrix,this.projectionMatrix)&&ma.equals(a.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,_=this.projectPosition(a),T=v0(_,this.pixelProjectionMatrix),P=(0,te.Z)(T,2),k=P[0],K=P[1],H=d?K:this.height-K;return a.length===2?[k,H]:[k,H,T[2]]}},{key:"unproject",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,_=s.targetZ,T=(0,te.Z)(a,3),P=T[0],k=T[1],K=T[2],H=d?k:this.height-k,de=_&&_*this.pixelsPerMeter,Ge=zm([P,H,K],this.pixelUnprojectionMatrix,de),ft=this.unprojectPosition(Ge),Ut=(0,te.Z)(ft,3),gr=Ut[0],Ir=Ut[1],Hr=Ut[2];return Number.isFinite(K)?[gr,Ir,Hr]:Number.isFinite(_)?[gr,Ir,_]:[gr,Ir]}},{key:"projectPosition",value:function(a){var s=this.projectFlat(a),l=(0,te.Z)(s,2),d=l[0],_=l[1],T=(a[2]||0)*this.pixelsPerMeter;return[d,_,T]}},{key:"unprojectPosition",value:function(a){var s=this.unprojectFlat(a),l=(0,te.Z)(s,2),d=l[0],_=l[1],T=(a[2]||0)/this.pixelsPerMeter;return[d,_,T]}},{key:"projectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}},{key:"unprojectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}}]),n}();function g0(n){var u=n.width,a=n.height,s=n.bounds,l=n.minExtent,d=l===void 0?0:l,_=n.maxZoom,T=_===void 0?24:_,P=n.padding,k=P===void 0?0:P,K=n.offset,H=K===void 0?[0,0]:K,de=(0,te.Z)(s,2),Ge=(0,te.Z)(de[0],2),ft=Ge[0],Ut=Ge[1],gr=(0,te.Z)(de[1],2),Ir=gr[0],Hr=gr[1];if(Number.isFinite(k)){var pn=k;k={top:pn,bottom:pn,left:pn,right:pn}}else Kh(Number.isFinite(k.top)&&Number.isFinite(k.bottom)&&Number.isFinite(k.left)&&Number.isFinite(k.right));var wn=new Um({width:u,height:a,longitude:0,latitude:0,zoom:0}),Wn=wn.project([ft,Hr]),Ii=wn.project([Ir,Ut]),qn=[Math.max(Math.abs(Ii[0]-Wn[0]),d),Math.max(Math.abs(Ii[1]-Wn[1]),d)],Qi=[u-k.left-k.right-Math.abs(H[0])*2,a-k.top-k.bottom-Math.abs(H[1])*2];Kh(Qi[0]>0&&Qi[1]>0);var Oa=Qi[0]/qn[0],ka=Qi[1]/qn[1],hi=(k.right-k.left)/2/Oa,Ta=(k.bottom-k.top)/2/ka,ro=[(Ii[0]+Wn[0])/2+hi,(Ii[1]+Wn[1])/2+Ta],Ju=wn.unproject(ro),Ep=wn.zoom+Math.log2(Math.abs(Math.min(Oa,ka)));return{longitude:Ju[0],latitude:Ju[1],zoom:Math.min(Ep,T)}}var Um=function(n){(0,we.Z)(u,n);function u(){var a,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,d=s.height,_=s.latitude,T=_===void 0?0:_,P=s.longitude,k=P===void 0?0:P,K=s.zoom,H=K===void 0?0:K,de=s.pitch,Ge=de===void 0?0:de,ft=s.bearing,Ut=ft===void 0?0:ft,gr=s.altitude,Ir=gr===void 0?1.5:gr,Hr=s.nearZMultiplier,pn=s.farZMultiplier;(0,ce.Z)(this,u),l=l||1,d=d||1;var wn=Fm(H);Ir=Math.max(.75,Ir);var Wn=Id([k,T],wn);Wn[2]=0;var Ii=d0({width:l,height:d,pitch:Ge,bearing:Ut,altitude:Ir,nearZMultiplier:Hr||1/d,farZMultiplier:pn||1.01}),qn=h0({height:d,center:Wn,pitch:Ge,bearing:Ut,altitude:Ir,flipY:!0});return a=(0,Pe.Z)(this,(0,Be.Z)(u).call(this,{width:l,height:d,viewMatrix:qn,projectionMatrix:Ii})),a.latitude=T,a.longitude=k,a.zoom=H,a.pitch=Ge,a.bearing=Ut,a.altitude=Ir,a.scale=wn,a.center=Wn,a.pixelsPerMeter=Nm((0,Gt.Z)((0,Gt.Z)(a))).pixelsPerMeter[2],Object.freeze((0,Gt.Z)((0,Gt.Z)(a))),a}return(0,q.Z)(u,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Id(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return rv(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,d=s.pos,_=zm(d,this.pixelUnprojectionMatrix),T=Id(l,this.scale),P=Cn([],T,Fs([],_)),k=Cn([],this.center,P);return rv(k,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,d=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:d})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=this.width,_=this.height,T=g0(Object.assign({width:d,height:_,bounds:s},l)),P=T.longitude,k=T.latitude,K=T.zoom;return new u({width:d,height:_,longitude:P,latitude:k,zoom:K})}}]),u}(m0),y0=function(){function n(){(0,ce.Z)(this,n),this.viewport=void 0}return(0,q.Z)(n,[{key:"syncWithMapCamera",value:function(a){var s=a.center,l=a.zoom,d=a.pitch,_=a.bearing,T=a.viewportHeight,P=a.viewportWidth;this.viewport=new Um({width:P,height:T,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:d,bearing:_})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(a,s){return this.viewport.projectFlat(a,s)}}]),n}(),jm={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Zm,Vm,Gm,Hm,Wm,Xm,Km,Yh,Ym,$m,Jm,Qm,qm,eg;function tg(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function _0(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?tg(Object(a),!0).forEach(function(s){(0,F.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):tg(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}y(63414)(`/* @antv/l7-maps */
.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=l0();var rg={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},x0=0,b0=12,ng="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",S0=(Zm=(0,Tt.b2)(),Vm=(0,Tt.f3)(S.vK.MapConfig),Gm=(0,Tt.f3)(S.vK.IGlobalConfigService),Hm=(0,Tt.f3)(S.vK.ILogService),Wm=(0,Tt.f3)(S.vK.ICoordinateSystemService),Xm=(0,Tt.f3)(S.vK.IEventEmitter),Zm(Km=(Yh=(eg=function(){function n(){var u=this;(0,ce.Z)(this,n),this.version=qd.MAPBOX,this.map=void 0,(0,Fn.Z)(this,"config",Ym,this),(0,Fn.Z)(this,"configService",$m,this),(0,Fn.Z)(this,"logger",Jm,this),(0,Fn.Z)(this,"coordinateSystemService",Qm,this),(0,Fn.Z)(this,"eventEmitter",qm,this),this.viewport=void 0,this.markerContainer=void 0,this.cameraChangedCallback=void 0,this.$mapContainer=void 0,this.handleCameraChanged=function(){var a=u.map.getCenter().wrap(),s=a.lat,l=a.lng;u.viewport.syncWithMapCamera({bearing:u.map.getBearing(),center:[l,s],viewportHeight:u.map.transform.height,pitch:u.map.getPitch(),viewportWidth:u.map.transform.width,zoom:u.map.getZoom(),cameraHeight:0});var d=u.config.offsetZoom,_=d===void 0?b0:d;u.viewport.getZoom()>_?u.coordinateSystemService.setCoordinateSystem(S.CoordinateSystem.LNGLAT_OFFSET):u.coordinateSystemService.setCoordinateSystem(S.CoordinateSystem.LNGLAT),u.cameraChangedCallback(u.viewport)}}return(0,q.Z)(n,[{key:"addMarkerContainer",value:function(){var a=this.map.getCanvasContainer();this.markerContainer=Oe.SO.create("div","l7-marker-container",a),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(a,s){S.MapServiceEvent.indexOf(a)!==-1?this.eventEmitter.on(a,s):this.map.on(rg[a]||a,s)}},{key:"off",value:function(a,s){this.map.off(rg[a]||a,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var a=this.map.transform;return[a.width,a.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(a){return this.map.setZoom(a)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(a){this.map.setCenter(a)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(a){this.map.setBearing(a)}},{key:"zoomIn",value:function(a,s){this.map.zoomIn(a,s)}},{key:"zoomOut",value:function(a,s){this.map.zoomOut(a,s)}},{key:"setPitch",value:function(a){return this.map.setPitch(a)}},{key:"panTo",value:function(a){this.map.panTo(a)}},{key:"panBy",value:function(a){this.panTo(a)}},{key:"fitBounds",value:function(a,s){this.map.fitBounds(a,s)}},{key:"setMaxZoom",value:function(a){this.map.setMaxZoom(a)}},{key:"setMinZoom",value:function(a){this.map.setMinZoom(a)}},{key:"setMapStatus",value:function(a){a.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),a.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),a.dragEnable===!1&&this.map.dragPan.disable(),a.dragEnable===!0&&this.map.dragPan.enable(),a.rotateEnable===!1&&this.map.dragRotate.disable(),a.rotateEnable===!0&&this.map.dragRotate.enable(),a.keyboardEnable===!1&&this.map.keyboard.disable(),a.keyboardEnable===!0&&this.map.keyboard.enable(),a.zoomEnable===!1&&this.map.scrollZoom.disable(),a.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(a,s){this.map.flyTo({zoom:a,center:s})}},{key:"setMapStyle",value:function(a){this.map.setStyle(this.getMapStyle(a))}},{key:"pixelToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToPixel",value:function(a){return this.map.project(a)}},{key:"containerToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToContainer",value:function(a){return this.map.project(a)}},{key:"lngLatToMercator",value:function(a,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),d=l.x,_=d===void 0?0:d,T=l.y,P=T===void 0?0:T,k=l.z,K=k===void 0?0:k;return{x:_,y:P,z:K}}},{key:"getModelMatrix",value:function(a,s,l){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},T=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),P=T.meterInMercatorCoordinateUnits(),k=ma.create();return ma.translate(k,k,dl(T.x-_.x,T.y-_.y,T.z||0-_.z)),ma.scale(k,k,dl(P*d[0],-P*d[1],P*d[2])),ma.rotateX(k,k,l[0]),ma.rotateY(k,k,l[1]),ma.rotateZ(k,k,l[2]),k}},{key:"init",value:function(){var u=(0,st.Z)(X().mark(function s(){var l,d,_,T,P,k,K,H,de,Ge,ft,Ut,gr;return X().wrap(function(Hr){for(;;)switch(Hr.prev=Hr.next){case 0:l=this.config,d=l.id,_=d===void 0?"map":d,T=l.attributionControl,P=T===void 0?!1:T,k=l.style,K=k===void 0?"light":k,H=l.token,de=H===void 0?ng:H,Ge=l.rotation,ft=Ge===void 0?0:Ge,Ut=l.mapInstance,gr=(0,mi.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new y0,!Ut&&!window.mapboxgl&&this.logger.error(this.configService.getSceneWarninfo("SDK")),de===ng&&K!=="blank"&&!window.mapboxgl.accessToken&&!Ut&&this.logger.warn(this.configService.getSceneWarninfo("MapToken")),!Ut&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=de),Ut?(this.map=Ut,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(_),this.map=new window.mapboxgl.Map(_0({container:this.$mapContainer,style:this.getMapStyle(K),attributionControl:P,bearing:ft},gr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Hr.stop()}},s,this)}));function a(){return u.apply(this,arguments)}return a}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(a){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),_=1;_<l;_++)d[_-1]=arguments[_];(s=this.eventEmitter).emit.apply(s,[a].concat(d))}},{key:"once",value:function(a){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),_=1;_<l;_++)d[_-1]=arguments[_];(s=this.eventEmitter).once.apply(s,[a].concat(d))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(a){var s=this.map.getCanvas(),l=a==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(a){this.cameraChangedCallback=a}},{key:"creatAmapContainer",value:function(a){var s=a;typeof a=="string"&&(s=document.getElementById(a));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+x0++,s.appendChild(l),l}},{key:"getMapStyle",value:function(a){return typeof a!="string"?a:jm[a]?jm[a]:a}}]),n}(),eg),Ym=(0,kn.Z)(Yh.prototype,"config",[Vm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$m=(0,kn.Z)(Yh.prototype,"configService",[Gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jm=(0,kn.Z)(Yh.prototype,"logger",[Hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qm=(0,kn.Z)(Yh.prototype,"coordinateSystemService",[Wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qm=(0,kn.Z)(Yh.prototype,"eventEmitter",[Xm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yh))||Km);function E0(n){var u=w0();return function(){var s=(0,Be.Z)(n),l;if(u){var d=(0,Be.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Pe.Z)(this,l)}}function w0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}y(63414)(`/* @antv/l7-maps */
.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var T0=function(n){(0,we.Z)(a,n);var u=E0(a);function a(){return(0,ce.Z)(this,a),u.apply(this,arguments)}return(0,q.Z)(a,[{key:"getServiceConstructor",value:function(){return S0}}]),a}(s0);function ig(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ag(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?ig(Object(a),!0).forEach(function(s){A0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ig(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function A0(n,u,a){return u in n?Object.defineProperty(n,u,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[u]=a,n}function C0(n,u){return O0(n)||I0(n,u)||M0(n,u)||P0()}function P0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function M0(n,u){if(!!n){if(typeof n=="string")return og(n,u);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return og(n,u)}}function og(n,u){(u==null||u>n.length)&&(u=n.length);for(var a=0,s=new Array(u);a<u;a++)s[a]=n[a];return s}function I0(n,u){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(u&&s.length===u));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function O0(n){if(Array.isArray(n))return n}var L0=b.memo(function(n){var u=n.style,a=n.className,s=n.map,l=n.option,d=n.onSceneLoaded,_=(0,b.createRef)(),T=(0,b.useState)(),P=C0(T,2),k=P[0],K=P[1];return(0,b.useEffect)(function(){var H=new Wi(ag(ag({id:_.current},l),{},{map:new T0(s)}));return H.on("loaded",function(){K(H),d&&d(H)}),function(){H.destroy()}},[]),(0,b.useEffect)(function(){k&&s.style&&k.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,b.useEffect)(function(){k&&s.zoom&&k.setZoom(s.zoom)},[s.zoom]),(0,b.useEffect)(function(){k&&s.center&&k.setCenter(s.center)},[JSON.stringify(s.center)]),(0,b.useEffect)(function(){k&&s.pitch!==void 0&&k.setPitch(s.pitch||0)},[s.pitch]),(0,b.useEffect)(function(){k&&s.rotation&&k.setRotation(s.rotation)},[s.rotation]),b.createElement(p.Provider,{value:k},(0,b.createElement)("div",{ref:_,style:u,className:a},k&&n.children))}),R0=L0;function sg(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function b_(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?sg(Object(a),!0).forEach(function(s){D0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):sg(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function D0(n,u,a){return u in n?Object.defineProperty(n,u,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[u]=a,n}function S_(n,u){return z0(n)||N0(n,u)||F0(n,u)||k0()}function k0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F0(n,u){if(!!n){if(typeof n=="string")return ug(n,u);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ug(n,u)}}function ug(n,u){(u==null||u>n.length)&&(u=n.length);for(var a=0,s=new Array(u);a<u;a++)s[a]=n[a];return s}function N0(n,u){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(u&&s.length===u));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function z0(n){if(Array.isArray(n))return n}var E_=null,w_=null;function T_(n,u){return Z0(n)||j0(n,u)||U0(n,u)||B0()}function B0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function U0(n,u){if(!!n){if(typeof n=="string")return lg(n,u);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return lg(n,u)}}function lg(n,u){(u==null||u>n.length)&&(u=n.length);for(var a=0,s=new Array(u);a<u;a++)s[a]=n[a];return s}function j0(n,u){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(u&&s.length===u));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function Z0(n){if(Array.isArray(n))return n}var A_=null,C_=null;function cg(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function P_(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?cg(Object(a),!0).forEach(function(s){V0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):cg(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function V0(n,u,a){return u in n?Object.defineProperty(n,u,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[u]=a,n}function M_(n,u){if(n==null)return{};var a=G0(n,u),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(l=0;l<d.length;l++)s=d[l],!(u.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function G0(n,u){if(n==null)return{};var a={},s=Object.keys(n),l,d;for(d=0;d<s.length;d++)l=s[d],!(u.indexOf(l)>=0)&&(a[l]=n[l]);return a}var I_=null,fg=y(73935);function H0(n,u){return Y0(n)||K0(n,u)||X0(n,u)||W0()}function W0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X0(n,u){if(!!n){if(typeof n=="string")return hg(n,u);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return hg(n,u)}}function hg(n,u){(u==null||u>n.length)&&(u=n.length);for(var a=0,s=new Array(u);a<u;a++)s[a]=n[a];return s}function K0(n,u){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(u&&s.length===u));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function Y0(n){if(Array.isArray(n))return n}var $0=b.useEffect,J0=b.useState;function O_(n){var u=n.className,a=n.style,s=n.children,l=n.position,d=useSceneValue(),_=J0(function(){return document.createElement("div")}),T=H0(_,1),P=T[0];return $0(function(){var k=new Control({position:l});return k.onAdd=function(){if(u&&(P.className=u),a){var K=Object.keys(a).map(function(H){return"".concat(H,":").concat(a[H])}).join(";");P.style.cssText=K}return P},k.onRemove=function(){},d.addControl(k),function(){d.removeControl(k)}},[]),createPortal(s,P)}var pg=(0,b.createContext)({});function L_(){return useContext(pg)}var Q0=b.useEffect,q0=b.memo(function(u){var a=u.layer,s=u.active;return Q0(function(){a.active(s.option)},[JSON.stringify(s)]),null}),e1=b.useEffect,t1=b.memo(function(u){var a=u.layer,s=u.animate;return e1(function(){a.animate(s)},[JSON.stringify(s)]),null}),r1=b.useEffect,n1=b.memo(function(u){var a=u.layer,s=u.color;return r1(function(){s.field?a.color(s.field,s.values):a.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),i1=b.useEffect,a1=b.memo(function(u){var a=u.layer,s=u.filter;return i1(function(){s.field&&a.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),o1=b.useEffect,s1=b.memo(function(u){var a=u.layer,s=u.scale;return o1(function(){a.scale(s.values)},[s.values]),null}),u1=b.useEffect,l1=b.memo(function(u){var a=u.layer,s=u.select;return u1(function(){a.select(s.option)},[JSON.stringify(s)]),null}),c1=b.useEffect,f1=b.memo(function(u){var a=u.layer,s=u.shape;return c1(function(){s.field?a.shape(s.field,s.values):a.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),h1=b.useEffect,p1=b.memo(function(u){var a=u.layer,s=u.size;return h1(function(){s.field?a.size(s.field,s.values):a.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),d1=["data"];function v1(n,u){if(n==null)return{};var a=m1(n,u),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(l=0;l<d.length;l++)s=d[l],!(u.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function m1(n,u){if(n==null)return{};var a={},s=Object.keys(n),l,d;for(d=0;d<s.length;d++)l=s[d],!(u.indexOf(l)>=0)&&(a[l]=n[l]);return a}var g1=b.useEffect,y1=b.memo(function(u){var a=u.layer,s=u.source,l=s.data,d=v1(s,d1);return g1(function(){a.inited?a.setData(l,d):a.source(l,d),d.autoFit&&a.fitBounds(d&&d.fitBoundsOptions)},[l,JSON.stringify(d)]),null}),_1=b.useEffect,x1=b.memo(function(u){var a=u.layer,s=u.style;return _1(function(){a.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function b1(n,u){return T1(n)||w1(n,u)||E1(n,u)||S1()}function S1(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E1(n,u){if(!!n){if(typeof n=="string")return dg(n,u);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dg(n,u)}}function dg(n,u){(u==null||u>n.length)&&(u=n.length);for(var a=0,s=new Array(u);a<u;a++)s[a]=n[a];return s}function w1(n,u){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(u&&s.length===u));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function T1(n){if(Array.isArray(n))return n}var ad=b.useEffect,A1=b.useState;function vg(n,u){var a=u.source,s=u.color,l=u.shape,d=u.style,_=u.size,T=u.scale,P=u.active,k=u.select,K=u.filter,H=u.animate,de=u.options,Ge=u.onLayerLoaded,ft=G(),Ut=A1(function(){var Hr;switch(n){case"polygonLayer":Hr=new Yo(de);break;case"lineLayer":Hr=new Hl(de);break;case"pointLayer":Hr=new rt(de);break;case"heatmapLayer":Hr=new $e(de);break;case"rasterLayer":Hr=new Kl(de);break;case"imageLayer":Hr=new vn(de);break;case"citybuildingLayer":Hr=new Iu(de);break;default:Hr=new Yo(de)}return Hr.on("inited",function(){Ge&&Ge(Hr,ft)}),Hr}),gr=b1(Ut,1),Ir=gr[0];return ad(function(){return ft.addLayer(Ir),function(){ft.removeLayer(Ir)}},[]),ad(function(){Ir.inited&&de&&Ir.updateLayerConfig(de)},[de==null?void 0:de.minZoom,de==null?void 0:de.maxZoom,de==null?void 0:de.visible]),ad(function(){Ir.inited&&(de==null?void 0:de.zIndex)&&Ir.setIndex(de.zIndex)},[de==null?void 0:de.zIndex]),ad(function(){Ir.inited&&(de==null?void 0:de.blend)&&Ir.setBlend(de.blend)},[de==null?void 0:de.blend]),ad(function(){ft.render()}),b.createElement(pg.Provider,{value:Ir},b.createElement(y1,{layer:Ir,source:a}),T&&b.createElement(s1,{layer:Ir,scale:T}),s&&b.createElement(n1,{layer:Ir,color:s}),_&&b.createElement(p1,{layer:Ir,size:_}),l&&b.createElement(f1,{layer:Ir,shape:l}),d&&b.createElement(x1,{layer:Ir,style:d}),P&&b.createElement(q0,{layer:Ir,active:P}),k&&b.createElement(l1,{layer:Ir,select:k}),K&&b.createElement(a1,{layer:Ir,filter:K}),H&&b.createElement(t1,{layer:Ir,animate:H}),u.children)}var R_=null,D_=null,C1=b.memo(function(u){return vg("pointLayer",u)}),P1=b.memo(function(u){return vg("heatmapLayer",u)}),k_=null,F_=null,N_=null,z_=b.useEffect,B_=null,U_=null;function Od(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Od=function(a){return typeof a}:Od=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Od(n)}function mg(n,u){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);u&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ld(n){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?mg(Object(a),!0).forEach(function(s){M1(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):mg(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function M1(n,u,a){return u in n?Object.defineProperty(n,u,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[u]=a,n}function I1(n,u){if(!(n instanceof u))throw new TypeError("Cannot call a class as a function")}function gg(n,u){for(var a=0;a<u.length;a++){var s=u[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function O1(n,u,a){return u&&gg(n.prototype,u),a&&gg(n,a),n}function L1(n,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(u&&u.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),u&&nv(n,u)}function nv(n,u){return nv=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},nv(n,u)}function R1(n){var u=F1();return function(){var s=Rd(n),l;if(u){var d=Rd(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return D1(this,l)}}function D1(n,u){return u&&(Od(u)==="object"||typeof u=="function")?u:k1(n)}function k1(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function F1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Rd(n){return Rd=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},Rd(n)}var j_=function(n){L1(a,n);var u=R1(a);function a(s){var l;return I1(this,a),l=u.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return O1(a,[{key:"componentDidMount",value:function(){var l,d=this.props,_=d.lnglat,T=d.children,P=d.option,k=d.lngLat,K=new Je(Ld(Ld({},P),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));_&&K.setLnglat(_),k&&K.setLnglat(k),T&&K.setDOMContent(this.el),this.popup=K,this.scene.addPopup(K)}},{key:"componentDidUpdate",value:function(l){var d,_,T,P,k,K,H=Array.isArray(l.lnglat)?l.lnglat:[l==null||(d=l.lnglat)===null||d===void 0?void 0:d.lng,l==null||(_=l.lnglat)===null||_===void 0?void 0:_.lat],de=Array.isArray(this.props.lnglat)?this.props.lnglat:[(T=this.props)===null||T===void 0||(P=T.lnglat)===null||P===void 0?void 0:P.lng,(k=this.props)===null||k===void 0||(K=k.lnglat)===null||K===void 0?void 0:K.lat],Ge=H.toString()!==de.toString();if(Ge){var ft;this.popup.remove(),this.popup=new Je(Ld(Ld({},this.props.option),{},{stopPropagation:(ft=this.props.option)===null||ft===void 0?void 0:ft.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return b.createElement(p.Consumer,{},function(d){return d&&(l.scene=d),(0,fg.createPortal)(l.props.children,l.el)})}}]),a}(b.PureComponent);function Dd(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Dd=function(a){return typeof a}:Dd=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Dd(n)}function N1(n,u){if(!(n instanceof u))throw new TypeError("Cannot call a class as a function")}function yg(n,u){for(var a=0;a<u.length;a++){var s=u[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function z1(n,u,a){return u&&yg(n.prototype,u),a&&yg(n,a),n}function B1(n,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(u&&u.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),u&&iv(n,u)}function iv(n,u){return iv=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},iv(n,u)}function U1(n){var u=V1();return function(){var s=kd(n),l;if(u){var d=kd(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return j1(this,l)}}function j1(n,u){return u&&(Dd(u)==="object"||typeof u=="function")?u:Z1(n)}function Z1(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function V1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function kd(n){return kd=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},kd(n)}var Z_=function(n){B1(a,n);var u=U1(a);function a(s){var l;return N1(this,a),l=u.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return z1(a,[{key:"componentDidMount",value:function(){var l=this.props,d=l.lnglat,_=l.children,T=l.option,P=l.onMarkerLoaded,k=new Or(T);d&&k.setLnglat(d),_&&k.setElement(this.el),this.marker=k,P&&P(k),this.scene.addMarker(k)}},{key:"componentDidUpdate",value:function(l){var d,_=(l==null?void 0:l.lnglat.toString())!==((d=this.props)===null||d===void 0?void 0:d.lnglat.toString());_&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return b.createElement(p.Consumer,{},function(d){return d&&(l.scene=d),(0,fg.createPortal)(l.props.children,l.el)})}}]),a}(b.PureComponent),V_=b.useEffect,G_=null,H_=null,W_=b.useEffect,X_=null},15054:function(){},76404:function(_t,O,y){var V=y(10177);_t.exports=b;function b(ce,q){switch(ce&&ce.type||null){case"FeatureCollection":return ce.features=ce.features.map(p(b,q)),ce;case"GeometryCollection":return ce.geometries=ce.geometries.map(p(b,q)),ce;case"Feature":return ce.geometry=b(ce.geometry,q),ce;case"Polygon":case"MultiPolygon":return G(ce,q);default:return ce}}function p(ce,q){return function(we){return ce(we,q)}}function G(ce,q){return ce.type==="Polygon"?ce.coordinates=S(ce.coordinates,q):ce.type==="MultiPolygon"&&(ce.coordinates=ce.coordinates.map(p(S,q))),ce}function S(ce,q){q=!!q,ce[0]=F(ce[0],q);for(var we=1;we<ce.length;we++)ce[we]=F(ce[we],!q);return ce}function F(ce,q){return te(ce)===q?ce:ce.reverse()}function te(ce){return V.ring(ce)>=0}},33692:function(_t,O,y){"use strict";y.d(O,{SO:function(){return V},z6:function(){return Rr},a5:function(){return b},Z:function(){return Lt},rQ:function(){return ar},bV:function(){return Dt},zi:function(){return sr},ds:function(){return Ar},Ev:function(){return et},oO:function(){return _r},W0:function(){return fr},Z6:function(){return $r},We:function(){return ot},Cl:function(){return mt},gJ:function(){return se},vP:function(){return N},yM:function(){return Tt},yA:function(){return hr},CI:function(){return dt}});var V={};y.r(V),y.d(V,{DPR:function(){return Ze},addClass:function(){return Oe},create:function(){return Pe},empty:function(){return xt},getClass:function(){return Qe},getContainer:function(){return te},getViewPortScale:function(){return St},hasClass:function(){return Xt},printCanvas:function(){return Gt},remove:function(){return Be},removeClass:function(){return Nt},setClass:function(){return Bt},setTransform:function(){return cr},splitWords:function(){return q},triggerResize:function(){return At},trim:function(){return ce}});var b={};y.r(b),y.d(b,{getColumn:function(){return oi},getSatByColumn:function(){return $},max:function(){return yn},mean:function(){return vi},min:function(){return _n},mode:function(){return Di},statMap:function(){return Zi},sum:function(){return ai}});function p(I){var j=131,Y=137,ue=0;I+="x";for(var De=Math.floor(9007199254740991/Y),He=0;He<I.length;He++)ue>De&&(ue=Math.floor(ue/Y)),ue=ue*j+I.charCodeAt(He);return ue}function G(I){I=I.toString();for(var j=5381,Y=I.length;Y;)j=j*33^I.charCodeAt(--Y);return j>>>0}var S=y(19877),F=window.document.documentElement.style;function te(I){var j=I;return typeof I=="string"&&(j=document.getElementById(I)),j}function ce(I){return I.trim?I.trim():I.replace(/^\s+|\s+$/g,"")}function q(I){return ce(I).split(/\s+/)}function we(I){if(!F)return I[0];for(var j in I)if(I[j]&&I[j]in F)return I[j];return I[0]}function Pe(I,j,Y){var ue=document.createElement(I);return ue.className=j||"",Y&&Y.appendChild(ue),ue}function Be(I){var j=I.parentNode;j&&j.removeChild(I)}function Oe(I,j){if(I.classList!==void 0)for(var Y=q(j),ue=0,De=Y.length;ue<De;ue++)I.classList.add(Y[ue]);else if(!Xt(I,j)){var He=Qe(I);Bt(I,(He?He+" ":"")+j)}}function Nt(I,j){I.classList!==void 0?I.classList.remove(j):Bt(I,ce((" "+Qe(I)+" ").replace(" "+j+" "," ")))}function Xt(I,j){if(I.classList!==void 0)return I.classList.contains(j);var Y=Qe(I);return Y.length>0&&new RegExp("(^|\\s)"+j+"(\\s|$)").test(Y)}function Bt(I,j){I instanceof HTMLElement?I.className=j:I.className.baseVal=j}function Qe(I){return I instanceof SVGElement&&(I=I.correspondingElement),I.className.baseVal===void 0?I.className:I.className.baseVal}function xt(I){for(;I&&I.firstChild;)I.removeChild(I.firstChild)}var nt=we(["transform","WebkitTransform"]);function cr(I,j){I.style[nt]=j}function At(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var I=window.document.createEvent("UIEvents");I.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(I)}}function Gt(I){var j=["padding: "+(I.height/2-8)+"px "+I.width/2+"px;","line-height: "+I.height+"px;","background-image: url("+I.toDataURL()+");"];console.log(`%c
`,j.join(""))}function St(){var I,j=document.querySelector('meta[name="viewport"]');if(!j)return 1;var Y=(I=j.content)===null||I===void 0?void 0:I.split(","),ue=Y.find(function(De){var He=De.split("="),he=(0,S.Z)(He,2),Ne=he[0],Ct=he[1];return Ne==="initial-scale"});return ue?ue.split("=")[1]*1:1}var Ze=St()<1?1:window.devicePixelRatio,yt=y(96285),Me=y(76553),Te=y(75304),Ie=y(77071),bt=y(34521),tr=y(41252);function ae(I){return Function.toString.call(I).indexOf("[native code]")!==-1}var Ee=y(83923);function le(I,j,Y){return(0,Ee.Z)()?le=Reflect.construct:le=function(De,He,he){var Ne=[null];Ne.push.apply(Ne,He);var Ct=Function.bind.apply(De,Ne),kr=new Ct;return he&&(0,tr.Z)(kr,he.prototype),kr},le.apply(null,arguments)}function Q(I){var j=typeof Map=="function"?new Map:void 0;return Q=function(ue){if(ue===null||!ae(ue))return ue;if(typeof ue!="function")throw new TypeError("Super expression must either be null or a function");if(typeof j!="undefined"){if(j.has(ue))return j.get(ue);j.set(ue,De)}function De(){return le(ue,arguments,(0,bt.Z)(this).constructor)}return De.prototype=Object.create(ue.prototype,{constructor:{value:De,enumerable:!1,writable:!0,configurable:!0}}),(0,tr.Z)(De,ue)},Q(I)}function re(I){var j=ke();return function(){var ue=(0,bt.Z)(I),De;if(j){var He=(0,bt.Z)(this).constructor;De=Reflect.construct(ue,arguments,He)}else De=ue.apply(this,arguments);return(0,Ie.Z)(this,De)}}function ke(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}var qe=function(I){(0,Te.Z)(Y,I);var j=re(Y);function Y(ue,De,He){var he;return(0,yt.Z)(this,Y),he=j.call(this,ue),he.status=void 0,he.url=void 0,he.status=De,he.url=He,he.name=he.constructor.name,he.message=ue,he}return(0,Me.Z)(Y,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),Y}(Q(Error));function Wt(I){var j=new XMLHttpRequest;j.open("GET",I.url,!0);for(var Y in I.headers)I.headers.hasOwnProperty(Y)&&j.setRequestHeader(Y,I.headers[Y]);return j.withCredentials=I.credentials==="include",j}var Or=function(j,Y){var ue=Wt(j);return ue.setRequestHeader("Accept","application/json"),ue.onerror=function(){Y(new Error(ue.statusText))},ue.onload=function(){if(ue.status>=200&&ue.status<300&&ue.response){var De;try{De=JSON.parse(ue.response)}catch(He){return Y(He)}Y(null,De)}else ue.status===401?Y(new qe("".concat(ue.statusText),ue.status,j.url)):Y(new qe(ue.statusText,ue.status,j.url))},ue.send(),ue},wr=function(j,Y){var ue=Wt(j);return ue.responseType="arraybuffer",ue.onerror=function(){Y(new Error(ue.statusText))},ue.onload=function(){var De=ue.response;if(De.byteLength===0&&ue.status===200)return Y(new Error("http status 200 returned without content."));ue.status>=200&&ue.status<300&&ue.response?Y(null,{data:De,cacheControl:ue.getResponseHeader("Cache-Control"),expires:ue.getResponseHeader("Expires")}):Y(new qe(ue.statusText,ue.status,j.url))},ue.send(),ue};function Nr(I){var j=window.document.createElement("a");return j.href=I,j.protocol===window.document.location.protocol&&j.host===window.document.location.host}var Vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",se=function(j,Y){return wr(j,function(ue,De){if(ue)Y(ue);else if(De){var He=new window.Image;He.crossOrigin="anonymous";var he=window.URL||window.webkitURL;He.onload=function(){Y(null,He),he.revokeObjectURL(He.src)};var Ne=new window.Blob([new Uint8Array(De.data)],{type:"image/png"});He.src=De.data.byteLength?he.createObjectURL(Ne):Vt}})},_e=y(19175),Le=2*Math.PI*6378137/2;function ot(I){var j=[Infinity,Infinity,-Infinity,-Infinity];return I.forEach(function(Y){var ue=Y.coordinates;Rt(j,ue)}),j}function Rt(I,j){return Array.isArray(j[0])?j.forEach(function(Y){Rt(I,Y)}):(I[0]>j[0]&&(I[0]=j[0]),I[1]>j[1]&&(I[1]=j[1]),I[2]<j[0]&&(I[2]=j[0]),I[3]<j[1]&&(I[3]=j[1])),I}function jt(I,j){return w(I,j)}function w(I,j){return Array.isArray(I[0])?I.map(function(Y){return w(Y,j)}):j(I)}function N(I){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,Y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};I=st(I,j);var ue=I[0],De=I[1],He=ue*Le/180,he=Math.log(Math.tan((90+De)*Math.PI/360))/(Math.PI/180);return he=he*Le/180,Y.enable&&(He=Number(He.toFixed(Y.decimal)),he=Number(he.toFixed(Y.decimal))),I.length===3?[He,he,I[2]]:[He,he]}function ve(I){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,Y=I[0],ue=I[1],De=Y/Le*180,He=ue/Le*180;return He=180/Math.PI*(2*Math.atan(Math.exp(He*Math.PI/180))-Math.PI/2),j!=null&&(De=Number(De.toFixed(j)),He=Number(He.toFixed(j))),I.length===3?[De,He,I[2]]:[De,He]}function Ae(I){if(I==null)throw new Error("lng is required");return(I>180||I<-180)&&(I=I%360,I>180&&(I=-360+I),I<-180&&(I=360+I),I===0&&(I=0)),I}function Je(I){if(I==null)throw new Error("lat is required");return(I>90||I<-90)&&(I=I%180,I>90&&(I=-180+I),I<-90&&(I=180+I),I===0&&(I=0)),I}function st(I,j){if(j===!1)return I;var Y=Ae(I[0]),ue=Je(I[1]);return ue>85&&(ue=85),ue<-85&&(ue=-85),I.length===3?[Y,ue,I[2]]:[Y,ue]}function Lt(I){var j=85.0511287798,Y=Math.max(Math.min(j,I[1]),-j),ue=256<<20,De=Math.PI/180,He=I[0]*De,he=Y*De;he=Math.log(Math.tan(Math.PI/4+he/2));var Ne=.5/Math.PI,Ct=.5,kr=-.5/Math.PI;return De=.5,He=ue*(Ne*He+Ct),he=ue*(kr*he+De),[Math.floor(He),Math.floor(he)]}function X(I){var j=.5/Math.PI,Y=.5,ue=-.5/Math.PI,De=.5,He=256<<20,he=_slicedToArray(I,2),Ne=he[0],Ct=he[1];Ne=(Ne/He-Y)/j,Ct=(Ct/He-De)/ue,Ct=(Math.atan(Math.pow(Math.E,Ct))-Math.PI/4)*2,De=Math.PI/180;var kr=Ct/De,jr=Ne/De;return[jr,kr]}function Tt(I,j,Y){var ue=(0,_e.Ht)(j[1]-I[1]),De=(0,_e.Ht)(j[0]-I[0]),He=(0,_e.Ht)(I[1]),he=(0,_e.Ht)(j[1]),Ne=Math.pow(Math.sin(ue/2),2)+Math.pow(Math.sin(De/2),2)*Math.cos(He)*Math.cos(he);return(0,_e.DL)(2*Math.atan2(Math.sqrt(Ne),Math.sqrt(1-Ne)),Y="meters")}function Kt(I){var j=Math.PI/180,Y=85.0511287798,ue=6378137,De=Math.max(Math.min(Y,I[1]),-Y),He=Math.sin(De*j),he=ue*I[0]*j,Ne=ue*Math.log((1+He)/(1-He))/2;return[he,Ne]}function hr(I,j){var Y=Math.abs(I[1][1]-I[0][1])*j,ue=Math.abs(I[1][0]-I[0][0])*j;return[[I[0][0]-ue,I[0][1]-Y],[I[1][0]+ue,I[1][1]+Y]]}function _r(I,j){return I[0][0]<=j[0][0]&&I[0][1]<=j[0][1]&&I[1][0]>=j[1][0]&&I[1][1]>=j[1][1]}function Ar(I){return[[I[0],I[1]],[I[2],I[3]]]}var Rr=function(){function I(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,Y=arguments.length>1?arguments[1]:void 0;(0,yt.Z)(this,I),this.limit=void 0,this.cache=void 0,this.destroy=void 0,this.order=void 0,this.limit=j,this.destroy=Y||this.defaultDestroy,this.order=[],this.clear()}return(0,Me.Z)(I,[{key:"clear",value:function(){var Y=this;this.order.forEach(function(ue){Y.delete(ue)}),this.cache={},this.order=[]}},{key:"get",value:function(Y){var ue=this.cache[Y];return ue&&(this.deleteOrder(Y),this.appendOrder(Y)),ue}},{key:"set",value:function(Y,ue){this.cache[Y]?(this.delete(Y),this.cache[Y]=ue,this.appendOrder(Y)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[Y]=ue,this.appendOrder(Y))}},{key:"delete",value:function(Y){var ue=this.cache[Y];ue&&(this.deleteCache(Y),this.deleteOrder(Y),this.destroy(ue,Y))}},{key:"deleteCache",value:function(Y){delete this.cache[Y]}},{key:"deleteOrder",value:function(Y){var ue=this.order.findIndex(function(De){return De===Y});ue>=0&&this.order.splice(ue,1)}},{key:"appendOrder",value:function(Y){this.order.push(Y)}},{key:"defaultDestroy",value:function(Y,ue){return null}}]),I}();function et(I,j){I.forEach(function(Y){!j[Y]||(j[Y]=j[Y].bind(j))})}var gt=y(10614);function dt(I){var j=gt.ZP(I),Y=[0,0,0,0];return j!=null&&(Y[0]=j.r/255,Y[1]=j.g/255,Y[2]=j.b/255,Y[3]=j.opacity),Y}function fr(I){var j=I&&I[0],Y=I&&I[1],ue=I&&I[2],De=j+Y*256+ue*65536-1;return De}function $r(I){return[I+1&255,I+1>>8&255,I+1>>8>>8&255]}function mt(I){var j=document.createElement("canvas"),Y=j.getContext("2d");j.width=256,j.height=1;for(var ue=Y.createLinearGradient(0,0,256,1),De=null,He=I.positions[0],he=I.positions[I.positions.length-1],Ne=0;Ne<I.colors.length;++Ne){var Ct=(I.positions[Ne]-He)/(he-He);ue.addColorStop(Ct,I.colors[Ne])}return Y.fillStyle=ue,Y.fillRect(0,0,256,1),De=new Uint8ClampedArray(Y.getImageData(0,0,256,1).data),new ImageData(De,256,1)}var Dt;(function(I){I.CENTER="center",I.TOP="top",I["TOP-LEFT"]="top-left",I["TOP-RIGHT"]="top-right",I.BOTTOM="bottom",I["BOTTOM-LEFT"]="bottom-left",I.LEFT="left",I.RIGHT="right"})(Dt||(Dt={}));var ar={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function sr(I,j,Y){var ue=I.classList;for(var De in ar)ar.hasOwnProperty(De)&&ue.remove("l7-".concat(Y,"-anchor-").concat(De));ue.add("l7-".concat(Y,"-anchor-").concat(j))}function yn(I){if(I.length===0)throw new Error("max requires at least one data point");for(var j=I[0],Y=1;Y<I.length;Y++)I[Y]>j&&(j=I[Y]);return j*1}function _n(I){if(I.length===0)throw new Error("min requires at least one data point");for(var j=I[0],Y=1;Y<I.length;Y++)I[Y]<j&&(j=I[Y]);return j*1}function ai(I){if(I.length===0)return 0;for(var j=I[0]*1,Y=1;Y<I.length;Y++)j+=I[Y]*1;return j}function vi(I){if(I.length===0)throw new Error("mean requires at least one data point");return ai(I)/I.length}function Di(I){if(I.length===0)throw new Error("mean requires at least one data point");if(I.length<3)return I[0];I.sort();for(var j=I[0],Y=NaN,ue=0,De=1,He=1;He<I.length+1;He++)I[He]!==j?(De>ue&&(ue=De,Y=j),De=1,j=I[He]):De++;return Y*1}var Zi={min:_n,max:yn,mean:vi,sum:ai,mode:Di};function oi(I,j){return I.map(function(Y){return Y[j]})}function $(I,j){return Zi[I](j)}},25882:function(_t,O,y){"use strict";y.d(O,{Z:function(){return V}});function V(b,p,G,S,F){var te={};return Object.keys(S).forEach(function(ce){te[ce]=S[ce]}),te.enumerable=!!te.enumerable,te.configurable=!!te.configurable,("value"in te||te.initializer)&&(te.writable=!0),te=G.slice().reverse().reduce(function(ce,q){return q(b,p,ce)||ce},te),F&&te.initializer!==void 0&&(te.value=te.initializer?te.initializer.call(F):void 0,te.initializer=void 0),te.initializer===void 0&&(Object.defineProperty(b,p,te),te=null),te}},17912:function(_t,O,y){"use strict";y.d(O,{Z:function(){return V}});function V(b,p,G,S){!G||Object.defineProperty(b,p,{enumerable:G.enumerable,configurable:G.configurable,writable:G.writable,value:G.initializer?G.initializer.call(S):void 0})}},10177:function(_t,O,y){var V=y(78798);_t.exports.geometry=b,_t.exports.ring=G;function b(F){var te=0,ce;switch(F.type){case"Polygon":return p(F.coordinates);case"MultiPolygon":for(ce=0;ce<F.coordinates.length;ce++)te+=p(F.coordinates[ce]);return te;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ce=0;ce<F.geometries.length;ce++)te+=b(F.geometries[ce]);return te}}function p(F){var te=0;if(F&&F.length>0){te+=Math.abs(G(F[0]));for(var ce=1;ce<F.length;ce++)te-=Math.abs(G(F[ce]))}return te}function G(F){var te,ce,q,we,Pe,Be,Oe,Nt=0,Xt=F.length;if(Xt>2){for(Oe=0;Oe<Xt;Oe++)Oe===Xt-2?(we=Xt-2,Pe=Xt-1,Be=0):Oe===Xt-1?(we=Xt-1,Pe=0,Be=1):(we=Oe,Pe=Oe+1,Be=Oe+2),te=F[we],ce=F[Pe],q=F[Be],Nt+=(S(q[0])-S(te[0]))*Math.sin(S(ce[1]));Nt=Nt*V.RADIUS*V.RADIUS/2}return Nt}function S(F){return F*Math.PI/180}},23197:function(_t){"use strict";_t.exports=y,_t.exports.default=y;var O=1e20;function y(S,F,te,ce,q,we){this.fontSize=S||24,this.buffer=F===void 0?3:F,this.cutoff=ce||.25,this.fontFamily=q||"sans-serif",this.fontWeight=we||"normal",this.radius=te||8;var Pe=this.size=this.fontSize+this.buffer*2,Be=Pe+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Pe,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Be*Be),this.gridInner=new Float64Array(Be*Be),this.f=new Float64Array(Be),this.z=new Float64Array(Be+1),this.v=new Uint16Array(Be),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Pe/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function V(S,F,te,ce,q,we,Pe){we.fill(O,0,F*te),Pe.fill(0,0,F*te);for(var Be=(F-ce)/2,Oe=0;Oe<q;Oe++)for(var Nt=0;Nt<ce;Nt++){var Xt=(Oe+Be)*F+Nt+Be,Bt=S.data[4*(Oe*ce+Nt)+3]/255;if(Bt===1)we[Xt]=0,Pe[Xt]=O;else if(Bt===0)we[Xt]=O,Pe[Xt]=0;else{var Qe=Math.max(0,.5-Bt),xt=Math.max(0,Bt-.5);we[Xt]=Qe*Qe,Pe[Xt]=xt*xt}}}function b(S,F,te,ce,q,we,Pe){for(var Be=0;Be<F*te;Be++){var Oe=Math.sqrt(ce[Be])-Math.sqrt(q[Be]);S[Be]=Math.round(255-255*(Oe/we+Pe))}}y.prototype._draw=function(S,F){var te=this.ctx.measureText(S),ce=te.width,q=2*this.buffer,we,Pe,Be,Oe,Nt,Xt,Bt,Qe;F&&this.useMetrics?(Nt=Math.floor(te.actualBoundingBoxAscent),Qe=this.buffer+Math.ceil(te.actualBoundingBoxAscent),Xt=this.buffer,Bt=this.buffer,Pe=Math.min(this.size,Math.ceil(te.actualBoundingBoxRight-te.actualBoundingBoxLeft)),Oe=Math.min(this.size-Xt,Math.ceil(te.actualBoundingBoxAscent+te.actualBoundingBoxDescent)),we=Pe+q,Be=Oe+q,this.ctx.textBaseline="alphabetic"):(we=Pe=this.size,Be=Oe=this.size,Nt=19*this.fontSize/24,Xt=Bt=0,Qe=this.middle,this.ctx.textBaseline="middle");var xt;Pe&&Oe&&(this.ctx.clearRect(Bt,Xt,Pe,Oe),this.ctx.fillText(S,this.buffer,Qe),xt=this.ctx.getImageData(Bt,Xt,Pe,Oe));var nt=new Uint8ClampedArray(we*Be);return V(xt,we,Be,Pe,Oe,this.gridOuter,this.gridInner),p(this.gridOuter,we,Be,this.f,this.v,this.z),p(this.gridInner,we,Be,this.f,this.v,this.z),b(nt,we,Be,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:nt,metrics:{width:Pe,height:Oe,sdfWidth:we,sdfHeight:Be,top:Nt,left:0,advance:ce}}},y.prototype.draw=function(S){return this._draw(S,!1).data},y.prototype.drawWithMetrics=function(S){return this._draw(S,!0)};function p(S,F,te,ce,q,we){for(var Pe=0;Pe<F;Pe++)G(S,Pe,F,te,ce,q,we);for(var Be=0;Be<te;Be++)G(S,Be*F,1,F,ce,q,we)}function G(S,F,te,ce,q,we,Pe){var Be,Oe,Nt,Xt;for(we[0]=0,Pe[0]=-O,Pe[1]=O,Be=0;Be<ce;Be++)q[Be]=S[F+Be*te];for(Be=1,Oe=0,Nt=0;Be<ce;Be++){do Xt=we[Oe],Nt=(q[Be]-q[Xt]+Be*Be-Xt*Xt)/(Be-Xt)/2;while(Nt<=Pe[Oe]&&--Oe>-1);Oe++,we[Oe]=Be,Pe[Oe]=Nt,Pe[Oe+1]=O}for(Be=0,Oe=0;Be<ce;Be++){for(;Pe[Oe+1]<Be;)Oe++;Xt=we[Oe],S[F+Be*te]=q[Xt]+(Be-Xt)*(Be-Xt)}}},19175:function(_t,O,y){"use strict";y.d(O,{zL:function(){return S},DL:function(){return nt},Ht:function(){return Ze}});var V=63710088e-1,b={centimeters:V*100,centimetres:V*100,degrees:V/111325,feet:V*3.28084,inches:V*39.37,kilometers:V/1e3,kilometres:V/1e3,meters:V,metres:V,miles:V/1609.344,millimeters:V*1e3,millimetres:V*1e3,nauticalmiles:V/1852,radians:1,yards:V*1.0936},p={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/V,yards:1.0936133},G={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function S(ae,Ee,le){le===void 0&&(le={});var Q={type:"Feature"};return(le.id===0||le.id)&&(Q.id=le.id),le.bbox&&(Q.bbox=le.bbox),Q.properties=Ee||{},Q.geometry=ae,Q}function F(ae,Ee,le){switch(le===void 0&&(le={}),ae){case"Point":return te(Ee).geometry;case"LineString":return Pe(Ee).geometry;case"Polygon":return q(Ee).geometry;case"MultiPoint":return Xt(Ee).geometry;case"MultiLineString":return Nt(Ee).geometry;case"MultiPolygon":return Bt(Ee).geometry;default:throw new Error(ae+" is invalid")}}function te(ae,Ee,le){if(le===void 0&&(le={}),!ae)throw new Error("coordinates is required");if(!Array.isArray(ae))throw new Error("coordinates must be an Array");if(ae.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Te(ae[0])||!Te(ae[1]))throw new Error("coordinates must contain numbers");var Q={type:"Point",coordinates:ae};return S(Q,Ee,le)}function ce(ae,Ee,le){return le===void 0&&(le={}),Oe(ae.map(function(Q){return te(Q,Ee)}),le)}function q(ae,Ee,le){le===void 0&&(le={});for(var Q=0,re=ae;Q<re.length;Q++){var ke=re[Q];if(ke.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var qe=0;qe<ke[ke.length-1].length;qe++)if(ke[ke.length-1][qe]!==ke[0][qe])throw new Error("First and last Position are not equivalent.")}var Wt={type:"Polygon",coordinates:ae};return S(Wt,Ee,le)}function we(ae,Ee,le){return le===void 0&&(le={}),Oe(ae.map(function(Q){return q(Q,Ee)}),le)}function Pe(ae,Ee,le){if(le===void 0&&(le={}),ae.length<2)throw new Error("coordinates must be an array of two or more positions");var Q={type:"LineString",coordinates:ae};return S(Q,Ee,le)}function Be(ae,Ee,le){return le===void 0&&(le={}),Oe(ae.map(function(Q){return Pe(Q,Ee)}),le)}function Oe(ae,Ee){Ee===void 0&&(Ee={});var le={type:"FeatureCollection"};return Ee.id&&(le.id=Ee.id),Ee.bbox&&(le.bbox=Ee.bbox),le.features=ae,le}function Nt(ae,Ee,le){le===void 0&&(le={});var Q={type:"MultiLineString",coordinates:ae};return S(Q,Ee,le)}function Xt(ae,Ee,le){le===void 0&&(le={});var Q={type:"MultiPoint",coordinates:ae};return S(Q,Ee,le)}function Bt(ae,Ee,le){le===void 0&&(le={});var Q={type:"MultiPolygon",coordinates:ae};return S(Q,Ee,le)}function Qe(ae,Ee,le){le===void 0&&(le={});var Q={type:"GeometryCollection",geometries:ae};return S(Q,Ee,le)}function xt(ae,Ee){if(Ee===void 0&&(Ee=0),Ee&&!(Ee>=0))throw new Error("precision must be a positive number");var le=Math.pow(10,Ee||0);return Math.round(ae*le)/le}function nt(ae,Ee){Ee===void 0&&(Ee="kilometers");var le=b[Ee];if(!le)throw new Error(Ee+" units is invalid");return ae*le}function cr(ae,Ee){Ee===void 0&&(Ee="kilometers");var le=b[Ee];if(!le)throw new Error(Ee+" units is invalid");return ae/le}function At(ae,Ee){return St(cr(ae,Ee))}function Gt(ae){var Ee=ae%360;return Ee<0&&(Ee+=360),Ee}function St(ae){var Ee=ae%(2*Math.PI);return Ee*180/Math.PI}function Ze(ae){var Ee=ae%360;return Ee*Math.PI/180}function yt(ae,Ee,le){if(Ee===void 0&&(Ee="kilometers"),le===void 0&&(le="kilometers"),!(ae>=0))throw new Error("length must be a positive number");return nt(cr(ae,Ee),le)}function Me(ae,Ee,le){if(Ee===void 0&&(Ee="meters"),le===void 0&&(le="kilometers"),!(ae>=0))throw new Error("area must be a positive number");var Q=G[Ee];if(!Q)throw new Error("invalid original units");var re=G[le];if(!re)throw new Error("invalid final units");return ae/Q*re}function Te(ae){return!isNaN(ae)&&ae!==null&&!Array.isArray(ae)}function Ie(ae){return!!ae&&ae.constructor===Object}function bt(ae){if(!ae)throw new Error("bbox is required");if(!Array.isArray(ae))throw new Error("bbox must be an Array");if(ae.length!==4&&ae.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");ae.forEach(function(Ee){if(!Te(Ee))throw new Error("bbox must only contain numbers")})}function tr(ae){if(!ae)throw new Error("id is required");if(["string","number"].indexOf(typeof ae)===-1)throw new Error("id must be a number or a string")}},75675:function(_t,O,y){"use strict";var V=y(19877),b=y(67294),p=y(55835);O.Z=function(){var G=b.useState(!1),S=(0,V.Z)(G,2),F=S[0],te=S[1];return b.useEffect(function(){te((0,p.fk)())},[]),F}},55835:function(_t,O,y){"use strict";y.d(O,{jD:function(){return b},GL:function(){return p},fk:function(){return S}});var V=y(20064),b=function(){return(0,V.Z)()&&window.document.documentElement},p=function(te){if(b()){var ce=Array.isArray(te)?te:[te],q=window.document.documentElement;return ce.some(function(we){return we in q.style})}return!1},G,S=function(){if(!b())return!1;if(G!==void 0)return G;var te=document.createElement("div");return te.style.display="flex",te.style.flexDirection="column",te.style.rowGap="1px",te.appendChild(document.createElement("div")),te.appendChild(document.createElement("div")),document.body.appendChild(te),G=te.scrollHeight===1,document.body.removeChild(te),G}},65886:function(_t,O,y){"use strict";var V=y(67294),b=(0,V.createContext)({});O.Z=b},18316:function(_t,O,y){"use strict";var V=y(4763),b=y(3066),p=y(95676),G=y(67294),S=y(35510),F=y.n(S),te=y(65886),ce=y(67170),q=function(Oe,Nt){var Xt={};for(var Bt in Oe)Object.prototype.hasOwnProperty.call(Oe,Bt)&&Nt.indexOf(Bt)<0&&(Xt[Bt]=Oe[Bt]);if(Oe!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Qe=0,Bt=Object.getOwnPropertySymbols(Oe);Qe<Bt.length;Qe++)Nt.indexOf(Bt[Qe])<0&&Object.prototype.propertyIsEnumerable.call(Oe,Bt[Qe])&&(Xt[Bt[Qe]]=Oe[Bt[Qe]]);return Xt};function we(Oe){return typeof Oe=="number"?"".concat(Oe," ").concat(Oe," auto"):/^\d+(\.\d+)?(px|em|rem|%)$/.test(Oe)?"0 0 ".concat(Oe):Oe}var Pe=["xs","sm","md","lg","xl","xxl"],Be=G.forwardRef(function(Oe,Nt){var Xt,Bt=G.useContext(ce.E_),Qe=Bt.getPrefixCls,xt=Bt.direction,nt=G.useContext(te.Z),cr=nt.gutter,At=nt.wrap,Gt=nt.supportFlexGap,St=Oe.prefixCls,Ze=Oe.span,yt=Oe.order,Me=Oe.offset,Te=Oe.push,Ie=Oe.pull,bt=Oe.className,tr=Oe.children,ae=Oe.flex,Ee=Oe.style,le=q(Oe,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),Q=Qe("col",St),re={};Pe.forEach(function(wr){var Nr,Vt={},se=Oe[wr];typeof se=="number"?Vt.span=se:(0,p.Z)(se)==="object"&&(Vt=se||{}),delete le[wr],re=(0,b.Z)((0,b.Z)({},re),(Nr={},(0,V.Z)(Nr,"".concat(Q,"-").concat(wr,"-").concat(Vt.span),Vt.span!==void 0),(0,V.Z)(Nr,"".concat(Q,"-").concat(wr,"-order-").concat(Vt.order),Vt.order||Vt.order===0),(0,V.Z)(Nr,"".concat(Q,"-").concat(wr,"-offset-").concat(Vt.offset),Vt.offset||Vt.offset===0),(0,V.Z)(Nr,"".concat(Q,"-").concat(wr,"-push-").concat(Vt.push),Vt.push||Vt.push===0),(0,V.Z)(Nr,"".concat(Q,"-").concat(wr,"-pull-").concat(Vt.pull),Vt.pull||Vt.pull===0),(0,V.Z)(Nr,"".concat(Q,"-rtl"),xt==="rtl"),Nr))});var ke=F()(Q,(Xt={},(0,V.Z)(Xt,"".concat(Q,"-").concat(Ze),Ze!==void 0),(0,V.Z)(Xt,"".concat(Q,"-order-").concat(yt),yt),(0,V.Z)(Xt,"".concat(Q,"-offset-").concat(Me),Me),(0,V.Z)(Xt,"".concat(Q,"-push-").concat(Te),Te),(0,V.Z)(Xt,"".concat(Q,"-pull-").concat(Ie),Ie),Xt),bt,re),qe={};if(cr&&cr[0]>0){var Wt=cr[0]/2;qe.paddingLeft=Wt,qe.paddingRight=Wt}if(cr&&cr[1]>0&&!Gt){var Or=cr[1]/2;qe.paddingTop=Or,qe.paddingBottom=Or}return ae&&(qe.flex=we(ae),ae==="auto"&&At===!1&&!qe.minWidth&&(qe.minWidth=0)),G.createElement("div",(0,b.Z)({},le,{style:(0,b.Z)((0,b.Z)({},qe),Ee),className:ke,ref:Nt}),tr)});Be.displayName="Col",O.Z=Be},69160:function(_t,O,y){"use strict";var V=y(3066),b=y(4763),p=y(95676),G=y(19877),S=y(67294),F=y(35510),te=y.n(F),ce=y(67170),q=y(65886),we=y(4381),Pe=y(85748),Be=y(75675),Oe=function(Qe,xt){var nt={};for(var cr in Qe)Object.prototype.hasOwnProperty.call(Qe,cr)&&xt.indexOf(cr)<0&&(nt[cr]=Qe[cr]);if(Qe!=null&&typeof Object.getOwnPropertySymbols=="function")for(var At=0,cr=Object.getOwnPropertySymbols(Qe);At<cr.length;At++)xt.indexOf(cr[At])<0&&Object.prototype.propertyIsEnumerable.call(Qe,cr[At])&&(nt[cr[At]]=Qe[cr[At]]);return nt},Nt=(0,we.b)("top","middle","bottom","stretch"),Xt=(0,we.b)("start","end","center","space-around","space-between"),Bt=S.forwardRef(function(Qe,xt){var nt,cr=Qe.prefixCls,At=Qe.justify,Gt=Qe.align,St=Qe.className,Ze=Qe.style,yt=Qe.children,Me=Qe.gutter,Te=Me===void 0?0:Me,Ie=Qe.wrap,bt=Oe(Qe,["prefixCls","justify","align","className","style","children","gutter","wrap"]),tr=S.useContext(ce.E_),ae=tr.getPrefixCls,Ee=tr.direction,le=S.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),Q=(0,G.Z)(le,2),re=Q[0],ke=Q[1],qe=(0,Be.Z)(),Wt=S.useRef(Te);S.useEffect(function(){var jt=Pe.ZP.subscribe(function(w){var N=Wt.current||0;(!Array.isArray(N)&&(0,p.Z)(N)==="object"||Array.isArray(N)&&((0,p.Z)(N[0])==="object"||(0,p.Z)(N[1])==="object"))&&ke(w)});return function(){return Pe.ZP.unsubscribe(jt)}},[]);var Or=function(){var w=[0,0],N=Array.isArray(Te)?Te:[Te,0];return N.forEach(function(ve,Ae){if((0,p.Z)(ve)==="object")for(var Je=0;Je<Pe.c4.length;Je++){var st=Pe.c4[Je];if(re[st]&&ve[st]!==void 0){w[Ae]=ve[st];break}}else w[Ae]=ve||0}),w},wr=ae("row",cr),Nr=Or(),Vt=te()(wr,(nt={},(0,b.Z)(nt,"".concat(wr,"-no-wrap"),Ie===!1),(0,b.Z)(nt,"".concat(wr,"-").concat(At),At),(0,b.Z)(nt,"".concat(wr,"-").concat(Gt),Gt),(0,b.Z)(nt,"".concat(wr,"-rtl"),Ee==="rtl"),nt),St),se={},_e=Nr[0]>0?Nr[0]/-2:void 0,Le=Nr[1]>0?Nr[1]/-2:void 0;if(_e&&(se.marginLeft=_e,se.marginRight=_e),qe){var ot=(0,G.Z)(Nr,2);se.rowGap=ot[1]}else Le&&(se.marginTop=Le,se.marginBottom=Le);var Rt=S.useMemo(function(){return{gutter:Nr,wrap:Ie,supportFlexGap:qe}},[Nr,Ie,qe]);return S.createElement(q.Z.Provider,{value:Rt},S.createElement("div",(0,V.Z)({},bt,{className:Vt,style:(0,V.Z)((0,V.Z)({},se),Ze),ref:xt}),yt))});Bt.displayName="Row",O.Z=Bt},86178:function(_t,O,y){"use strict";var V=y(43673),b=y.n(V),p=y(37753),G=y.n(p)},37154:function(_t,O,y){"use strict";var V=y(44547);/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function b(Te,Ie){if(Te===Ie)return 0;for(var bt=Te.length,tr=Ie.length,ae=0,Ee=Math.min(bt,tr);ae<Ee;++ae)if(Te[ae]!==Ie[ae]){bt=Te[ae],tr=Ie[ae];break}return bt<tr?-1:tr<bt?1:0}function p(Te){return y.g.Buffer&&typeof y.g.Buffer.isBuffer=="function"?y.g.Buffer.isBuffer(Te):!!(Te!=null&&Te._isBuffer)}var G=y(72676),S=Object.prototype.hasOwnProperty,F=Array.prototype.slice,te=function(){return function(){}.name==="foo"}();function ce(Te){return Object.prototype.toString.call(Te)}function q(Te){return p(Te)||typeof y.g.ArrayBuffer!="function"?!1:typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(Te):Te?!!(Te instanceof DataView||Te.buffer&&Te.buffer instanceof ArrayBuffer):!1}var we=_t.exports=Qe,Pe=/\s*function\s+([^\(\s]*)\s*/;function Be(Te){if(!!G.isFunction(Te)){if(te)return Te.name;var Ie=Te.toString(),bt=Ie.match(Pe);return bt&&bt[1]}}we.AssertionError=function(Ie){this.name="AssertionError",this.actual=Ie.actual,this.expected=Ie.expected,this.operator=Ie.operator,Ie.message?(this.message=Ie.message,this.generatedMessage=!1):(this.message=Xt(this),this.generatedMessage=!0);var bt=Ie.stackStartFunction||Bt;if(Error.captureStackTrace)Error.captureStackTrace(this,bt);else{var tr=new Error;if(tr.stack){var ae=tr.stack,Ee=Be(bt),le=ae.indexOf(`
`+Ee);if(le>=0){var Q=ae.indexOf(`
`,le+1);ae=ae.substring(Q+1)}this.stack=ae}}},G.inherits(we.AssertionError,Error);function Oe(Te,Ie){return typeof Te=="string"?Te.length<Ie?Te:Te.slice(0,Ie):Te}function Nt(Te){if(te||!G.isFunction(Te))return G.inspect(Te);var Ie=Be(Te),bt=Ie?": "+Ie:"";return"[Function"+bt+"]"}function Xt(Te){return Oe(Nt(Te.actual),128)+" "+Te.operator+" "+Oe(Nt(Te.expected),128)}function Bt(Te,Ie,bt,tr,ae){throw new we.AssertionError({message:bt,actual:Te,expected:Ie,operator:tr,stackStartFunction:ae})}we.fail=Bt;function Qe(Te,Ie){Te||Bt(Te,!0,Ie,"==",we.ok)}we.ok=Qe,we.equal=function(Ie,bt,tr){Ie!=bt&&Bt(Ie,bt,tr,"==",we.equal)},we.notEqual=function(Ie,bt,tr){Ie==bt&&Bt(Ie,bt,tr,"!=",we.notEqual)},we.deepEqual=function(Ie,bt,tr){xt(Ie,bt,!1)||Bt(Ie,bt,tr,"deepEqual",we.deepEqual)},we.deepStrictEqual=function(Ie,bt,tr){xt(Ie,bt,!0)||Bt(Ie,bt,tr,"deepStrictEqual",we.deepStrictEqual)};function xt(Te,Ie,bt,tr){if(Te===Ie)return!0;if(p(Te)&&p(Ie))return b(Te,Ie)===0;if(G.isDate(Te)&&G.isDate(Ie))return Te.getTime()===Ie.getTime();if(G.isRegExp(Te)&&G.isRegExp(Ie))return Te.source===Ie.source&&Te.global===Ie.global&&Te.multiline===Ie.multiline&&Te.lastIndex===Ie.lastIndex&&Te.ignoreCase===Ie.ignoreCase;if((Te===null||typeof Te!="object")&&(Ie===null||typeof Ie!="object"))return bt?Te===Ie:Te==Ie;if(q(Te)&&q(Ie)&&ce(Te)===ce(Ie)&&!(Te instanceof Float32Array||Te instanceof Float64Array))return b(new Uint8Array(Te.buffer),new Uint8Array(Ie.buffer))===0;if(p(Te)!==p(Ie))return!1;tr=tr||{actual:[],expected:[]};var ae=tr.actual.indexOf(Te);return ae!==-1&&ae===tr.expected.indexOf(Ie)?!0:(tr.actual.push(Te),tr.expected.push(Ie),cr(Te,Ie,bt,tr))}function nt(Te){return Object.prototype.toString.call(Te)=="[object Arguments]"}function cr(Te,Ie,bt,tr){if(Te==null||Ie===null||Ie===void 0)return!1;if(G.isPrimitive(Te)||G.isPrimitive(Ie))return Te===Ie;if(bt&&Object.getPrototypeOf(Te)!==Object.getPrototypeOf(Ie))return!1;var ae=nt(Te),Ee=nt(Ie);if(ae&&!Ee||!ae&&Ee)return!1;if(ae)return Te=F.call(Te),Ie=F.call(Ie),xt(Te,Ie,bt);var le=Me(Te),Q=Me(Ie),re,ke;if(le.length!==Q.length)return!1;for(le.sort(),Q.sort(),ke=le.length-1;ke>=0;ke--)if(le[ke]!==Q[ke])return!1;for(ke=le.length-1;ke>=0;ke--)if(re=le[ke],!xt(Te[re],Ie[re],bt,tr))return!1;return!0}we.notDeepEqual=function(Ie,bt,tr){xt(Ie,bt,!1)&&Bt(Ie,bt,tr,"notDeepEqual",we.notDeepEqual)},we.notDeepStrictEqual=At;function At(Te,Ie,bt){xt(Te,Ie,!0)&&Bt(Te,Ie,bt,"notDeepStrictEqual",At)}we.strictEqual=function(Ie,bt,tr){Ie!==bt&&Bt(Ie,bt,tr,"===",we.strictEqual)},we.notStrictEqual=function(Ie,bt,tr){Ie===bt&&Bt(Ie,bt,tr,"!==",we.notStrictEqual)};function Gt(Te,Ie){if(!Te||!Ie)return!1;if(Object.prototype.toString.call(Ie)=="[object RegExp]")return Ie.test(Te);try{if(Te instanceof Ie)return!0}catch(bt){}return Error.isPrototypeOf(Ie)?!1:Ie.call({},Te)===!0}function St(Te){var Ie;try{Te()}catch(bt){Ie=bt}return Ie}function Ze(Te,Ie,bt,tr){var ae;if(typeof Ie!="function")throw new TypeError('"block" argument must be a function');typeof bt=="string"&&(tr=bt,bt=null),ae=St(Ie),tr=(bt&&bt.name?" ("+bt.name+").":".")+(tr?" "+tr:"."),Te&&!ae&&Bt(ae,bt,"Missing expected exception"+tr);var Ee=typeof tr=="string",le=!Te&&G.isError(ae),Q=!Te&&ae&&!bt;if((le&&Ee&&Gt(ae,bt)||Q)&&Bt(ae,bt,"Got unwanted exception"+tr),Te&&ae&&bt&&!Gt(ae,bt)||!Te&&ae)throw ae}we.throws=function(Te,Ie,bt){Ze(!0,Te,Ie,bt)},we.doesNotThrow=function(Te,Ie,bt){Ze(!1,Te,Ie,bt)},we.ifError=function(Te){if(Te)throw Te};function yt(Te,Ie){Te||Bt(Te,!0,Ie,"==",yt)}we.strict=V(yt,we,{equal:we.strictEqual,deepEqual:we.deepStrictEqual,notEqual:we.notStrictEqual,notDeepEqual:we.notDeepStrictEqual}),we.strict.strict=we.strict;var Me=Object.keys||function(Te){var Ie=[];for(var bt in Te)S.call(Te,bt)&&Ie.push(bt);return Ie}},66097:function(_t){typeof Object.create=="function"?_t.exports=function(y,V){y.super_=V,y.prototype=Object.create(V.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}})}:_t.exports=function(y,V){y.super_=V;var b=function(){};b.prototype=V.prototype,y.prototype=new b,y.prototype.constructor=y}},14289:function(_t){_t.exports=function(y){return y&&typeof y=="object"&&typeof y.copy=="function"&&typeof y.fill=="function"&&typeof y.readUInt8=="function"}},72676:function(_t,O,y){var V=y(82195),b=/%[sdj%]/g;O.format=function(Q){if(!cr(Q)){for(var re=[],ke=0;ke<arguments.length;ke++)re.push(S(arguments[ke]));return re.join(" ")}for(var ke=1,qe=arguments,Wt=qe.length,Or=String(Q).replace(b,function(Nr){if(Nr==="%%")return"%";if(ke>=Wt)return Nr;switch(Nr){case"%s":return String(qe[ke++]);case"%d":return Number(qe[ke++]);case"%j":try{return JSON.stringify(qe[ke++])}catch(Vt){return"[Circular]"}default:return Nr}}),wr=qe[ke];ke<Wt;wr=qe[++ke])Qe(wr)||!Ze(wr)?Or+=" "+wr:Or+=" "+S(wr);return Or},O.deprecate=function(Q,re){if(Gt(y.g.process))return function(){return O.deprecate(Q,re).apply(this,arguments)};if(V.noDeprecation===!0)return Q;var ke=!1;function qe(){if(!ke){if(V.throwDeprecation)throw new Error(re);V.traceDeprecation?console.trace(re):console.error(re),ke=!0}return Q.apply(this,arguments)}return qe};var p={},G;O.debuglog=function(Q){if(Gt(G)&&(G={NODE_ENV:"production"}.NODE_DEBUG||""),Q=Q.toUpperCase(),!p[Q])if(new RegExp("\\b"+Q+"\\b","i").test(G)){var re=V.pid;p[Q]=function(){var ke=O.format.apply(O,arguments);console.error("%s %d: %s",Q,re,ke)}}else p[Q]=function(){};return p[Q]};function S(Q,re){var ke={seen:[],stylize:te};return arguments.length>=3&&(ke.depth=arguments[2]),arguments.length>=4&&(ke.colors=arguments[3]),Bt(re)?ke.showHidden=re:re&&O._extend(ke,re),Gt(ke.showHidden)&&(ke.showHidden=!1),Gt(ke.depth)&&(ke.depth=2),Gt(ke.colors)&&(ke.colors=!1),Gt(ke.customInspect)&&(ke.customInspect=!0),ke.colors&&(ke.stylize=F),q(ke,Q,ke.depth)}O.inspect=S,S.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},S.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function F(Q,re){var ke=S.styles[re];return ke?"["+S.colors[ke][0]+"m"+Q+"["+S.colors[ke][1]+"m":Q}function te(Q,re){return Q}function ce(Q){var re={};return Q.forEach(function(ke,qe){re[ke]=!0}),re}function q(Q,re,ke){if(Q.customInspect&&re&&Te(re.inspect)&&re.inspect!==O.inspect&&!(re.constructor&&re.constructor.prototype===re)){var qe=re.inspect(ke,Q);return cr(qe)||(qe=q(Q,qe,ke)),qe}var Wt=we(Q,re);if(Wt)return Wt;var Or=Object.keys(re),wr=ce(Or);if(Q.showHidden&&(Or=Object.getOwnPropertyNames(re)),Me(re)&&(Or.indexOf("message")>=0||Or.indexOf("description")>=0))return Pe(re);if(Or.length===0){if(Te(re)){var Nr=re.name?": "+re.name:"";return Q.stylize("[Function"+Nr+"]","special")}if(St(re))return Q.stylize(RegExp.prototype.toString.call(re),"regexp");if(yt(re))return Q.stylize(Date.prototype.toString.call(re),"date");if(Me(re))return Pe(re)}var Vt="",se=!1,_e=["{","}"];if(Xt(re)&&(se=!0,_e=["[","]"]),Te(re)){var Le=re.name?": "+re.name:"";Vt=" [Function"+Le+"]"}if(St(re)&&(Vt=" "+RegExp.prototype.toString.call(re)),yt(re)&&(Vt=" "+Date.prototype.toUTCString.call(re)),Me(re)&&(Vt=" "+Pe(re)),Or.length===0&&(!se||re.length==0))return _e[0]+Vt+_e[1];if(ke<0)return St(re)?Q.stylize(RegExp.prototype.toString.call(re),"regexp"):Q.stylize("[Object]","special");Q.seen.push(re);var ot;return se?ot=Be(Q,re,ke,wr,Or):ot=Or.map(function(Rt){return Oe(Q,re,ke,wr,Rt,se)}),Q.seen.pop(),Nt(ot,Vt,_e)}function we(Q,re){if(Gt(re))return Q.stylize("undefined","undefined");if(cr(re)){var ke="'"+JSON.stringify(re).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Q.stylize(ke,"string")}if(nt(re))return Q.stylize(""+re,"number");if(Bt(re))return Q.stylize(""+re,"boolean");if(Qe(re))return Q.stylize("null","null")}function Pe(Q){return"["+Error.prototype.toString.call(Q)+"]"}function Be(Q,re,ke,qe,Wt){for(var Or=[],wr=0,Nr=re.length;wr<Nr;++wr)le(re,String(wr))?Or.push(Oe(Q,re,ke,qe,String(wr),!0)):Or.push("");return Wt.forEach(function(Vt){Vt.match(/^\d+$/)||Or.push(Oe(Q,re,ke,qe,Vt,!0))}),Or}function Oe(Q,re,ke,qe,Wt,Or){var wr,Nr,Vt;if(Vt=Object.getOwnPropertyDescriptor(re,Wt)||{value:re[Wt]},Vt.get?Vt.set?Nr=Q.stylize("[Getter/Setter]","special"):Nr=Q.stylize("[Getter]","special"):Vt.set&&(Nr=Q.stylize("[Setter]","special")),le(qe,Wt)||(wr="["+Wt+"]"),Nr||(Q.seen.indexOf(Vt.value)<0?(Qe(ke)?Nr=q(Q,Vt.value,null):Nr=q(Q,Vt.value,ke-1),Nr.indexOf(`
`)>-1&&(Or?Nr=Nr.split(`
`).map(function(se){return"  "+se}).join(`
`).substr(2):Nr=`
`+Nr.split(`
`).map(function(se){return"   "+se}).join(`
`))):Nr=Q.stylize("[Circular]","special")),Gt(wr)){if(Or&&Wt.match(/^\d+$/))return Nr;wr=JSON.stringify(""+Wt),wr.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(wr=wr.substr(1,wr.length-2),wr=Q.stylize(wr,"name")):(wr=wr.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),wr=Q.stylize(wr,"string"))}return wr+": "+Nr}function Nt(Q,re,ke){var qe=0,Wt=Q.reduce(function(Or,wr){return qe++,wr.indexOf(`
`)>=0&&qe++,Or+wr.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Wt>60?ke[0]+(re===""?"":re+`
 `)+" "+Q.join(`,
  `)+" "+ke[1]:ke[0]+re+" "+Q.join(", ")+" "+ke[1]}function Xt(Q){return Array.isArray(Q)}O.isArray=Xt;function Bt(Q){return typeof Q=="boolean"}O.isBoolean=Bt;function Qe(Q){return Q===null}O.isNull=Qe;function xt(Q){return Q==null}O.isNullOrUndefined=xt;function nt(Q){return typeof Q=="number"}O.isNumber=nt;function cr(Q){return typeof Q=="string"}O.isString=cr;function At(Q){return typeof Q=="symbol"}O.isSymbol=At;function Gt(Q){return Q===void 0}O.isUndefined=Gt;function St(Q){return Ze(Q)&&bt(Q)==="[object RegExp]"}O.isRegExp=St;function Ze(Q){return typeof Q=="object"&&Q!==null}O.isObject=Ze;function yt(Q){return Ze(Q)&&bt(Q)==="[object Date]"}O.isDate=yt;function Me(Q){return Ze(Q)&&(bt(Q)==="[object Error]"||Q instanceof Error)}O.isError=Me;function Te(Q){return typeof Q=="function"}O.isFunction=Te;function Ie(Q){return Q===null||typeof Q=="boolean"||typeof Q=="number"||typeof Q=="string"||typeof Q=="symbol"||typeof Q=="undefined"}O.isPrimitive=Ie,O.isBuffer=y(14289);function bt(Q){return Object.prototype.toString.call(Q)}function tr(Q){return Q<10?"0"+Q.toString(10):Q.toString(10)}var ae=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Ee(){var Q=new Date,re=[tr(Q.getHours()),tr(Q.getMinutes()),tr(Q.getSeconds())].join(":");return[Q.getDate(),ae[Q.getMonth()],re].join(" ")}O.log=function(){console.log("%s - %s",Ee(),O.format.apply(O,arguments))},O.inherits=y(66097),O._extend=function(Q,re){if(!re||!Ze(re))return Q;for(var ke=Object.keys(re),qe=ke.length;qe--;)Q[ke[qe]]=re[ke[qe]];return Q};function le(Q,re){return Object.prototype.hasOwnProperty.call(Q,re)}},10614:function(_t,O,y){"use strict";y.d(O,{ZP:function(){return cr},B8:function(){return Ze}});function V(Q,re,ke){Q.prototype=re.prototype=ke,ke.constructor=Q}function b(Q,re){var ke=Object.create(Q.prototype);for(var qe in re)ke[qe]=re[qe];return ke}function p(){}var G=.7,S=1/G,F="\\s*([+-]?\\d+)\\s*",te="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ce="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",q=/^#([0-9a-f]{3,8})$/,we=new RegExp("^rgb\\("+[F,F,F]+"\\)$"),Pe=new RegExp("^rgb\\("+[ce,ce,ce]+"\\)$"),Be=new RegExp("^rgba\\("+[F,F,F,te]+"\\)$"),Oe=new RegExp("^rgba\\("+[ce,ce,ce,te]+"\\)$"),Nt=new RegExp("^hsl\\("+[te,ce,ce]+"\\)$"),Xt=new RegExp("^hsla\\("+[te,ce,ce,te]+"\\)$"),Bt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};V(p,cr,{copy:function(re){return Object.assign(new this.constructor,this,re)},displayable:function(){return this.rgb().displayable()},hex:Qe,formatHex:Qe,formatHsl:xt,formatRgb:nt,toString:nt});function Qe(){return this.rgb().formatHex()}function xt(){return tr(this).formatHsl()}function nt(){return this.rgb().formatRgb()}function cr(Q){var re,ke;return Q=(Q+"").trim().toLowerCase(),(re=q.exec(Q))?(ke=re[1].length,re=parseInt(re[1],16),ke===6?At(re):ke===3?new yt(re>>8&15|re>>4&240,re>>4&15|re&240,(re&15)<<4|re&15,1):ke===8?Gt(re>>24&255,re>>16&255,re>>8&255,(re&255)/255):ke===4?Gt(re>>12&15|re>>8&240,re>>8&15|re>>4&240,re>>4&15|re&240,((re&15)<<4|re&15)/255):null):(re=we.exec(Q))?new yt(re[1],re[2],re[3],1):(re=Pe.exec(Q))?new yt(re[1]*255/100,re[2]*255/100,re[3]*255/100,1):(re=Be.exec(Q))?Gt(re[1],re[2],re[3],re[4]):(re=Oe.exec(Q))?Gt(re[1]*255/100,re[2]*255/100,re[3]*255/100,re[4]):(re=Nt.exec(Q))?bt(re[1],re[2]/100,re[3]/100,1):(re=Xt.exec(Q))?bt(re[1],re[2]/100,re[3]/100,re[4]):Bt.hasOwnProperty(Q)?At(Bt[Q]):Q==="transparent"?new yt(NaN,NaN,NaN,0):null}function At(Q){return new yt(Q>>16&255,Q>>8&255,Q&255,1)}function Gt(Q,re,ke,qe){return qe<=0&&(Q=re=ke=NaN),new yt(Q,re,ke,qe)}function St(Q){return Q instanceof p||(Q=cr(Q)),Q?(Q=Q.rgb(),new yt(Q.r,Q.g,Q.b,Q.opacity)):new yt}function Ze(Q,re,ke,qe){return arguments.length===1?St(Q):new yt(Q,re,ke,qe==null?1:qe)}function yt(Q,re,ke,qe){this.r=+Q,this.g=+re,this.b=+ke,this.opacity=+qe}V(yt,Ze,b(p,{brighter:function(re){return re=re==null?S:Math.pow(S,re),new yt(this.r*re,this.g*re,this.b*re,this.opacity)},darker:function(re){return re=re==null?G:Math.pow(G,re),new yt(this.r*re,this.g*re,this.b*re,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Me,formatHex:Me,formatRgb:Te,toString:Te}));function Me(){return"#"+Ie(this.r)+Ie(this.g)+Ie(this.b)}function Te(){var Q=this.opacity;return Q=isNaN(Q)?1:Math.max(0,Math.min(1,Q)),(Q===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(Q===1?")":", "+Q+")")}function Ie(Q){return Q=Math.max(0,Math.min(255,Math.round(Q)||0)),(Q<16?"0":"")+Q.toString(16)}function bt(Q,re,ke,qe){return qe<=0?Q=re=ke=NaN:ke<=0||ke>=1?Q=re=NaN:re<=0&&(Q=NaN),new Ee(Q,re,ke,qe)}function tr(Q){if(Q instanceof Ee)return new Ee(Q.h,Q.s,Q.l,Q.opacity);if(Q instanceof p||(Q=cr(Q)),!Q)return new Ee;if(Q instanceof Ee)return Q;Q=Q.rgb();var re=Q.r/255,ke=Q.g/255,qe=Q.b/255,Wt=Math.min(re,ke,qe),Or=Math.max(re,ke,qe),wr=NaN,Nr=Or-Wt,Vt=(Or+Wt)/2;return Nr?(re===Or?wr=(ke-qe)/Nr+(ke<qe)*6:ke===Or?wr=(qe-re)/Nr+2:wr=(re-ke)/Nr+4,Nr/=Vt<.5?Or+Wt:2-Or-Wt,wr*=60):Nr=Vt>0&&Vt<1?0:wr,new Ee(wr,Nr,Vt,Q.opacity)}function ae(Q,re,ke,qe){return arguments.length===1?tr(Q):new Ee(Q,re,ke,qe==null?1:qe)}function Ee(Q,re,ke,qe){this.h=+Q,this.s=+re,this.l=+ke,this.opacity=+qe}V(Ee,ae,b(p,{brighter:function(re){return re=re==null?S:Math.pow(S,re),new Ee(this.h,this.s,this.l*re,this.opacity)},darker:function(re){return re=re==null?G:Math.pow(G,re),new Ee(this.h,this.s,this.l*re,this.opacity)},rgb:function(){var re=this.h%360+(this.h<0)*360,ke=isNaN(re)||isNaN(this.s)?0:this.s,qe=this.l,Wt=qe+(qe<.5?qe:1-qe)*ke,Or=2*qe-Wt;return new yt(le(re>=240?re-240:re+120,Or,Wt),le(re,Or,Wt),le(re<120?re+240:re-120,Or,Wt),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var re=this.opacity;return re=isNaN(re)?1:Math.max(0,Math.min(1,re)),(re===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(re===1?")":", "+re+")")}}));function le(Q,re,ke){return(Q<60?re+(ke-re)*Q/60:Q<180?ke:Q<240?re+(ke-re)*(240-Q)/60:re)*255}},31727:function(_t){"use strict";_t.exports=O,_t.exports.default=O;function O(ae,Ee,le){le=le||2;var Q=Ee&&Ee.length,re=Q?Ee[0]*le:ae.length,ke=y(ae,0,re,le,!0),qe=[];if(!ke||ke.next===ke.prev)return qe;var Wt,Or,wr,Nr,Vt,se,_e;if(Q&&(ke=te(ae,Ee,ke,le)),ae.length>80*le){Wt=wr=ae[0],Or=Nr=ae[1];for(var Le=le;Le<re;Le+=le)Vt=ae[Le],se=ae[Le+1],Vt<Wt&&(Wt=Vt),se<Or&&(Or=se),Vt>wr&&(wr=Vt),se>Nr&&(Nr=se);_e=Math.max(wr-Wt,Nr-Or),_e=_e!==0?1/_e:0}return b(ke,qe,le,Wt,Or,_e),qe}function y(ae,Ee,le,Q,re){var ke,qe;if(re===tr(ae,Ee,le,Q)>0)for(ke=Ee;ke<le;ke+=Q)qe=Te(ke,ae[ke],ae[ke+1],qe);else for(ke=le-Q;ke>=Ee;ke-=Q)qe=Te(ke,ae[ke],ae[ke+1],qe);return qe&&nt(qe,qe.next)&&(Ie(qe),qe=qe.next),qe}function V(ae,Ee){if(!ae)return ae;Ee||(Ee=ae);var le=ae,Q;do if(Q=!1,!le.steiner&&(nt(le,le.next)||xt(le.prev,le,le.next)===0)){if(Ie(le),le=Ee=le.prev,le===le.next)break;Q=!0}else le=le.next;while(Q||le!==Ee);return Ee}function b(ae,Ee,le,Q,re,ke,qe){if(!!ae){!qe&&ke&&Be(ae,Q,re,ke);for(var Wt=ae,Or,wr;ae.prev!==ae.next;){if(Or=ae.prev,wr=ae.next,ke?G(ae,Q,re,ke):p(ae)){Ee.push(Or.i/le),Ee.push(ae.i/le),Ee.push(wr.i/le),Ie(ae),ae=wr.next,Wt=wr.next;continue}if(ae=wr,ae===Wt){qe?qe===1?(ae=S(V(ae),Ee,le),b(ae,Ee,le,Q,re,ke,2)):qe===2&&F(ae,Ee,le,Q,re,ke):b(V(ae),Ee,le,Q,re,ke,1);break}}}}function p(ae){var Ee=ae.prev,le=ae,Q=ae.next;if(xt(Ee,le,Q)>=0)return!1;for(var re=ae.next.next;re!==ae.prev;){if(Bt(Ee.x,Ee.y,le.x,le.y,Q.x,Q.y,re.x,re.y)&&xt(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function G(ae,Ee,le,Q){var re=ae.prev,ke=ae,qe=ae.next;if(xt(re,ke,qe)>=0)return!1;for(var Wt=re.x<ke.x?re.x<qe.x?re.x:qe.x:ke.x<qe.x?ke.x:qe.x,Or=re.y<ke.y?re.y<qe.y?re.y:qe.y:ke.y<qe.y?ke.y:qe.y,wr=re.x>ke.x?re.x>qe.x?re.x:qe.x:ke.x>qe.x?ke.x:qe.x,Nr=re.y>ke.y?re.y>qe.y?re.y:qe.y:ke.y>qe.y?ke.y:qe.y,Vt=Nt(Wt,Or,Ee,le,Q),se=Nt(wr,Nr,Ee,le,Q),_e=ae.prevZ,Le=ae.nextZ;_e&&_e.z>=Vt&&Le&&Le.z<=se;){if(_e!==ae.prev&&_e!==ae.next&&Bt(re.x,re.y,ke.x,ke.y,qe.x,qe.y,_e.x,_e.y)&&xt(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,Le!==ae.prev&&Le!==ae.next&&Bt(re.x,re.y,ke.x,ke.y,qe.x,qe.y,Le.x,Le.y)&&xt(Le.prev,Le,Le.next)>=0))return!1;Le=Le.nextZ}for(;_e&&_e.z>=Vt;){if(_e!==ae.prev&&_e!==ae.next&&Bt(re.x,re.y,ke.x,ke.y,qe.x,qe.y,_e.x,_e.y)&&xt(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;Le&&Le.z<=se;){if(Le!==ae.prev&&Le!==ae.next&&Bt(re.x,re.y,ke.x,ke.y,qe.x,qe.y,Le.x,Le.y)&&xt(Le.prev,Le,Le.next)>=0)return!1;Le=Le.nextZ}return!0}function S(ae,Ee,le){var Q=ae;do{var re=Q.prev,ke=Q.next.next;!nt(re,ke)&&cr(re,Q,Q.next,ke)&&Ze(re,ke)&&Ze(ke,re)&&(Ee.push(re.i/le),Ee.push(Q.i/le),Ee.push(ke.i/le),Ie(Q),Ie(Q.next),Q=ae=ke),Q=Q.next}while(Q!==ae);return V(Q)}function F(ae,Ee,le,Q,re,ke){var qe=ae;do{for(var Wt=qe.next.next;Wt!==qe.prev;){if(qe.i!==Wt.i&&Qe(qe,Wt)){var Or=Me(qe,Wt);qe=V(qe,qe.next),Or=V(Or,Or.next),b(qe,Ee,le,Q,re,ke),b(Or,Ee,le,Q,re,ke);return}Wt=Wt.next}qe=qe.next}while(qe!==ae)}function te(ae,Ee,le,Q){var re=[],ke,qe,Wt,Or,wr;for(ke=0,qe=Ee.length;ke<qe;ke++)Wt=Ee[ke]*Q,Or=ke<qe-1?Ee[ke+1]*Q:ae.length,wr=y(ae,Wt,Or,Q,!1),wr===wr.next&&(wr.steiner=!0),re.push(Xt(wr));for(re.sort(ce),ke=0;ke<re.length;ke++)q(re[ke],le),le=V(le,le.next);return le}function ce(ae,Ee){return ae.x-Ee.x}function q(ae,Ee){if(Ee=we(ae,Ee),Ee){var le=Me(Ee,ae);V(Ee,Ee.next),V(le,le.next)}}function we(ae,Ee){var le=Ee,Q=ae.x,re=ae.y,ke=-Infinity,qe;do{if(re<=le.y&&re>=le.next.y&&le.next.y!==le.y){var Wt=le.x+(re-le.y)*(le.next.x-le.x)/(le.next.y-le.y);if(Wt<=Q&&Wt>ke){if(ke=Wt,Wt===Q){if(re===le.y)return le;if(re===le.next.y)return le.next}qe=le.x<le.next.x?le:le.next}}le=le.next}while(le!==Ee);if(!qe)return null;if(Q===ke)return qe;var Or=qe,wr=qe.x,Nr=qe.y,Vt=Infinity,se;le=qe;do Q>=le.x&&le.x>=wr&&Q!==le.x&&Bt(re<Nr?Q:ke,re,wr,Nr,re<Nr?ke:Q,re,le.x,le.y)&&(se=Math.abs(re-le.y)/(Q-le.x),Ze(le,ae)&&(se<Vt||se===Vt&&(le.x>qe.x||le.x===qe.x&&Pe(qe,le)))&&(qe=le,Vt=se)),le=le.next;while(le!==Or);return qe}function Pe(ae,Ee){return xt(ae.prev,ae,Ee.prev)<0&&xt(Ee.next,ae,ae.next)<0}function Be(ae,Ee,le,Q){var re=ae;do re.z===null&&(re.z=Nt(re.x,re.y,Ee,le,Q)),re.prevZ=re.prev,re.nextZ=re.next,re=re.next;while(re!==ae);re.prevZ.nextZ=null,re.prevZ=null,Oe(re)}function Oe(ae){var Ee,le,Q,re,ke,qe,Wt,Or,wr=1;do{for(le=ae,ae=null,ke=null,qe=0;le;){for(qe++,Q=le,Wt=0,Ee=0;Ee<wr&&(Wt++,Q=Q.nextZ,!!Q);Ee++);for(Or=wr;Wt>0||Or>0&&Q;)Wt!==0&&(Or===0||!Q||le.z<=Q.z)?(re=le,le=le.nextZ,Wt--):(re=Q,Q=Q.nextZ,Or--),ke?ke.nextZ=re:ae=re,re.prevZ=ke,ke=re;le=Q}ke.nextZ=null,wr*=2}while(qe>1);return ae}function Nt(ae,Ee,le,Q,re){return ae=32767*(ae-le)*re,Ee=32767*(Ee-Q)*re,ae=(ae|ae<<8)&16711935,ae=(ae|ae<<4)&252645135,ae=(ae|ae<<2)&858993459,ae=(ae|ae<<1)&1431655765,Ee=(Ee|Ee<<8)&16711935,Ee=(Ee|Ee<<4)&252645135,Ee=(Ee|Ee<<2)&858993459,Ee=(Ee|Ee<<1)&1431655765,ae|Ee<<1}function Xt(ae){var Ee=ae,le=ae;do(Ee.x<le.x||Ee.x===le.x&&Ee.y<le.y)&&(le=Ee),Ee=Ee.next;while(Ee!==ae);return le}function Bt(ae,Ee,le,Q,re,ke,qe,Wt){return(re-qe)*(Ee-Wt)-(ae-qe)*(ke-Wt)>=0&&(ae-qe)*(Q-Wt)-(le-qe)*(Ee-Wt)>=0&&(le-qe)*(ke-Wt)-(re-qe)*(Q-Wt)>=0}function Qe(ae,Ee){return ae.next.i!==Ee.i&&ae.prev.i!==Ee.i&&!St(ae,Ee)&&(Ze(ae,Ee)&&Ze(Ee,ae)&&yt(ae,Ee)&&(xt(ae.prev,ae,Ee.prev)||xt(ae,Ee.prev,Ee))||nt(ae,Ee)&&xt(ae.prev,ae,ae.next)>0&&xt(Ee.prev,Ee,Ee.next)>0)}function xt(ae,Ee,le){return(Ee.y-ae.y)*(le.x-Ee.x)-(Ee.x-ae.x)*(le.y-Ee.y)}function nt(ae,Ee){return ae.x===Ee.x&&ae.y===Ee.y}function cr(ae,Ee,le,Q){var re=Gt(xt(ae,Ee,le)),ke=Gt(xt(ae,Ee,Q)),qe=Gt(xt(le,Q,ae)),Wt=Gt(xt(le,Q,Ee));return!!(re!==ke&&qe!==Wt||re===0&&At(ae,le,Ee)||ke===0&&At(ae,Q,Ee)||qe===0&&At(le,ae,Q)||Wt===0&&At(le,Ee,Q))}function At(ae,Ee,le){return Ee.x<=Math.max(ae.x,le.x)&&Ee.x>=Math.min(ae.x,le.x)&&Ee.y<=Math.max(ae.y,le.y)&&Ee.y>=Math.min(ae.y,le.y)}function Gt(ae){return ae>0?1:ae<0?-1:0}function St(ae,Ee){var le=ae;do{if(le.i!==ae.i&&le.next.i!==ae.i&&le.i!==Ee.i&&le.next.i!==Ee.i&&cr(le,le.next,ae,Ee))return!0;le=le.next}while(le!==ae);return!1}function Ze(ae,Ee){return xt(ae.prev,ae,ae.next)<0?xt(ae,Ee,ae.next)>=0&&xt(ae,ae.prev,Ee)>=0:xt(ae,Ee,ae.prev)<0||xt(ae,ae.next,Ee)<0}function yt(ae,Ee){var le=ae,Q=!1,re=(ae.x+Ee.x)/2,ke=(ae.y+Ee.y)/2;do le.y>ke!=le.next.y>ke&&le.next.y!==le.y&&re<(le.next.x-le.x)*(ke-le.y)/(le.next.y-le.y)+le.x&&(Q=!Q),le=le.next;while(le!==ae);return Q}function Me(ae,Ee){var le=new bt(ae.i,ae.x,ae.y),Q=new bt(Ee.i,Ee.x,Ee.y),re=ae.next,ke=Ee.prev;return ae.next=Ee,Ee.prev=ae,le.next=re,re.prev=le,Q.next=le,le.prev=Q,ke.next=Q,Q.prev=ke,Q}function Te(ae,Ee,le,Q){var re=new bt(ae,Ee,le);return Q?(re.next=Q.next,re.prev=Q,Q.next.prev=re,Q.next=re):(re.prev=re,re.next=re),re}function Ie(ae){ae.next.prev=ae.prev,ae.prev.next=ae.next,ae.prevZ&&(ae.prevZ.nextZ=ae.nextZ),ae.nextZ&&(ae.nextZ.prevZ=ae.prevZ)}function bt(ae,Ee,le){this.i=ae,this.x=Ee,this.y=le,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}O.deviation=function(ae,Ee,le,Q){var re=Ee&&Ee.length,ke=re?Ee[0]*le:ae.length,qe=Math.abs(tr(ae,0,ke,le));if(re)for(var Wt=0,Or=Ee.length;Wt<Or;Wt++){var wr=Ee[Wt]*le,Nr=Wt<Or-1?Ee[Wt+1]*le:ae.length;qe-=Math.abs(tr(ae,wr,Nr,le))}var Vt=0;for(Wt=0;Wt<Q.length;Wt+=3){var se=Q[Wt]*le,_e=Q[Wt+1]*le,Le=Q[Wt+2]*le;Vt+=Math.abs((ae[se]-ae[Le])*(ae[_e+1]-ae[se+1])-(ae[se]-ae[_e])*(ae[Le+1]-ae[se+1]))}return qe===0&&Vt===0?0:Math.abs((Vt-qe)/qe)};function tr(ae,Ee,le,Q){for(var re=0,ke=Ee,qe=le-Q;ke<le;ke+=Q)re+=(ae[qe]-ae[ke])*(ae[ke+1]+ae[qe+1]),qe=ke;return re}O.flatten=function(ae){for(var Ee=ae[0][0].length,le={vertices:[],holes:[],dimensions:Ee},Q=0,re=0;re<ae.length;re++){for(var ke=0;ke<ae[re].length;ke++)for(var qe=0;qe<Ee;qe++)le.vertices.push(ae[re][ke][qe]);re>0&&(Q+=ae[re-1].length,le.holes.push(Q))}return le}},35708:function(_t){function O(V){var b=V.target||V.srcElement;b.__resizeRAF__&&cancelAnimationFrame(b.__resizeRAF__),b.__resizeRAF__=requestAnimationFrame(function(){var p=b.__resizeTrigger__,G=p&&p.__resizeListeners__;G&&G.forEach(function(S){S.call(p,V)})})}var y=function(b,p){var G=this,S=G.document,F,te=S.attachEvent;typeof navigator!="undefined"&&(F=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function ce(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",O)}if(!b.__resizeListeners__)if(b.__resizeListeners__=[],te)b.__resizeTrigger__=b,b.attachEvent("onresize",O);else{getComputedStyle(b).position==="static"&&(b.style.position="relative");var q=b.__resizeTrigger__=S.createElement("object");q.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),q.setAttribute("class","resize-sensor"),q.setAttribute("tabindex","-1"),q.setAttribute("title",""),q.__resizeElement__=b,q.onload=ce,q.type="text/html",F&&b.appendChild(q),q.data="about:blank",F||b.appendChild(q)}b.__resizeListeners__.push(p)};_t.exports=typeof window=="undefined"?y:y.bind(window),_t.exports.unbind=function(V,b){var p=document.attachEvent,G=V.__resizeListeners__||[];if(b){var S=G.indexOf(b);S!==-1&&G.splice(S,1)}else G=V.__resizeListeners__=[];if(!G.length){if(p)V.detachEvent("onresize",O);else if(V.__resizeTrigger__){var F=V.__resizeTrigger__.contentDocument,te=F&&F.defaultView;te&&(te.removeEventListener("resize",O),delete te.__resizeTrigger__),V.__resizeTrigger__=!V.removeChild(V.__resizeTrigger__)}delete V.__resizeListeners__}}},85910:function(_t){"use strict";var O=Object.prototype.hasOwnProperty,y="~";function V(){}Object.create&&(V.prototype=Object.create(null),new V().__proto__||(y=!1));function b(F,te,ce){this.fn=F,this.context=te,this.once=ce||!1}function p(F,te,ce,q,we){if(typeof ce!="function")throw new TypeError("The listener must be a function");var Pe=new b(ce,q||F,we),Be=y?y+te:te;return F._events[Be]?F._events[Be].fn?F._events[Be]=[F._events[Be],Pe]:F._events[Be].push(Pe):(F._events[Be]=Pe,F._eventsCount++),F}function G(F,te){--F._eventsCount==0?F._events=new V:delete F._events[te]}function S(){this._events=new V,this._eventsCount=0}S.prototype.eventNames=function(){var te=[],ce,q;if(this._eventsCount===0)return te;for(q in ce=this._events)O.call(ce,q)&&te.push(y?q.slice(1):q);return Object.getOwnPropertySymbols?te.concat(Object.getOwnPropertySymbols(ce)):te},S.prototype.listeners=function(te){var ce=y?y+te:te,q=this._events[ce];if(!q)return[];if(q.fn)return[q.fn];for(var we=0,Pe=q.length,Be=new Array(Pe);we<Pe;we++)Be[we]=q[we].fn;return Be},S.prototype.listenerCount=function(te){var ce=y?y+te:te,q=this._events[ce];return q?q.fn?1:q.length:0},S.prototype.emit=function(te,ce,q,we,Pe,Be){var Oe=y?y+te:te;if(!this._events[Oe])return!1;var Nt=this._events[Oe],Xt=arguments.length,Bt,Qe;if(Nt.fn){switch(Nt.once&&this.removeListener(te,Nt.fn,void 0,!0),Xt){case 1:return Nt.fn.call(Nt.context),!0;case 2:return Nt.fn.call(Nt.context,ce),!0;case 3:return Nt.fn.call(Nt.context,ce,q),!0;case 4:return Nt.fn.call(Nt.context,ce,q,we),!0;case 5:return Nt.fn.call(Nt.context,ce,q,we,Pe),!0;case 6:return Nt.fn.call(Nt.context,ce,q,we,Pe,Be),!0}for(Qe=1,Bt=new Array(Xt-1);Qe<Xt;Qe++)Bt[Qe-1]=arguments[Qe];Nt.fn.apply(Nt.context,Bt)}else{var xt=Nt.length,nt;for(Qe=0;Qe<xt;Qe++)switch(Nt[Qe].once&&this.removeListener(te,Nt[Qe].fn,void 0,!0),Xt){case 1:Nt[Qe].fn.call(Nt[Qe].context);break;case 2:Nt[Qe].fn.call(Nt[Qe].context,ce);break;case 3:Nt[Qe].fn.call(Nt[Qe].context,ce,q);break;case 4:Nt[Qe].fn.call(Nt[Qe].context,ce,q,we);break;default:if(!Bt)for(nt=1,Bt=new Array(Xt-1);nt<Xt;nt++)Bt[nt-1]=arguments[nt];Nt[Qe].fn.apply(Nt[Qe].context,Bt)}}return!0},S.prototype.on=function(te,ce,q){return p(this,te,ce,q,!1)},S.prototype.once=function(te,ce,q){return p(this,te,ce,q,!0)},S.prototype.removeListener=function(te,ce,q,we){var Pe=y?y+te:te;if(!this._events[Pe])return this;if(!ce)return G(this,Pe),this;var Be=this._events[Pe];if(Be.fn)Be.fn===ce&&(!we||Be.once)&&(!q||Be.context===q)&&G(this,Pe);else{for(var Oe=0,Nt=[],Xt=Be.length;Oe<Xt;Oe++)(Be[Oe].fn!==ce||we&&!Be[Oe].once||q&&Be[Oe].context!==q)&&Nt.push(Be[Oe]);Nt.length?this._events[Pe]=Nt.length===1?Nt[0]:Nt:G(this,Pe)}return this},S.prototype.removeAllListeners=function(te){var ce;return te?(ce=y?y+te:te,this._events[ce]&&G(this,ce)):(this._events=new V,this._eventsCount=0),this},S.prototype.off=S.prototype.removeListener,S.prototype.addListener=S.prototype.on,S.prefixed=y,S.EventEmitter=S,_t.exports=S},52371:function(_t,O,y){"use strict";y.d(O,{Ib:function(){return V},WT:function(){return b},FD:function(){return p}});var V=1e-6,b=typeof Float32Array!="undefined"?Float32Array:Array,p=Math.random;function G(ce){b=ce}var S=Math.PI/180;function F(ce){return ce*S}function te(ce,q){return Math.abs(ce-q)<=V*Math.max(1,Math.abs(ce),Math.abs(q))}Math.hypot||(Math.hypot=function(){for(var ce=0,q=arguments.length;q--;)ce+=arguments[q]*arguments[q];return Math.sqrt(ce)})},29327:function(_t,O,y){"use strict";y.r(O),y.d(O,{create:function(){return b},clone:function(){return p},copy:function(){return G},fromValues:function(){return S},set:function(){return F},identity:function(){return te},transpose:function(){return ce},invert:function(){return q},adjoint:function(){return we},determinant:function(){return Pe},multiply:function(){return Be},translate:function(){return Oe},scale:function(){return Nt},rotate:function(){return Xt},rotateX:function(){return Bt},rotateY:function(){return Qe},rotateZ:function(){return xt},fromTranslation:function(){return nt},fromScaling:function(){return cr},fromRotation:function(){return At},fromXRotation:function(){return Gt},fromYRotation:function(){return St},fromZRotation:function(){return Ze},fromRotationTranslation:function(){return yt},fromQuat2:function(){return Me},getTranslation:function(){return Te},getScaling:function(){return Ie},getRotation:function(){return bt},fromRotationTranslationScale:function(){return tr},fromRotationTranslationScaleOrigin:function(){return ae},fromQuat:function(){return Ee},frustum:function(){return le},perspective:function(){return Q},perspectiveFromFieldOfView:function(){return re},ortho:function(){return ke},lookAt:function(){return qe},targetTo:function(){return Wt},str:function(){return Or},frob:function(){return wr},add:function(){return Nr},subtract:function(){return Vt},multiplyScalar:function(){return se},multiplyScalarAndAdd:function(){return _e},exactEquals:function(){return Le},equals:function(){return ot},mul:function(){return Rt},sub:function(){return jt}});var V=y(52371);function b(){var w=new V.WT(16);return V.WT!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=0,w[12]=0,w[13]=0,w[14]=0),w[0]=1,w[5]=1,w[10]=1,w[15]=1,w}function p(w){var N=new V.WT(16);return N[0]=w[0],N[1]=w[1],N[2]=w[2],N[3]=w[3],N[4]=w[4],N[5]=w[5],N[6]=w[6],N[7]=w[7],N[8]=w[8],N[9]=w[9],N[10]=w[10],N[11]=w[11],N[12]=w[12],N[13]=w[13],N[14]=w[14],N[15]=w[15],N}function G(w,N){return w[0]=N[0],w[1]=N[1],w[2]=N[2],w[3]=N[3],w[4]=N[4],w[5]=N[5],w[6]=N[6],w[7]=N[7],w[8]=N[8],w[9]=N[9],w[10]=N[10],w[11]=N[11],w[12]=N[12],w[13]=N[13],w[14]=N[14],w[15]=N[15],w}function S(w,N,ve,Ae,Je,st,Lt,X,Tt,Kt,hr,_r,Ar,Rr,et,gt){var dt=new V.WT(16);return dt[0]=w,dt[1]=N,dt[2]=ve,dt[3]=Ae,dt[4]=Je,dt[5]=st,dt[6]=Lt,dt[7]=X,dt[8]=Tt,dt[9]=Kt,dt[10]=hr,dt[11]=_r,dt[12]=Ar,dt[13]=Rr,dt[14]=et,dt[15]=gt,dt}function F(w,N,ve,Ae,Je,st,Lt,X,Tt,Kt,hr,_r,Ar,Rr,et,gt,dt){return w[0]=N,w[1]=ve,w[2]=Ae,w[3]=Je,w[4]=st,w[5]=Lt,w[6]=X,w[7]=Tt,w[8]=Kt,w[9]=hr,w[10]=_r,w[11]=Ar,w[12]=Rr,w[13]=et,w[14]=gt,w[15]=dt,w}function te(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function ce(w,N){if(w===N){var ve=N[1],Ae=N[2],Je=N[3],st=N[6],Lt=N[7],X=N[11];w[1]=N[4],w[2]=N[8],w[3]=N[12],w[4]=ve,w[6]=N[9],w[7]=N[13],w[8]=Ae,w[9]=st,w[11]=N[14],w[12]=Je,w[13]=Lt,w[14]=X}else w[0]=N[0],w[1]=N[4],w[2]=N[8],w[3]=N[12],w[4]=N[1],w[5]=N[5],w[6]=N[9],w[7]=N[13],w[8]=N[2],w[9]=N[6],w[10]=N[10],w[11]=N[14],w[12]=N[3],w[13]=N[7],w[14]=N[11],w[15]=N[15];return w}function q(w,N){var ve=N[0],Ae=N[1],Je=N[2],st=N[3],Lt=N[4],X=N[5],Tt=N[6],Kt=N[7],hr=N[8],_r=N[9],Ar=N[10],Rr=N[11],et=N[12],gt=N[13],dt=N[14],fr=N[15],$r=ve*X-Ae*Lt,mt=ve*Tt-Je*Lt,Dt=ve*Kt-st*Lt,ar=Ae*Tt-Je*X,sr=Ae*Kt-st*X,yn=Je*Kt-st*Tt,_n=hr*gt-_r*et,ai=hr*dt-Ar*et,vi=hr*fr-Rr*et,Di=_r*dt-Ar*gt,Zi=_r*fr-Rr*gt,oi=Ar*fr-Rr*dt,$=$r*oi-mt*Zi+Dt*Di+ar*vi-sr*ai+yn*_n;return $?($=1/$,w[0]=(X*oi-Tt*Zi+Kt*Di)*$,w[1]=(Je*Zi-Ae*oi-st*Di)*$,w[2]=(gt*yn-dt*sr+fr*ar)*$,w[3]=(Ar*sr-_r*yn-Rr*ar)*$,w[4]=(Tt*vi-Lt*oi-Kt*ai)*$,w[5]=(ve*oi-Je*vi+st*ai)*$,w[6]=(dt*Dt-et*yn-fr*mt)*$,w[7]=(hr*yn-Ar*Dt+Rr*mt)*$,w[8]=(Lt*Zi-X*vi+Kt*_n)*$,w[9]=(Ae*vi-ve*Zi-st*_n)*$,w[10]=(et*sr-gt*Dt+fr*$r)*$,w[11]=(_r*Dt-hr*sr-Rr*$r)*$,w[12]=(X*ai-Lt*Di-Tt*_n)*$,w[13]=(ve*Di-Ae*ai+Je*_n)*$,w[14]=(gt*mt-et*ar-dt*$r)*$,w[15]=(hr*ar-_r*mt+Ar*$r)*$,w):null}function we(w,N){var ve=N[0],Ae=N[1],Je=N[2],st=N[3],Lt=N[4],X=N[5],Tt=N[6],Kt=N[7],hr=N[8],_r=N[9],Ar=N[10],Rr=N[11],et=N[12],gt=N[13],dt=N[14],fr=N[15];return w[0]=X*(Ar*fr-Rr*dt)-_r*(Tt*fr-Kt*dt)+gt*(Tt*Rr-Kt*Ar),w[1]=-(Ae*(Ar*fr-Rr*dt)-_r*(Je*fr-st*dt)+gt*(Je*Rr-st*Ar)),w[2]=Ae*(Tt*fr-Kt*dt)-X*(Je*fr-st*dt)+gt*(Je*Kt-st*Tt),w[3]=-(Ae*(Tt*Rr-Kt*Ar)-X*(Je*Rr-st*Ar)+_r*(Je*Kt-st*Tt)),w[4]=-(Lt*(Ar*fr-Rr*dt)-hr*(Tt*fr-Kt*dt)+et*(Tt*Rr-Kt*Ar)),w[5]=ve*(Ar*fr-Rr*dt)-hr*(Je*fr-st*dt)+et*(Je*Rr-st*Ar),w[6]=-(ve*(Tt*fr-Kt*dt)-Lt*(Je*fr-st*dt)+et*(Je*Kt-st*Tt)),w[7]=ve*(Tt*Rr-Kt*Ar)-Lt*(Je*Rr-st*Ar)+hr*(Je*Kt-st*Tt),w[8]=Lt*(_r*fr-Rr*gt)-hr*(X*fr-Kt*gt)+et*(X*Rr-Kt*_r),w[9]=-(ve*(_r*fr-Rr*gt)-hr*(Ae*fr-st*gt)+et*(Ae*Rr-st*_r)),w[10]=ve*(X*fr-Kt*gt)-Lt*(Ae*fr-st*gt)+et*(Ae*Kt-st*X),w[11]=-(ve*(X*Rr-Kt*_r)-Lt*(Ae*Rr-st*_r)+hr*(Ae*Kt-st*X)),w[12]=-(Lt*(_r*dt-Ar*gt)-hr*(X*dt-Tt*gt)+et*(X*Ar-Tt*_r)),w[13]=ve*(_r*dt-Ar*gt)-hr*(Ae*dt-Je*gt)+et*(Ae*Ar-Je*_r),w[14]=-(ve*(X*dt-Tt*gt)-Lt*(Ae*dt-Je*gt)+et*(Ae*Tt-Je*X)),w[15]=ve*(X*Ar-Tt*_r)-Lt*(Ae*Ar-Je*_r)+hr*(Ae*Tt-Je*X),w}function Pe(w){var N=w[0],ve=w[1],Ae=w[2],Je=w[3],st=w[4],Lt=w[5],X=w[6],Tt=w[7],Kt=w[8],hr=w[9],_r=w[10],Ar=w[11],Rr=w[12],et=w[13],gt=w[14],dt=w[15],fr=N*Lt-ve*st,$r=N*X-Ae*st,mt=N*Tt-Je*st,Dt=ve*X-Ae*Lt,ar=ve*Tt-Je*Lt,sr=Ae*Tt-Je*X,yn=Kt*et-hr*Rr,_n=Kt*gt-_r*Rr,ai=Kt*dt-Ar*Rr,vi=hr*gt-_r*et,Di=hr*dt-Ar*et,Zi=_r*dt-Ar*gt;return fr*Zi-$r*Di+mt*vi+Dt*ai-ar*_n+sr*yn}function Be(w,N,ve){var Ae=N[0],Je=N[1],st=N[2],Lt=N[3],X=N[4],Tt=N[5],Kt=N[6],hr=N[7],_r=N[8],Ar=N[9],Rr=N[10],et=N[11],gt=N[12],dt=N[13],fr=N[14],$r=N[15],mt=ve[0],Dt=ve[1],ar=ve[2],sr=ve[3];return w[0]=mt*Ae+Dt*X+ar*_r+sr*gt,w[1]=mt*Je+Dt*Tt+ar*Ar+sr*dt,w[2]=mt*st+Dt*Kt+ar*Rr+sr*fr,w[3]=mt*Lt+Dt*hr+ar*et+sr*$r,mt=ve[4],Dt=ve[5],ar=ve[6],sr=ve[7],w[4]=mt*Ae+Dt*X+ar*_r+sr*gt,w[5]=mt*Je+Dt*Tt+ar*Ar+sr*dt,w[6]=mt*st+Dt*Kt+ar*Rr+sr*fr,w[7]=mt*Lt+Dt*hr+ar*et+sr*$r,mt=ve[8],Dt=ve[9],ar=ve[10],sr=ve[11],w[8]=mt*Ae+Dt*X+ar*_r+sr*gt,w[9]=mt*Je+Dt*Tt+ar*Ar+sr*dt,w[10]=mt*st+Dt*Kt+ar*Rr+sr*fr,w[11]=mt*Lt+Dt*hr+ar*et+sr*$r,mt=ve[12],Dt=ve[13],ar=ve[14],sr=ve[15],w[12]=mt*Ae+Dt*X+ar*_r+sr*gt,w[13]=mt*Je+Dt*Tt+ar*Ar+sr*dt,w[14]=mt*st+Dt*Kt+ar*Rr+sr*fr,w[15]=mt*Lt+Dt*hr+ar*et+sr*$r,w}function Oe(w,N,ve){var Ae=ve[0],Je=ve[1],st=ve[2],Lt,X,Tt,Kt,hr,_r,Ar,Rr,et,gt,dt,fr;return N===w?(w[12]=N[0]*Ae+N[4]*Je+N[8]*st+N[12],w[13]=N[1]*Ae+N[5]*Je+N[9]*st+N[13],w[14]=N[2]*Ae+N[6]*Je+N[10]*st+N[14],w[15]=N[3]*Ae+N[7]*Je+N[11]*st+N[15]):(Lt=N[0],X=N[1],Tt=N[2],Kt=N[3],hr=N[4],_r=N[5],Ar=N[6],Rr=N[7],et=N[8],gt=N[9],dt=N[10],fr=N[11],w[0]=Lt,w[1]=X,w[2]=Tt,w[3]=Kt,w[4]=hr,w[5]=_r,w[6]=Ar,w[7]=Rr,w[8]=et,w[9]=gt,w[10]=dt,w[11]=fr,w[12]=Lt*Ae+hr*Je+et*st+N[12],w[13]=X*Ae+_r*Je+gt*st+N[13],w[14]=Tt*Ae+Ar*Je+dt*st+N[14],w[15]=Kt*Ae+Rr*Je+fr*st+N[15]),w}function Nt(w,N,ve){var Ae=ve[0],Je=ve[1],st=ve[2];return w[0]=N[0]*Ae,w[1]=N[1]*Ae,w[2]=N[2]*Ae,w[3]=N[3]*Ae,w[4]=N[4]*Je,w[5]=N[5]*Je,w[6]=N[6]*Je,w[7]=N[7]*Je,w[8]=N[8]*st,w[9]=N[9]*st,w[10]=N[10]*st,w[11]=N[11]*st,w[12]=N[12],w[13]=N[13],w[14]=N[14],w[15]=N[15],w}function Xt(w,N,ve,Ae){var Je=Ae[0],st=Ae[1],Lt=Ae[2],X=Math.hypot(Je,st,Lt),Tt,Kt,hr,_r,Ar,Rr,et,gt,dt,fr,$r,mt,Dt,ar,sr,yn,_n,ai,vi,Di,Zi,oi,$,I;return X<V.Ib?null:(X=1/X,Je*=X,st*=X,Lt*=X,Tt=Math.sin(ve),Kt=Math.cos(ve),hr=1-Kt,_r=N[0],Ar=N[1],Rr=N[2],et=N[3],gt=N[4],dt=N[5],fr=N[6],$r=N[7],mt=N[8],Dt=N[9],ar=N[10],sr=N[11],yn=Je*Je*hr+Kt,_n=st*Je*hr+Lt*Tt,ai=Lt*Je*hr-st*Tt,vi=Je*st*hr-Lt*Tt,Di=st*st*hr+Kt,Zi=Lt*st*hr+Je*Tt,oi=Je*Lt*hr+st*Tt,$=st*Lt*hr-Je*Tt,I=Lt*Lt*hr+Kt,w[0]=_r*yn+gt*_n+mt*ai,w[1]=Ar*yn+dt*_n+Dt*ai,w[2]=Rr*yn+fr*_n+ar*ai,w[3]=et*yn+$r*_n+sr*ai,w[4]=_r*vi+gt*Di+mt*Zi,w[5]=Ar*vi+dt*Di+Dt*Zi,w[6]=Rr*vi+fr*Di+ar*Zi,w[7]=et*vi+$r*Di+sr*Zi,w[8]=_r*oi+gt*$+mt*I,w[9]=Ar*oi+dt*$+Dt*I,w[10]=Rr*oi+fr*$+ar*I,w[11]=et*oi+$r*$+sr*I,N!==w&&(w[12]=N[12],w[13]=N[13],w[14]=N[14],w[15]=N[15]),w)}function Bt(w,N,ve){var Ae=Math.sin(ve),Je=Math.cos(ve),st=N[4],Lt=N[5],X=N[6],Tt=N[7],Kt=N[8],hr=N[9],_r=N[10],Ar=N[11];return N!==w&&(w[0]=N[0],w[1]=N[1],w[2]=N[2],w[3]=N[3],w[12]=N[12],w[13]=N[13],w[14]=N[14],w[15]=N[15]),w[4]=st*Je+Kt*Ae,w[5]=Lt*Je+hr*Ae,w[6]=X*Je+_r*Ae,w[7]=Tt*Je+Ar*Ae,w[8]=Kt*Je-st*Ae,w[9]=hr*Je-Lt*Ae,w[10]=_r*Je-X*Ae,w[11]=Ar*Je-Tt*Ae,w}function Qe(w,N,ve){var Ae=Math.sin(ve),Je=Math.cos(ve),st=N[0],Lt=N[1],X=N[2],Tt=N[3],Kt=N[8],hr=N[9],_r=N[10],Ar=N[11];return N!==w&&(w[4]=N[4],w[5]=N[5],w[6]=N[6],w[7]=N[7],w[12]=N[12],w[13]=N[13],w[14]=N[14],w[15]=N[15]),w[0]=st*Je-Kt*Ae,w[1]=Lt*Je-hr*Ae,w[2]=X*Je-_r*Ae,w[3]=Tt*Je-Ar*Ae,w[8]=st*Ae+Kt*Je,w[9]=Lt*Ae+hr*Je,w[10]=X*Ae+_r*Je,w[11]=Tt*Ae+Ar*Je,w}function xt(w,N,ve){var Ae=Math.sin(ve),Je=Math.cos(ve),st=N[0],Lt=N[1],X=N[2],Tt=N[3],Kt=N[4],hr=N[5],_r=N[6],Ar=N[7];return N!==w&&(w[8]=N[8],w[9]=N[9],w[10]=N[10],w[11]=N[11],w[12]=N[12],w[13]=N[13],w[14]=N[14],w[15]=N[15]),w[0]=st*Je+Kt*Ae,w[1]=Lt*Je+hr*Ae,w[2]=X*Je+_r*Ae,w[3]=Tt*Je+Ar*Ae,w[4]=Kt*Je-st*Ae,w[5]=hr*Je-Lt*Ae,w[6]=_r*Je-X*Ae,w[7]=Ar*Je-Tt*Ae,w}function nt(w,N){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=N[0],w[13]=N[1],w[14]=N[2],w[15]=1,w}function cr(w,N){return w[0]=N[0],w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=N[1],w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=N[2],w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function At(w,N,ve){var Ae=ve[0],Je=ve[1],st=ve[2],Lt=Math.hypot(Ae,Je,st),X,Tt,Kt;return Lt<V.Ib?null:(Lt=1/Lt,Ae*=Lt,Je*=Lt,st*=Lt,X=Math.sin(N),Tt=Math.cos(N),Kt=1-Tt,w[0]=Ae*Ae*Kt+Tt,w[1]=Je*Ae*Kt+st*X,w[2]=st*Ae*Kt-Je*X,w[3]=0,w[4]=Ae*Je*Kt-st*X,w[5]=Je*Je*Kt+Tt,w[6]=st*Je*Kt+Ae*X,w[7]=0,w[8]=Ae*st*Kt+Je*X,w[9]=Je*st*Kt-Ae*X,w[10]=st*st*Kt+Tt,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w)}function Gt(w,N){var ve=Math.sin(N),Ae=Math.cos(N);return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Ae,w[6]=ve,w[7]=0,w[8]=0,w[9]=-ve,w[10]=Ae,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function St(w,N){var ve=Math.sin(N),Ae=Math.cos(N);return w[0]=Ae,w[1]=0,w[2]=-ve,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=ve,w[9]=0,w[10]=Ae,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Ze(w,N){var ve=Math.sin(N),Ae=Math.cos(N);return w[0]=Ae,w[1]=ve,w[2]=0,w[3]=0,w[4]=-ve,w[5]=Ae,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function yt(w,N,ve){var Ae=N[0],Je=N[1],st=N[2],Lt=N[3],X=Ae+Ae,Tt=Je+Je,Kt=st+st,hr=Ae*X,_r=Ae*Tt,Ar=Ae*Kt,Rr=Je*Tt,et=Je*Kt,gt=st*Kt,dt=Lt*X,fr=Lt*Tt,$r=Lt*Kt;return w[0]=1-(Rr+gt),w[1]=_r+$r,w[2]=Ar-fr,w[3]=0,w[4]=_r-$r,w[5]=1-(hr+gt),w[6]=et+dt,w[7]=0,w[8]=Ar+fr,w[9]=et-dt,w[10]=1-(hr+Rr),w[11]=0,w[12]=ve[0],w[13]=ve[1],w[14]=ve[2],w[15]=1,w}function Me(w,N){var ve=new V.WT(3),Ae=-N[0],Je=-N[1],st=-N[2],Lt=N[3],X=N[4],Tt=N[5],Kt=N[6],hr=N[7],_r=Ae*Ae+Je*Je+st*st+Lt*Lt;return _r>0?(ve[0]=(X*Lt+hr*Ae+Tt*st-Kt*Je)*2/_r,ve[1]=(Tt*Lt+hr*Je+Kt*Ae-X*st)*2/_r,ve[2]=(Kt*Lt+hr*st+X*Je-Tt*Ae)*2/_r):(ve[0]=(X*Lt+hr*Ae+Tt*st-Kt*Je)*2,ve[1]=(Tt*Lt+hr*Je+Kt*Ae-X*st)*2,ve[2]=(Kt*Lt+hr*st+X*Je-Tt*Ae)*2),yt(w,N,ve),w}function Te(w,N){return w[0]=N[12],w[1]=N[13],w[2]=N[14],w}function Ie(w,N){var ve=N[0],Ae=N[1],Je=N[2],st=N[4],Lt=N[5],X=N[6],Tt=N[8],Kt=N[9],hr=N[10];return w[0]=Math.hypot(ve,Ae,Je),w[1]=Math.hypot(st,Lt,X),w[2]=Math.hypot(Tt,Kt,hr),w}function bt(w,N){var ve=new V.WT(3);Ie(ve,N);var Ae=1/ve[0],Je=1/ve[1],st=1/ve[2],Lt=N[0]*Ae,X=N[1]*Je,Tt=N[2]*st,Kt=N[4]*Ae,hr=N[5]*Je,_r=N[6]*st,Ar=N[8]*Ae,Rr=N[9]*Je,et=N[10]*st,gt=Lt+hr+et,dt=0;return gt>0?(dt=Math.sqrt(gt+1)*2,w[3]=.25*dt,w[0]=(_r-Rr)/dt,w[1]=(Ar-Tt)/dt,w[2]=(X-Kt)/dt):Lt>hr&&Lt>et?(dt=Math.sqrt(1+Lt-hr-et)*2,w[3]=(_r-Rr)/dt,w[0]=.25*dt,w[1]=(X+Kt)/dt,w[2]=(Ar+Tt)/dt):hr>et?(dt=Math.sqrt(1+hr-Lt-et)*2,w[3]=(Ar-Tt)/dt,w[0]=(X+Kt)/dt,w[1]=.25*dt,w[2]=(_r+Rr)/dt):(dt=Math.sqrt(1+et-Lt-hr)*2,w[3]=(X-Kt)/dt,w[0]=(Ar+Tt)/dt,w[1]=(_r+Rr)/dt,w[2]=.25*dt),w}function tr(w,N,ve,Ae){var Je=N[0],st=N[1],Lt=N[2],X=N[3],Tt=Je+Je,Kt=st+st,hr=Lt+Lt,_r=Je*Tt,Ar=Je*Kt,Rr=Je*hr,et=st*Kt,gt=st*hr,dt=Lt*hr,fr=X*Tt,$r=X*Kt,mt=X*hr,Dt=Ae[0],ar=Ae[1],sr=Ae[2];return w[0]=(1-(et+dt))*Dt,w[1]=(Ar+mt)*Dt,w[2]=(Rr-$r)*Dt,w[3]=0,w[4]=(Ar-mt)*ar,w[5]=(1-(_r+dt))*ar,w[6]=(gt+fr)*ar,w[7]=0,w[8]=(Rr+$r)*sr,w[9]=(gt-fr)*sr,w[10]=(1-(_r+et))*sr,w[11]=0,w[12]=ve[0],w[13]=ve[1],w[14]=ve[2],w[15]=1,w}function ae(w,N,ve,Ae,Je){var st=N[0],Lt=N[1],X=N[2],Tt=N[3],Kt=st+st,hr=Lt+Lt,_r=X+X,Ar=st*Kt,Rr=st*hr,et=st*_r,gt=Lt*hr,dt=Lt*_r,fr=X*_r,$r=Tt*Kt,mt=Tt*hr,Dt=Tt*_r,ar=Ae[0],sr=Ae[1],yn=Ae[2],_n=Je[0],ai=Je[1],vi=Je[2],Di=(1-(gt+fr))*ar,Zi=(Rr+Dt)*ar,oi=(et-mt)*ar,$=(Rr-Dt)*sr,I=(1-(Ar+fr))*sr,j=(dt+$r)*sr,Y=(et+mt)*yn,ue=(dt-$r)*yn,De=(1-(Ar+gt))*yn;return w[0]=Di,w[1]=Zi,w[2]=oi,w[3]=0,w[4]=$,w[5]=I,w[6]=j,w[7]=0,w[8]=Y,w[9]=ue,w[10]=De,w[11]=0,w[12]=ve[0]+_n-(Di*_n+$*ai+Y*vi),w[13]=ve[1]+ai-(Zi*_n+I*ai+ue*vi),w[14]=ve[2]+vi-(oi*_n+j*ai+De*vi),w[15]=1,w}function Ee(w,N){var ve=N[0],Ae=N[1],Je=N[2],st=N[3],Lt=ve+ve,X=Ae+Ae,Tt=Je+Je,Kt=ve*Lt,hr=Ae*Lt,_r=Ae*X,Ar=Je*Lt,Rr=Je*X,et=Je*Tt,gt=st*Lt,dt=st*X,fr=st*Tt;return w[0]=1-_r-et,w[1]=hr+fr,w[2]=Ar-dt,w[3]=0,w[4]=hr-fr,w[5]=1-Kt-et,w[6]=Rr+gt,w[7]=0,w[8]=Ar+dt,w[9]=Rr-gt,w[10]=1-Kt-_r,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function le(w,N,ve,Ae,Je,st,Lt){var X=1/(ve-N),Tt=1/(Je-Ae),Kt=1/(st-Lt);return w[0]=st*2*X,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=st*2*Tt,w[6]=0,w[7]=0,w[8]=(ve+N)*X,w[9]=(Je+Ae)*Tt,w[10]=(Lt+st)*Kt,w[11]=-1,w[12]=0,w[13]=0,w[14]=Lt*st*2*Kt,w[15]=0,w}function Q(w,N,ve,Ae,Je){var st=1/Math.tan(N/2),Lt;return w[0]=st/ve,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=st,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,Je!=null&&Je!==Infinity?(Lt=1/(Ae-Je),w[10]=(Je+Ae)*Lt,w[14]=2*Je*Ae*Lt):(w[10]=-1,w[14]=-2*Ae),w}function re(w,N,ve,Ae){var Je=Math.tan(N.upDegrees*Math.PI/180),st=Math.tan(N.downDegrees*Math.PI/180),Lt=Math.tan(N.leftDegrees*Math.PI/180),X=Math.tan(N.rightDegrees*Math.PI/180),Tt=2/(Lt+X),Kt=2/(Je+st);return w[0]=Tt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Kt,w[6]=0,w[7]=0,w[8]=-((Lt-X)*Tt*.5),w[9]=(Je-st)*Kt*.5,w[10]=Ae/(ve-Ae),w[11]=-1,w[12]=0,w[13]=0,w[14]=Ae*ve/(ve-Ae),w[15]=0,w}function ke(w,N,ve,Ae,Je,st,Lt){var X=1/(N-ve),Tt=1/(Ae-Je),Kt=1/(st-Lt);return w[0]=-2*X,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*Tt,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=2*Kt,w[11]=0,w[12]=(N+ve)*X,w[13]=(Je+Ae)*Tt,w[14]=(Lt+st)*Kt,w[15]=1,w}function qe(w,N,ve,Ae){var Je,st,Lt,X,Tt,Kt,hr,_r,Ar,Rr,et=N[0],gt=N[1],dt=N[2],fr=Ae[0],$r=Ae[1],mt=Ae[2],Dt=ve[0],ar=ve[1],sr=ve[2];return Math.abs(et-Dt)<V.Ib&&Math.abs(gt-ar)<V.Ib&&Math.abs(dt-sr)<V.Ib?te(w):(hr=et-Dt,_r=gt-ar,Ar=dt-sr,Rr=1/Math.hypot(hr,_r,Ar),hr*=Rr,_r*=Rr,Ar*=Rr,Je=$r*Ar-mt*_r,st=mt*hr-fr*Ar,Lt=fr*_r-$r*hr,Rr=Math.hypot(Je,st,Lt),Rr?(Rr=1/Rr,Je*=Rr,st*=Rr,Lt*=Rr):(Je=0,st=0,Lt=0),X=_r*Lt-Ar*st,Tt=Ar*Je-hr*Lt,Kt=hr*st-_r*Je,Rr=Math.hypot(X,Tt,Kt),Rr?(Rr=1/Rr,X*=Rr,Tt*=Rr,Kt*=Rr):(X=0,Tt=0,Kt=0),w[0]=Je,w[1]=X,w[2]=hr,w[3]=0,w[4]=st,w[5]=Tt,w[6]=_r,w[7]=0,w[8]=Lt,w[9]=Kt,w[10]=Ar,w[11]=0,w[12]=-(Je*et+st*gt+Lt*dt),w[13]=-(X*et+Tt*gt+Kt*dt),w[14]=-(hr*et+_r*gt+Ar*dt),w[15]=1,w)}function Wt(w,N,ve,Ae){var Je=N[0],st=N[1],Lt=N[2],X=Ae[0],Tt=Ae[1],Kt=Ae[2],hr=Je-ve[0],_r=st-ve[1],Ar=Lt-ve[2],Rr=hr*hr+_r*_r+Ar*Ar;Rr>0&&(Rr=1/Math.sqrt(Rr),hr*=Rr,_r*=Rr,Ar*=Rr);var et=Tt*Ar-Kt*_r,gt=Kt*hr-X*Ar,dt=X*_r-Tt*hr;return Rr=et*et+gt*gt+dt*dt,Rr>0&&(Rr=1/Math.sqrt(Rr),et*=Rr,gt*=Rr,dt*=Rr),w[0]=et,w[1]=gt,w[2]=dt,w[3]=0,w[4]=_r*dt-Ar*gt,w[5]=Ar*et-hr*dt,w[6]=hr*gt-_r*et,w[7]=0,w[8]=hr,w[9]=_r,w[10]=Ar,w[11]=0,w[12]=Je,w[13]=st,w[14]=Lt,w[15]=1,w}function Or(w){return"mat4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+", "+w[4]+", "+w[5]+", "+w[6]+", "+w[7]+", "+w[8]+", "+w[9]+", "+w[10]+", "+w[11]+", "+w[12]+", "+w[13]+", "+w[14]+", "+w[15]+")"}function wr(w){return Math.hypot(w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15])}function Nr(w,N,ve){return w[0]=N[0]+ve[0],w[1]=N[1]+ve[1],w[2]=N[2]+ve[2],w[3]=N[3]+ve[3],w[4]=N[4]+ve[4],w[5]=N[5]+ve[5],w[6]=N[6]+ve[6],w[7]=N[7]+ve[7],w[8]=N[8]+ve[8],w[9]=N[9]+ve[9],w[10]=N[10]+ve[10],w[11]=N[11]+ve[11],w[12]=N[12]+ve[12],w[13]=N[13]+ve[13],w[14]=N[14]+ve[14],w[15]=N[15]+ve[15],w}function Vt(w,N,ve){return w[0]=N[0]-ve[0],w[1]=N[1]-ve[1],w[2]=N[2]-ve[2],w[3]=N[3]-ve[3],w[4]=N[4]-ve[4],w[5]=N[5]-ve[5],w[6]=N[6]-ve[6],w[7]=N[7]-ve[7],w[8]=N[8]-ve[8],w[9]=N[9]-ve[9],w[10]=N[10]-ve[10],w[11]=N[11]-ve[11],w[12]=N[12]-ve[12],w[13]=N[13]-ve[13],w[14]=N[14]-ve[14],w[15]=N[15]-ve[15],w}function se(w,N,ve){return w[0]=N[0]*ve,w[1]=N[1]*ve,w[2]=N[2]*ve,w[3]=N[3]*ve,w[4]=N[4]*ve,w[5]=N[5]*ve,w[6]=N[6]*ve,w[7]=N[7]*ve,w[8]=N[8]*ve,w[9]=N[9]*ve,w[10]=N[10]*ve,w[11]=N[11]*ve,w[12]=N[12]*ve,w[13]=N[13]*ve,w[14]=N[14]*ve,w[15]=N[15]*ve,w}function _e(w,N,ve,Ae){return w[0]=N[0]+ve[0]*Ae,w[1]=N[1]+ve[1]*Ae,w[2]=N[2]+ve[2]*Ae,w[3]=N[3]+ve[3]*Ae,w[4]=N[4]+ve[4]*Ae,w[5]=N[5]+ve[5]*Ae,w[6]=N[6]+ve[6]*Ae,w[7]=N[7]+ve[7]*Ae,w[8]=N[8]+ve[8]*Ae,w[9]=N[9]+ve[9]*Ae,w[10]=N[10]+ve[10]*Ae,w[11]=N[11]+ve[11]*Ae,w[12]=N[12]+ve[12]*Ae,w[13]=N[13]+ve[13]*Ae,w[14]=N[14]+ve[14]*Ae,w[15]=N[15]+ve[15]*Ae,w}function Le(w,N){return w[0]===N[0]&&w[1]===N[1]&&w[2]===N[2]&&w[3]===N[3]&&w[4]===N[4]&&w[5]===N[5]&&w[6]===N[6]&&w[7]===N[7]&&w[8]===N[8]&&w[9]===N[9]&&w[10]===N[10]&&w[11]===N[11]&&w[12]===N[12]&&w[13]===N[13]&&w[14]===N[14]&&w[15]===N[15]}function ot(w,N){var ve=w[0],Ae=w[1],Je=w[2],st=w[3],Lt=w[4],X=w[5],Tt=w[6],Kt=w[7],hr=w[8],_r=w[9],Ar=w[10],Rr=w[11],et=w[12],gt=w[13],dt=w[14],fr=w[15],$r=N[0],mt=N[1],Dt=N[2],ar=N[3],sr=N[4],yn=N[5],_n=N[6],ai=N[7],vi=N[8],Di=N[9],Zi=N[10],oi=N[11],$=N[12],I=N[13],j=N[14],Y=N[15];return Math.abs(ve-$r)<=V.Ib*Math.max(1,Math.abs(ve),Math.abs($r))&&Math.abs(Ae-mt)<=V.Ib*Math.max(1,Math.abs(Ae),Math.abs(mt))&&Math.abs(Je-Dt)<=V.Ib*Math.max(1,Math.abs(Je),Math.abs(Dt))&&Math.abs(st-ar)<=V.Ib*Math.max(1,Math.abs(st),Math.abs(ar))&&Math.abs(Lt-sr)<=V.Ib*Math.max(1,Math.abs(Lt),Math.abs(sr))&&Math.abs(X-yn)<=V.Ib*Math.max(1,Math.abs(X),Math.abs(yn))&&Math.abs(Tt-_n)<=V.Ib*Math.max(1,Math.abs(Tt),Math.abs(_n))&&Math.abs(Kt-ai)<=V.Ib*Math.max(1,Math.abs(Kt),Math.abs(ai))&&Math.abs(hr-vi)<=V.Ib*Math.max(1,Math.abs(hr),Math.abs(vi))&&Math.abs(_r-Di)<=V.Ib*Math.max(1,Math.abs(_r),Math.abs(Di))&&Math.abs(Ar-Zi)<=V.Ib*Math.max(1,Math.abs(Ar),Math.abs(Zi))&&Math.abs(Rr-oi)<=V.Ib*Math.max(1,Math.abs(Rr),Math.abs(oi))&&Math.abs(et-$)<=V.Ib*Math.max(1,Math.abs(et),Math.abs($))&&Math.abs(gt-I)<=V.Ib*Math.max(1,Math.abs(gt),Math.abs(I))&&Math.abs(dt-j)<=V.Ib*Math.max(1,Math.abs(dt),Math.abs(j))&&Math.abs(fr-Y)<=V.Ib*Math.max(1,Math.abs(fr),Math.abs(Y))}var Rt=Be,jt=Vt},85263:function(_t,O,y){"use strict";y.d(O,{Ue:function(){return b},al:function(){return G},bA:function(){return Bt},fF:function(){return bt}});var V=y(52371);function b(){var se=new V.WT(4);return V.WT!=Float32Array&&(se[0]=0,se[1]=0,se[2]=0,se[3]=0),se}function p(se){var _e=new glMatrix.ARRAY_TYPE(4);return _e[0]=se[0],_e[1]=se[1],_e[2]=se[2],_e[3]=se[3],_e}function G(se,_e,Le,ot){var Rt=new V.WT(4);return Rt[0]=se,Rt[1]=_e,Rt[2]=Le,Rt[3]=ot,Rt}function S(se,_e){return se[0]=_e[0],se[1]=_e[1],se[2]=_e[2],se[3]=_e[3],se}function F(se,_e,Le,ot,Rt){return se[0]=_e,se[1]=Le,se[2]=ot,se[3]=Rt,se}function te(se,_e,Le){return se[0]=_e[0]+Le[0],se[1]=_e[1]+Le[1],se[2]=_e[2]+Le[2],se[3]=_e[3]+Le[3],se}function ce(se,_e,Le){return se[0]=_e[0]-Le[0],se[1]=_e[1]-Le[1],se[2]=_e[2]-Le[2],se[3]=_e[3]-Le[3],se}function q(se,_e,Le){return se[0]=_e[0]*Le[0],se[1]=_e[1]*Le[1],se[2]=_e[2]*Le[2],se[3]=_e[3]*Le[3],se}function we(se,_e,Le){return se[0]=_e[0]/Le[0],se[1]=_e[1]/Le[1],se[2]=_e[2]/Le[2],se[3]=_e[3]/Le[3],se}function Pe(se,_e){return se[0]=Math.ceil(_e[0]),se[1]=Math.ceil(_e[1]),se[2]=Math.ceil(_e[2]),se[3]=Math.ceil(_e[3]),se}function Be(se,_e){return se[0]=Math.floor(_e[0]),se[1]=Math.floor(_e[1]),se[2]=Math.floor(_e[2]),se[3]=Math.floor(_e[3]),se}function Oe(se,_e,Le){return se[0]=Math.min(_e[0],Le[0]),se[1]=Math.min(_e[1],Le[1]),se[2]=Math.min(_e[2],Le[2]),se[3]=Math.min(_e[3],Le[3]),se}function Nt(se,_e,Le){return se[0]=Math.max(_e[0],Le[0]),se[1]=Math.max(_e[1],Le[1]),se[2]=Math.max(_e[2],Le[2]),se[3]=Math.max(_e[3],Le[3]),se}function Xt(se,_e){return se[0]=Math.round(_e[0]),se[1]=Math.round(_e[1]),se[2]=Math.round(_e[2]),se[3]=Math.round(_e[3]),se}function Bt(se,_e,Le){return se[0]=_e[0]*Le,se[1]=_e[1]*Le,se[2]=_e[2]*Le,se[3]=_e[3]*Le,se}function Qe(se,_e,Le,ot){return se[0]=_e[0]+Le[0]*ot,se[1]=_e[1]+Le[1]*ot,se[2]=_e[2]+Le[2]*ot,se[3]=_e[3]+Le[3]*ot,se}function xt(se,_e){var Le=_e[0]-se[0],ot=_e[1]-se[1],Rt=_e[2]-se[2],jt=_e[3]-se[3];return Math.hypot(Le,ot,Rt,jt)}function nt(se,_e){var Le=_e[0]-se[0],ot=_e[1]-se[1],Rt=_e[2]-se[2],jt=_e[3]-se[3];return Le*Le+ot*ot+Rt*Rt+jt*jt}function cr(se){var _e=se[0],Le=se[1],ot=se[2],Rt=se[3];return Math.hypot(_e,Le,ot,Rt)}function At(se){var _e=se[0],Le=se[1],ot=se[2],Rt=se[3];return _e*_e+Le*Le+ot*ot+Rt*Rt}function Gt(se,_e){return se[0]=-_e[0],se[1]=-_e[1],se[2]=-_e[2],se[3]=-_e[3],se}function St(se,_e){return se[0]=1/_e[0],se[1]=1/_e[1],se[2]=1/_e[2],se[3]=1/_e[3],se}function Ze(se,_e){var Le=_e[0],ot=_e[1],Rt=_e[2],jt=_e[3],w=Le*Le+ot*ot+Rt*Rt+jt*jt;return w>0&&(w=1/Math.sqrt(w)),se[0]=Le*w,se[1]=ot*w,se[2]=Rt*w,se[3]=jt*w,se}function yt(se,_e){return se[0]*_e[0]+se[1]*_e[1]+se[2]*_e[2]+se[3]*_e[3]}function Me(se,_e,Le,ot){var Rt=Le[0]*ot[1]-Le[1]*ot[0],jt=Le[0]*ot[2]-Le[2]*ot[0],w=Le[0]*ot[3]-Le[3]*ot[0],N=Le[1]*ot[2]-Le[2]*ot[1],ve=Le[1]*ot[3]-Le[3]*ot[1],Ae=Le[2]*ot[3]-Le[3]*ot[2],Je=_e[0],st=_e[1],Lt=_e[2],X=_e[3];return se[0]=st*Ae-Lt*ve+X*N,se[1]=-(Je*Ae)+Lt*w-X*jt,se[2]=Je*ve-st*w+X*Rt,se[3]=-(Je*N)+st*jt-Lt*Rt,se}function Te(se,_e,Le,ot){var Rt=_e[0],jt=_e[1],w=_e[2],N=_e[3];return se[0]=Rt+ot*(Le[0]-Rt),se[1]=jt+ot*(Le[1]-jt),se[2]=w+ot*(Le[2]-w),se[3]=N+ot*(Le[3]-N),se}function Ie(se,_e){_e=_e||1;var Le,ot,Rt,jt,w,N;do Le=glMatrix.RANDOM()*2-1,ot=glMatrix.RANDOM()*2-1,w=Le*Le+ot*ot;while(w>=1);do Rt=glMatrix.RANDOM()*2-1,jt=glMatrix.RANDOM()*2-1,N=Rt*Rt+jt*jt;while(N>=1);var ve=Math.sqrt((1-w)/N);return se[0]=_e*Le,se[1]=_e*ot,se[2]=_e*Rt*ve,se[3]=_e*jt*ve,se}function bt(se,_e,Le){var ot=_e[0],Rt=_e[1],jt=_e[2],w=_e[3];return se[0]=Le[0]*ot+Le[4]*Rt+Le[8]*jt+Le[12]*w,se[1]=Le[1]*ot+Le[5]*Rt+Le[9]*jt+Le[13]*w,se[2]=Le[2]*ot+Le[6]*Rt+Le[10]*jt+Le[14]*w,se[3]=Le[3]*ot+Le[7]*Rt+Le[11]*jt+Le[15]*w,se}function tr(se,_e,Le){var ot=_e[0],Rt=_e[1],jt=_e[2],w=Le[0],N=Le[1],ve=Le[2],Ae=Le[3],Je=Ae*ot+N*jt-ve*Rt,st=Ae*Rt+ve*ot-w*jt,Lt=Ae*jt+w*Rt-N*ot,X=-w*ot-N*Rt-ve*jt;return se[0]=Je*Ae+X*-w+st*-ve-Lt*-N,se[1]=st*Ae+X*-N+Lt*-w-Je*-ve,se[2]=Lt*Ae+X*-ve+Je*-N-st*-w,se[3]=_e[3],se}function ae(se){return se[0]=0,se[1]=0,se[2]=0,se[3]=0,se}function Ee(se){return"vec4("+se[0]+", "+se[1]+", "+se[2]+", "+se[3]+")"}function le(se,_e){return se[0]===_e[0]&&se[1]===_e[1]&&se[2]===_e[2]&&se[3]===_e[3]}function Q(se,_e){var Le=se[0],ot=se[1],Rt=se[2],jt=se[3],w=_e[0],N=_e[1],ve=_e[2],Ae=_e[3];return Math.abs(Le-w)<=glMatrix.EPSILON*Math.max(1,Math.abs(Le),Math.abs(w))&&Math.abs(ot-N)<=glMatrix.EPSILON*Math.max(1,Math.abs(ot),Math.abs(N))&&Math.abs(Rt-ve)<=glMatrix.EPSILON*Math.max(1,Math.abs(Rt),Math.abs(ve))&&Math.abs(jt-Ae)<=glMatrix.EPSILON*Math.max(1,Math.abs(jt),Math.abs(Ae))}var re=null,ke=null,qe=null,Wt=null,Or=null,wr=null,Nr=null,Vt=function(){var se=b();return function(_e,Le,ot,Rt,jt,w){var N,ve;for(Le||(Le=4),ot||(ot=0),Rt?ve=Math.min(Rt*Le+ot,_e.length):ve=_e.length,N=ot;N<ve;N+=Le)se[0]=_e[N],se[1]=_e[N+1],se[2]=_e[N+2],se[3]=_e[N+3],jt(se,se,w),_e[N]=se[0],_e[N+1]=se[1],_e[N+2]=se[2],_e[N+3]=se[3];return _e}}()},68420:function(_t,O,y){var V;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(b,p,G,S){"use strict";var F=["","webkit","Moz","MS","ms","o"],te=p.createElement("div"),ce="function",q=Math.round,we=Math.abs,Pe=Date.now;function Be(it,pe,Ke){return setTimeout(cr(it,Ke),pe)}function Oe(it,pe,Ke){return Array.isArray(it)?(Nt(it,Ke[pe],Ke),!0):!1}function Nt(it,pe,Ke){var qt;if(!!it)if(it.forEach)it.forEach(pe,Ke);else if(it.length!==S)for(qt=0;qt<it.length;)pe.call(Ke,it[qt],qt,it),qt++;else for(qt in it)it.hasOwnProperty(qt)&&pe.call(Ke,it[qt],qt,it)}function Xt(it,pe,Ke){var qt="DEPRECATED METHOD: "+pe+`
`+Ke+` AT 
`;return function(){var Wr=new Error("get-stack-trace"),bn=Wr&&Wr.stack?Wr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",xi=b.console&&(b.console.warn||b.console.log);return xi&&xi.call(b.console,qt,bn),it.apply(this,arguments)}}var Bt;typeof Object.assign!="function"?Bt=function(pe){if(pe===S||pe===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ke=Object(pe),qt=1;qt<arguments.length;qt++){var Wr=arguments[qt];if(Wr!==S&&Wr!==null)for(var bn in Wr)Wr.hasOwnProperty(bn)&&(Ke[bn]=Wr[bn])}return Ke}:Bt=Object.assign;var Qe=Xt(function(pe,Ke,qt){for(var Wr=Object.keys(Ke),bn=0;bn<Wr.length;)(!qt||qt&&pe[Wr[bn]]===S)&&(pe[Wr[bn]]=Ke[Wr[bn]]),bn++;return pe},"extend","Use `assign`."),xt=Xt(function(pe,Ke){return Qe(pe,Ke,!0)},"merge","Use `assign`.");function nt(it,pe,Ke){var qt=pe.prototype,Wr;Wr=it.prototype=Object.create(qt),Wr.constructor=it,Wr._super=qt,Ke&&Bt(Wr,Ke)}function cr(it,pe){return function(){return it.apply(pe,arguments)}}function At(it,pe){return typeof it==ce?it.apply(pe&&pe[0]||S,pe):it}function Gt(it,pe){return it===S?pe:it}function St(it,pe,Ke){Nt(Te(pe),function(qt){it.addEventListener(qt,Ke,!1)})}function Ze(it,pe,Ke){Nt(Te(pe),function(qt){it.removeEventListener(qt,Ke,!1)})}function yt(it,pe){for(;it;){if(it==pe)return!0;it=it.parentNode}return!1}function Me(it,pe){return it.indexOf(pe)>-1}function Te(it){return it.trim().split(/\s+/g)}function Ie(it,pe,Ke){if(it.indexOf&&!Ke)return it.indexOf(pe);for(var qt=0;qt<it.length;){if(Ke&&it[qt][Ke]==pe||!Ke&&it[qt]===pe)return qt;qt++}return-1}function bt(it){return Array.prototype.slice.call(it,0)}function tr(it,pe,Ke){for(var qt=[],Wr=[],bn=0;bn<it.length;){var xi=pe?it[bn][pe]:it[bn];Ie(Wr,xi)<0&&qt.push(it[bn]),Wr[bn]=xi,bn++}return Ke&&(pe?qt=qt.sort(function(Vi,Wa){return Vi[pe]>Wa[pe]}):qt=qt.sort()),qt}function ae(it,pe){for(var Ke,qt,Wr=pe[0].toUpperCase()+pe.slice(1),bn=0;bn<F.length;){if(Ke=F[bn],qt=Ke?Ke+Wr:pe,qt in it)return qt;bn++}return S}var Ee=1;function le(){return Ee++}function Q(it){var pe=it.ownerDocument||it;return pe.defaultView||pe.parentWindow||b}var re=/mobile|tablet|ip(ad|hone|od)|android/i,ke="ontouchstart"in b,qe=ae(b,"PointerEvent")!==S,Wt=ke&&re.test(navigator.userAgent),Or="touch",wr="pen",Nr="mouse",Vt="kinect",se=25,_e=1,Le=2,ot=4,Rt=8,jt=1,w=2,N=4,ve=8,Ae=16,Je=w|N,st=ve|Ae,Lt=Je|st,X=["x","y"],Tt=["clientX","clientY"];function Kt(it,pe){var Ke=this;this.manager=it,this.callback=pe,this.element=it.element,this.target=it.options.inputTarget,this.domHandler=function(qt){At(it.options.enable,[it])&&Ke.handler(qt)},this.init()}Kt.prototype={handler:function(){},init:function(){this.evEl&&St(this.element,this.evEl,this.domHandler),this.evTarget&&St(this.target,this.evTarget,this.domHandler),this.evWin&&St(Q(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ze(this.element,this.evEl,this.domHandler),this.evTarget&&Ze(this.target,this.evTarget,this.domHandler),this.evWin&&Ze(Q(this.element),this.evWin,this.domHandler)}};function hr(it){var pe,Ke=it.options.inputClass;return Ke?pe=Ke:qe?pe=I:Wt?pe=Ct:ke?pe=yr:pe=vi,new pe(it,_r)}function _r(it,pe,Ke){var qt=Ke.pointers.length,Wr=Ke.changedPointers.length,bn=pe&_e&&qt-Wr==0,xi=pe&(ot|Rt)&&qt-Wr==0;Ke.isFirst=!!bn,Ke.isFinal=!!xi,bn&&(it.session={}),Ke.eventType=pe,Ar(it,Ke),it.emit("hammer.input",Ke),it.recognize(Ke),it.session.prevInput=Ke}function Ar(it,pe){var Ke=it.session,qt=pe.pointers,Wr=qt.length;Ke.firstInput||(Ke.firstInput=gt(pe)),Wr>1&&!Ke.firstMultiple?Ke.firstMultiple=gt(pe):Wr===1&&(Ke.firstMultiple=!1);var bn=Ke.firstInput,xi=Ke.firstMultiple,_a=xi?xi.center:bn.center,Vi=pe.center=dt(qt);pe.timeStamp=Pe(),pe.deltaTime=pe.timeStamp-bn.timeStamp,pe.angle=Dt(_a,Vi),pe.distance=mt(_a,Vi),Rr(Ke,pe),pe.offsetDirection=$r(pe.deltaX,pe.deltaY);var Wa=fr(pe.deltaTime,pe.deltaX,pe.deltaY);pe.overallVelocityX=Wa.x,pe.overallVelocityY=Wa.y,pe.overallVelocity=we(Wa.x)>we(Wa.y)?Wa.x:Wa.y,pe.scale=xi?sr(xi.pointers,qt):1,pe.rotation=xi?ar(xi.pointers,qt):0,pe.maxPointers=Ke.prevInput?pe.pointers.length>Ke.prevInput.maxPointers?pe.pointers.length:Ke.prevInput.maxPointers:pe.pointers.length,et(Ke,pe);var ko=it.element;yt(pe.srcEvent.target,ko)&&(ko=pe.srcEvent.target),pe.target=ko}function Rr(it,pe){var Ke=pe.center,qt=it.offsetDelta||{},Wr=it.prevDelta||{},bn=it.prevInput||{};(pe.eventType===_e||bn.eventType===ot)&&(Wr=it.prevDelta={x:bn.deltaX||0,y:bn.deltaY||0},qt=it.offsetDelta={x:Ke.x,y:Ke.y}),pe.deltaX=Wr.x+(Ke.x-qt.x),pe.deltaY=Wr.y+(Ke.y-qt.y)}function et(it,pe){var Ke=it.lastInterval||pe,qt=pe.timeStamp-Ke.timeStamp,Wr,bn,xi,_a;if(pe.eventType!=Rt&&(qt>se||Ke.velocity===S)){var Vi=pe.deltaX-Ke.deltaX,Wa=pe.deltaY-Ke.deltaY,ko=fr(qt,Vi,Wa);bn=ko.x,xi=ko.y,Wr=we(ko.x)>we(ko.y)?ko.x:ko.y,_a=$r(Vi,Wa),it.lastInterval=pe}else Wr=Ke.velocity,bn=Ke.velocityX,xi=Ke.velocityY,_a=Ke.direction;pe.velocity=Wr,pe.velocityX=bn,pe.velocityY=xi,pe.direction=_a}function gt(it){for(var pe=[],Ke=0;Ke<it.pointers.length;)pe[Ke]={clientX:q(it.pointers[Ke].clientX),clientY:q(it.pointers[Ke].clientY)},Ke++;return{timeStamp:Pe(),pointers:pe,center:dt(pe),deltaX:it.deltaX,deltaY:it.deltaY}}function dt(it){var pe=it.length;if(pe===1)return{x:q(it[0].clientX),y:q(it[0].clientY)};for(var Ke=0,qt=0,Wr=0;Wr<pe;)Ke+=it[Wr].clientX,qt+=it[Wr].clientY,Wr++;return{x:q(Ke/pe),y:q(qt/pe)}}function fr(it,pe,Ke){return{x:pe/it||0,y:Ke/it||0}}function $r(it,pe){return it===pe?jt:we(it)>=we(pe)?it<0?w:N:pe<0?ve:Ae}function mt(it,pe,Ke){Ke||(Ke=X);var qt=pe[Ke[0]]-it[Ke[0]],Wr=pe[Ke[1]]-it[Ke[1]];return Math.sqrt(qt*qt+Wr*Wr)}function Dt(it,pe,Ke){Ke||(Ke=X);var qt=pe[Ke[0]]-it[Ke[0]],Wr=pe[Ke[1]]-it[Ke[1]];return Math.atan2(Wr,qt)*180/Math.PI}function ar(it,pe){return Dt(pe[1],pe[0],Tt)+Dt(it[1],it[0],Tt)}function sr(it,pe){return mt(pe[0],pe[1],Tt)/mt(it[0],it[1],Tt)}var yn={mousedown:_e,mousemove:Le,mouseup:ot},_n="mousedown",ai="mousemove mouseup";function vi(){this.evEl=_n,this.evWin=ai,this.pressed=!1,Kt.apply(this,arguments)}nt(vi,Kt,{handler:function(pe){var Ke=yn[pe.type];Ke&_e&&pe.button===0&&(this.pressed=!0),Ke&Le&&pe.which!==1&&(Ke=ot),!!this.pressed&&(Ke&ot&&(this.pressed=!1),this.callback(this.manager,Ke,{pointers:[pe],changedPointers:[pe],pointerType:Nr,srcEvent:pe}))}});var Di={pointerdown:_e,pointermove:Le,pointerup:ot,pointercancel:Rt,pointerout:Rt},Zi={2:Or,3:wr,4:Nr,5:Vt},oi="pointerdown",$="pointermove pointerup pointercancel";b.MSPointerEvent&&!b.PointerEvent&&(oi="MSPointerDown",$="MSPointerMove MSPointerUp MSPointerCancel");function I(){this.evEl=oi,this.evWin=$,Kt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}nt(I,Kt,{handler:function(pe){var Ke=this.store,qt=!1,Wr=pe.type.toLowerCase().replace("ms",""),bn=Di[Wr],xi=Zi[pe.pointerType]||pe.pointerType,_a=xi==Or,Vi=Ie(Ke,pe.pointerId,"pointerId");bn&_e&&(pe.button===0||_a)?Vi<0&&(Ke.push(pe),Vi=Ke.length-1):bn&(ot|Rt)&&(qt=!0),!(Vi<0)&&(Ke[Vi]=pe,this.callback(this.manager,bn,{pointers:Ke,changedPointers:[pe],pointerType:xi,srcEvent:pe}),qt&&Ke.splice(Vi,1))}});var j={touchstart:_e,touchmove:Le,touchend:ot,touchcancel:Rt},Y="touchstart",ue="touchstart touchmove touchend touchcancel";function De(){this.evTarget=Y,this.evWin=ue,this.started=!1,Kt.apply(this,arguments)}nt(De,Kt,{handler:function(pe){var Ke=j[pe.type];if(Ke===_e&&(this.started=!0),!!this.started){var qt=He.call(this,pe,Ke);Ke&(ot|Rt)&&qt[0].length-qt[1].length==0&&(this.started=!1),this.callback(this.manager,Ke,{pointers:qt[0],changedPointers:qt[1],pointerType:Or,srcEvent:pe})}}});function He(it,pe){var Ke=bt(it.touches),qt=bt(it.changedTouches);return pe&(ot|Rt)&&(Ke=tr(Ke.concat(qt),"identifier",!0)),[Ke,qt]}var he={touchstart:_e,touchmove:Le,touchend:ot,touchcancel:Rt},Ne="touchstart touchmove touchend touchcancel";function Ct(){this.evTarget=Ne,this.targetIds={},Kt.apply(this,arguments)}nt(Ct,Kt,{handler:function(pe){var Ke=he[pe.type],qt=kr.call(this,pe,Ke);!qt||this.callback(this.manager,Ke,{pointers:qt[0],changedPointers:qt[1],pointerType:Or,srcEvent:pe})}});function kr(it,pe){var Ke=bt(it.touches),qt=this.targetIds;if(pe&(_e|Le)&&Ke.length===1)return qt[Ke[0].identifier]=!0,[Ke,Ke];var Wr,bn,xi=bt(it.changedTouches),_a=[],Vi=this.target;if(bn=Ke.filter(function(Wa){return yt(Wa.target,Vi)}),pe===_e)for(Wr=0;Wr<bn.length;)qt[bn[Wr].identifier]=!0,Wr++;for(Wr=0;Wr<xi.length;)qt[xi[Wr].identifier]&&_a.push(xi[Wr]),pe&(ot|Rt)&&delete qt[xi[Wr].identifier],Wr++;if(!!_a.length)return[tr(bn.concat(_a),"identifier",!0),_a]}var jr=2500,$t=25;function yr(){Kt.apply(this,arguments);var it=cr(this.handler,this);this.touch=new Ct(this.manager,it),this.mouse=new vi(this.manager,it),this.primaryTouch=null,this.lastTouches=[]}nt(yr,Kt,{handler:function(pe,Ke,qt){var Wr=qt.pointerType==Or,bn=qt.pointerType==Nr;if(!(bn&&qt.sourceCapabilities&&qt.sourceCapabilities.firesTouchEvents)){if(Wr)qr.call(this,Ke,qt);else if(bn&&dr.call(this,qt))return;this.callback(pe,Ke,qt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function qr(it,pe){it&_e?(this.primaryTouch=pe.changedPointers[0].identifier,gn.call(this,pe)):it&(ot|Rt)&&gn.call(this,pe)}function gn(it){var pe=it.changedPointers[0];if(pe.identifier===this.primaryTouch){var Ke={x:pe.clientX,y:pe.clientY};this.lastTouches.push(Ke);var qt=this.lastTouches,Wr=function(){var xi=qt.indexOf(Ke);xi>-1&&qt.splice(xi,1)};setTimeout(Wr,jr)}}function dr(it){for(var pe=it.srcEvent.clientX,Ke=it.srcEvent.clientY,qt=0;qt<this.lastTouches.length;qt++){var Wr=this.lastTouches[qt],bn=Math.abs(pe-Wr.x),xi=Math.abs(Ke-Wr.y);if(bn<=$t&&xi<=$t)return!0}return!1}var hn=ae(te.style,"touchAction"),ln=hn!==S,fn="compute",ri="auto",dn="manipulation",ci="none",Bi="pan-x",pi="pan-y",_i=Wi();function Ai(it,pe){this.manager=it,this.set(pe)}Ai.prototype={set:function(pe){pe==fn&&(pe=this.compute()),ln&&this.manager.element.style&&_i[pe]&&(this.manager.element.style[hn]=pe),this.actions=pe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var pe=[];return Nt(this.manager.recognizers,function(Ke){At(Ke.options.enable,[Ke])&&(pe=pe.concat(Ke.getTouchAction()))}),xo(pe.join(" "))},preventDefaults:function(pe){var Ke=pe.srcEvent,qt=pe.offsetDirection;if(this.manager.session.prevented){Ke.preventDefault();return}var Wr=this.actions,bn=Me(Wr,ci)&&!_i[ci],xi=Me(Wr,pi)&&!_i[pi],_a=Me(Wr,Bi)&&!_i[Bi];if(bn){var Vi=pe.pointers.length===1,Wa=pe.distance<2,ko=pe.deltaTime<250;if(Vi&&Wa&&ko)return}if(!(_a&&xi)&&(bn||xi&&qt&Je||_a&&qt&st))return this.preventSrc(Ke)},preventSrc:function(pe){this.manager.session.prevented=!0,pe.preventDefault()}};function xo(it){if(Me(it,ci))return ci;var pe=Me(it,Bi),Ke=Me(it,pi);return pe&&Ke?ci:pe||Ke?pe?Bi:pi:Me(it,dn)?dn:ri}function Wi(){if(!ln)return!1;var it={},pe=b.CSS&&b.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ke){it[Ke]=pe?b.CSS.supports("touch-action",Ke):!0}),it}var mi=1,Fn=2,kn=4,Zn=8,ra=Zn,js=16,ua=32;function Ki(it){this.options=Bt({},this.defaults,it||{}),this.id=le(),this.manager=null,this.options.enable=Gt(this.options.enable,!0),this.state=mi,this.simultaneous={},this.requireFail=[]}Ki.prototype={defaults:{},set:function(pe){return Bt(this.options,pe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(pe){if(Oe(pe,"recognizeWith",this))return this;var Ke=this.simultaneous;return pe=ya(pe,this),Ke[pe.id]||(Ke[pe.id]=pe,pe.recognizeWith(this)),this},dropRecognizeWith:function(pe){return Oe(pe,"dropRecognizeWith",this)?this:(pe=ya(pe,this),delete this.simultaneous[pe.id],this)},requireFailure:function(pe){if(Oe(pe,"requireFailure",this))return this;var Ke=this.requireFail;return pe=ya(pe,this),Ie(Ke,pe)===-1&&(Ke.push(pe),pe.requireFailure(this)),this},dropRequireFailure:function(pe){if(Oe(pe,"dropRequireFailure",this))return this;pe=ya(pe,this);var Ke=Ie(this.requireFail,pe);return Ke>-1&&this.requireFail.splice(Ke,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(pe){return!!this.simultaneous[pe.id]},emit:function(pe){var Ke=this,qt=this.state;function Wr(bn){Ke.manager.emit(bn,pe)}qt<Zn&&Wr(Ke.options.event+mu(qt)),Wr(Ke.options.event),pe.additionalEvent&&Wr(pe.additionalEvent),qt>=Zn&&Wr(Ke.options.event+mu(qt))},tryEmit:function(pe){if(this.canEmit())return this.emit(pe);this.state=ua},canEmit:function(){for(var pe=0;pe<this.requireFail.length;){if(!(this.requireFail[pe].state&(ua|mi)))return!1;pe++}return!0},recognize:function(pe){var Ke=Bt({},pe);if(!At(this.options.enable,[this,Ke])){this.reset(),this.state=ua;return}this.state&(ra|js|ua)&&(this.state=mi),this.state=this.process(Ke),this.state&(Fn|kn|Zn|js)&&this.tryEmit(Ke)},process:function(pe){},getTouchAction:function(){},reset:function(){}};function mu(it){return it&js?"cancel":it&Zn?"end":it&kn?"move":it&Fn?"start":""}function gu(it){return it==Ae?"down":it==ve?"up":it==w?"left":it==N?"right":""}function ya(it,pe){var Ke=pe.manager;return Ke?Ke.get(it):it}function no(){Ki.apply(this,arguments)}nt(no,Ki,{defaults:{pointers:1},attrTest:function(pe){var Ke=this.options.pointers;return Ke===0||pe.pointers.length===Ke},process:function(pe){var Ke=this.state,qt=pe.eventType,Wr=Ke&(Fn|kn),bn=this.attrTest(pe);return Wr&&(qt&Rt||!bn)?Ke|js:Wr||bn?qt&ot?Ke|Zn:Ke&Fn?Ke|kn:Fn:ua}});function Ya(){no.apply(this,arguments),this.pX=null,this.pY=null}nt(Ya,no,{defaults:{event:"pan",threshold:10,pointers:1,direction:Lt},getTouchAction:function(){var pe=this.options.direction,Ke=[];return pe&Je&&Ke.push(pi),pe&st&&Ke.push(Bi),Ke},directionTest:function(pe){var Ke=this.options,qt=!0,Wr=pe.distance,bn=pe.direction,xi=pe.deltaX,_a=pe.deltaY;return bn&Ke.direction||(Ke.direction&Je?(bn=xi===0?jt:xi<0?w:N,qt=xi!=this.pX,Wr=Math.abs(pe.deltaX)):(bn=_a===0?jt:_a<0?ve:Ae,qt=_a!=this.pY,Wr=Math.abs(pe.deltaY))),pe.direction=bn,qt&&Wr>Ke.threshold&&bn&Ke.direction},attrTest:function(pe){return no.prototype.attrTest.call(this,pe)&&(this.state&Fn||!(this.state&Fn)&&this.directionTest(pe))},emit:function(pe){this.pX=pe.deltaX,this.pY=pe.deltaY;var Ke=gu(pe.direction);Ke&&(pe.additionalEvent=this.options.event+Ke),this._super.emit.call(this,pe)}});function Na(){no.apply(this,arguments)}nt(Na,no,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ci]},attrTest:function(pe){return this._super.attrTest.call(this,pe)&&(Math.abs(pe.scale-1)>this.options.threshold||this.state&Fn)},emit:function(pe){if(pe.scale!==1){var Ke=pe.scale<1?"in":"out";pe.additionalEvent=this.options.event+Ke}this._super.emit.call(this,pe)}});function Ho(){Ki.apply(this,arguments),this._timer=null,this._input=null}nt(Ho,Ki,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ri]},process:function(pe){var Ke=this.options,qt=pe.pointers.length===Ke.pointers,Wr=pe.distance<Ke.threshold,bn=pe.deltaTime>Ke.time;if(this._input=pe,!Wr||!qt||pe.eventType&(ot|Rt)&&!bn)this.reset();else if(pe.eventType&_e)this.reset(),this._timer=Be(function(){this.state=ra,this.tryEmit()},Ke.time,this);else if(pe.eventType&ot)return ra;return ua},reset:function(){clearTimeout(this._timer)},emit:function(pe){this.state===ra&&(pe&&pe.eventType&ot?this.manager.emit(this.options.event+"up",pe):(this._input.timeStamp=Pe(),this.manager.emit(this.options.event,this._input)))}});function aa(){no.apply(this,arguments)}nt(aa,no,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ci]},attrTest:function(pe){return this._super.attrTest.call(this,pe)&&(Math.abs(pe.rotation)>this.options.threshold||this.state&Fn)}});function Ga(){no.apply(this,arguments)}nt(Ga,no,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Je|st,pointers:1},getTouchAction:function(){return Ya.prototype.getTouchAction.call(this)},attrTest:function(pe){var Ke=this.options.direction,qt;return Ke&(Je|st)?qt=pe.overallVelocity:Ke&Je?qt=pe.overallVelocityX:Ke&st&&(qt=pe.overallVelocityY),this._super.attrTest.call(this,pe)&&Ke&pe.offsetDirection&&pe.distance>this.options.threshold&&pe.maxPointers==this.options.pointers&&we(qt)>this.options.velocity&&pe.eventType&ot},emit:function(pe){var Ke=gu(pe.offsetDirection);Ke&&this.manager.emit(this.options.event+Ke,pe),this.manager.emit(this.options.event,pe)}});function io(){Ki.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}nt(io,Ki,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[dn]},process:function(pe){var Ke=this.options,qt=pe.pointers.length===Ke.pointers,Wr=pe.distance<Ke.threshold,bn=pe.deltaTime<Ke.time;if(this.reset(),pe.eventType&_e&&this.count===0)return this.failTimeout();if(Wr&&bn&&qt){if(pe.eventType!=ot)return this.failTimeout();var xi=this.pTime?pe.timeStamp-this.pTime<Ke.interval:!0,_a=!this.pCenter||mt(this.pCenter,pe.center)<Ke.posThreshold;this.pTime=pe.timeStamp,this.pCenter=pe.center,!_a||!xi?this.count=1:this.count+=1,this._input=pe;var Vi=this.count%Ke.taps;if(Vi===0)return this.hasRequireFailures()?(this._timer=Be(function(){this.state=ra,this.tryEmit()},Ke.interval,this),Fn):ra}return ua},failTimeout:function(){return this._timer=Be(function(){this.state=ua},this.options.interval,this),ua},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ra&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function oa(it,pe){return pe=pe||{},pe.recognizers=Gt(pe.recognizers,oa.defaults.preset),new ts(it,pe)}oa.VERSION="2.0.7",oa.defaults={domEvents:!1,touchAction:fn,enable:!0,inputTarget:null,inputClass:null,preset:[[aa,{enable:!1}],[Na,{enable:!1},["rotate"]],[Ga,{direction:Je}],[Ya,{direction:Je},["swipe"]],[io],[io,{event:"doubletap",taps:2},["tap"]],[Ho]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var qi=1,Pl=2;function ts(it,pe){this.options=Bt({},oa.defaults,pe||{}),this.options.inputTarget=this.options.inputTarget||it,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=it,this.input=hr(this),this.touchAction=new Ai(this,this.options.touchAction),$a(this,!0),Nt(this.options.recognizers,function(Ke){var qt=this.add(new Ke[0](Ke[1]));Ke[2]&&qt.recognizeWith(Ke[2]),Ke[3]&&qt.requireFailure(Ke[3])},this)}ts.prototype={set:function(pe){return Bt(this.options,pe),pe.touchAction&&this.touchAction.update(),pe.inputTarget&&(this.input.destroy(),this.input.target=pe.inputTarget,this.input.init()),this},stop:function(pe){this.session.stopped=pe?Pl:qi},recognize:function(pe){var Ke=this.session;if(!Ke.stopped){this.touchAction.preventDefaults(pe);var qt,Wr=this.recognizers,bn=Ke.curRecognizer;(!bn||bn&&bn.state&ra)&&(bn=Ke.curRecognizer=null);for(var xi=0;xi<Wr.length;)qt=Wr[xi],Ke.stopped!==Pl&&(!bn||qt==bn||qt.canRecognizeWith(bn))?qt.recognize(pe):qt.reset(),!bn&&qt.state&(Fn|kn|Zn)&&(bn=Ke.curRecognizer=qt),xi++}},get:function(pe){if(pe instanceof Ki)return pe;for(var Ke=this.recognizers,qt=0;qt<Ke.length;qt++)if(Ke[qt].options.event==pe)return Ke[qt];return null},add:function(pe){if(Oe(pe,"add",this))return this;var Ke=this.get(pe.options.event);return Ke&&this.remove(Ke),this.recognizers.push(pe),pe.manager=this,this.touchAction.update(),pe},remove:function(pe){if(Oe(pe,"remove",this))return this;if(pe=this.get(pe),pe){var Ke=this.recognizers,qt=Ie(Ke,pe);qt!==-1&&(Ke.splice(qt,1),this.touchAction.update())}return this},on:function(pe,Ke){if(pe!==S&&Ke!==S){var qt=this.handlers;return Nt(Te(pe),function(Wr){qt[Wr]=qt[Wr]||[],qt[Wr].push(Ke)}),this}},off:function(pe,Ke){if(pe!==S){var qt=this.handlers;return Nt(Te(pe),function(Wr){Ke?qt[Wr]&&qt[Wr].splice(Ie(qt[Wr],Ke),1):delete qt[Wr]}),this}},emit:function(pe,Ke){this.options.domEvents&&Ha(pe,Ke);var qt=this.handlers[pe]&&this.handlers[pe].slice();if(!(!qt||!qt.length)){Ke.type=pe,Ke.preventDefault=function(){Ke.srcEvent.preventDefault()};for(var Wr=0;Wr<qt.length;)qt[Wr](Ke),Wr++}},destroy:function(){this.element&&$a(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function $a(it,pe){var Ke=it.element;if(!!Ke.style){var qt;Nt(it.options.cssProps,function(Wr,bn){qt=ae(Ke.style,bn),pe?(it.oldCssProps[qt]=Ke.style[qt],Ke.style[qt]=Wr):Ke.style[qt]=it.oldCssProps[qt]||""}),pe||(it.oldCssProps={})}}function Ha(it,pe){var Ke=p.createEvent("Event");Ke.initEvent(it,!0,!0),Ke.gesture=pe,pe.target.dispatchEvent(Ke)}Bt(oa,{INPUT_START:_e,INPUT_MOVE:Le,INPUT_END:ot,INPUT_CANCEL:Rt,STATE_POSSIBLE:mi,STATE_BEGAN:Fn,STATE_CHANGED:kn,STATE_ENDED:Zn,STATE_RECOGNIZED:ra,STATE_CANCELLED:js,STATE_FAILED:ua,DIRECTION_NONE:jt,DIRECTION_LEFT:w,DIRECTION_RIGHT:N,DIRECTION_UP:ve,DIRECTION_DOWN:Ae,DIRECTION_HORIZONTAL:Je,DIRECTION_VERTICAL:st,DIRECTION_ALL:Lt,Manager:ts,Input:Kt,TouchAction:Ai,TouchInput:Ct,MouseInput:vi,PointerEventInput:I,TouchMouseInput:yr,SingleTouchInput:De,Recognizer:Ki,AttrRecognizer:no,Tap:io,Pan:Ya,Swipe:Ga,Pinch:Na,Rotate:aa,Press:Ho,on:St,off:Ze,each:Nt,merge:xt,extend:Qe,assign:Bt,inherit:nt,bindFn:cr,prefixed:ae});var la=typeof b!="undefined"?b:typeof self!="undefined"?self:{};la.Hammer=oa,V=function(){return oa}.call(O,y,O,_t),V!==S&&(_t.exports=V)})(window,document,"Hammer")},5397:function(_t,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0});var y=Symbol.for("INJECTION");function V(F,te,ce,q){function we(){return q&&!Reflect.hasMetadata(y,this,te)&&Reflect.defineMetadata(y,ce(),this,te),Reflect.hasMetadata(y,this,te)?Reflect.getMetadata(y,this,te):ce()}function Pe(Be){Reflect.defineMetadata(y,Be,this,te)}Object.defineProperty(F,te,{configurable:!0,enumerable:!0,get:we,set:Pe})}function b(F,te){return function(ce){return function(q,we){var Pe=function(){return F.get(ce)};V(q,we,Pe,te)}}}O.makePropertyInjectDecorator=b;function p(F,te){return function(ce,q){return function(we,Pe){var Be=function(){return F.getNamed(ce,q)};V(we,Pe,Be,te)}}}O.makePropertyInjectNamedDecorator=p;function G(F,te){return function(ce,q,we){return function(Pe,Be){var Oe=function(){return F.getTagged(ce,q,we)};V(Pe,Be,Oe,te)}}}O.makePropertyInjectTaggedDecorator=G;function S(F,te){return function(ce){return function(q,we){var Pe=function(){return F.getAll(ce)};V(q,we,Pe,te)}}}O.makePropertyMultiInjectDecorator=S},3020:function(_t,O,y){"use strict";var V;V={value:!0};var b=y(5397);function p(G,S){S===void 0&&(S=!0);var F=b.makePropertyInjectDecorator(G,S),te=b.makePropertyInjectNamedDecorator(G,S),ce=b.makePropertyInjectTaggedDecorator(G,S),q=b.makePropertyMultiInjectDecorator(G,S);return{lazyInject:F,lazyInjectNamed:te,lazyInjectTagged:ce,lazyMultiInject:q}}O.Z=p},29604:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.tagProperty=O.tagParameter=O.decorate=void 0;var V=y(15251),b=y(86062);function p(q,we,Pe,Be){var Oe=b.TAGGED;S(Oe,q,we,Be,Pe)}O.tagParameter=p;function G(q,we,Pe){var Be=b.TAGGED_PROP;S(Be,q.constructor,we,Pe)}O.tagProperty=G;function S(q,we,Pe,Be,Oe){var Nt={},Xt=typeof Oe=="number",Bt=Oe!==void 0&&Xt?Oe.toString():Pe;if(Xt&&Pe!==void 0)throw new Error(V.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(q,we)&&(Nt=Reflect.getMetadata(q,we));var Qe=Nt[Bt];if(!Array.isArray(Qe))Qe=[];else for(var xt=0,nt=Qe;xt<nt.length;xt++){var cr=nt[xt];if(cr.key===Be.key)throw new Error(V.DUPLICATED_METADATA+" "+cr.key.toString())}Qe.push(Be),Nt[Bt]=Qe,Reflect.defineMetadata(q,Nt,we)}function F(q,we){Reflect.decorate(q,we)}function te(q,we){return function(Pe,Be){we(Pe,Be,q)}}function ce(q,we,Pe){typeof Pe=="number"?F([te(Pe,q)],we):typeof Pe=="string"?Reflect.decorate([q],we,Pe):F([q],we)}O.decorate=ce},89256:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.inject=O.LazyServiceIdentifer=void 0;var V=y(15251),b=y(86062),p=y(38463),G=y(29604),S=function(){function te(ce){this._cb=ce}return te.prototype.unwrap=function(){return this._cb()},te}();O.LazyServiceIdentifer=S;function F(te){return function(ce,q,we){if(te===void 0)throw new Error(V.UNDEFINED_INJECT_ANNOTATION(ce.name));var Pe=new p.Metadata(b.INJECT_TAG,te);typeof we=="number"?G.tagParameter(ce,q,we,Pe):G.tagProperty(ce,q,Pe)}}O.inject=F},14219:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.injectable=void 0;var V=y(15251),b=y(86062);function p(){return function(G){if(Reflect.hasOwnMetadata(b.PARAM_TYPES,G))throw new Error(V.DUPLICATED_INJECTABLE_DECORATOR);var S=Reflect.getMetadata(b.DESIGN_PARAM_TYPES,G)||[];return Reflect.defineMetadata(b.PARAM_TYPES,S,G),G}}O.injectable=p},56777:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.multiInject=void 0;var V=y(86062),b=y(38463),p=y(29604);function G(S){return function(F,te,ce){var q=new b.Metadata(V.MULTI_INJECT_TAG,S);typeof ce=="number"?p.tagParameter(F,te,ce,q):p.tagProperty(F,te,q)}}O.multiInject=G},58476:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.named=void 0;var V=y(86062),b=y(38463),p=y(29604);function G(S){return function(F,te,ce){var q=new b.Metadata(V.NAMED_TAG,S);typeof ce=="number"?p.tagParameter(F,te,ce,q):p.tagProperty(F,te,q)}}O.named=G},33575:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.optional=void 0;var V=y(86062),b=y(38463),p=y(29604);function G(){return function(S,F,te){var ce=new b.Metadata(V.OPTIONAL_TAG,!0);typeof te=="number"?p.tagParameter(S,F,te,ce):p.tagProperty(S,F,ce)}}O.optional=G},71485:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.postConstruct=void 0;var V=y(15251),b=y(86062),p=y(38463);function G(){return function(S,F,te){var ce=new p.Metadata(b.POST_CONSTRUCT,F);if(Reflect.hasOwnMetadata(b.POST_CONSTRUCT,S.constructor))throw new Error(V.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(b.POST_CONSTRUCT,ce,S.constructor)}}O.postConstruct=G},52591:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.tagged=void 0;var V=y(38463),b=y(29604);function p(G,S){return function(F,te,ce){var q=new V.Metadata(G,S);typeof ce=="number"?b.tagParameter(F,te,ce,q):b.tagProperty(F,te,q)}}O.tagged=p},23853:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.targetName=void 0;var V=y(86062),b=y(38463),p=y(29604);function G(S){return function(F,te,ce){var q=new b.Metadata(V.NAME_TAG,S);p.tagParameter(F,te,ce,q)}}O.targetName=G},30588:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.unmanaged=void 0;var V=y(86062),b=y(38463),p=y(29604);function G(){return function(S,F,te){var ce=new b.Metadata(V.UNMANAGED_TAG,!0);p.tagParameter(S,F,te,ce)}}O.unmanaged=G},7590:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Binding=void 0;var V=y(1073),b=y(70758),p=function(){function G(S,F){this.id=b.id(),this.activated=!1,this.serviceIdentifier=S,this.scope=F,this.type=V.BindingTypeEnum.Invalid,this.constraint=function(te){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return G.prototype.clone=function(){var S=new G(this.serviceIdentifier,this.scope);return S.activated=S.scope===V.BindingScopeEnum.Singleton?this.activated:!1,S.implementationType=this.implementationType,S.dynamicValue=this.dynamicValue,S.scope=this.scope,S.type=this.type,S.factory=this.factory,S.provider=this.provider,S.constraint=this.constraint,S.onActivation=this.onActivation,S.cache=this.cache,S},G}();O.Binding=p},76764:function(_t,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingCount=void 0;var y={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};O.BindingCount=y},15251:function(_t,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.STACK_OVERFLOW=O.CIRCULAR_DEPENDENCY_IN_FACTORY=O.POST_CONSTRUCT_ERROR=O.MULTIPLE_POST_CONSTRUCT_METHODS=O.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=O.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=O.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=O.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=O.ARGUMENTS_LENGTH_MISMATCH=O.INVALID_DECORATOR_OPERATION=O.INVALID_TO_SELF_VALUE=O.INVALID_FUNCTION_BINDING=O.INVALID_MIDDLEWARE_RETURN=O.NO_MORE_SNAPSHOTS_AVAILABLE=O.INVALID_BINDING_TYPE=O.NOT_IMPLEMENTED=O.CIRCULAR_DEPENDENCY=O.UNDEFINED_INJECT_ANNOTATION=O.MISSING_INJECT_ANNOTATION=O.MISSING_INJECTABLE_ANNOTATION=O.NOT_REGISTERED=O.CANNOT_UNBIND=O.AMBIGUOUS_MATCH=O.KEY_NOT_FOUND=O.NULL_ARGUMENT=O.DUPLICATED_METADATA=O.DUPLICATED_INJECTABLE_DECORATOR=void 0,O.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",O.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",O.NULL_ARGUMENT="NULL argument",O.KEY_NOT_FOUND="Key Not Found",O.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",O.CANNOT_UNBIND="Could not unbind serviceIdentifier:",O.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",O.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",O.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var y=function(S){return"@inject called with undefined this could mean that the class "+S+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};O.UNDEFINED_INJECT_ANNOTATION=y,O.CIRCULAR_DEPENDENCY="Circular dependency found:",O.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",O.INVALID_BINDING_TYPE="Invalid binding type:",O.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",O.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",O.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",O.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",O.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var V=function(){for(var S=[],F=0;F<arguments.length;F++)S[F]=arguments[F];return"The number of constructor arguments in the derived class "+(S[0]+" must be >= than the number of constructor arguments of its base class.")};O.ARGUMENTS_LENGTH_MISMATCH=V,O.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",O.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",O.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",O.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",O.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var b=function(){for(var S=[],F=0;F<arguments.length;F++)S[F]=arguments[F];return"@postConstruct error in class "+S[0]+": "+S[1]};O.POST_CONSTRUCT_ERROR=b;var p=function(){for(var S=[],F=0;F<arguments.length;F++)S[F]=arguments[F];return"It looks like there is a circular dependency "+("in one of the '"+S[0]+"' bindings. Please investigate bindings with")+("service identifier '"+S[1]+"'.")};O.CIRCULAR_DEPENDENCY_IN_FACTORY=p,O.STACK_OVERFLOW="Maximum call stack size exceeded"},1073:function(_t,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.TargetTypeEnum=O.BindingTypeEnum=O.BindingScopeEnum=void 0;var y={Request:"Request",Singleton:"Singleton",Transient:"Transient"};O.BindingScopeEnum=y;var V={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};O.BindingTypeEnum=V;var b={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};O.TargetTypeEnum=b},86062:function(_t,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.NON_CUSTOM_TAG_KEYS=O.POST_CONSTRUCT=O.DESIGN_PARAM_TYPES=O.PARAM_TYPES=O.TAGGED_PROP=O.TAGGED=O.MULTI_INJECT_TAG=O.INJECT_TAG=O.OPTIONAL_TAG=O.UNMANAGED_TAG=O.NAME_TAG=O.NAMED_TAG=void 0,O.NAMED_TAG="named",O.NAME_TAG="name",O.UNMANAGED_TAG="unmanaged",O.OPTIONAL_TAG="optional",O.INJECT_TAG="inject",O.MULTI_INJECT_TAG="multi_inject",O.TAGGED="inversify:tagged",O.TAGGED_PROP="inversify:tagged_props",O.PARAM_TYPES="inversify:paramtypes",O.DESIGN_PARAM_TYPES="design:paramtypes",O.POST_CONSTRUCT="post_construct";function y(){return[O.INJECT_TAG,O.MULTI_INJECT_TAG,O.NAME_TAG,O.UNMANAGED_TAG,O.NAMED_TAG,O.OPTIONAL_TAG]}O.NON_CUSTOM_TAG_KEYS=y()},51539:function(_t,O,y){"use strict";var V=this&&this.__awaiter||function(Qe,xt,nt,cr){function At(Gt){return Gt instanceof nt?Gt:new nt(function(St){St(Gt)})}return new(nt||(nt=Promise))(function(Gt,St){function Ze(Te){try{Me(cr.next(Te))}catch(Ie){St(Ie)}}function yt(Te){try{Me(cr.throw(Te))}catch(Ie){St(Ie)}}function Me(Te){Te.done?Gt(Te.value):At(Te.value).then(Ze,yt)}Me((cr=cr.apply(Qe,xt||[])).next())})},b=this&&this.__generator||function(Qe,xt){var nt={label:0,sent:function(){if(Gt[0]&1)throw Gt[1];return Gt[1]},trys:[],ops:[]},cr,At,Gt,St;return St={next:Ze(0),throw:Ze(1),return:Ze(2)},typeof Symbol=="function"&&(St[Symbol.iterator]=function(){return this}),St;function Ze(Me){return function(Te){return yt([Me,Te])}}function yt(Me){if(cr)throw new TypeError("Generator is already executing.");for(;nt;)try{if(cr=1,At&&(Gt=Me[0]&2?At.return:Me[0]?At.throw||((Gt=At.return)&&Gt.call(At),0):At.next)&&!(Gt=Gt.call(At,Me[1])).done)return Gt;switch(At=0,Gt&&(Me=[Me[0]&2,Gt.value]),Me[0]){case 0:case 1:Gt=Me;break;case 4:return nt.label++,{value:Me[1],done:!1};case 5:nt.label++,At=Me[1],Me=[0];continue;case 7:Me=nt.ops.pop(),nt.trys.pop();continue;default:if(Gt=nt.trys,!(Gt=Gt.length>0&&Gt[Gt.length-1])&&(Me[0]===6||Me[0]===2)){nt=0;continue}if(Me[0]===3&&(!Gt||Me[1]>Gt[0]&&Me[1]<Gt[3])){nt.label=Me[1];break}if(Me[0]===6&&nt.label<Gt[1]){nt.label=Gt[1],Gt=Me;break}if(Gt&&nt.label<Gt[2]){nt.label=Gt[2],nt.ops.push(Me);break}Gt[2]&&nt.ops.pop(),nt.trys.pop();continue}Me=xt.call(Qe,nt)}catch(Te){Me=[6,Te],At=0}finally{cr=Gt=0}if(Me[0]&5)throw Me[1];return{value:Me[0]?Me[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(Qe,xt){for(var nt=0,cr=xt.length,At=Qe.length;nt<cr;nt++,At++)Qe[At]=xt[nt];return Qe};Object.defineProperty(O,"__esModule",{value:!0}),O.Container=void 0;var G=y(7590),S=y(15251),F=y(1073),te=y(86062),ce=y(89759),q=y(38113),we=y(57461),Pe=y(99628),Be=y(70758),Oe=y(94863),Nt=y(80384),Xt=y(34629),Bt=function(){function Qe(xt){this._appliedMiddleware=[];var nt=xt||{};if(typeof nt!="object")throw new Error(""+S.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(nt.defaultScope===void 0)nt.defaultScope=F.BindingScopeEnum.Transient;else if(nt.defaultScope!==F.BindingScopeEnum.Singleton&&nt.defaultScope!==F.BindingScopeEnum.Transient&&nt.defaultScope!==F.BindingScopeEnum.Request)throw new Error(""+S.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(nt.autoBindInjectable===void 0)nt.autoBindInjectable=!1;else if(typeof nt.autoBindInjectable!="boolean")throw new Error(""+S.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(nt.skipBaseClassChecks===void 0)nt.skipBaseClassChecks=!1;else if(typeof nt.skipBaseClassChecks!="boolean")throw new Error(""+S.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:nt.autoBindInjectable,defaultScope:nt.defaultScope,skipBaseClassChecks:nt.skipBaseClassChecks},this.id=Be.id(),this._bindingDictionary=new Xt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ce.MetadataReader}return Qe.merge=function(xt,nt){for(var cr=[],At=2;At<arguments.length;At++)cr[At-2]=arguments[At];var Gt=new Qe,St=p([xt,nt],cr).map(function(Me){return q.getBindingDictionary(Me)}),Ze=q.getBindingDictionary(Gt);function yt(Me,Te){Me.traverse(function(Ie,bt){bt.forEach(function(tr){Te.add(tr.serviceIdentifier,tr.clone())})})}return St.forEach(function(Me){yt(Me,Ze)}),Gt},Qe.prototype.load=function(){for(var xt=[],nt=0;nt<arguments.length;nt++)xt[nt]=arguments[nt];for(var cr=this._getContainerModuleHelpersFactory(),At=0,Gt=xt;At<Gt.length;At++){var St=Gt[At],Ze=cr(St.id);St.registry(Ze.bindFunction,Ze.unbindFunction,Ze.isboundFunction,Ze.rebindFunction)}},Qe.prototype.loadAsync=function(){for(var xt=[],nt=0;nt<arguments.length;nt++)xt[nt]=arguments[nt];return V(this,void 0,void 0,function(){var cr,At,Gt,St,Ze;return b(this,function(yt){switch(yt.label){case 0:cr=this._getContainerModuleHelpersFactory(),At=0,Gt=xt,yt.label=1;case 1:return At<Gt.length?(St=Gt[At],Ze=cr(St.id),[4,St.registry(Ze.bindFunction,Ze.unbindFunction,Ze.isboundFunction,Ze.rebindFunction)]):[3,4];case 2:yt.sent(),yt.label=3;case 3:return At++,[3,1];case 4:return[2]}})})},Qe.prototype.unload=function(){for(var xt=this,nt=[],cr=0;cr<arguments.length;cr++)nt[cr]=arguments[cr];var At=function(St){return function(Ze){return Ze.moduleId===St}};nt.forEach(function(Gt){var St=At(Gt.id);xt._bindingDictionary.removeByCondition(St)})},Qe.prototype.bind=function(xt){var nt=this.options.defaultScope||F.BindingScopeEnum.Transient,cr=new G.Binding(xt,nt);return this._bindingDictionary.add(xt,cr),new Pe.BindingToSyntax(cr)},Qe.prototype.rebind=function(xt){return this.unbind(xt),this.bind(xt)},Qe.prototype.unbind=function(xt){try{this._bindingDictionary.remove(xt)}catch(nt){throw new Error(S.CANNOT_UNBIND+" "+Oe.getServiceIdentifierAsString(xt))}},Qe.prototype.unbindAll=function(){this._bindingDictionary=new Xt.Lookup},Qe.prototype.isBound=function(xt){var nt=this._bindingDictionary.hasKey(xt);return!nt&&this.parent&&(nt=this.parent.isBound(xt)),nt},Qe.prototype.isBoundNamed=function(xt,nt){return this.isBoundTagged(xt,te.NAMED_TAG,nt)},Qe.prototype.isBoundTagged=function(xt,nt,cr){var At=!1;if(this._bindingDictionary.hasKey(xt)){var Gt=this._bindingDictionary.get(xt),St=q.createMockRequest(this,xt,nt,cr);At=Gt.some(function(Ze){return Ze.constraint(St)})}return!At&&this.parent&&(At=this.parent.isBoundTagged(xt,nt,cr)),At},Qe.prototype.snapshot=function(){this._snapshots.push(Nt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Qe.prototype.restore=function(){var xt=this._snapshots.pop();if(xt===void 0)throw new Error(S.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=xt.bindings,this._middleware=xt.middleware},Qe.prototype.createChild=function(xt){var nt=new Qe(xt||this.options);return nt.parent=this,nt},Qe.prototype.applyMiddleware=function(){for(var xt=[],nt=0;nt<arguments.length;nt++)xt[nt]=arguments[nt];this._appliedMiddleware=this._appliedMiddleware.concat(xt);var cr=this._middleware?this._middleware:this._planAndResolve();this._middleware=xt.reduce(function(At,Gt){return Gt(At)},cr)},Qe.prototype.applyCustomMetadataReader=function(xt){this._metadataReader=xt},Qe.prototype.get=function(xt){return this._get(!1,!1,F.TargetTypeEnum.Variable,xt)},Qe.prototype.getTagged=function(xt,nt,cr){return this._get(!1,!1,F.TargetTypeEnum.Variable,xt,nt,cr)},Qe.prototype.getNamed=function(xt,nt){return this.getTagged(xt,te.NAMED_TAG,nt)},Qe.prototype.getAll=function(xt){return this._get(!0,!0,F.TargetTypeEnum.Variable,xt)},Qe.prototype.getAllTagged=function(xt,nt,cr){return this._get(!1,!0,F.TargetTypeEnum.Variable,xt,nt,cr)},Qe.prototype.getAllNamed=function(xt,nt){return this.getAllTagged(xt,te.NAMED_TAG,nt)},Qe.prototype.resolve=function(xt){var nt=this.createChild();return nt.bind(xt).toSelf(),this._appliedMiddleware.forEach(function(cr){nt.applyMiddleware(cr)}),nt.get(xt)},Qe.prototype._getContainerModuleHelpersFactory=function(){var xt=this,nt=function(yt,Me){yt._binding.moduleId=Me},cr=function(yt){return function(Me){var Te=xt.bind.bind(xt),Ie=Te(Me);return nt(Ie,yt),Ie}},At=function(yt){return function(Me){var Te=xt.unbind.bind(xt);Te(Me)}},Gt=function(yt){return function(Me){var Te=xt.isBound.bind(xt);return Te(Me)}},St=function(yt){return function(Me){var Te=xt.rebind.bind(xt),Ie=Te(Me);return nt(Ie,yt),Ie}};return function(Ze){return{bindFunction:cr(Ze),isboundFunction:Gt(Ze),rebindFunction:St(Ze),unbindFunction:At(Ze)}}},Qe.prototype._get=function(xt,nt,cr,At,Gt,St){var Ze=null,yt={avoidConstraints:xt,contextInterceptor:function(Te){return Te},isMultiInject:nt,key:Gt,serviceIdentifier:At,targetType:cr,value:St};if(this._middleware){if(Ze=this._middleware(yt),Ze==null)throw new Error(S.INVALID_MIDDLEWARE_RETURN)}else Ze=this._planAndResolve()(yt);return Ze},Qe.prototype._planAndResolve=function(){var xt=this;return function(nt){var cr=q.plan(xt._metadataReader,xt,nt.isMultiInject,nt.targetType,nt.serviceIdentifier,nt.key,nt.value,nt.avoidConstraints);cr=nt.contextInterceptor(cr);var At=we.resolve(cr);return At}},Qe}();O.Container=Bt},808:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.AsyncContainerModule=O.ContainerModule=void 0;var V=y(70758),b=function(){function G(S){this.id=V.id(),this.registry=S}return G}();O.ContainerModule=b;var p=function(){function G(S){this.id=V.id(),this.registry=S}return G}();O.AsyncContainerModule=p},80384:function(_t,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.ContainerSnapshot=void 0;var y=function(){function V(){}return V.of=function(b,p){var G=new V;return G.bindings=b,G.middleware=p,G},V}();O.ContainerSnapshot=y},34629:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Lookup=void 0;var V=y(15251),b=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(G,S){if(G==null)throw new Error(V.NULL_ARGUMENT);if(S==null)throw new Error(V.NULL_ARGUMENT);var F=this._map.get(G);F!==void 0?(F.push(S),this._map.set(G,F)):this._map.set(G,[S])},p.prototype.get=function(G){if(G==null)throw new Error(V.NULL_ARGUMENT);var S=this._map.get(G);if(S!==void 0)return S;throw new Error(V.KEY_NOT_FOUND)},p.prototype.remove=function(G){if(G==null)throw new Error(V.NULL_ARGUMENT);if(!this._map.delete(G))throw new Error(V.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(G){var S=this;this._map.forEach(function(F,te){var ce=F.filter(function(q){return!G(q)});ce.length>0?S._map.set(te,ce):S._map.delete(te)})},p.prototype.hasKey=function(G){if(G==null)throw new Error(V.NULL_ARGUMENT);return this._map.has(G)},p.prototype.clone=function(){var G=new p;return this._map.forEach(function(S,F){S.forEach(function(te){return G.add(F,te.clone())})}),G},p.prototype.traverse=function(G){this._map.forEach(function(S,F){G(F,S)})},p}();O.Lookup=b},62141:function(_t,O,y){"use strict";var V;V={value:!0},V=V=V=V=V=V=O.GW=V=V=O.zY=V=V=V=V=V=O.f3=V=V=O.b2=V=V=V=V=V=O.W2=V=void 0;var b=y(86062);V=b;var p=y(51539);Object.defineProperty(O,"W2",{enumerable:!0,get:function(){return p.Container}});var G=y(1073);V={enumerable:!0,get:function(){return G.BindingScopeEnum}},V={enumerable:!0,get:function(){return G.BindingTypeEnum}},V={enumerable:!0,get:function(){return G.TargetTypeEnum}};var S=y(808);V={enumerable:!0,get:function(){return S.AsyncContainerModule}},V={enumerable:!0,get:function(){return S.ContainerModule}};var F=y(14219);Object.defineProperty(O,"b2",{enumerable:!0,get:function(){return F.injectable}});var te=y(52591);V={enumerable:!0,get:function(){return te.tagged}};var ce=y(58476);V={enumerable:!0,get:function(){return ce.named}};var q=y(89256);Object.defineProperty(O,"f3",{enumerable:!0,get:function(){return q.inject}}),V={enumerable:!0,get:function(){return q.LazyServiceIdentifer}};var we=y(33575);V={enumerable:!0,get:function(){return we.optional}};var Pe=y(30588);V={enumerable:!0,get:function(){return Pe.unmanaged}};var Be=y(56777);V={enumerable:!0,get:function(){return Be.multiInject}};var Oe=y(23853);V={enumerable:!0,get:function(){return Oe.targetName}};var Nt=y(71485);Object.defineProperty(O,"zY",{enumerable:!0,get:function(){return Nt.postConstruct}});var Xt=y(89759);V={enumerable:!0,get:function(){return Xt.MetadataReader}};var Bt=y(70758);V={enumerable:!0,get:function(){return Bt.id}};var Qe=y(29604);Object.defineProperty(O,"GW",{enumerable:!0,get:function(){return Qe.decorate}});var xt=y(54437);V={enumerable:!0,get:function(){return xt.traverseAncerstors}},V={enumerable:!0,get:function(){return xt.taggedConstraint}},V={enumerable:!0,get:function(){return xt.namedConstraint}},V={enumerable:!0,get:function(){return xt.typeConstraint}};var nt=y(94863);V={enumerable:!0,get:function(){return nt.getServiceIdentifierAsString}};var cr=y(88858);V={enumerable:!0,get:function(){return cr.multiBindToService}}},62706:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Context=void 0;var V=y(70758),b=function(){function p(G){this.id=V.id(),this.container=G}return p.prototype.addPlan=function(G){this.plan=G},p.prototype.setCurrentRequest=function(G){this.currentRequest=G},p}();O.Context=b},38463:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Metadata=void 0;var V=y(86062),b=function(){function p(G,S){this.key=G,this.value=S}return p.prototype.toString=function(){return this.key===V.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();O.Metadata=b},89759:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.MetadataReader=void 0;var V=y(86062),b=function(){function p(){}return p.prototype.getConstructorMetadata=function(G){var S=Reflect.getMetadata(V.PARAM_TYPES,G),F=Reflect.getMetadata(V.TAGGED,G);return{compilerGeneratedMetadata:S,userGeneratedMetadata:F||{}}},p.prototype.getPropertiesMetadata=function(G){var S=Reflect.getMetadata(V.TAGGED_PROP,G)||[];return S},p}();O.MetadataReader=b},62400:function(_t,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Plan=void 0;var y=function(){function V(b,p){this.parentContext=b,this.rootRequest=p}return V}();O.Plan=y},38113:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.getBindingDictionary=O.createMockRequest=O.plan=void 0;var V=y(76764),b=y(15251),p=y(1073),G=y(86062),S=y(64357),F=y(94863),te=y(62706),ce=y(38463),q=y(62400),we=y(71031),Pe=y(21994),Be=y(29953);function Oe(At){return At._bindingDictionary}O.getBindingDictionary=Oe;function Nt(At,Gt,St,Ze,yt,Me){var Te=At?G.MULTI_INJECT_TAG:G.INJECT_TAG,Ie=new ce.Metadata(Te,St),bt=new Be.Target(Gt,Ze,St,Ie);if(yt!==void 0){var tr=new ce.Metadata(yt,Me);bt.metadata.push(tr)}return bt}function Xt(At,Gt,St,Ze,yt){var Me=xt(St.container,yt.serviceIdentifier),Te=[];return Me.length===V.BindingCount.NoBindingsAvailable&&St.container.options.autoBindInjectable&&typeof yt.serviceIdentifier=="function"&&At.getConstructorMetadata(yt.serviceIdentifier).compilerGeneratedMetadata&&(St.container.bind(yt.serviceIdentifier).toSelf(),Me=xt(St.container,yt.serviceIdentifier)),Gt?Te=Me:Te=Me.filter(function(Ie){var bt=new Pe.Request(Ie.serviceIdentifier,St,Ze,Ie,yt);return Ie.constraint(bt)}),Bt(yt.serviceIdentifier,Te,yt,St.container),Te}function Bt(At,Gt,St,Ze){switch(Gt.length){case V.BindingCount.NoBindingsAvailable:if(St.isOptional())return Gt;var yt=F.getServiceIdentifierAsString(At),Me=b.NOT_REGISTERED;throw Me+=F.listMetadataForTarget(yt,St),Me+=F.listRegisteredBindingsForServiceIdentifier(Ze,yt,xt),new Error(Me);case V.BindingCount.OnlyOneBindingAvailable:if(!St.isArray())return Gt;case V.BindingCount.MultipleBindingsAvailable:default:if(St.isArray())return Gt;var yt=F.getServiceIdentifierAsString(At),Me=b.AMBIGUOUS_MATCH+" "+yt;throw Me+=F.listRegisteredBindingsForServiceIdentifier(Ze,yt,xt),new Error(Me)}}function Qe(At,Gt,St,Ze,yt,Me){var Te,Ie;if(yt===null){Te=Xt(At,Gt,Ze,null,Me),Ie=new Pe.Request(St,Ze,null,Te,Me);var bt=new q.Plan(Ze,Ie);Ze.addPlan(bt)}else Te=Xt(At,Gt,Ze,yt,Me),Ie=yt.addChildRequest(Me.serviceIdentifier,Te,Me);Te.forEach(function(tr){var ae=null;if(Me.isArray())ae=Ie.addChildRequest(tr.serviceIdentifier,tr,Me);else{if(tr.cache)return;ae=Ie}if(tr.type===p.BindingTypeEnum.Instance&&tr.implementationType!==null){var Ee=we.getDependencies(At,tr.implementationType);if(!Ze.container.options.skipBaseClassChecks){var le=we.getBaseClassDependencyCount(At,tr.implementationType);if(Ee.length<le){var Q=b.ARGUMENTS_LENGTH_MISMATCH(we.getFunctionName(tr.implementationType));throw new Error(Q)}}Ee.forEach(function(re){Qe(At,!1,re.serviceIdentifier,Ze,ae,re)})}})}function xt(At,Gt){var St=[],Ze=Oe(At);return Ze.hasKey(Gt)?St=Ze.get(Gt):At.parent!==null&&(St=xt(At.parent,Gt)),St}function nt(At,Gt,St,Ze,yt,Me,Te,Ie){Ie===void 0&&(Ie=!1);var bt=new te.Context(Gt),tr=Nt(St,Ze,yt,"",Me,Te);try{return Qe(At,Ie,yt,bt,null,tr),bt}catch(ae){throw S.isStackOverflowExeption(ae)&&bt.plan&&F.circularDependencyToException(bt.plan.rootRequest),ae}}O.plan=nt;function cr(At,Gt,St,Ze){var yt=new Be.Target(p.TargetTypeEnum.Variable,"",Gt,new ce.Metadata(St,Ze)),Me=new te.Context(At),Te=new Pe.Request(Gt,Me,null,[],yt);return Te}O.createMockRequest=cr},20881:function(_t,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.QueryableString=void 0;var y=function(){function V(b){this.str=b}return V.prototype.startsWith=function(b){return this.str.indexOf(b)===0},V.prototype.endsWith=function(b){var p="",G=b.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},G)},V.prototype.contains=function(b){return this.str.indexOf(b)!==-1},V.prototype.equals=function(b){return this.str===b},V.prototype.value=function(){return this.str},V}();O.QueryableString=y},71031:function(_t,O,y){"use strict";var V=this&&this.__spreadArray||function(Xt,Bt){for(var Qe=0,xt=Bt.length,nt=Xt.length;Qe<xt;Qe++,nt++)Xt[nt]=Bt[Qe];return Xt};Object.defineProperty(O,"__esModule",{value:!0}),O.getFunctionName=O.getBaseClassDependencyCount=O.getDependencies=void 0;var b=y(89256),p=y(15251),G=y(1073),S=y(86062),F=y(94863);Object.defineProperty(O,"getFunctionName",{enumerable:!0,get:function(){return F.getFunctionName}});var te=y(29953);function ce(Xt,Bt){var Qe=F.getFunctionName(Bt),xt=q(Xt,Qe,Bt,!1);return xt}O.getDependencies=ce;function q(Xt,Bt,Qe,xt){var nt=Xt.getConstructorMetadata(Qe),cr=nt.compilerGeneratedMetadata;if(cr===void 0){var At=p.MISSING_INJECTABLE_ANNOTATION+" "+Bt+".";throw new Error(At)}var Gt=nt.userGeneratedMetadata,St=Object.keys(Gt),Ze=Qe.length===0&&St.length>0,yt=St.length>Qe.length,Me=Ze||yt?St.length:Qe.length,Te=Pe(xt,Bt,cr,Gt,Me),Ie=Be(Xt,Qe),bt=V(V([],Te),Ie);return bt}function we(Xt,Bt,Qe,xt,nt){var cr=nt[Xt.toString()]||[],At=Nt(cr),Gt=At.unmanaged!==!0,St=xt[Xt],Ze=At.inject||At.multiInject;if(St=Ze||St,St instanceof b.LazyServiceIdentifer&&(St=St.unwrap()),Gt){var yt=St===Object,Me=St===Function,Te=St===void 0,Ie=yt||Me||Te;if(!Bt&&Ie){var bt=p.MISSING_INJECT_ANNOTATION+" argument "+Xt+" in class "+Qe+".";throw new Error(bt)}var tr=new te.Target(G.TargetTypeEnum.ConstructorArgument,At.targetName,St);return tr.metadata=cr,tr}return null}function Pe(Xt,Bt,Qe,xt,nt){for(var cr=[],At=0;At<nt;At++){var Gt=At,St=we(Gt,Xt,Bt,Qe,xt);St!==null&&cr.push(St)}return cr}function Be(Xt,Bt){for(var Qe=Xt.getPropertiesMetadata(Bt),xt=[],nt=Object.keys(Qe),cr=0,At=nt;cr<At.length;cr++){var Gt=At[cr],St=Qe[Gt],Ze=Nt(Qe[Gt]),yt=Ze.targetName||Gt,Me=Ze.inject||Ze.multiInject,Te=new te.Target(G.TargetTypeEnum.ClassProperty,yt,Me);Te.metadata=St,xt.push(Te)}var Ie=Object.getPrototypeOf(Bt.prototype).constructor;if(Ie!==Object){var bt=Be(Xt,Ie);xt=V(V([],xt),bt)}return xt}function Oe(Xt,Bt){var Qe=Object.getPrototypeOf(Bt.prototype).constructor;if(Qe!==Object){var xt=F.getFunctionName(Qe),nt=q(Xt,xt,Qe,!0),cr=nt.map(function(St){return St.metadata.filter(function(Ze){return Ze.key===S.UNMANAGED_TAG})}),At=[].concat.apply([],cr).length,Gt=nt.length-At;return Gt>0?Gt:Oe(Xt,Qe)}else return 0}O.getBaseClassDependencyCount=Oe;function Nt(Xt){var Bt={};return Xt.forEach(function(Qe){Bt[Qe.key.toString()]=Qe.value}),{inject:Bt[S.INJECT_TAG],multiInject:Bt[S.MULTI_INJECT_TAG],targetName:Bt[S.NAME_TAG],unmanaged:Bt[S.UNMANAGED_TAG]}}},21994:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Request=void 0;var V=y(70758),b=function(){function p(G,S,F,te,ce){this.id=V.id(),this.serviceIdentifier=G,this.parentContext=S,this.parentRequest=F,this.target=ce,this.childRequests=[],this.bindings=Array.isArray(te)?te:[te],this.requestScope=F===null?new Map:null}return p.prototype.addChildRequest=function(G,S,F){var te=new p(G,this.parentContext,this,S,F);return this.childRequests.push(te),te},p}();O.Request=b},29953:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Target=void 0;var V=y(86062),b=y(70758),p=y(38463),G=y(20881),S=function(){function F(te,ce,q,we){this.id=b.id(),this.type=te,this.serviceIdentifier=q,this.name=new G.QueryableString(ce||""),this.metadata=new Array;var Pe=null;typeof we=="string"?Pe=new p.Metadata(V.NAMED_TAG,we):we instanceof p.Metadata&&(Pe=we),Pe!==null&&this.metadata.push(Pe)}return F.prototype.hasTag=function(te){for(var ce=0,q=this.metadata;ce<q.length;ce++){var we=q[ce];if(we.key===te)return!0}return!1},F.prototype.isArray=function(){return this.hasTag(V.MULTI_INJECT_TAG)},F.prototype.matchesArray=function(te){return this.matchesTag(V.MULTI_INJECT_TAG)(te)},F.prototype.isNamed=function(){return this.hasTag(V.NAMED_TAG)},F.prototype.isTagged=function(){return this.metadata.some(function(te){return V.NON_CUSTOM_TAG_KEYS.every(function(ce){return te.key!==ce})})},F.prototype.isOptional=function(){return this.matchesTag(V.OPTIONAL_TAG)(!0)},F.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(te){return te.key===V.NAMED_TAG})[0]:null},F.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(te){return V.NON_CUSTOM_TAG_KEYS.every(function(ce){return te.key!==ce})}):null},F.prototype.matchesNamedTag=function(te){return this.matchesTag(V.NAMED_TAG)(te)},F.prototype.matchesTag=function(te){var ce=this;return function(q){for(var we=0,Pe=ce.metadata;we<Pe.length;we++){var Be=Pe[we];if(Be.key===te&&Be.value===q)return!0}return!1}},F}();O.Target=S},28906:function(_t,O,y){"use strict";var V=this&&this.__spreadArray||function(q,we){for(var Pe=0,Be=we.length,Oe=q.length;Pe<Be;Pe++,Oe++)q[Oe]=we[Pe];return q};Object.defineProperty(O,"__esModule",{value:!0}),O.resolveInstance=void 0;var b=y(15251),p=y(1073),G=y(86062);function S(q,we,Pe){var Be=we.filter(function(Nt){return Nt.target!==null&&Nt.target.type===p.TargetTypeEnum.ClassProperty}),Oe=Be.map(Pe);return Be.forEach(function(Nt,Xt){var Bt="";Bt=Nt.target.name.value();var Qe=Oe[Xt];q[Bt]=Qe}),q}function F(q,we){return new(q.bind.apply(q,V([void 0],we)))}function te(q,we){if(Reflect.hasMetadata(G.POST_CONSTRUCT,q)){var Pe=Reflect.getMetadata(G.POST_CONSTRUCT,q);try{we[Pe.value]()}catch(Be){throw new Error(b.POST_CONSTRUCT_ERROR(q.name,Be.message))}}}function ce(q,we,Pe){var Be=null;if(we.length>0){var Oe=we.filter(function(Xt){return Xt.target!==null&&Xt.target.type===p.TargetTypeEnum.ConstructorArgument}),Nt=Oe.map(Pe);Be=F(q,Nt),Be=S(Be,we,Pe)}else Be=new q;return te(q,Be),Be}O.resolveInstance=ce},57461:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.resolve=void 0;var V=y(15251),b=y(1073),p=y(64357),G=y(94863),S=y(28906),F=function(we,Pe,Be){try{return Be()}catch(Oe){throw p.isStackOverflowExeption(Oe)?new Error(V.CIRCULAR_DEPENDENCY_IN_FACTORY(we,Pe.toString())):Oe}},te=function q(we){return function(Pe){Pe.parentContext.setCurrentRequest(Pe);var Be=Pe.bindings,Oe=Pe.childRequests,Nt=Pe.target&&Pe.target.isArray(),Xt=!Pe.parentRequest||!Pe.parentRequest.target||!Pe.target||!Pe.parentRequest.target.matchesArray(Pe.target.serviceIdentifier);if(Nt&&Xt)return Oe.map(function(At){var Gt=q(we);return Gt(At)});var Bt=null;if(Pe.target.isOptional()&&Be.length===0)return;var Qe=Be[0],xt=Qe.scope===b.BindingScopeEnum.Singleton,nt=Qe.scope===b.BindingScopeEnum.Request;if(xt&&Qe.activated)return Qe.cache;if(nt&&we!==null&&we.has(Qe.id))return we.get(Qe.id);if(Qe.type===b.BindingTypeEnum.ConstantValue)Bt=Qe.cache,Qe.activated=!0;else if(Qe.type===b.BindingTypeEnum.Function)Bt=Qe.cache,Qe.activated=!0;else if(Qe.type===b.BindingTypeEnum.Constructor)Bt=Qe.implementationType;else if(Qe.type===b.BindingTypeEnum.DynamicValue&&Qe.dynamicValue!==null)Bt=F("toDynamicValue",Qe.serviceIdentifier,function(){return Qe.dynamicValue(Pe.parentContext)});else if(Qe.type===b.BindingTypeEnum.Factory&&Qe.factory!==null)Bt=F("toFactory",Qe.serviceIdentifier,function(){return Qe.factory(Pe.parentContext)});else if(Qe.type===b.BindingTypeEnum.Provider&&Qe.provider!==null)Bt=F("toProvider",Qe.serviceIdentifier,function(){return Qe.provider(Pe.parentContext)});else if(Qe.type===b.BindingTypeEnum.Instance&&Qe.implementationType!==null)Bt=S.resolveInstance(Qe.implementationType,Oe,q(we));else{var cr=G.getServiceIdentifierAsString(Pe.serviceIdentifier);throw new Error(V.INVALID_BINDING_TYPE+" "+cr)}return typeof Qe.onActivation=="function"&&(Bt=Qe.onActivation(Pe.parentContext,Bt)),xt&&(Qe.cache=Bt,Qe.activated=!0),nt&&we!==null&&!we.has(Qe.id)&&we.set(Qe.id,Bt),Bt}};function ce(q){var we=te(q.plan.rootRequest.requestScope);return we(q.plan.rootRequest)}O.resolve=ce},37694:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingInSyntax=void 0;var V=y(1073),b=y(93991),p=function(){function G(S){this._binding=S}return G.prototype.inRequestScope=function(){return this._binding.scope=V.BindingScopeEnum.Request,new b.BindingWhenOnSyntax(this._binding)},G.prototype.inSingletonScope=function(){return this._binding.scope=V.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},G.prototype.inTransientScope=function(){return this._binding.scope=V.BindingScopeEnum.Transient,new b.BindingWhenOnSyntax(this._binding)},G}();O.BindingInSyntax=p},16312:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingInWhenOnSyntax=void 0;var V=y(37694),b=y(60080),p=y(37150),G=function(){function S(F){this._binding=F,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new b.BindingOnSyntax(this._binding),this._bindingInSyntax=new V.BindingInSyntax(F)}return S.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},S.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},S.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},S.prototype.when=function(F){return this._bindingWhenSyntax.when(F)},S.prototype.whenTargetNamed=function(F){return this._bindingWhenSyntax.whenTargetNamed(F)},S.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},S.prototype.whenTargetTagged=function(F,te){return this._bindingWhenSyntax.whenTargetTagged(F,te)},S.prototype.whenInjectedInto=function(F){return this._bindingWhenSyntax.whenInjectedInto(F)},S.prototype.whenParentNamed=function(F){return this._bindingWhenSyntax.whenParentNamed(F)},S.prototype.whenParentTagged=function(F,te){return this._bindingWhenSyntax.whenParentTagged(F,te)},S.prototype.whenAnyAncestorIs=function(F){return this._bindingWhenSyntax.whenAnyAncestorIs(F)},S.prototype.whenNoAncestorIs=function(F){return this._bindingWhenSyntax.whenNoAncestorIs(F)},S.prototype.whenAnyAncestorNamed=function(F){return this._bindingWhenSyntax.whenAnyAncestorNamed(F)},S.prototype.whenAnyAncestorTagged=function(F,te){return this._bindingWhenSyntax.whenAnyAncestorTagged(F,te)},S.prototype.whenNoAncestorNamed=function(F){return this._bindingWhenSyntax.whenNoAncestorNamed(F)},S.prototype.whenNoAncestorTagged=function(F,te){return this._bindingWhenSyntax.whenNoAncestorTagged(F,te)},S.prototype.whenAnyAncestorMatches=function(F){return this._bindingWhenSyntax.whenAnyAncestorMatches(F)},S.prototype.whenNoAncestorMatches=function(F){return this._bindingWhenSyntax.whenNoAncestorMatches(F)},S.prototype.onActivation=function(F){return this._bindingOnSyntax.onActivation(F)},S}();O.BindingInWhenOnSyntax=G},60080:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingOnSyntax=void 0;var V=y(37150),b=function(){function p(G){this._binding=G}return p.prototype.onActivation=function(G){return this._binding.onActivation=G,new V.BindingWhenSyntax(this._binding)},p}();O.BindingOnSyntax=b},99628:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingToSyntax=void 0;var V=y(15251),b=y(1073),p=y(16312),G=y(93991),S=function(){function F(te){this._binding=te}return F.prototype.to=function(te){return this._binding.type=b.BindingTypeEnum.Instance,this._binding.implementationType=te,new p.BindingInWhenOnSyntax(this._binding)},F.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+V.INVALID_TO_SELF_VALUE);var te=this._binding.serviceIdentifier;return this.to(te)},F.prototype.toConstantValue=function(te){return this._binding.type=b.BindingTypeEnum.ConstantValue,this._binding.cache=te,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=b.BindingScopeEnum.Singleton,new G.BindingWhenOnSyntax(this._binding)},F.prototype.toDynamicValue=function(te){return this._binding.type=b.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=te,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},F.prototype.toConstructor=function(te){return this._binding.type=b.BindingTypeEnum.Constructor,this._binding.implementationType=te,this._binding.scope=b.BindingScopeEnum.Singleton,new G.BindingWhenOnSyntax(this._binding)},F.prototype.toFactory=function(te){return this._binding.type=b.BindingTypeEnum.Factory,this._binding.factory=te,this._binding.scope=b.BindingScopeEnum.Singleton,new G.BindingWhenOnSyntax(this._binding)},F.prototype.toFunction=function(te){if(typeof te!="function")throw new Error(V.INVALID_FUNCTION_BINDING);var ce=this.toConstantValue(te);return this._binding.type=b.BindingTypeEnum.Function,this._binding.scope=b.BindingScopeEnum.Singleton,ce},F.prototype.toAutoFactory=function(te){return this._binding.type=b.BindingTypeEnum.Factory,this._binding.factory=function(ce){var q=function(){return ce.container.get(te)};return q},this._binding.scope=b.BindingScopeEnum.Singleton,new G.BindingWhenOnSyntax(this._binding)},F.prototype.toProvider=function(te){return this._binding.type=b.BindingTypeEnum.Provider,this._binding.provider=te,this._binding.scope=b.BindingScopeEnum.Singleton,new G.BindingWhenOnSyntax(this._binding)},F.prototype.toService=function(te){this.toDynamicValue(function(ce){return ce.container.get(te)})},F}();O.BindingToSyntax=S},93991:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingWhenOnSyntax=void 0;var V=y(60080),b=y(37150),p=function(){function G(S){this._binding=S,this._bindingWhenSyntax=new b.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new V.BindingOnSyntax(this._binding)}return G.prototype.when=function(S){return this._bindingWhenSyntax.when(S)},G.prototype.whenTargetNamed=function(S){return this._bindingWhenSyntax.whenTargetNamed(S)},G.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},G.prototype.whenTargetTagged=function(S,F){return this._bindingWhenSyntax.whenTargetTagged(S,F)},G.prototype.whenInjectedInto=function(S){return this._bindingWhenSyntax.whenInjectedInto(S)},G.prototype.whenParentNamed=function(S){return this._bindingWhenSyntax.whenParentNamed(S)},G.prototype.whenParentTagged=function(S,F){return this._bindingWhenSyntax.whenParentTagged(S,F)},G.prototype.whenAnyAncestorIs=function(S){return this._bindingWhenSyntax.whenAnyAncestorIs(S)},G.prototype.whenNoAncestorIs=function(S){return this._bindingWhenSyntax.whenNoAncestorIs(S)},G.prototype.whenAnyAncestorNamed=function(S){return this._bindingWhenSyntax.whenAnyAncestorNamed(S)},G.prototype.whenAnyAncestorTagged=function(S,F){return this._bindingWhenSyntax.whenAnyAncestorTagged(S,F)},G.prototype.whenNoAncestorNamed=function(S){return this._bindingWhenSyntax.whenNoAncestorNamed(S)},G.prototype.whenNoAncestorTagged=function(S,F){return this._bindingWhenSyntax.whenNoAncestorTagged(S,F)},G.prototype.whenAnyAncestorMatches=function(S){return this._bindingWhenSyntax.whenAnyAncestorMatches(S)},G.prototype.whenNoAncestorMatches=function(S){return this._bindingWhenSyntax.whenNoAncestorMatches(S)},G.prototype.onActivation=function(S){return this._bindingOnSyntax.onActivation(S)},G}();O.BindingWhenOnSyntax=p},37150:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingWhenSyntax=void 0;var V=y(60080),b=y(54437),p=function(){function G(S){this._binding=S}return G.prototype.when=function(S){return this._binding.constraint=S,new V.BindingOnSyntax(this._binding)},G.prototype.whenTargetNamed=function(S){return this._binding.constraint=b.namedConstraint(S),new V.BindingOnSyntax(this._binding)},G.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(S){var F=S.target!==null&&!S.target.isNamed()&&!S.target.isTagged();return F},new V.BindingOnSyntax(this._binding)},G.prototype.whenTargetTagged=function(S,F){return this._binding.constraint=b.taggedConstraint(S)(F),new V.BindingOnSyntax(this._binding)},G.prototype.whenInjectedInto=function(S){return this._binding.constraint=function(F){return b.typeConstraint(S)(F.parentRequest)},new V.BindingOnSyntax(this._binding)},G.prototype.whenParentNamed=function(S){return this._binding.constraint=function(F){return b.namedConstraint(S)(F.parentRequest)},new V.BindingOnSyntax(this._binding)},G.prototype.whenParentTagged=function(S,F){return this._binding.constraint=function(te){return b.taggedConstraint(S)(F)(te.parentRequest)},new V.BindingOnSyntax(this._binding)},G.prototype.whenAnyAncestorIs=function(S){return this._binding.constraint=function(F){return b.traverseAncerstors(F,b.typeConstraint(S))},new V.BindingOnSyntax(this._binding)},G.prototype.whenNoAncestorIs=function(S){return this._binding.constraint=function(F){return!b.traverseAncerstors(F,b.typeConstraint(S))},new V.BindingOnSyntax(this._binding)},G.prototype.whenAnyAncestorNamed=function(S){return this._binding.constraint=function(F){return b.traverseAncerstors(F,b.namedConstraint(S))},new V.BindingOnSyntax(this._binding)},G.prototype.whenNoAncestorNamed=function(S){return this._binding.constraint=function(F){return!b.traverseAncerstors(F,b.namedConstraint(S))},new V.BindingOnSyntax(this._binding)},G.prototype.whenAnyAncestorTagged=function(S,F){return this._binding.constraint=function(te){return b.traverseAncerstors(te,b.taggedConstraint(S)(F))},new V.BindingOnSyntax(this._binding)},G.prototype.whenNoAncestorTagged=function(S,F){return this._binding.constraint=function(te){return!b.traverseAncerstors(te,b.taggedConstraint(S)(F))},new V.BindingOnSyntax(this._binding)},G.prototype.whenAnyAncestorMatches=function(S){return this._binding.constraint=function(F){return b.traverseAncerstors(F,S)},new V.BindingOnSyntax(this._binding)},G.prototype.whenNoAncestorMatches=function(S){return this._binding.constraint=function(F){return!b.traverseAncerstors(F,S)},new V.BindingOnSyntax(this._binding)},G}();O.BindingWhenSyntax=p},54437:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.typeConstraint=O.namedConstraint=O.taggedConstraint=O.traverseAncerstors=void 0;var V=y(86062),b=y(38463),p=function te(ce,q){var we=ce.parentRequest;return we!==null?q(we)?!0:te(we,q):!1};O.traverseAncerstors=p;var G=function(ce){return function(q){var we=function(Be){return Be!==null&&Be.target!==null&&Be.target.matchesTag(ce)(q)};return we.metaData=new b.Metadata(ce,q),we}};O.taggedConstraint=G;var S=G(V.NAMED_TAG);O.namedConstraint=S;var F=function(ce){return function(q){var we=null;if(q!==null)if(we=q.bindings[0],typeof ce=="string"){var Pe=we.serviceIdentifier;return Pe===ce}else{var Be=q.bindings[0].implementationType;return ce===Be}return!1}};O.typeConstraint=F},88858:function(_t,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.multiBindToService=void 0;var y=function(b){return function(p){return function(){for(var G=[],S=0;S<arguments.length;S++)G[S]=arguments[S];return G.forEach(function(F){return b.bind(F).toService(p)})}}};O.multiBindToService=y},64357:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.isStackOverflowExeption=void 0;var V=y(15251);function b(p){return p instanceof RangeError||p.message===V.STACK_OVERFLOW}O.isStackOverflowExeption=b},70758:function(_t,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.id=void 0;var y=0;function V(){return y++}O.id=V},94863:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.circularDependencyToException=O.listMetadataForTarget=O.listRegisteredBindingsForServiceIdentifier=O.getServiceIdentifierAsString=O.getFunctionName=void 0;var V=y(15251);function b(q){if(typeof q=="function"){var we=q;return we.name}else{if(typeof q=="symbol")return q.toString();var we=q;return we}}O.getServiceIdentifierAsString=b;function p(q,we,Pe){var Be="",Oe=Pe(q,we);return Oe.length!==0&&(Be=`
Registered bindings:`,Oe.forEach(function(Nt){var Xt="Object";Nt.implementationType!==null&&(Xt=ce(Nt.implementationType)),Be=Be+`
 `+Xt,Nt.constraint.metaData&&(Be=Be+" - "+Nt.constraint.metaData)})),Be}O.listRegisteredBindingsForServiceIdentifier=p;function G(q,we){return q.parentRequest===null?!1:q.parentRequest.serviceIdentifier===we?!0:G(q.parentRequest,we)}function S(q){function we(Be,Oe){Oe===void 0&&(Oe=[]);var Nt=b(Be.serviceIdentifier);return Oe.push(Nt),Be.parentRequest!==null?we(Be.parentRequest,Oe):Oe}var Pe=we(q);return Pe.reverse().join(" --> ")}function F(q){q.childRequests.forEach(function(we){if(G(we,we.serviceIdentifier)){var Pe=S(we);throw new Error(V.CIRCULAR_DEPENDENCY+" "+Pe)}else F(we)})}O.circularDependencyToException=F;function te(q,we){if(we.isTagged()||we.isNamed()){var Pe="",Be=we.getNamedTag(),Oe=we.getCustomTags();return Be!==null&&(Pe+=Be.toString()+`
`),Oe!==null&&Oe.forEach(function(Nt){Pe+=Nt.toString()+`
`})," "+q+`
 `+q+" - "+Pe}else return" "+q}O.listMetadataForTarget=te;function ce(q){if(q.name)return q.name;var we=q.toString(),Pe=we.match(/^function\s*([^\s(]+)/);return Pe?Pe[1]:"Anonymous function: "+we}O.getFunctionName=ce},63414:function(_t){_t.exports=O;function O(y,V){V||(V=document);var b=V.head||V.getElementsByTagName("head")[0];if(!b){b=V.createElement("head");var p=V.body||V.getElementsByTagName("body")[0];p?p.parentNode.insertBefore(b,p):V.documentElement.appendChild(b)}var G=V.createElement("style");return G.type="text/css",G.styleSheet?G.styleSheet.cssText=y:G.appendChild(V.createTextNode(y)),b.appendChild(G),G}},81921:function(_t){var O=Array.isArray;_t.exports=O},96695:function(_t){function O(y){return y==null}_t.exports=O},60283:function(_t){var O="[object Object]";function y(Pe){var Be=!1;if(Pe!=null&&typeof Pe.toString!="function")try{Be=!!(Pe+"")}catch(Oe){}return Be}function V(Pe,Be){return function(Oe){return Pe(Be(Oe))}}var b=Function.prototype,p=Object.prototype,G=b.toString,S=p.hasOwnProperty,F=G.call(Object),te=p.toString,ce=V(Object.getPrototypeOf,Object);function q(Pe){return!!Pe&&typeof Pe=="object"}function we(Pe){if(!q(Pe)||te.call(Pe)!=O||y(Pe))return!1;var Be=ce(Pe);if(Be===null)return!0;var Oe=S.call(Be,"constructor")&&Be.constructor;return typeof Oe=="function"&&Oe instanceof Oe&&G.call(Oe)==F}_t.exports=we},59227:function(_t,O,y){_t=y.nmd(_t);var V=200,b="__lodash_hash_undefined__",p=800,G=16,S=9007199254740991,F="[object Arguments]",te="[object Array]",ce="[object AsyncFunction]",q="[object Boolean]",we="[object Date]",Pe="[object Error]",Be="[object Function]",Oe="[object GeneratorFunction]",Nt="[object Map]",Xt="[object Number]",Bt="[object Null]",Qe="[object Object]",xt="[object Proxy]",nt="[object RegExp]",cr="[object Set]",At="[object String]",Gt="[object Undefined]",St="[object WeakMap]",Ze="[object ArrayBuffer]",yt="[object DataView]",Me="[object Float32Array]",Te="[object Float64Array]",Ie="[object Int8Array]",bt="[object Int16Array]",tr="[object Int32Array]",ae="[object Uint8Array]",Ee="[object Uint8ClampedArray]",le="[object Uint16Array]",Q="[object Uint32Array]",re=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,qe=/^(?:0|[1-9]\d*)$/,Wt={};Wt[Me]=Wt[Te]=Wt[Ie]=Wt[bt]=Wt[tr]=Wt[ae]=Wt[Ee]=Wt[le]=Wt[Q]=!0,Wt[F]=Wt[te]=Wt[Ze]=Wt[q]=Wt[yt]=Wt[we]=Wt[Pe]=Wt[Be]=Wt[Nt]=Wt[Xt]=Wt[Qe]=Wt[nt]=Wt[cr]=Wt[At]=Wt[St]=!1;var Or=typeof y.g=="object"&&y.g&&y.g.Object===Object&&y.g,wr=typeof self=="object"&&self&&self.Object===Object&&self,Nr=Or||wr||Function("return this")(),Vt=O&&!O.nodeType&&O,se=Vt&&!0&&_t&&!_t.nodeType&&_t,_e=se&&se.exports===Vt,Le=_e&&Or.process,ot=function(){try{var Ve=se&&se.require&&se.require("util").types;return Ve||Le&&Le.binding&&Le.binding("util")}catch(Ft){}}(),Rt=ot&&ot.isTypedArray;function jt(Ve,Ft,br){switch(br.length){case 0:return Ve.call(Ft);case 1:return Ve.call(Ft,br[0]);case 2:return Ve.call(Ft,br[0],br[1]);case 3:return Ve.call(Ft,br[0],br[1],br[2])}return Ve.apply(Ft,br)}function w(Ve,Ft){for(var br=-1,Cn=Array(Ve);++br<Ve;)Cn[br]=Ft(br);return Cn}function N(Ve){return function(Ft){return Ve(Ft)}}function ve(Ve,Ft){return Ve==null?void 0:Ve[Ft]}function Ae(Ve,Ft){return function(br){return Ve(Ft(br))}}var Je=Array.prototype,st=Function.prototype,Lt=Object.prototype,X=Nr["__core-js_shared__"],Tt=st.toString,Kt=Lt.hasOwnProperty,hr=function(){var Ve=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||"");return Ve?"Symbol(src)_1."+Ve:""}(),_r=Lt.toString,Ar=Tt.call(Object),Rr=RegExp("^"+Tt.call(Kt).replace(re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),et=_e?Nr.Buffer:void 0,gt=Nr.Symbol,dt=Nr.Uint8Array,fr=et?et.allocUnsafe:void 0,$r=Ae(Object.getPrototypeOf,Object),mt=Object.create,Dt=Lt.propertyIsEnumerable,ar=Je.splice,sr=gt?gt.toStringTag:void 0,yn=function(){try{var Ve=oa(Object,"defineProperty");return Ve({},"",{}),Ve}catch(Ft){}}(),_n=et?et.isBuffer:void 0,ai=Math.max,vi=Date.now,Di=oa(Nr,"Map"),Zi=oa(Object,"create"),oi=function(){function Ve(){}return function(Ft){if(!ao(Ft))return{};if(mt)return mt(Ft);Ve.prototype=Ft;var br=new Ve;return Ve.prototype=void 0,br}}();function $(Ve){var Ft=-1,br=Ve==null?0:Ve.length;for(this.clear();++Ft<br;){var Cn=Ve[Ft];this.set(Cn[0],Cn[1])}}function I(){this.__data__=Zi?Zi(null):{},this.size=0}function j(Ve){var Ft=this.has(Ve)&&delete this.__data__[Ve];return this.size-=Ft?1:0,Ft}function Y(Ve){var Ft=this.__data__;if(Zi){var br=Ft[Ve];return br===b?void 0:br}return Kt.call(Ft,Ve)?Ft[Ve]:void 0}function ue(Ve){var Ft=this.__data__;return Zi?Ft[Ve]!==void 0:Kt.call(Ft,Ve)}function De(Ve,Ft){var br=this.__data__;return this.size+=this.has(Ve)?0:1,br[Ve]=Zi&&Ft===void 0?b:Ft,this}$.prototype.clear=I,$.prototype.delete=j,$.prototype.get=Y,$.prototype.has=ue,$.prototype.set=De;function He(Ve){var Ft=-1,br=Ve==null?0:Ve.length;for(this.clear();++Ft<br;){var Cn=Ve[Ft];this.set(Cn[0],Cn[1])}}function he(){this.__data__=[],this.size=0}function Ne(Ve){var Ft=this.__data__,br=xo(Ft,Ve);if(br<0)return!1;var Cn=Ft.length-1;return br==Cn?Ft.pop():ar.call(Ft,br,1),--this.size,!0}function Ct(Ve){var Ft=this.__data__,br=xo(Ft,Ve);return br<0?void 0:Ft[br][1]}function kr(Ve){return xo(this.__data__,Ve)>-1}function jr(Ve,Ft){var br=this.__data__,Cn=xo(br,Ve);return Cn<0?(++this.size,br.push([Ve,Ft])):br[Cn][1]=Ft,this}He.prototype.clear=he,He.prototype.delete=Ne,He.prototype.get=Ct,He.prototype.has=kr,He.prototype.set=jr;function $t(Ve){var Ft=-1,br=Ve==null?0:Ve.length;for(this.clear();++Ft<br;){var Cn=Ve[Ft];this.set(Cn[0],Cn[1])}}function yr(){this.size=0,this.__data__={hash:new $,map:new(Di||He),string:new $}}function qr(Ve){var Ft=io(this,Ve).delete(Ve);return this.size-=Ft?1:0,Ft}function gn(Ve){return io(this,Ve).get(Ve)}function dr(Ve){return io(this,Ve).has(Ve)}function hn(Ve,Ft){var br=io(this,Ve),Cn=br.size;return br.set(Ve,Ft),this.size+=br.size==Cn?0:1,this}$t.prototype.clear=yr,$t.prototype.delete=qr,$t.prototype.get=gn,$t.prototype.has=dr,$t.prototype.set=hn;function ln(Ve){var Ft=this.__data__=new He(Ve);this.size=Ft.size}function fn(){this.__data__=new He,this.size=0}function ri(Ve){var Ft=this.__data__,br=Ft.delete(Ve);return this.size=Ft.size,br}function dn(Ve){return this.__data__.get(Ve)}function ci(Ve){return this.__data__.has(Ve)}function Bi(Ve,Ft){var br=this.__data__;if(br instanceof He){var Cn=br.__data__;if(!Di||Cn.length<V-1)return Cn.push([Ve,Ft]),this.size=++br.size,this;br=this.__data__=new $t(Cn)}return br.set(Ve,Ft),this.size=br.size,this}ln.prototype.clear=fn,ln.prototype.delete=ri,ln.prototype.get=dn,ln.prototype.has=ci,ln.prototype.set=Bi;function pi(Ve,Ft){var br=ko(Ve),Cn=!br&&Wa(Ve),Yi=!br&&!Cn&&Qu(Ve),Aa=!br&&!Cn&&!Yi&&xa(Ve),za=br||Cn||Yi||Aa,sa=za?w(Ve.length,String):[],La=sa.length;for(var vs in Ve)(Ft||Kt.call(Ve,vs))&&!(za&&(vs=="length"||Yi&&(vs=="offset"||vs=="parent")||Aa&&(vs=="buffer"||vs=="byteLength"||vs=="byteOffset")||ts(vs,La)))&&sa.push(vs);return sa}function _i(Ve,Ft,br){(br!==void 0&&!Vi(Ve[Ft],br)||br===void 0&&!(Ft in Ve))&&Wi(Ve,Ft,br)}function Ai(Ve,Ft,br){var Cn=Ve[Ft];(!(Kt.call(Ve,Ft)&&Vi(Cn,br))||br===void 0&&!(Ft in Ve))&&Wi(Ve,Ft,br)}function xo(Ve,Ft){for(var br=Ve.length;br--;)if(Vi(Ve[br][0],Ft))return br;return-1}function Wi(Ve,Ft,br){Ft=="__proto__"&&yn?yn(Ve,Ft,{configurable:!0,enumerable:!0,value:br,writable:!0}):Ve[Ft]=br}var mi=Ga();function Fn(Ve){return Ve==null?Ve===void 0?Gt:Bt:sr&&sr in Object(Ve)?qi(Ve):Ke(Ve)}function kn(Ve){return Ds(Ve)&&Fn(Ve)==F}function Zn(Ve){if(!ao(Ve)||la(Ve))return!1;var Ft=rs(Ve)?Rr:ke;return Ft.test(_a(Ve))}function ra(Ve){return Ds(Ve)&&ds(Ve.length)&&!!Wt[Fn(Ve)]}function js(Ve){if(!ao(Ve))return pe(Ve);var Ft=it(Ve),br=[];for(var Cn in Ve)Cn=="constructor"&&(Ft||!Kt.call(Ve,Cn))||br.push(Cn);return br}function ua(Ve,Ft,br,Cn,Yi){Ve!==Ft&&mi(Ft,function(Aa,za){if(Yi||(Yi=new ln),ao(Aa))Ki(Ve,Ft,za,br,ua,Cn,Yi);else{var sa=Cn?Cn(Wr(Ve,za),Aa,za+"",Ve,Ft,Yi):void 0;sa===void 0&&(sa=Aa),_i(Ve,za,sa)}},Ja)}function Ki(Ve,Ft,br,Cn,Yi,Aa,za){var sa=Wr(Ve,br),La=Wr(Ft,br),vs=za.get(La);if(vs){_i(Ve,br,vs);return}var ks=Aa?Aa(sa,La,br+"",Ve,Ft,za):void 0,ha=ks===void 0;if(ha){var fl=ko(La),xu=!fl&&Qu(La),ms=!fl&&!xu&&xa(La);ks=La,fl||xu||ms?ko(sa)?ks=sa:_u(sa)?ks=Na(sa):xu?(ha=!1,ks=ya(La,!0)):ms?(ha=!1,ks=Ya(La,!0)):ks=[]:su(La)||Wa(La)?(ks=sa,Wa(sa)?ks=bi(sa):(!ao(sa)||rs(sa))&&(ks=Pl(La))):ha=!1}ha&&(za.set(La,ks),Yi(ks,La,Cn,Aa,za),za.delete(La)),_i(Ve,br,ks)}function mu(Ve,Ft){return bn(qt(Ve,Ft,oo),Ve+"")}var gu=yn?function(Ve,Ft){return yn(Ve,"toString",{configurable:!0,enumerable:!1,value:Co(Ft),writable:!0})}:oo;function ya(Ve,Ft){if(Ft)return Ve.slice();var br=Ve.length,Cn=fr?fr(br):new Ve.constructor(br);return Ve.copy(Cn),Cn}function no(Ve){var Ft=new Ve.constructor(Ve.byteLength);return new dt(Ft).set(new dt(Ve)),Ft}function Ya(Ve,Ft){var br=Ft?no(Ve.buffer):Ve.buffer;return new Ve.constructor(br,Ve.byteOffset,Ve.length)}function Na(Ve,Ft){var br=-1,Cn=Ve.length;for(Ft||(Ft=Array(Cn));++br<Cn;)Ft[br]=Ve[br];return Ft}function Ho(Ve,Ft,br,Cn){var Yi=!br;br||(br={});for(var Aa=-1,za=Ft.length;++Aa<za;){var sa=Ft[Aa],La=Cn?Cn(br[sa],Ve[sa],sa,br,Ve):void 0;La===void 0&&(La=Ve[sa]),Yi?Wi(br,sa,La):Ai(br,sa,La)}return br}function aa(Ve){return mu(function(Ft,br){var Cn=-1,Yi=br.length,Aa=Yi>1?br[Yi-1]:void 0,za=Yi>2?br[2]:void 0;for(Aa=Ve.length>3&&typeof Aa=="function"?(Yi--,Aa):void 0,za&&$a(br[0],br[1],za)&&(Aa=Yi<3?void 0:Aa,Yi=1),Ft=Object(Ft);++Cn<Yi;){var sa=br[Cn];sa&&Ve(Ft,sa,Cn,Aa)}return Ft})}function Ga(Ve){return function(Ft,br,Cn){for(var Yi=-1,Aa=Object(Ft),za=Cn(Ft),sa=za.length;sa--;){var La=za[Ve?sa:++Yi];if(br(Aa[La],La,Aa)===!1)break}return Ft}}function io(Ve,Ft){var br=Ve.__data__;return Ha(Ft)?br[typeof Ft=="string"?"string":"hash"]:br.map}function oa(Ve,Ft){var br=ve(Ve,Ft);return Zn(br)?br:void 0}function qi(Ve){var Ft=Kt.call(Ve,sr),br=Ve[sr];try{Ve[sr]=void 0;var Cn=!0}catch(Aa){}var Yi=_r.call(Ve);return Cn&&(Ft?Ve[sr]=br:delete Ve[sr]),Yi}function Pl(Ve){return typeof Ve.constructor=="function"&&!it(Ve)?oi($r(Ve)):{}}function ts(Ve,Ft){var br=typeof Ve;return Ft=Ft==null?S:Ft,!!Ft&&(br=="number"||br!="symbol"&&qe.test(Ve))&&Ve>-1&&Ve%1==0&&Ve<Ft}function $a(Ve,Ft,br){if(!ao(br))return!1;var Cn=typeof Ft;return(Cn=="number"?yu(br)&&ts(Ft,br.length):Cn=="string"&&Ft in br)?Vi(br[Ft],Ve):!1}function Ha(Ve){var Ft=typeof Ve;return Ft=="string"||Ft=="number"||Ft=="symbol"||Ft=="boolean"?Ve!=="__proto__":Ve===null}function la(Ve){return!!hr&&hr in Ve}function it(Ve){var Ft=Ve&&Ve.constructor,br=typeof Ft=="function"&&Ft.prototype||Lt;return Ve===br}function pe(Ve){var Ft=[];if(Ve!=null)for(var br in Object(Ve))Ft.push(br);return Ft}function Ke(Ve){return _r.call(Ve)}function qt(Ve,Ft,br){return Ft=ai(Ft===void 0?Ve.length-1:Ft,0),function(){for(var Cn=arguments,Yi=-1,Aa=ai(Cn.length-Ft,0),za=Array(Aa);++Yi<Aa;)za[Yi]=Cn[Ft+Yi];Yi=-1;for(var sa=Array(Ft+1);++Yi<Ft;)sa[Yi]=Cn[Yi];return sa[Ft]=br(za),jt(Ve,this,sa)}}function Wr(Ve,Ft){if(!(Ft==="constructor"&&typeof Ve[Ft]=="function")&&Ft!="__proto__")return Ve[Ft]}var bn=xi(gu);function xi(Ve){var Ft=0,br=0;return function(){var Cn=vi(),Yi=G-(Cn-br);if(br=Cn,Yi>0){if(++Ft>=p)return arguments[0]}else Ft=0;return Ve.apply(void 0,arguments)}}function _a(Ve){if(Ve!=null){try{return Tt.call(Ve)}catch(Ft){}try{return Ve+""}catch(Ft){}}return""}function Vi(Ve,Ft){return Ve===Ft||Ve!==Ve&&Ft!==Ft}var Wa=kn(function(){return arguments}())?kn:function(Ve){return Ds(Ve)&&Kt.call(Ve,"callee")&&!Dt.call(Ve,"callee")},ko=Array.isArray;function yu(Ve){return Ve!=null&&ds(Ve.length)&&!rs(Ve)}function _u(Ve){return Ds(Ve)&&yu(Ve)}var Qu=_n||cl;function rs(Ve){if(!ao(Ve))return!1;var Ft=Fn(Ve);return Ft==Be||Ft==Oe||Ft==ce||Ft==xt}function ds(Ve){return typeof Ve=="number"&&Ve>-1&&Ve%1==0&&Ve<=S}function ao(Ve){var Ft=typeof Ve;return Ve!=null&&(Ft=="object"||Ft=="function")}function Ds(Ve){return Ve!=null&&typeof Ve=="object"}function su(Ve){if(!Ds(Ve)||Fn(Ve)!=Qe)return!1;var Ft=$r(Ve);if(Ft===null)return!0;var br=Kt.call(Ft,"constructor")&&Ft.constructor;return typeof br=="function"&&br instanceof br&&Tt.call(br)==Ar}var xa=Rt?N(Rt):ra;function bi(Ve){return Ho(Ve,Ja(Ve))}function Ja(Ve){return yu(Ve)?pi(Ve,!0):js(Ve)}var ba=aa(function(Ve,Ft,br,Cn){ua(Ve,Ft,br,Cn)});function Co(Ve){return function(){return Ve}}function oo(Ve){return Ve}function cl(){return!1}_t.exports=ba},41176:function(_t,O,y){var V=200,b="__lodash_hash_undefined__",p=1/0,G="[object Function]",S="[object GeneratorFunction]",F=/[\\^$.*+?()[\]{}|]/g,te=/^\[object .+?Constructor\]$/,ce=typeof y.g=="object"&&y.g&&y.g.Object===Object&&y.g,q=typeof self=="object"&&self&&self.Object===Object&&self,we=ce||q||Function("return this")();function Pe(mt,Dt){var ar=mt?mt.length:0;return!!ar&&Nt(mt,Dt,0)>-1}function Be(mt,Dt,ar){for(var sr=-1,yn=mt?mt.length:0;++sr<yn;)if(ar(Dt,mt[sr]))return!0;return!1}function Oe(mt,Dt,ar,sr){for(var yn=mt.length,_n=ar+(sr?1:-1);sr?_n--:++_n<yn;)if(Dt(mt[_n],_n,mt))return _n;return-1}function Nt(mt,Dt,ar){if(Dt!==Dt)return Oe(mt,Xt,ar);for(var sr=ar-1,yn=mt.length;++sr<yn;)if(mt[sr]===Dt)return sr;return-1}function Xt(mt){return mt!==mt}function Bt(mt,Dt){return mt.has(Dt)}function Qe(mt,Dt){return mt==null?void 0:mt[Dt]}function xt(mt){var Dt=!1;if(mt!=null&&typeof mt.toString!="function")try{Dt=!!(mt+"")}catch(ar){}return Dt}function nt(mt){var Dt=-1,ar=Array(mt.size);return mt.forEach(function(sr){ar[++Dt]=sr}),ar}var cr=Array.prototype,At=Function.prototype,Gt=Object.prototype,St=we["__core-js_shared__"],Ze=function(){var mt=/[^.]+$/.exec(St&&St.keys&&St.keys.IE_PROTO||"");return mt?"Symbol(src)_1."+mt:""}(),yt=At.toString,Me=Gt.hasOwnProperty,Te=Gt.toString,Ie=RegExp("^"+yt.call(Me).replace(F,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bt=cr.splice,tr=hr(we,"Map"),ae=hr(we,"Set"),Ee=hr(Object,"create");function le(mt){var Dt=-1,ar=mt?mt.length:0;for(this.clear();++Dt<ar;){var sr=mt[Dt];this.set(sr[0],sr[1])}}function Q(){this.__data__=Ee?Ee(null):{}}function re(mt){return this.has(mt)&&delete this.__data__[mt]}function ke(mt){var Dt=this.__data__;if(Ee){var ar=Dt[mt];return ar===b?void 0:ar}return Me.call(Dt,mt)?Dt[mt]:void 0}function qe(mt){var Dt=this.__data__;return Ee?Dt[mt]!==void 0:Me.call(Dt,mt)}function Wt(mt,Dt){var ar=this.__data__;return ar[mt]=Ee&&Dt===void 0?b:Dt,this}le.prototype.clear=Q,le.prototype.delete=re,le.prototype.get=ke,le.prototype.has=qe,le.prototype.set=Wt;function Or(mt){var Dt=-1,ar=mt?mt.length:0;for(this.clear();++Dt<ar;){var sr=mt[Dt];this.set(sr[0],sr[1])}}function wr(){this.__data__=[]}function Nr(mt){var Dt=this.__data__,ar=st(Dt,mt);if(ar<0)return!1;var sr=Dt.length-1;return ar==sr?Dt.pop():bt.call(Dt,ar,1),!0}function Vt(mt){var Dt=this.__data__,ar=st(Dt,mt);return ar<0?void 0:Dt[ar][1]}function se(mt){return st(this.__data__,mt)>-1}function _e(mt,Dt){var ar=this.__data__,sr=st(ar,mt);return sr<0?ar.push([mt,Dt]):ar[sr][1]=Dt,this}Or.prototype.clear=wr,Or.prototype.delete=Nr,Or.prototype.get=Vt,Or.prototype.has=se,Or.prototype.set=_e;function Le(mt){var Dt=-1,ar=mt?mt.length:0;for(this.clear();++Dt<ar;){var sr=mt[Dt];this.set(sr[0],sr[1])}}function ot(){this.__data__={hash:new le,map:new(tr||Or),string:new le}}function Rt(mt){return Kt(this,mt).delete(mt)}function jt(mt){return Kt(this,mt).get(mt)}function w(mt){return Kt(this,mt).has(mt)}function N(mt,Dt){return Kt(this,mt).set(mt,Dt),this}Le.prototype.clear=ot,Le.prototype.delete=Rt,Le.prototype.get=jt,Le.prototype.has=w,Le.prototype.set=N;function ve(mt){var Dt=-1,ar=mt?mt.length:0;for(this.__data__=new Le;++Dt<ar;)this.add(mt[Dt])}function Ae(mt){return this.__data__.set(mt,b),this}function Je(mt){return this.__data__.has(mt)}ve.prototype.add=ve.prototype.push=Ae,ve.prototype.has=Je;function st(mt,Dt){for(var ar=mt.length;ar--;)if(gt(mt[ar][0],Dt))return ar;return-1}function Lt(mt){if(!fr(mt)||Ar(mt))return!1;var Dt=dt(mt)||xt(mt)?Ie:te;return Dt.test(Rr(mt))}function X(mt,Dt,ar){var sr=-1,yn=Pe,_n=mt.length,ai=!0,vi=[],Di=vi;if(ar)ai=!1,yn=Be;else if(_n>=V){var Zi=Dt?null:Tt(mt);if(Zi)return nt(Zi);ai=!1,yn=Bt,Di=new ve}else Di=Dt?[]:vi;e:for(;++sr<_n;){var oi=mt[sr],$=Dt?Dt(oi):oi;if(oi=ar||oi!==0?oi:0,ai&&$===$){for(var I=Di.length;I--;)if(Di[I]===$)continue e;Dt&&Di.push($),vi.push(oi)}else yn(Di,$,ar)||(Di!==vi&&Di.push($),vi.push(oi))}return vi}var Tt=ae&&1/nt(new ae([,-0]))[1]==p?function(mt){return new ae(mt)}:$r;function Kt(mt,Dt){var ar=mt.__data__;return _r(Dt)?ar[typeof Dt=="string"?"string":"hash"]:ar.map}function hr(mt,Dt){var ar=Qe(mt,Dt);return Lt(ar)?ar:void 0}function _r(mt){var Dt=typeof mt;return Dt=="string"||Dt=="number"||Dt=="symbol"||Dt=="boolean"?mt!=="__proto__":mt===null}function Ar(mt){return!!Ze&&Ze in mt}function Rr(mt){if(mt!=null){try{return yt.call(mt)}catch(Dt){}try{return mt+""}catch(Dt){}}return""}function et(mt){return mt&&mt.length?X(mt):[]}function gt(mt,Dt){return mt===Dt||mt!==mt&&Dt!==Dt}function dt(mt){var Dt=fr(mt)?Te.call(mt):"";return Dt==G||Dt==S}function fr(mt){var Dt=typeof mt;return!!mt&&(Dt=="object"||Dt=="function")}function $r(){}_t.exports=et},2614:function(_t){(function(O,y){_t.exports=y()})(this,function(){"use strict";var O,y,V;function b(p,G){if(!O)O=G;else if(!y)y=G;else{var S="var sharedChunk = {}; ("+O+")(sharedChunk); ("+y+")(sharedChunk);",F={};O(F),V=G(F),typeof window!="undefined"&&(V.workerUrl=window.URL.createObjectURL(new Blob([S],{type:"text/javascript"})))}}return b(["exports"],function(p){"use strict";function G(e,t){return e(t={exports:{}},t.exports),t.exports}var S=F;function F(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}F.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},F.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},F.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},F.prototype.solveCurveX=function(e,t){var r,f,v,m,x;for(t===void 0&&(t=1e-6),v=e,x=0;x<8;x++){if(m=this.sampleCurveX(v)-e,Math.abs(m)<t)return v;var A=this.sampleCurveDerivativeX(v);if(Math.abs(A)<1e-6)break;v-=m/A}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(m=this.sampleCurveX(v),Math.abs(m-e)<t)return v;e>m?r=v:f=v,v=.5*(f-r)+r}return v},F.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var te=ce;function ce(e,t){this.x=e,this.y=t}ce.prototype={clone:function(){return new ce(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,r){return this.clone()._rotateAround(t,r)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var r=t.x-this.x,f=t.y-this.y;return r*r+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)},_matMult:function(t){var r=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var r=Math.cos(t),f=Math.sin(t),v=f*this.x+r*this.y;return this.x=r*this.x-f*this.y,this.y=v,this},_rotateAround:function(t,r){var f=Math.cos(t),v=Math.sin(t),m=r.y+v*(this.x-r.x)+f*(this.y-r.y);return this.x=r.x+f*(this.x-r.x)-v*(this.y-r.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ce.convert=function(e){return e instanceof ce?e:Array.isArray(e)?new ce(e[0],e[1]):e};var q=typeof self!="undefined"?self:{},we=Math.pow(2,53)-1;function Pe(e,t,r,f){var v=new S(e,t,r,f);return function(m){return v.solve(m)}}var Be=Pe(.25,.1,.25,1);function Oe(e,t,r){return Math.min(r,Math.max(t,e))}function Nt(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function Xt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var m=v[f];for(var x in m)e[x]=m[x]}return e}var Bt=1;function Qe(){return Bt++}function xt(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function nt(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function cr(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function At(e,t){return e.indexOf(t,e.length-t.length)!==-1}function Gt(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function St(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function Ze(e){return Array.isArray(e)?e.map(Ze):typeof e=="object"&&e?Gt(e,Ze):e}var yt={};function Me(e){yt[e]||(typeof console!="undefined"&&console.warn(e),yt[e]=!0)}function Te(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Ie(e){for(var t=0,r=0,f=e.length,v=f-1,m=void 0,x=void 0;r<f;v=r++)t+=((x=e[v]).x-(m=e[r]).x)*(m.y+x.y);return t}function bt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function tr(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,m,x){var A=m||x;return t[v]=!A||A.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var ae=null;function Ee(e){if(ae==null){var t=e.navigator?e.navigator.userAgent:null;ae=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ae}function le(e){try{var t=q[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var Q,re,ke,qe,Wt=q.performance&&q.performance.now?q.performance.now.bind(q.performance):Date.now.bind(Date),Or=q.requestAnimationFrame||q.mozRequestAnimationFrame||q.webkitRequestAnimationFrame||q.msRequestAnimationFrame,wr=q.cancelAnimationFrame||q.mozCancelAnimationFrame||q.webkitCancelAnimationFrame||q.msCancelAnimationFrame,Nr={now:Wt,frame:function(t){var r=Or(t);return{cancel:function(){return wr(r)}}},getImageData:function(t,r){r===void 0&&(r=0);var f=q.document.createElement("canvas"),v=f.getContext("2d");if(!v)throw new Error("failed to create canvas 2d context");return f.width=t.width,f.height=t.height,v.drawImage(t,0,0,t.width,t.height),v.getImageData(-r,-r,t.width+2*r,t.height+2*r)},resolveURL:function(t){return Q||(Q=q.document.createElement("a")),Q.href=t,Q.href},hardwareConcurrency:q.navigator&&q.navigator.hardwareConcurrency||4,get devicePixelRatio(){return q.devicePixelRatio},get prefersReducedMotion(){return!!q.matchMedia&&(re==null&&(re=q.matchMedia("(prefers-reduced-motion: reduce)")),re.matches)}},Vt={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},se={supported:!1,testSupport:function(t){!_e&&qe&&(Le?ot(t):ke=t)}},_e=!1,Le=!1;function ot(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,qe),e.isContextLost())return;se.supported=!0}catch(r){}e.deleteTexture(t),_e=!0}q.document&&((qe=q.document.createElement("img")).onload=function(){ke&&ot(ke),ke=null,Le=!0},qe.onerror=function(){_e=!0,ke=null},qe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Rt="01",jt=function(t,r){this._transformRequestFn=t,this._customAccessToken=r,this._createSkuToken()};function w(e){return e.indexOf("mapbox:")===0}jt.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Rt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},jt.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},jt.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},jt.prototype.normalizeStyleURL=function(e,t){if(!w(e))return e;var r=Je(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},jt.prototype.normalizeGlyphsURL=function(e,t){if(!w(e))return e;var r=Je(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},jt.prototype.normalizeSourceURL=function(e,t){if(!w(e))return e;var r=Je(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},jt.prototype.normalizeSpriteURL=function(e,t,r,f){var v=Je(e);return w(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,st(v))},jt.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!w(e))return e;var r=Je(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Nr.devicePixelRatio>=2||t===512?"@2x":"")+(se.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var m=0,x=v;m<x.length;m+=1){var A=x[m].match(/^access_token=(.*)$/);if(A)return A[1]}return null}(r.params)||Vt.ACCESS_TOKEN;return Vt.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},jt.prototype.canonicalizeTileURL=function(e,t){var r=Je(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(m){return!m.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},jt.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&w(t),f=[],v=0,m=e.tiles||[];v<m.length;v+=1){var x=m[v];ve(x)?f.push(this.canonicalizeTileURL(x,r)):f.push(x)}return f},jt.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=Je(Vt.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!Vt.REQUIRE_ACCESS_TOKEN)return st(e);if(!(t=t||Vt.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(m){return m.indexOf("access_token")===-1}),e.params.push("access_token="+t),st(e)};var N=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ve(e){return N.test(e)}var Ae=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Je(e){var t=e.match(Ae);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function st(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function Lt(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(q.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var X=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};X.prototype.getStorageKey=function(e){var t,r=Lt(Vt.ACCESS_TOKEN);return t=r&&r.u?q.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):Vt.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},X.prototype.fetchEventData=function(){var e=le("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=q.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=q.localStorage.getItem(r);v&&(this.anonId=v)}catch(m){Me("Unable to read from LocalStorage")}},X.prototype.saveEventData=function(){var e=le("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{q.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&q.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){Me("Unable to write to LocalStorage")}},X.prototype.processRequests=function(e){},X.prototype.postEvent=function(e,t,r,f){var v=this;if(Vt.EVENTS_URL){var m=Je(Vt.EVENTS_URL);m.params.push("access_token="+(f||Vt.ACCESS_TOKEN||""));var x={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:Rt,userId:this.anonId},A=t?Xt(x,t):x,D={url:st(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=oi(D,function(z){v.pendingRequest=null,r(z),v.saveEventData(),v.processRequests(f)})}},X.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var Tt,Kt,hr=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,m){this.skuToken=v,(Vt.EVENTS_URL&&m||Vt.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(x){return w(x)||ve(x)}))&&this.queueRequest({id:f,timestamp:Date.now()},m)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),m=v.id,x=v.timestamp;m&&this.success[m]||(this.anonId||this.fetchEventData(),nt(this.anonId)||(this.anonId=xt()),this.postEvent(x,{skuToken:this.skuToken},function(A){A||m&&(f.success[m]=!0)},r))}},t}(X),_r=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){Vt.EVENTS_URL&&Vt.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return w(v)||ve(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=Lt(Vt.ACCESS_TOKEN),m=v?v.u:Vt.ACCESS_TOKEN,x=m!==this.eventData.tokenU;nt(this.anonId)||(this.anonId=xt(),x=!0);var A=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),z=new Date(A),W=(A-this.eventData.lastSuccess)/864e5;x=x||W>=1||W<-1||D.getDate()!==z.getDate()}else x=!0;if(!x)return this.processRequests();this.postEvent(A,{"enabled.telemetry":!1},function(ie){ie||(f.eventData.lastSuccess=A,f.eventData.tokenU=m)},r)}},t}(X)),Ar=_r.postTurnstileEvent.bind(_r),Rr=new hr,et=Rr.postMapLoadEvent.bind(Rr),gt=500,dt=50;function fr(){q.caches&&!Tt&&(Tt=q.caches.open("mapbox-tiles"))}function $r(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var mt,Dt=1/0;function ar(){return mt==null&&(mt=q.OffscreenCanvas&&new q.OffscreenCanvas(1,1).getContext("2d")&&typeof q.createImageBitmap=="function"),mt}var sr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(sr);var yn=function(e){function t(r,f,v){f===401&&ve(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),_n=bt()?function(){return self.worker&&self.worker.referrer}:function(){return(q.location.protocol==="blob:"?q.parent:q).location.href},ai,vi,Di=function(t,r){if(!(/^file:/.test(f=t.url)||/^file:/.test(_n())&&!/^\w+:/.test(f))){if(q.fetch&&q.Request&&q.AbortController&&q.Request.prototype.hasOwnProperty("signal"))return function(v,m){var x,A=new q.AbortController,D=new q.Request(v.url,{method:v.method||"GET",body:v.body,credentials:v.credentials,headers:v.headers,referrer:_n(),signal:A.signal}),z=!1,W=!1,ie=(x=D.url).indexOf("sku=")>0&&ve(x);v.type==="json"&&D.headers.set("Accept","application/json");var oe=function(ze,at,ut){if(!W){if(ze&&ze.message!=="SecurityError"&&Me(ze),at&&ut)return xe(at);var Ot=Date.now();q.fetch(D).then(function(Yt){if(Yt.ok){var ir=ie?Yt.clone():null;return xe(Yt,ir,Ot)}return m(new yn(Yt.statusText,Yt.status,v.url))}).catch(function(Yt){Yt.code!==20&&m(new Error(Yt.message))})}},xe=function(ze,at,ut){(v.type==="arrayBuffer"?ze.arrayBuffer():v.type==="json"?ze.json():ze.text()).then(function(Ot){W||(at&&ut&&function(Yt,ir,Lr){if(fr(),Tt){var Er={status:ir.status,statusText:ir.statusText,headers:new q.Headers};ir.headers.forEach(function(cn,Ln){return Er.headers.set(Ln,cn)});var tn=tr(ir.headers.get("Cache-Control")||"");tn["no-store"]||(tn["max-age"]&&Er.headers.set("Expires",new Date(Lr+1e3*tn["max-age"]).toUTCString()),new Date(Er.headers.get("Expires")).getTime()-Lr<42e4||function(cn,Ln){if(Kt===void 0)try{new Response(new ReadableStream),Kt=!0}catch(Gn){Kt=!1}Kt?Ln(cn.body):cn.blob().then(Ln)}(ir,function(cn){var Ln=new q.Response(cn,Er);fr(),Tt&&Tt.then(function(Gn){return Gn.put($r(Yt.url),Ln)}).catch(function(Gn){return Me(Gn.message)})}))}}(D,at,ut),z=!0,m(null,Ot,ze.headers.get("Cache-Control"),ze.headers.get("Expires")))}).catch(function(Ot){W||m(new Error(Ot.message))})};return ie?function(je,ze){if(fr(),!Tt)return ze(null);var at=$r(je.url);Tt.then(function(ut){ut.match(at).then(function(Ot){var Yt=function(ir){if(!ir)return!1;var Lr=new Date(ir.headers.get("Expires")||0),Er=tr(ir.headers.get("Cache-Control")||"");return Lr>Date.now()&&!Er["no-cache"]}(Ot);ut.delete(at),Yt&&ut.put(at,Ot.clone()),ze(null,Ot,Yt)}).catch(ze)}).catch(ze)}(D,oe):oe(null,null),{cancel:function(){W=!0,z||A.abort()}}}(t,r);if(bt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,r,void 0,!0)}var f;return function(v,m){var x=new q.XMLHttpRequest;for(var A in x.open(v.method||"GET",v.url,!0),v.type==="arrayBuffer"&&(x.responseType="arraybuffer"),v.headers)x.setRequestHeader(A,v.headers[A]);return v.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=v.credentials==="include",x.onerror=function(){m(new Error(x.statusText))},x.onload=function(){if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){var D=x.response;if(v.type==="json")try{D=JSON.parse(x.response)}catch(z){return m(z)}m(null,D,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else m(new yn(x.statusText,x.status,v.url))},x.send(v.body),{cancel:function(){return x.abort()}}}(t,r)},Zi=function(t,r){return Di(Xt(t,{type:"arrayBuffer"}),r)},oi=function(t,r){return Di(Xt(t,{method:"POST"}),r)},$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ai=[],vi=0;var I=function e(t,r){if(se.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),vi>=Vt.MAX_PARALLEL_IMAGE_REQUESTS){var f={requestParameters:t,callback:r,cancelled:!1,cancel:function(){this.cancelled=!0}};return ai.push(f),f}vi++;var v=!1,m=function(){if(!v)for(v=!0,vi--;ai.length&&vi<Vt.MAX_PARALLEL_IMAGE_REQUESTS;){var D=ai.shift();D.cancelled||(D.cancel=e(D.requestParameters,D.callback).cancel)}},x=Zi(t,function(A,D,z,W){m(),A?r(A):D&&(ar()?function(ie,oe){var xe=new q.Blob([new Uint8Array(ie)],{type:"image/png"});q.createImageBitmap(xe).then(function(je){oe(null,je)}).catch(function(je){oe(new Error("Could not load image because of "+je.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(D,r):function(ie,oe,xe,je){var ze=new q.Image,at=q.URL;ze.onload=function(){oe(null,ze),at.revokeObjectURL(ze.src),ze.onload=null,q.requestAnimationFrame(function(){ze.src=$})},ze.onerror=function(){return oe(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ut=new q.Blob([new Uint8Array(ie)],{type:"image/png"});ze.cacheControl=xe,ze.expires=je,ze.src=ie.byteLength?at.createObjectURL(ut):$}(D,r,z,W))});return{cancel:function(){x.cancel(),m()}}};function j(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function Y(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var ue=function(t,r){r===void 0&&(r={}),Xt(this,r),this.type=t},De=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",Xt({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ue),He=function(){};He.prototype.on=function(e,t){return this._listeners=this._listeners||{},j(e,t,this._listeners),this},He.prototype.off=function(e,t){return Y(e,t,this._listeners),Y(e,t,this._oneTimeListeners),this},He.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},j(e,t,this._oneTimeListeners),this},He.prototype.fire=function(e,t){typeof e=="string"&&(e=new ue(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var m=0,x=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];m<x.length;m+=1){var A=x[m];Y(r,A,this._oneTimeListeners),A.call(this,e)}var D=this._eventedParent;D&&(Xt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(e))}else e instanceof De&&console.error(e.error);return this},He.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},He.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var he={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ne=function(t,r,f,v){this.message=(t?t+": ":"")+f,v&&(this.identifier=v),r!=null&&r.__line__&&(this.line=r.__line__)};function Ct(e){var t=e.value;return t?[new Ne(e.key,t,"constants have been deprecated as of v8")]:[]}function kr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var m=v[f];for(var x in m)e[x]=m[x]}return e}function jr(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function $t(e){if(Array.isArray(e))return e.map($t);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=$t(e[r]);return t}return jr(e)}var yr=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),qr=function(t,r){r===void 0&&(r=[]),this.parent=t,this.bindings={};for(var f=0,v=r;f<v.length;f+=1){var m=v[f];this.bindings[m[0]]=m[1]}};qr.prototype.concat=function(e){return new qr(this,e)},qr.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},qr.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var gn={kind:"null"},dr={kind:"number"},hn={kind:"string"},ln={kind:"boolean"},fn={kind:"color"},ri={kind:"object"},dn={kind:"value"},ci={kind:"collator"},Bi={kind:"formatted"},pi={kind:"resolvedImage"};function _i(e,t){return{kind:"array",itemType:e,N:t}}function Ai(e){if(e.kind==="array"){var t=Ai(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var xo=[gn,dr,hn,ln,fn,Bi,ri,_i(dn),pi];function Wi(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Wi(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=xo;r<f.length;r+=1)if(!Wi(f[r],t))return null}}return"Expected "+Ai(e)+" but found "+Ai(t)+" instead."}function mi(e,t){return t.some(function(r){return r.kind===e.kind})}function Fn(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var kn=G(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(A){return(A=Math.round(A))<0?0:A>255?255:A}function v(A){return f(A[A.length-1]==="%"?parseFloat(A)/100*255:parseInt(A))}function m(A){return(D=A[A.length-1]==="%"?parseFloat(A)/100:parseFloat(A))<0?0:D>1?1:D;var D}function x(A,D,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?A+(D-A)*z*6:2*z<1?D:3*z<2?A+(D-A)*(2/3-z)*6:A}try{t.parseCSSColor=function(A){var D,z=A.replace(/ /g,"").toLowerCase();if(z in r)return r[z].slice();if(z[0]==="#")return z.length===4?(D=parseInt(z.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:z.length===7&&(D=parseInt(z.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var W=z.indexOf("("),ie=z.indexOf(")");if(W!==-1&&ie+1===z.length){var oe=z.substr(0,W),xe=z.substr(W+1,ie-(W+1)).split(","),je=1;switch(oe){case"rgba":if(xe.length!==4)return null;je=m(xe.pop());case"rgb":return xe.length!==3?null:[v(xe[0]),v(xe[1]),v(xe[2]),je];case"hsla":if(xe.length!==4)return null;je=m(xe.pop());case"hsl":if(xe.length!==3)return null;var ze=(parseFloat(xe[0])%360+360)%360/360,at=m(xe[1]),ut=m(xe[2]),Ot=ut<=.5?ut*(at+1):ut+at-ut*at,Yt=2*ut-Ot;return[f(255*x(Yt,Ot,ze+1/3)),f(255*x(Yt,Ot,ze)),f(255*x(Yt,Ot,ze-1/3)),je];default:return null}}return null}}catch(A){}}).parseCSSColor,Zn=function(t,r,f,v){v===void 0&&(v=1),this.r=t,this.g=r,this.b=f,this.a=v};Zn.parse=function(e){if(e){if(e instanceof Zn)return e;if(typeof e=="string"){var t=kn(e);if(t)return new Zn(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Zn.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},Zn.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Zn.black=new Zn(0,0,0,1),Zn.white=new Zn(1,1,1,1),Zn.transparent=new Zn(0,0,0,0),Zn.red=new Zn(1,0,0,1);var ra=function(t,r,f){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ra.prototype.compare=function(e,t){return this.collator.compare(e,t)},ra.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var js=function(t,r,f,v,m){this.text=t,this.image=r,this.scale=f,this.fontStack=v,this.textColor=m},ua=function(t){this.sections=t};ua.fromString=function(e){return new ua([new js(e,null,null,null,null)])},ua.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},ua.factory=function(e){return e instanceof ua?e:ua.fromString(e)},ua.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},ua.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var Ki=function(t){this.name=t.name,this.available=t.available};function mu(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function gu(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Zn||e instanceof ra||e instanceof ua||e instanceof Ki)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!gu(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!gu(e[f]))return!1;return!0}return!1}function ya(e){if(e===null)return gn;if(typeof e=="string")return hn;if(typeof e=="boolean")return ln;if(typeof e=="number")return dr;if(e instanceof Zn)return fn;if(e instanceof ra)return ci;if(e instanceof ua)return Bi;if(e instanceof Ki)return pi;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var m=ya(v[f]);if(t){if(t===m)continue;t=dn;break}t=m}return _i(t||dn,r)}return ri}function no(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Zn||e instanceof ua||e instanceof Ki?e.toString():JSON.stringify(e)}Ki.prototype.toString=function(){return this.name},Ki.fromString=function(e){return e?new Ki({name:e,available:!1}):null},Ki.prototype.serialize=function(){return["image",this.name]};var Ya=function(t,r){this.type=t,this.value=r};Ya.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!gu(e[1]))return t.error("invalid value");var r=e[1],f=ya(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new Ya(f,r)},Ya.prototype.evaluate=function(){return this.value},Ya.prototype.eachChild=function(){},Ya.prototype.outputDefined=function(){return!0},Ya.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Zn?["rgba"].concat(this.value.toArray()):this.value instanceof ua?this.value.serialize():this.value};var Na=function(t){this.name="ExpressionEvaluationError",this.message=t};Na.prototype.toJSON=function(){return this.message};var Ho={string:hn,number:dr,boolean:ln,object:ri},aa=function(t,r){this.type=t,this.args=r};aa.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var m,x;if(e.length>2){var A=e[1];if(typeof A!="string"||!(A in Ho)||A==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);m=Ho[A],f++}else m=dn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);x=e[2],f++}r=_i(m,x)}else r=Ho[v];for(var D=[];f<e.length;f++){var z=t.parse(e[f],f,dn);if(!z)return null;D.push(z)}return new aa(r,D)},aa.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!Wi(this.type,ya(r)))return r;if(t===this.args.length-1)throw new Na("Expected value to be of type "+Ai(this.type)+", but found "+Ai(ya(r))+" instead.")}return null},aa.prototype.eachChild=function(e){this.args.forEach(e)},aa.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},aa.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Ga=function(t){this.type=Bi,this.sections=t};Ga.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,m=1;m<=e.length-1;++m){var x=e[m];if(v&&typeof x=="object"&&!Array.isArray(x)){v=!1;var A=null;if(x["font-scale"]&&!(A=t.parse(x["font-scale"],1,dr)))return null;var D=null;if(x["text-font"]&&!(D=t.parse(x["text-font"],1,_i(hn))))return null;var z=null;if(x["text-color"]&&!(z=t.parse(x["text-color"],1,fn)))return null;var W=f[f.length-1];W.scale=A,W.font=D,W.textColor=z}else{var ie=t.parse(e[m],1,dn);if(!ie)return null;var oe=ie.type.kind;if(oe!=="string"&&oe!=="value"&&oe!=="null"&&oe!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:ie,scale:null,font:null,textColor:null})}}return new Ga(f)},Ga.prototype.evaluate=function(e){return new ua(this.sections.map(function(t){var r=t.content.evaluate(e);return ya(r)===pi?new js("",r,null,null,null):new js(no(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Ga.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},Ga.prototype.outputDefined=function(){return!1},Ga.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var io=function(t){this.type=pi,this.input=t};io.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,hn);return r?new io(r):t.error("No image name provided.")},io.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=Ki.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},io.prototype.eachChild=function(e){e(this.input)},io.prototype.outputDefined=function(){return!1},io.prototype.serialize=function(){return["image",this.input.serialize()]};var oa={"to-boolean":ln,"to-color":fn,"to-number":dr,"to-string":hn},qi=function(t,r){this.type=t,this.args=r};qi.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=oa[r],v=[],m=1;m<e.length;m++){var x=t.parse(e[m],m,dn);if(!x)return null;v.push(x)}return new qi(f,v)},qi.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof Zn)return t;if(typeof t=="string"){var m=e.parseColor(t);if(m)return m}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":mu(t[0],t[1],t[2],t[3])))return new Zn(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Na(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var x=null,A=0,D=this.args;A<D.length;A+=1){if((x=D[A].evaluate(e))===null)return 0;var z=Number(x);if(!isNaN(z))return z}throw new Na("Could not convert "+JSON.stringify(x)+" to number.")}return this.type.kind==="formatted"?ua.fromString(no(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ki.fromString(no(this.args[0].evaluate(e))):no(this.args[0].evaluate(e))},qi.prototype.eachChild=function(e){this.args.forEach(e)},qi.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},qi.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ga([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new io(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var Pl=["Unknown","Point","LineString","Polygon"],ts=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ts.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ts.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Pl[this.feature.type]:this.feature.type:null},ts.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ts.prototype.canonicalID=function(){return this.canonical},ts.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ts.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Zn.parse(e)),t};var $a=function(t,r,f,v){this.name=t,this.type=r,this._evaluate=f,this.args=v};$a.prototype.evaluate=function(e){return this._evaluate(e,this.args)},$a.prototype.eachChild=function(e){this.args.forEach(e)},$a.prototype.outputDefined=function(){return!1},$a.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},$a.parse=function(e,t){var r,f=e[0],v=$a.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var m=Array.isArray(v)?v[0]:v.type,x=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,A=x.filter(function(Dn){var xn=Dn[0];return!Array.isArray(xn)||xn.length===e.length-1}),D=null,z=0,W=A;z<W.length;z+=1){var ie=W[z],oe=ie[0],xe=ie[1];D=new xa(t.registry,t.path,null,t.scope);for(var je=[],ze=!1,at=1;at<e.length;at++){var ut=e[at],Ot=Array.isArray(oe)?oe[at-1]:oe.type,Yt=D.parse(ut,1+je.length,Ot);if(!Yt){ze=!0;break}je.push(Yt)}if(!ze)if(Array.isArray(oe)&&oe.length!==je.length)D.error("Expected "+oe.length+" arguments, but found "+je.length+" instead.");else{for(var ir=0;ir<je.length;ir++){var Lr=Array.isArray(oe)?oe[ir]:oe.type,Er=je[ir];D.concat(ir+1).checkSubtype(Lr,Er.type)}if(D.errors.length===0)return new $a(f,m,xe,je)}}if(A.length===1)(r=t.errors).push.apply(r,D.errors);else{for(var tn=(A.length?A:x).map(function(Dn){var xn;return xn=Dn[0],Array.isArray(xn)?"("+xn.map(Ai).join(", ")+")":"("+Ai(xn.type)+"...)"}).join(" | "),cn=[],Ln=1;Ln<e.length;Ln++){var Gn=t.parse(e[Ln],1+cn.length);if(!Gn)return null;cn.push(Ai(Gn.type))}t.error("Expected arguments of type "+tn+", but found ("+cn.join(", ")+") instead.")}return null},$a.register=function(e,t){for(var r in $a.definitions=t,t)e[r]=$a};var Ha=function(t,r,f){this.type=ci,this.locale=f,this.caseSensitive=t,this.diacriticSensitive=r};function la(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function it(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function pe(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function Ke(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function qt(e,t){for(var r,f,v,m,x,A,D,z=!1,W=0,ie=t.length;W<ie;W++)for(var oe=t[W],xe=0,je=oe.length;xe<je-1;xe++){if((m=(r=e)[0]-(f=oe[xe])[0])*(D=r[1]-(v=oe[xe+1])[1])-(A=r[0]-v[0])*(x=r[1]-f[1])==0&&m*A<=0&&x*D<=0)return!1;Ke(e,oe[xe],oe[xe+1])&&(z=!z)}return z}function Wr(e,t){for(var r=0;r<t.length;r++)if(qt(e,t[r]))return!0;return!1}function bn(e,t,r,f){var v=f[0]-r[0],m=f[1]-r[1],x=(e[0]-r[0])*m-v*(e[1]-r[1]),A=(t[0]-r[0])*m-v*(t[1]-r[1]);return x>0&&A<0||x<0&&A>0}function xi(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var m=v[f],x=0;x<m.length-1;++x)if((ie=[(W=m[x+1])[0]-(z=m[x])[0],W[1]-z[1]])[0]*(oe=[(D=t)[0]-(A=e)[0],D[1]-A[1]])[1]-ie[1]*oe[0]!=0&&bn(A,D,z,W)&&bn(z,W,A,D))return!0;var A,D,z,W,ie,oe;return!1}function _a(e,t){for(var r=0;r<e.length;++r)if(!qt(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(xi(e[f],e[f+1],t))return!1;return!0}function Vi(e,t){for(var r=0;r<t.length;r++)if(_a(e,t[r]))return!0;return!1}function Wa(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var m=[],x=0;x<e[v].length;x++){var A=pe(e[v][x],r);la(t,A),m.push(A)}f.push(m)}return f}function ko(e,t,r){for(var f=[],v=0;v<e.length;v++){var m=Wa(e[v],t,r);f.push(m)}return f}function yu(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,m=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;m===0&&(m=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=m}la(t,e)}function _u(e,t,r,f){for(var v=8192*Math.pow(2,f.z),m=[8192*f.x,8192*f.y],x=[],A=0,D=e;A<D.length;A+=1)for(var z=0,W=D[A];z<W.length;z+=1){var ie=W[z],oe=[ie.x+m[0],ie.y+m[1]];yu(oe,t,r,v),x.push(oe)}return x}function Qu(e,t,r,f){for(var v,m=8192*Math.pow(2,f.z),x=[8192*f.x,8192*f.y],A=[],D=0,z=e;D<z.length;D+=1){for(var W=[],ie=0,oe=z[D];ie<oe.length;ie+=1){var xe=oe[ie],je=[xe.x+x[0],xe.y+x[1]];la(t,je),W.push(je)}A.push(W)}if(t[2]-t[0]<=m/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var ze=0,at=A;ze<at.length;ze+=1)for(var ut=0,Ot=at[ze];ut<Ot.length;ut+=1)yu(Ot[ut],t,r,m)}return A}Ha.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,ln);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,ln);if(!v)return null;var m=null;return r.locale&&!(m=t.parse(r.locale,1,hn))?null:new Ha(f,v,m)},Ha.prototype.evaluate=function(e){return new ra(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},Ha.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},Ha.prototype.outputDefined=function(){return!1},Ha.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var rs=function(t,r){this.type=ln,this.geojson=t,this.geometries=r};function ds(e){if(e instanceof $a&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof rs)return!1;var t=!0;return e.eachChild(function(r){t&&!ds(r)&&(t=!1)}),t}function ao(e){if(e instanceof $a&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!ao(r)&&(t=!1)}),t}function Ds(e,t){if(e instanceof $a&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!Ds(f,t)&&(r=!1)}),r}rs.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(gu(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new rs(r,r.features[f].geometry)}else if(r.type==="Feature"){var m=r.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new rs(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new rs(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},rs.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var x=Wa(r.coordinates,v,m),A=_u(t.geometry(),f,v,m);if(!it(f,v))return!1;for(var D=0,z=A;D<z.length;D+=1)if(!qt(z[D],x))return!1}if(r.type==="MultiPolygon"){var W=ko(r.coordinates,v,m),ie=_u(t.geometry(),f,v,m);if(!it(f,v))return!1;for(var oe=0,xe=ie;oe<xe.length;oe+=1)if(!Wr(xe[oe],W))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var x=Wa(r.coordinates,v,m),A=Qu(t.geometry(),f,v,m);if(!it(f,v))return!1;for(var D=0,z=A;D<z.length;D+=1)if(!_a(z[D],x))return!1}if(r.type==="MultiPolygon"){var W=ko(r.coordinates,v,m),ie=Qu(t.geometry(),f,v,m);if(!it(f,v))return!1;for(var oe=0,xe=ie;oe<xe.length;oe+=1)if(!Vi(xe[oe],W))return!1}return!0}(e,this.geometries)}return!1},rs.prototype.eachChild=function(){},rs.prototype.outputDefined=function(){return!0},rs.prototype.serialize=function(){return["within",this.geojson]};var su=function(t,r){this.type=r.type,this.name=t,this.boundExpression=r};su.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new su(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},su.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},su.prototype.eachChild=function(){},su.prototype.outputDefined=function(){return!1},su.prototype.serialize=function(){return["var",this.name]};var xa=function(t,r,f,v,m){r===void 0&&(r=[]),v===void 0&&(v=new qr),m===void 0&&(m=[]),this.registry=t,this.path=r,this.key=r.map(function(x){return"["+x+"]"}).join(""),this.scope=v,this.errors=m,this.expectedType=f};function bi(e,t){for(var r,f=e.length-1,v=0,m=f,x=0;v<=m;)if((r=e[x=Math.floor((v+m)/2)])<=t){if(x===f||t<e[x+1])return x;v=x+1}else{if(!(r>t))throw new Na("Input is not a number.");m=x-1}return 0}xa.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},xa.prototype._parse=function(e,t){function r(z,W,ie){return ie==="assert"?new aa(W,[z]):ie==="coerce"?new qi(W,[z]):z}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var m=v.parse(e,this);if(!m)return null;if(this.expectedType){var x=this.expectedType,A=m.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||A.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string"){if(this.checkSubtype(x,A))return null}else m=r(m,x,t.typeAnnotation||"coerce");else m=r(m,x,t.typeAnnotation||"assert")}if(!(m instanceof Ya)&&m.type.kind!=="resolvedImage"&&function z(W){if(W instanceof su)return z(W.boundExpression);if(W instanceof $a&&W.name==="error"||W instanceof Ha||W instanceof rs)return!1;var ie=W instanceof qi||W instanceof aa,oe=!0;return W.eachChild(function(xe){oe=ie?oe&&z(xe):oe&&xe instanceof Ya}),!!oe&&ds(W)&&Ds(W,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(m)){var D=new ts;try{m=new Ya(m.type,m.evaluate(D))}catch(z){return this.error(z.message),null}}return m}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},xa.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new xa(this.registry,f,t||null,v,this.errors)},xa.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new yr(f,e))},xa.prototype.checkSubtype=function(e,t){var r=Wi(e,t);return r&&this.error(r),r};var Ja=function(t,r,f){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(var v=0,m=f;v<m.length;v+=1){var x=m[v],A=x[1];this.labels.push(x[0]),this.outputs.push(A)}};function ba(e,t,r){return e*(1-r)+t*r}Ja.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,dr);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var m=1;m<e.length;m+=2){var x=m===1?-1/0:e[m],A=e[m+1],D=m,z=m+1;if(typeof x!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(f.length&&f[f.length-1][0]>=x)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var W=t.parse(A,z,v);if(!W)return null;v=v||W.type,f.push([x,W])}return new Ja(v,r,f)},Ja.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[bi(t,f)].evaluate(e)},Ja.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Ja.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Ja.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var Co=Object.freeze({__proto__:null,number:ba,color:function(t,r,f){return new Zn(ba(t.r,r.r,f),ba(t.g,r.g,f),ba(t.b,r.b,f),ba(t.a,r.a,f))},array:function(t,r,f){return t.map(function(v,m){return ba(v,r[m],f)})}}),oo=6/29*3*(6/29),cl=Math.PI/180,Ve=180/Math.PI;function Ft(e){return e>.008856451679035631?Math.pow(e,1/3):e/oo+4/29}function br(e){return e>6/29?e*e*e:oo*(e-4/29)}function Cn(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Yi(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Aa(e){var t=Yi(e.r),r=Yi(e.g),f=Yi(e.b),v=Ft((.4124564*t+.3575761*r+.1804375*f)/.95047),m=Ft((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*m-16,a:500*(v-m),b:200*(m-Ft((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function za(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*br(t),r=.95047*br(r),f=1.08883*br(f),new Zn(Cn(3.2404542*r-1.5371385*t-.4985314*f),Cn(-.969266*r+1.8760108*t+.041556*f),Cn(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function sa(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var La={forward:Aa,reverse:za,interpolate:function(t,r,f){return{l:ba(t.l,r.l,f),a:ba(t.a,r.a,f),b:ba(t.b,r.b,f),alpha:ba(t.alpha,r.alpha,f)}}},vs={forward:function(t){var r=Aa(t),f=r.l,v=r.a,m=r.b,x=Math.atan2(m,v)*Ve;return{h:x<0?x+360:x,c:Math.sqrt(v*v+m*m),l:f,alpha:t.a}},reverse:function(t){var r=t.h*cl,f=t.c;return za({l:t.l,a:Math.cos(r)*f,b:Math.sin(r)*f,alpha:t.alpha})},interpolate:function(t,r,f){return{h:sa(t.h,r.h,f),c:ba(t.c,r.c,f),l:ba(t.l,r.l,f),alpha:ba(t.alpha,r.alpha,f)}}},ks=Object.freeze({__proto__:null,lab:La,hcl:vs}),ha=function(t,r,f,v,m){this.type=t,this.operator=r,this.interpolation=f,this.input=v,this.labels=[],this.outputs=[];for(var x=0,A=m;x<A.length;x+=1){var D=A[x],z=D[1];this.labels.push(D[0]),this.outputs.push(z)}};function fl(e,t,r,f){var v=f-r,m=e-r;return v===0?0:t===1?m/v:(Math.pow(t,m)-1)/(Math.pow(t,v)-1)}ha.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=fl(t,e.base,r,f);else if(e.name==="linear")v=fl(t,1,r,f);else if(e.name==="cubic-bezier"){var m=e.controlPoints;v=new S(m[0],m[1],m[2],m[3]).solve(fl(t,1,r,f))}return v},ha.parse=function(e,t){var r=e[0],f=e[1],v=e[2],m=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var x=f[1];if(typeof x!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:x}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var A=f.slice(1);if(A.length!==4||A.some(function(at){return typeof at!="number"||at<0||at>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:A}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,dr)))return null;var D=[],z=null;r==="interpolate-hcl"||r==="interpolate-lab"?z=fn:t.expectedType&&t.expectedType.kind!=="value"&&(z=t.expectedType);for(var W=0;W<m.length;W+=2){var ie=m[W],oe=m[W+1],xe=W+3,je=W+4;if(typeof ie!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',xe);if(D.length&&D[D.length-1][0]>=ie)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',xe);var ze=t.parse(oe,je,z);if(!ze)return null;z=z||ze.type,D.push([ie,ze])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new ha(z,r,f,v,D):t.error("Type "+Ai(z)+" is not interpolatable.")},ha.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var m=bi(t,f),x=ha.interpolationFactor(this.interpolation,f,t[m],t[m+1]),A=r[m].evaluate(e),D=r[m+1].evaluate(e);return this.operator==="interpolate"?Co[this.type.kind.toLowerCase()](A,D,x):this.operator==="interpolate-hcl"?vs.reverse(vs.interpolate(vs.forward(A),vs.forward(D),x)):La.reverse(La.interpolate(La.forward(A),La.forward(D),x))},ha.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},ha.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ha.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var xu=function(t,r){this.type=t,this.args=r};xu.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],m=0,x=e.slice(1);m<x.length;m+=1){var A=t.parse(x[m],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!A)return null;r=r||A.type,v.push(A)}var D=f&&v.some(function(z){return Wi(f,z.type)});return new xu(D?dn:r,v)},xu.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,m=this.args;v<m.length&&(f++,(r=m[v].evaluate(e))&&r instanceof Ki&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},xu.prototype.eachChild=function(e){this.args.forEach(e)},xu.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},xu.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var ms=function(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r};ms.prototype.evaluate=function(e){return this.result.evaluate(e)},ms.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},ms.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var m=t.parse(e[f+1],f+1);if(!m)return null;r.push([v,m])}var x=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return x?new ms(r,x):null},ms.prototype.outputDefined=function(){return this.result.outputDefined()},ms.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var Ml=function(t,r,f){this.type=t,this.index=r,this.input=f};Ml.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,dr),f=t.parse(e[2],2,_i(t.expectedType||dn));return r&&f?new Ml(f.type.itemType,r,f):null},Ml.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Na("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Na("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Na("Array index must be an integer, but found "+t+" instead.");return r[t]},Ml.prototype.eachChild=function(e){e(this.index),e(this.input)},Ml.prototype.outputDefined=function(){return!1},Ml.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var zu=function(t,r){this.type=ln,this.needle=t,this.haystack=r};zu.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,dn),f=t.parse(e[2],2,dn);return r&&f?mi(r.type,[ln,hn,dr,gn,dn])?new zu(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ai(r.type)+" instead"):null},zu.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Fn(t,["boolean","string","number","null"]))throw new Na("Expected first argument to be of type boolean, string, number or null, but found "+Ai(ya(t))+" instead.");if(!Fn(r,["string","array"]))throw new Na("Expected second argument to be of type array or string, but found "+Ai(ya(r))+" instead.");return r.indexOf(t)>=0},zu.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},zu.prototype.outputDefined=function(){return!0},zu.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var qu=function(t,r,f){this.type=dr,this.needle=t,this.haystack=r,this.fromIndex=f};qu.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,dn),f=t.parse(e[2],2,dn);if(!r||!f)return null;if(!mi(r.type,[ln,hn,dr,gn,dn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ai(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,dr);return v?new qu(r,f,v):null}return new qu(r,f)},qu.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Fn(t,["boolean","string","number","null"]))throw new Na("Expected first argument to be of type boolean, string, number or null, but found "+Ai(ya(t))+" instead.");if(!Fn(r,["string","array"]))throw new Na("Expected second argument to be of type array or string, but found "+Ai(ya(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},qu.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},qu.prototype.outputDefined=function(){return!1},qu.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Fs=function(t,r,f,v,m,x){this.inputType=t,this.type=r,this.input=f,this.cases=v,this.outputs=m,this.otherwise=x};Fs.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},m=[],x=2;x<e.length-1;x+=2){var A=e[x],D=e[x+1];Array.isArray(A)||(A=[A]);var z=t.concat(x);if(A.length===0)return z.error("Expected at least one branch label.");for(var W=0,ie=A;W<ie.length;W+=1){var oe=ie[W];if(typeof oe!="number"&&typeof oe!="string")return z.error("Branch labels must be numbers or strings.");if(typeof oe=="number"&&Math.abs(oe)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof oe=="number"&&Math.floor(oe)!==oe)return z.error("Numeric branch labels must be integer values.");if(r){if(z.checkSubtype(r,ya(oe)))return null}else r=ya(oe);if(v[String(oe)]!==void 0)return z.error("Branch labels must be unique.");v[String(oe)]=m.length}var xe=t.parse(D,x,f);if(!xe)return null;f=f||xe.type,m.push(xe)}var je=t.parse(e[1],1,dn);if(!je)return null;var ze=t.parse(e[e.length-1],e.length-1,f);return ze?je.type.kind!=="value"&&t.concat(1).checkSubtype(r,je.type)?null:new Fs(r,f,je,v,m,ze):null},Fs.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(ya(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Fs.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Fs.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Fs.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,m=Object.keys(this.cases).sort();v<m.length;v+=1){var x=m[v];(ie=f[this.cases[x]])===void 0?(f[this.cases[x]]=r.length,r.push([this.cases[x],[x]])):r[ie][1].push(x)}for(var A=function(je){return e.inputType.kind==="number"?Number(je):je},D=0,z=r;D<z.length;D+=1){var W=z[D],ie=W[0],oe=W[1];t.push(oe.length===1?A(oe[0]):oe.map(A)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var Il=function(t,r,f){this.type=t,this.branches=r,this.otherwise=f};Il.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var m=t.parse(e[v],v,ln);if(!m)return null;var x=t.parse(e[v+1],v+1,r);if(!x)return null;f.push([m,x]),r=r||x.type}var A=t.parse(e[e.length-1],e.length-1,r);return A?new Il(r,f,A):null},Il.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},Il.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},Il.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},Il.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var gs=function(t,r,f,v){this.type=t,this.input=r,this.beginIndex=f,this.endIndex=v};function Jl(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Df(e,t,r,f){return f.compare(t,r)===0}function Ca(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(m,x,A){this.type=ln,this.lhs=m,this.rhs=x,this.collator=A,this.hasUntypedArgument=m.type.kind==="value"||x.type.kind==="value"}return v.parse=function(m,x){if(m.length!==3&&m.length!==4)return x.error("Expected two or three arguments.");var A=m[0],D=x.parse(m[1],1,dn);if(!D)return null;if(!Jl(A,D.type))return x.concat(1).error('"'+A+`" comparisons are not supported for type '`+Ai(D.type)+"'.");var z=x.parse(m[2],2,dn);if(!z)return null;if(!Jl(A,z.type))return x.concat(2).error('"'+A+`" comparisons are not supported for type '`+Ai(z.type)+"'.");if(D.type.kind!==z.type.kind&&D.type.kind!=="value"&&z.type.kind!=="value")return x.error("Cannot compare types '"+Ai(D.type)+"' and '"+Ai(z.type)+"'.");f&&(D.type.kind==="value"&&z.type.kind!=="value"?D=new aa(z.type,[D]):D.type.kind!=="value"&&z.type.kind==="value"&&(z=new aa(D.type,[z])));var W=null;if(m.length===4){if(D.type.kind!=="string"&&z.type.kind!=="string"&&D.type.kind!=="value"&&z.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(!(W=x.parse(m[3],3,ci)))return null}return new v(D,z,W)},v.prototype.evaluate=function(m){var x=this.lhs.evaluate(m),A=this.rhs.evaluate(m);if(f&&this.hasUntypedArgument){var D=ya(x),z=ya(A);if(D.kind!==z.kind||D.kind!=="string"&&D.kind!=="number")throw new Na('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+D.kind+", "+z.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var W=ya(x),ie=ya(A);if(W.kind!=="string"||ie.kind!=="string")return t(m,x,A)}return this.collator?r(m,x,A,this.collator.evaluate(m)):t(m,x,A)},v.prototype.eachChild=function(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var m=[e];return this.eachChild(function(x){m.push(x.serialize())}),m},v}()}gs.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,dn),f=t.parse(e[2],2,dr);if(!r||!f)return null;if(!mi(r.type,[_i(dn),hn,dn]))return t.error("Expected first argument to be of type array or string, but found "+Ai(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,dr);return v?new gs(r.type,r,f,v):null}return new gs(r.type,r,f)},gs.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Fn(t,["string","array"]))throw new Na("Expected first argument to be of type array or string, but found "+Ai(ya(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},gs.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},gs.prototype.outputDefined=function(){return!1},gs.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var $f=Ca("==",function(e,t,r){return t===r},Df),Uc=Ca("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!Df(0,t,r,f)}),af=Ca("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),Ef=Ca(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),of=Ca("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),go=Ca(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),Ol=function(t,r,f,v,m){this.type=hn,this.number=t,this.locale=r,this.currency=f,this.minFractionDigits=v,this.maxFractionDigits=m};Ol.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,dr);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,hn)))return null;var m=null;if(f.currency&&!(m=t.parse(f.currency,1,hn)))return null;var x=null;if(f["min-fraction-digits"]&&!(x=t.parse(f["min-fraction-digits"],1,dr)))return null;var A=null;return f["max-fraction-digits"]&&!(A=t.parse(f["max-fraction-digits"],1,dr))?null:new Ol(r,v,m,x,A)},Ol.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Ol.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Ol.prototype.outputDefined=function(){return!1},Ol.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Ll=function(t){this.type=dr,this.input=t};Ll.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Ai(r.type)+" instead."):new Ll(r):null},Ll.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Na("Expected value to be of type string or array, but found "+Ai(ya(t))+" instead.")},Ll.prototype.eachChild=function(e){e(this.input)},Ll.prototype.outputDefined=function(){return!1},Ll.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Es={"==":$f,"!=":Uc,">":Ef,"<":af,">=":go,"<=":of,array:aa,at:Ml,boolean:aa,case:Il,coalesce:xu,collator:Ha,format:Ga,image:io,in:zu,"index-of":qu,interpolate:ha,"interpolate-hcl":ha,"interpolate-lab":ha,length:Ll,let:ms,literal:Ya,match:Fs,number:aa,"number-format":Ol,object:aa,slice:gs,step:Ja,string:aa,"to-boolean":qi,"to-color":qi,"to-number":qi,"to-string":qi,var:su,within:rs};function sf(e,t){var r=t[0],f=t[1],v=t[2],m=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var x=m?m.evaluate(e):1,A=mu(r,f,v,x);if(A)throw new Na(A);return new Zn(r/255*x,f/255*x,v/255*x,x)}function Rl(e,t){return e in t}function Bu(e,t){var r=t[e];return r===void 0?null:r}function Po(e){return{type:e}}function uf(e){return{result:"success",value:e}}function bu(e){return{result:"error",value:e}}function hl(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function kf(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Dl(e){return!!e.expression&&e.expression.interpolated}function Ra(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function uu(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function vc(e){return e}function Mo(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function ns(e,t,r,f,v){return Mo(typeof r===v?f[r]:void 0,e.default,t.default)}function kl(e,t,r){if(Ra(r)!=="number")return Mo(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=bi(e.stops.map(function(m){return m[0]}),r);return e.stops[v][1]}function Fl(e,t,r){var f=e.base!==void 0?e.base:1;if(Ra(r)!=="number")return Mo(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var m=bi(e.stops.map(function(ie){return ie[0]}),r),x=function(ie,oe,xe,je){var ze=je-xe,at=ie-xe;return ze===0?0:oe===1?at/ze:(Math.pow(oe,at)-1)/(Math.pow(oe,ze)-1)}(r,f,e.stops[m][0],e.stops[m+1][0]),A=e.stops[m][1],D=e.stops[m+1][1],z=Co[t.type]||vc;if(e.colorSpace&&e.colorSpace!=="rgb"){var W=ks[e.colorSpace];z=function(oe,xe){return W.reverse(W.interpolate(W.forward(oe),W.forward(xe),x))}}return typeof A.evaluate=="function"?{evaluate:function(){for(var oe=[],xe=arguments.length;xe--;)oe[xe]=arguments[xe];var je=A.evaluate.apply(void 0,oe),ze=D.evaluate.apply(void 0,oe);if(je!==void 0&&ze!==void 0)return z(je,ze,x)}}:z(A,D,x)}function Su(e,t,r){return t.type==="color"?r=Zn.parse(r):t.type==="formatted"?r=ua.fromString(r.toString()):t.type==="resolvedImage"?r=Ki.fromString(r.toString()):Ra(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),Mo(r,e.default,t.default)}$a.register(Es,{error:[{kind:"error"},[hn],function(e,t){throw new Na(t[0].evaluate(e))}],typeof:[hn,[dn],function(e,t){return Ai(ya(t[0].evaluate(e)))}],"to-rgba":[_i(dr,4),[fn],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[fn,[dr,dr,dr],sf],rgba:[fn,[dr,dr,dr,dr],sf],has:{type:ln,overloads:[[[hn],function(e,t){return Rl(t[0].evaluate(e),e.properties())}],[[hn,ri],function(e,t){var r=t[1];return Rl(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:dn,overloads:[[[hn],function(e,t){return Bu(t[0].evaluate(e),e.properties())}],[[hn,ri],function(e,t){var r=t[1];return Bu(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[dn,[hn],function(e,t){return Bu(t[0].evaluate(e),e.featureState||{})}],properties:[ri,[],function(e){return e.properties()}],"geometry-type":[hn,[],function(e){return e.geometryType()}],id:[dn,[],function(e){return e.id()}],zoom:[dr,[],function(e){return e.globals.zoom}],"heatmap-density":[dr,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[dr,[],function(e){return e.globals.lineProgress||0}],accumulated:[dn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[dr,Po(dr),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[dr,Po(dr),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:dr,overloads:[[[dr,dr],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[dr],function(e,t){return-t[0].evaluate(e)}]]},"/":[dr,[dr,dr],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[dr,[dr,dr],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[dr,[],function(){return Math.LN2}],pi:[dr,[],function(){return Math.PI}],e:[dr,[],function(){return Math.E}],"^":[dr,[dr,dr],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[dr,[dr],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[dr,[dr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[dr,[dr],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[dr,[dr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[dr,[dr],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[dr,[dr],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[dr,[dr],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[dr,[dr],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[dr,[dr],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[dr,[dr],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[dr,Po(dr),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[dr,Po(dr),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[dr,[dr],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[dr,[dr],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[dr,[dr],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[dr,[dr],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[ln,[hn,dn],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[ln,[dn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[ln,[hn],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[ln,[hn,dn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v<m}],"filter-id-<":[ln,[dn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[ln,[hn,dn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v>m}],"filter-id->":[ln,[dn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[ln,[hn,dn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v<=m}],"filter-id-<=":[ln,[dn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[ln,[hn,dn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v>=m}],"filter-id->=":[ln,[dn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[ln,[dn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[ln,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[ln,[_i(hn)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[ln,[_i(dn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[ln,[hn,_i(dn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[ln,[hn,_i(dn)],function(e,t){var r=t[0],f=t[1];return function(v,m,x,A){for(;x<=A;){var D=x+A>>1;if(m[D]===v)return!0;m[D]>v?A=D-1:x=D+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:ln,overloads:[[[ln,ln],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[Po(ln),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:ln,overloads:[[[ln,ln],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[Po(ln),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[ln,[ln],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[ln,[hn],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[hn,[hn],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[hn,[hn],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[hn,Po(dn),function(e,t){return t.map(function(r){return no(r.evaluate(e))}).join("")}],"resolved-locale":[hn,[ci],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var lu=function(t,r){this.expression=t,this._warningHistory={},this._evaluator=new ts,this._defaultValue=r?function(f){return f.type==="color"&&uu(f.default)?new Zn(0,0,0,0):f.type==="color"?Zn.parse(f.default)||null:f.default===void 0?null:f.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null};function cu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Es}function Ql(e,t){var r=new xa(Es,[],t?function(v){var m={color:fn,string:hn,number:dr,enum:hn,boolean:ln,formatted:Bi,resolvedImage:pi};return v.type==="array"?_i(m[v.value]||dn,v.length):m[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?uf(new lu(f,t)):bu(r.errors)}lu.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,m){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)},lu.prototype.evaluate=function(e,t,r,f,v,m){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m||null;try{var x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Na("Expected value to be one of "+Object.keys(this._enumValues).map(function(A){return JSON.stringify(A)}).join(", ")+", but found "+JSON.stringify(x)+" instead.");return x}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console!="undefined"&&console.warn(A.message)),this._defaultValue}};var Nl=function(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!ao(r.expression)};Nl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,m)},Nl.prototype.evaluate=function(e,t,r,f,v,m){return this._styleExpression.evaluate(e,t,r,f,v,m)};var pl=function(t,r,f,v){this.kind=t,this.zoomStops=f,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!ao(r.expression),this.interpolationType=v};function ql(e,t){if((e=Ql(e,t)).result==="error")return e;var r=e.value.expression,f=ds(r);if(!f&&!hl(t))return bu([new yr("","data expressions not supported")]);var v=Ds(r,["zoom"]);if(!v&&!kf(t))return bu([new yr("","zoom expressions not supported")]);var m=function x(A){var D=null;if(A instanceof ms)D=x(A.result);else if(A instanceof xu)for(var z=0,W=A.args;z<W.length&&!(D=x(W[z]));z+=1);else(A instanceof Ja||A instanceof ha)&&A.input instanceof $a&&A.input.name==="zoom"&&(D=A);return D instanceof yr||A.eachChild(function(ie){var oe=x(ie);oe instanceof yr?D=oe:!D&&oe?D=new yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&oe&&D!==oe&&(D=new yr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(r);return m||v?m instanceof yr?bu([m]):m instanceof ha&&!Dl(t)?bu([new yr("",'"interpolate" expressions cannot be used with this property')]):uf(m?new pl(f?"camera":"composite",e.value,m.labels,m instanceof ha?m.interpolation:void 0):new Nl(f?"constant":"source",e.value)):bu([new yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}pl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,m)},pl.prototype.evaluate=function(e,t,r,f,v,m){return this._styleExpression.evaluate(e,t,r,f,v,m)},pl.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?ha.interpolationFactor(this.interpolationType,e,t,r):0};var qs=function(t,r){this._parameters=t,this._specification=r,kr(this,function f(v,m){var x,A,D,z=m.type==="color",W=v.stops&&typeof v.stops[0][0]=="object",ie=W||!(W||v.property!==void 0),oe=v.type||(Dl(m)?"exponential":"interval");if(z&&((v=kr({},v)).stops&&(v.stops=v.stops.map(function(Dn){return[Dn[0],Zn.parse(Dn[1])]})),v.default=Zn.parse(v.default?v.default:m.default)),v.colorSpace&&v.colorSpace!=="rgb"&&!ks[v.colorSpace])throw new Error("Unknown color space: "+v.colorSpace);if(oe==="exponential")x=Fl;else if(oe==="interval")x=kl;else if(oe==="categorical"){x=ns,A=Object.create(null);for(var xe=0,je=v.stops;xe<je.length;xe+=1){var ze=je[xe];A[ze[0]]=ze[1]}D=typeof v.stops[0][0]}else{if(oe!=="identity")throw new Error('Unknown function type "'+oe+'"');x=Su}if(W){for(var at={},ut=[],Ot=0;Ot<v.stops.length;Ot++){var Yt=v.stops[Ot],ir=Yt[0].zoom;at[ir]===void 0&&(at[ir]={zoom:ir,type:v.type,property:v.property,default:v.default,stops:[]},ut.push(ir)),at[ir].stops.push([Yt[0].value,Yt[1]])}for(var Lr=[],Er=0,tn=ut;Er<tn.length;Er+=1){var cn=tn[Er];Lr.push([at[cn].zoom,f(at[cn],m)])}var Ln={name:"linear"};return{kind:"composite",interpolationType:Ln,interpolationFactor:ha.interpolationFactor.bind(void 0,Ln),zoomStops:Lr.map(function(Dn){return Dn[0]}),evaluate:function(xn,ei){var Jn=xn.zoom;return Fl({stops:Lr,base:v.base},m,Jn).evaluate(Jn,ei)}}}if(ie){var Gn=oe==="exponential"?{name:"exponential",base:v.base!==void 0?v.base:1}:null;return{kind:"camera",interpolationType:Gn,interpolationFactor:ha.interpolationFactor.bind(void 0,Gn),zoomStops:v.stops.map(function(Dn){return Dn[0]}),evaluate:function(xn){return x(v,m,xn.zoom,A,D)}}}return{kind:"source",evaluate:function(xn,ei){var Jn=ei&&ei.properties?ei.properties[v.property]:void 0;return Jn===void 0?Mo(v.default,m.default):x(v,m,Jn,A,D)}}}(this._parameters,this._specification))};function is(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},m=e.style,x=e.styleSpec,A=[],D=Ra(r);if(D!=="object")return[new Ne(t,r,"object expected, "+D+" found")];for(var z in r){var W=z.split(".")[0],ie=f[W]||f["*"],oe=void 0;if(v[W])oe=v[W];else if(f[W])oe=zi;else if(v["*"])oe=v["*"];else{if(!f["*"]){A.push(new Ne(t,r[z],'unknown property "'+z+'"'));continue}oe=zi}A=A.concat(oe({key:(t&&t+".")+z,value:r[z],valueSpec:ie,style:m,styleSpec:x,object:r,objectKey:z},r))}for(var xe in f)v[xe]||f[xe].required&&f[xe].default===void 0&&r[xe]===void 0&&A.push(new Ne(t,r,'missing required property "'+xe+'"'));return A}function zl(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,m=e.key,x=e.arrayElementValidator||zi;if(Ra(t)!=="array")return[new Ne(m,t,"array expected, "+Ra(t)+" found")];if(r.length&&t.length!==r.length)return[new Ne(m,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new Ne(m,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var A={type:r.value,values:r.values};v.$version<7&&(A.function=r.function),Ra(r.value)==="object"&&(A=r.value);for(var D=[],z=0;z<t.length;z++)D=D.concat(x({array:t,arrayIndex:z,value:t[z],valueSpec:A,style:f,styleSpec:v,key:m+"["+z+"]"}));return D}function jc(e){var t=e.key,r=e.value,f=e.valueSpec,v=Ra(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new Ne(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new Ne(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new Ne(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function dl(e){var t,r,f,v=e.valueSpec,m=jr(e.value.type),x={},A=m!=="categorical"&&e.value.property===void 0,D=!A,z=Ra(e.value.stops)==="array"&&Ra(e.value.stops[0])==="array"&&Ra(e.value.stops[0][0])==="object",W=is({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(je){if(m==="identity")return[new Ne(je.key,je.value,'identity function may not have a "stops" property')];var ze=[],at=je.value;return ze=ze.concat(zl({key:je.key,value:at,valueSpec:je.valueSpec,style:je.style,styleSpec:je.styleSpec,arrayElementValidator:ie})),Ra(at)==="array"&&at.length===0&&ze.push(new Ne(je.key,at,"array must have at least one stop")),ze},default:function(je){return zi({key:je.key,value:je.value,valueSpec:v,style:je.style,styleSpec:je.styleSpec})}}});return m==="identity"&&A&&W.push(new Ne(e.key,e.value,'missing required property "property"')),m==="identity"||e.value.stops||W.push(new Ne(e.key,e.value,'missing required property "stops"')),m==="exponential"&&e.valueSpec.expression&&!Dl(e.valueSpec)&&W.push(new Ne(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(D&&!hl(e.valueSpec)?W.push(new Ne(e.key,e.value,"property functions not supported")):A&&!kf(e.valueSpec)&&W.push(new Ne(e.key,e.value,"zoom functions not supported"))),m!=="categorical"&&!z||e.value.property!==void 0||W.push(new Ne(e.key,e.value,'"property" property is required')),W;function ie(xe){var je=[],ze=xe.value,at=xe.key;if(Ra(ze)!=="array")return[new Ne(at,ze,"array expected, "+Ra(ze)+" found")];if(ze.length!==2)return[new Ne(at,ze,"array length 2 expected, length "+ze.length+" found")];if(z){if(Ra(ze[0])!=="object")return[new Ne(at,ze,"object expected, "+Ra(ze[0])+" found")];if(ze[0].zoom===void 0)return[new Ne(at,ze,"object stop key must have zoom")];if(ze[0].value===void 0)return[new Ne(at,ze,"object stop key must have value")];if(f&&f>jr(ze[0].zoom))return[new Ne(at,ze[0].zoom,"stop zoom values must appear in ascending order")];jr(ze[0].zoom)!==f&&(f=jr(ze[0].zoom),r=void 0,x={}),je=je.concat(is({key:at+"[0]",value:ze[0],valueSpec:{zoom:{}},style:xe.style,styleSpec:xe.styleSpec,objectElementValidators:{zoom:jc,value:oe}}))}else je=je.concat(oe({key:at+"[0]",value:ze[0],valueSpec:{},style:xe.style,styleSpec:xe.styleSpec},ze));return cu($t(ze[1]))?je.concat([new Ne(at+"[1]",ze[1],"expressions are not allowed in function stops.")]):je.concat(zi({key:at+"[1]",value:ze[1],valueSpec:v,style:xe.style,styleSpec:xe.styleSpec}))}function oe(xe,je){var ze=Ra(xe.value),at=jr(xe.value),ut=xe.value!==null?xe.value:je;if(t){if(ze!==t)return[new Ne(xe.key,ut,ze+" stop domain type must match previous stop domain type "+t)]}else t=ze;if(ze!=="number"&&ze!=="string"&&ze!=="boolean")return[new Ne(xe.key,ut,"stop domain value must be a number, string, or boolean")];if(ze!=="number"&&m!=="categorical"){var Ot="number expected, "+ze+" found";return hl(v)&&m===void 0&&(Ot+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ne(xe.key,ut,Ot)]}return m!=="categorical"||ze!=="number"||isFinite(at)&&Math.floor(at)===at?m!=="categorical"&&ze==="number"&&r!==void 0&&at<r?[new Ne(xe.key,ut,"stop domain values must appear in ascending order")]:(r=at,m==="categorical"&&at in x?[new Ne(xe.key,ut,"stop domain values must be unique")]:(x[at]=!0,[])):[new Ne(xe.key,ut,"integer expected, found "+at)]}}function el(e){var t=(e.expressionContext==="property"?ql:Ql)($t(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new Ne(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new Ne(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!ao(r))return[new Ne(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!ao(r))return[new Ne(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!Ds(r,["zoom","feature-state"]))return[new Ne(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!ds(r))return[new Ne(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ec(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(jr(r))===-1&&v.push(new Ne(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(jr(r))===-1&&v.push(new Ne(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function Zc(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!Zc(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}qs.deserialize=function(e){return new qs(e._parameters,e._specification)},qs.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var tl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Bl(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Zc(e)||(e=rl(e));var t=Ql(e,tl);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(f,v,m){return t.value.evaluate(f,v,{},m)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function mc(e,t){return e<t?-1:e>t?1:0}function rl(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?Vc(e[1],e[2],"=="):r==="!="?Ul(Vc(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Vc(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(rl))):r==="all"?["all"].concat(e.slice(1).map(rl)):r==="none"?["all"].concat(e.slice(1).map(rl).map(Ul)):r==="in"?lf(e[1],e.slice(2)):r==="!in"?Ul(lf(e[1],e.slice(2))):r==="has"?cf(e[1]):r==="!has"?Ul(cf(e[1])):r!=="within"||e}function Vc(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function lf(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(mc)]]:["filter-in-small",e,["literal",t]]}}function cf(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Ul(e){return["!",e]}function Gc(e){return Zc($t(e.value))?el(kr({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(Ra(f)!=="array")return[new Ne(v,f,"array expected, "+Ra(f)+" found")];var m,x=r.styleSpec,A=[];if(f.length<1)return[new Ne(v,f,"filter array must have at least 1 element")];switch(A=A.concat(ec({key:v+"[0]",value:f[0],valueSpec:x.filter_operator,style:r.style,styleSpec:r.styleSpec})),jr(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&jr(f[1])==="$type"&&A.push(new Ne(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&A.push(new Ne(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(m=Ra(f[1]))!=="string"&&A.push(new Ne(v+"[1]",f[1],"string expected, "+m+" found"));for(var D=2;D<f.length;D++)m=Ra(f[D]),jr(f[1])==="$type"?A=A.concat(ec({key:v+"["+D+"]",value:f[D],valueSpec:x.geometry_type,style:r.style,styleSpec:r.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&A.push(new Ne(v+"["+D+"]",f[D],"string, number, or boolean expected, "+m+" found"));break;case"any":case"all":case"none":for(var z=1;z<f.length;z++)A=A.concat(t({key:v+"["+z+"]",value:f[z],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":m=Ra(f[1]),f.length!==2?A.push(new Ne(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):m!=="string"&&A.push(new Ne(v+"[1]",f[1],"string expected, "+m+" found"));break;case"within":m=Ra(f[1]),f.length!==2?A.push(new Ne(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):m!=="object"&&A.push(new Ne(v+"[1]",f[1],"object expected, "+m+" found"))}return A}(e)}function Hc(e,t){var r=e.key,f=e.style,v=e.styleSpec,m=e.value,x=e.objectKey,A=v[t+"_"+e.layerType];if(!A)return[];var D=x.match(/^(.*)-transition$/);if(t==="paint"&&D&&A[D[1]]&&A[D[1]].transition)return zi({key:r,value:m,valueSpec:v.transition,style:f,styleSpec:v});var z,W=e.valueSpec||A[x];if(!W)return[new Ne(r,m,'unknown property "'+x+'"')];if(Ra(m)==="string"&&hl(W)&&!W.tokens&&(z=/^{([^}]+)}$/.exec(m)))return[new Ne(r,m,'"'+x+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var ie=[];return e.layerType==="symbol"&&(x==="text-field"&&f&&!f.glyphs&&ie.push(new Ne(r,m,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&uu($t(m))&&jr(m.type)==="identity"&&ie.push(new Ne(r,m,'"text-font" does not support identity functions'))),ie.concat(zi({key:e.key,value:m,valueSpec:W,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:x}))}function gc(e){return Hc(e,"paint")}function nl(e){return Hc(e,"layout")}function Wc(e){var t=[],r=e.value,f=e.key,v=e.style,m=e.styleSpec;r.type||r.ref||t.push(new Ne(f,r,'either "type" or "ref" is required'));var x,A=jr(r.type),D=jr(r.ref);if(r.id)for(var z=jr(r.id),W=0;W<e.arrayIndex;W++){var ie=v.layers[W];jr(ie.id)===z&&t.push(new Ne(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+ie.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(je){je in r&&t.push(new Ne(f,r[je],'"'+je+'" is prohibited for ref layers'))}),v.layers.forEach(function(je){jr(je.id)===D&&(x=je)}),x?x.ref?t.push(new Ne(f,r.ref,"ref cannot reference another ref layer")):A=jr(x.type):t.push(new Ne(f,r.ref,'ref layer "'+D+'" not found'));else if(A!=="background")if(r.source){var oe=v.sources&&v.sources[r.source],xe=oe&&jr(oe.type);oe?xe==="vector"&&A==="raster"?t.push(new Ne(f,r.source,'layer "'+r.id+'" requires a raster source')):xe==="raster"&&A!=="raster"?t.push(new Ne(f,r.source,'layer "'+r.id+'" requires a vector source')):xe!=="vector"||r["source-layer"]?xe==="raster-dem"&&A!=="hillshade"?t.push(new Ne(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="line"||!r.paint||!r.paint["line-gradient"]||xe==="geojson"&&oe.lineMetrics||t.push(new Ne(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Ne(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new Ne(f,r.source,'source "'+r.source+'" not found'))}else t.push(new Ne(f,r,'missing required property "source"'));return t=t.concat(is({key:f,value:r,valueSpec:m.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return zi({key:f+".type",value:r.type,valueSpec:m.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:Gc,layout:function(ze){return is({layer:r,key:ze.key,value:ze.value,style:ze.style,styleSpec:ze.styleSpec,objectElementValidators:{"*":function(ut){return nl(kr({layerType:A},ut))}}})},paint:function(ze){return is({layer:r,key:ze.key,value:ze.value,style:ze.style,styleSpec:ze.styleSpec,objectElementValidators:{"*":function(ut){return gc(kr({layerType:A},ut))}}})}}}))}function Eu(e){var t=e.value,r=e.key,f=Ra(t);return f!=="string"?[new Ne(r,t,"string expected, "+f+" found")]:[]}var Ia={promoteId:function(t){var r=t.key,f=t.value;if(Ra(f)==="string")return Eu({key:r,value:f});var v=[];for(var m in f)v.push.apply(v,Eu({key:r+"."+m,value:f[m]}));return v}};function jl(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new Ne(r,t,'"type" is required')];var m,x=jr(t.type);switch(x){case"vector":case"raster":case"raster-dem":return is({key:r,value:t,valueSpec:f["source_"+x.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:Ia});case"geojson":if(m=is({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:Ia}),t.cluster)for(var A in t.clusterProperties){var D=t.clusterProperties[A],z=D[0],W=typeof z=="string"?[z,["accumulated"],["get",A]]:z;m.push.apply(m,el({key:r+"."+A+".map",value:D[1],expressionContext:"cluster-map"})),m.push.apply(m,el({key:r+"."+A+".reduce",value:W,expressionContext:"cluster-reduce"}))}return m;case"video":return is({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return is({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new Ne(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ec({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function wu(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,m=[],x=Ra(t);if(t===void 0)return m;if(x!=="object")return m.concat([new Ne("light",t,"object expected, "+x+" found")]);for(var A in t){var D=A.match(/^(.*)-transition$/);m=m.concat(D&&f[D[1]]&&f[D[1]].transition?zi({key:A,value:t[A],valueSpec:r.transition,style:v,styleSpec:r}):f[A]?zi({key:A,value:t[A],valueSpec:f[A],style:v,styleSpec:r}):[new Ne(A,t[A],'unknown property "'+A+'"')])}return m}var Uu={"*":function(){return[]},array:zl,boolean:function(t){var r=t.value,f=t.key,v=Ra(r);return v!=="boolean"?[new Ne(f,r,"boolean expected, "+v+" found")]:[]},number:jc,color:function(t){var r=t.key,f=t.value,v=Ra(f);return v!=="string"?[new Ne(r,f,"color expected, "+v+" found")]:kn(f)===null?[new Ne(r,f,'color expected, "'+f+'" found')]:[]},constants:Ct,enum:ec,filter:Gc,function:dl,layer:Wc,object:is,source:jl,light:wu,string:Eu,formatted:function(t){return Eu(t).length===0?[]:el(t)},resolvedImage:function(t){return Eu(t).length===0?[]:el(t)}};function zi(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&uu(jr(t))?dl(e):r.expression&&cu($t(t))?el(e):r.type&&Uu[r.type]?Uu[r.type](e):is(kr({},e,{valueSpec:r.type?f[r.type]:r}))}function Pa(e){var t=e.value,r=e.key,f=Eu(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new Ne(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new Ne(r,t,'"glyphs" url must include a "{range}" token'))),f}function Ma(e,t){t===void 0&&(t=he);var r=[];return r=r.concat(zi({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Pa,"*":function(){return[]}}})),e.constants&&(r=r.concat(Ct({key:"constants",value:e.constants,style:e,styleSpec:t}))),tc(r)}function tc(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function Zl(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return tc(e.apply(this,t))}}Ma.source=Zl(jl),Ma.light=Zl(wu),Ma.layer=Zl(Wc),Ma.filter=Zl(Gc),Ma.paintProperty=Zl(gc),Ma.layoutProperty=Zl(nl);var rc=Ma,wf=rc.light,Tf=rc.paintProperty,Vl=rc.layoutProperty;function ju(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new De(new Error(v[f].message))),r=!0;return r}var Zu=Qa;function Qa(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var m=0;m<this.d*this.d;m++){var x=v[3+m],A=v[3+m+1];f.push(x===A?null:v.subarray(x,A))}var D=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],D),this.bboxes=v.subarray(D),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var z=0;z<this.d*this.d;z++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var W=r/t*e;this.min=-W,this.max=e+W}Qa.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},Qa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Qa.prototype._insertCell=function(e,t,r,f,v,m){this.cells[v].push(m)},Qa.prototype.query=function(e,t,r,f,v){var m=this.min,x=this.max;if(e<=m&&t<=m&&x<=r&&x<=f&&!v)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(e,t,r,f,this._queryCell,A,{},v),A},Qa.prototype._queryCell=function(e,t,r,f,v,m,x,A){var D=this.cells[v];if(D!==null)for(var z=this.keys,W=this.bboxes,ie=0;ie<D.length;ie++){var oe=D[ie];if(x[oe]===void 0){var xe=4*oe;(A?A(W[xe+0],W[xe+1],W[xe+2],W[xe+3]):e<=W[xe+2]&&t<=W[xe+3]&&r>=W[xe+0]&&f>=W[xe+1])?(x[oe]=!0,m.push(z[oe])):x[oe]=!1}}},Qa.prototype._forEachCell=function(e,t,r,f,v,m,x,A){for(var D=this._convertToCellCoord(e),z=this._convertToCellCoord(t),W=this._convertToCellCoord(r),ie=this._convertToCellCoord(f),oe=D;oe<=W;oe++)for(var xe=z;xe<=ie;xe++){var je=this.d*xe+oe;if((!A||A(this._convertFromCellCoord(oe),this._convertFromCellCoord(xe),this._convertFromCellCoord(oe+1),this._convertFromCellCoord(xe+1)))&&v.call(this,e,t,r,f,je,m,x,A))return}},Qa.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Qa.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Qa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var m=t,x=0;x<e.length;x++){var A=e[x];v[3+x]=m,v.set(A,m),m+=A.length}return v[3+e.length]=m,v.set(this.keys,m),v[3+e.length+1]=m+=this.keys.length,v.set(this.bboxes,m),m+=this.bboxes.length,v.buffer};var ys=q.ImageData,vl=q.ImageBitmap,so={};function Tn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),so[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var Ns in Tn("Object",Object),Zu.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Zu.deserialize=function(e){return new Zu(e.buffer)},Tn("Grid",Zu),Tn("Color",Zn),Tn("Error",Error),Tn("ResolvedImage",Ki),Tn("StylePropertyFunction",qs),Tn("StyleExpression",lu,{omit:["_evaluator"]}),Tn("ZoomDependentExpression",pl),Tn("ZoomConstantExpression",Nl),Tn("CompoundExpression",$a,{omit:["_evaluate"]}),Es)Es[Ns]._classRegistryKey||Tn("Expression_"+Ns,Es[Ns]);function nc(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function ml(e){return vl&&e instanceof vl}function eu(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(nc(e)||ml(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof ys)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,m=e;v<m.length;v+=1)f.push(eu(m[v],t));return f}if(typeof e=="object"){var x=e.constructor,A=x._classRegistryKey;if(!A)throw new Error("can't serialize object of unregistered class");var D=x.serialize?x.serialize(e,t):{};if(!x.serialize){for(var z in e)if(e.hasOwnProperty(z)&&!(so[A].omit.indexOf(z)>=0)){var W=e[z];D[z]=so[A].shallow.indexOf(z)>=0?W:eu(W,t)}e instanceof Error&&(D.message=e.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return A!=="Object"&&(D.$name=A),D}throw new Error("can't serialize object of type "+typeof e)}function Zs(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||nc(e)||ml(e)||ArrayBuffer.isView(e)||e instanceof ys)return e;if(Array.isArray(e))return e.map(Zs);if(typeof e=="object"){var t=e.$name||"Object",r=so[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,m=Object.keys(e);v<m.length;v+=1){var x=m[v];if(x!=="$name"){var A=e[x];f[x]=so[t].shallow.indexOf(x)>=0?A:Zs(A)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var gl=function(){this.first=!0};gl.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var en={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Xc(e){for(var t=0,r=e;t<r.length;t+=1)if(yc(r[t].charCodeAt(0)))return!0;return!1}function yc(e){return!(e!==746&&e!==747&&(e<4352||!(en["Bopomofo Extended"](e)||en.Bopomofo(e)||en["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||en["CJK Compatibility Ideographs"](e)||en["CJK Compatibility"](e)||en["CJK Radicals Supplement"](e)||en["CJK Strokes"](e)||!(!en["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||en["CJK Unified Ideographs Extension A"](e)||en["CJK Unified Ideographs"](e)||en["Enclosed CJK Letters and Months"](e)||en["Hangul Compatibility Jamo"](e)||en["Hangul Jamo Extended-A"](e)||en["Hangul Jamo Extended-B"](e)||en["Hangul Jamo"](e)||en["Hangul Syllables"](e)||en.Hiragana(e)||en["Ideographic Description Characters"](e)||en.Kanbun(e)||en["Kangxi Radicals"](e)||en["Katakana Phonetic Extensions"](e)||en.Katakana(e)&&e!==12540||!(!en["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!en["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||en["Unified Canadian Aboriginal Syllabics"](e)||en["Unified Canadian Aboriginal Syllabics Extended"](e)||en["Vertical Forms"](e)||en["Yijing Hexagram Symbols"](e)||en["Yi Syllables"](e)||en["Yi Radicals"](e))))}function Vu(e){return!(yc(e)||function(t){return!!(en["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||en["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||en["Letterlike Symbols"](t)||en["Number Forms"](t)||en["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||en["Control Pictures"](t)&&t!==9251||en["Optical Character Recognition"](t)||en["Enclosed Alphanumerics"](t)||en["Geometric Shapes"](t)||en["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||en["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||en["CJK Symbols and Punctuation"](t)||en.Katakana(t)||en["Private Use Area"](t)||en["CJK Compatibility Forms"](t)||en["Small Form Variants"](t)||en["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function tu(e){return e>=1424&&e<=2303||en["Arabic Presentation Forms-A"](e)||en["Arabic Presentation Forms-B"](e)}function Ba(e,t){return!(!t&&tu(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||en.Khmer(e))}function Tu(e){for(var t=0,r=e;t<r.length;t+=1)if(tu(r[t].charCodeAt(0)))return!0;return!1}var Au=null,Wo="unavailable",Cu=null,il=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Wo="error"),Au&&Au(t)};function yl(){Kc.fire(new ue("pluginStateChange",{pluginStatus:Wo,pluginURL:Cu}))}var Kc=new He,_c=function(){return Wo},ws=function(){if(Wo!=="deferred"||!Cu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Wo="loading",yl(),Cu&&Zi({url:Cu},function(t){t?il(t):(Wo="loaded",yl())})},Ts={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Wo==="loaded"||Ts.applyArabicShaping!=null},isLoading:function(){return Wo==="loading"},setState:function(t){Wo=t.pluginStatus,Cu=t.pluginURL},isParsed:function(){return Ts.applyArabicShaping!=null&&Ts.processBidirectionalText!=null&&Ts.processStyledBidirectionalText!=null},getPluginURL:function(){return Cu}},Oi=function(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new gl,this.transition={})};Oi.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!Ba(v[f].charCodeAt(0),r))return!1;return!0}(e,Ts.isLoaded())},Oi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Oi.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var Pu=function(t,r){this.property=t,this.value=r,this.expression=function(f,v){if(uu(f))return new qs(f,v);if(cu(f)){var m=ql(f,v);if(m.result==="error")throw new Error(m.value.map(function(A){return A.key+": "+A.message}).join(", "));return m.value}var x=f;return typeof f=="string"&&v.type==="color"&&(x=Zn.parse(f)),{kind:"constant",evaluate:function(){return x}}}(r===void 0?t.specification.default:r,t.specification)};Pu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Pu.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var Xo=function(t){this.property=t,this.value=new Pu(t,void 0)};Xo.prototype.transitioned=function(e,t){return new _l(this.property,this.value,t,Xt({},e.transition,this.transition),e.now)},Xo.prototype.untransitioned=function(){return new _l(this.property,this.value,null,{},0)};var Io=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Io.prototype.getValue=function(e){return Ze(this._values[e].value.value)},Io.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Xo(this._values[e].property)),this._values[e].value=new Pu(this._values[e].property,t===null?void 0:Ze(t))},Io.prototype.getTransition=function(e){return Ze(this._values[e].transition)},Io.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Xo(this._values[e].property)),this._values[e].transition=Ze(t)||void 0},Io.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var m=this.getTransition(f);m!==void 0&&(e[f+"-transition"]=m)}return e},Io.prototype.transitioned=function(e,t){for(var r=new Gu(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var m=v[f];r._values[m]=this._values[m].transitioned(e,t._values[m])}return r},Io.prototype.untransitioned=function(){for(var e=new Gu(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var _l=function(t,r,f,v,m){this.property=t,this.value=r,this.begin=m+v.delay||0,this.end=this.begin+v.duration||0,t.specification.transition&&(v.delay||v.duration)&&(this.prior=f)};_l.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),m=this.prior;if(m){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return m.possiblyEvaluate(e,t,r);var x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,t,r),v,function(A){if(A<=0)return 0;if(A>=1)return 1;var D=A*A,z=D*A;return 4*(A<.5?z:3*(A-D)+z-.75)}(x))}return v};var Gu=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Gu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Mu(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var x=m[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f},Gu.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var ru=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};ru.prototype.getValue=function(e){return Ze(this._values[e].value)},ru.prototype.setValue=function(e,t){this._values[e]=new Pu(this._values[e].property,t===null?void 0:Ze(t))},ru.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},ru.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Mu(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var x=m[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f};var as=function(t,r,f){this.property=t,this.value=r,this.parameters=f};as.prototype.isConstant=function(){return this.value.kind==="constant"},as.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},as.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var Mu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Mu.prototype.get=function(e){return this._values[e]};var Bn=function(t){this.specification=t};Bn.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},Bn.prototype.interpolate=function(e,t,r){var f=Co[this.specification.type];return f?f(e,t,r):e};var On=function(t,r){this.specification=t,this.overrides=r};On.prototype.possiblyEvaluate=function(e,t,r,f){return new as(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},On.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new as(this,{kind:"constant",value:void 0},e.parameters);var f=Co[this.specification.type];return f?new as(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},On.prototype.evaluate=function(e,t,r,f,v,m){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,m)};var xc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,m){if(r.value===void 0)return new as(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var x=r.expression.evaluate(f,null,{},v,m),A=r.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,D=this._calculate(A,A,A,f);return new as(this,{kind:"constant",value:D},f)}if(r.expression.kind==="camera"){var z=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new as(this,{kind:"constant",value:z},f)}return new as(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,m,x,A){if(r.kind==="source"){var D=r.evaluate(f,v,m,x,A);return this._calculate(D,D,D,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,m),r.evaluate({zoom:Math.floor(f.zoom)},v,m),r.evaluate({zoom:Math.floor(f.zoom)+1},v,m),f):r.value},t.prototype._calculate=function(r,f,v,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}(On),os=function(t){this.specification=t};os.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new Oi(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Oi(Math.floor(t.zoom),t)),e.expression.evaluate(new Oi(Math.floor(t.zoom+1),t)),t)}},os.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},os.prototype.interpolate=function(e){return e};var bo=function(t){this.specification=t};bo.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},bo.prototype.interpolate=function(){return!1};var Fo=function(t){for(var r in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var f=t[r];f.specification.overridable&&this.overridableProperties.push(r);var v=this.defaultPropertyValues[r]=new Pu(f,void 0),m=this.defaultTransitionablePropertyValues[r]=new Xo(f);this.defaultTransitioningPropertyValues[r]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=v.possiblyEvaluate({})}};Tn("DataDrivenProperty",On),Tn("DataConstantProperty",Bn),Tn("CrossFadedDataDrivenProperty",xc),Tn("CrossFadedProperty",os),Tn("ColorRampProperty",bo);var Vs=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new ru(f.layout)),f.paint)){for(var v in this._transitionablePaint=new Io(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var m in r.layout)this.setLayoutProperty(m,r.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Mu(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(Vl,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return At(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(Tf,"layers."+this.id+".paint."+r,r,f,v))return!1;if(At(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var m=this._transitionablePaint._values[r],x=m.property.specification["property-type"]==="cross-faded-data-driven",A=m.value.isDataDriven(),D=m.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var z=this._transitionablePaint._values[r].value;return z.isDataDriven()||A||x||this._handleOverridablePaintPropertyUpdate(r,D,z)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),St(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,m,x){return x===void 0&&(x={}),(!x||x.validate!==!1)&&ju(this,r.call(rc,{key:f,layerType:this.type,objectKey:v,value:m,styleSpec:he,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof as&&hl(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(He),Gs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Gl=function(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},$i=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function So(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var m=Gs[v.type].BYTES_PER_ELEMENT,x=r=ff(r,Math.max(t,m)),A=v.components||1;return f=Math.max(f,m),r+=m*A,{name:v.name,type:v.type,components:A,offset:x}}),size:ff(r,Math.max(f,t)),alignment:t}}function ff(e,t){return Math.ceil(e/t)*t}$i.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},$i.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},$i.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},$i.prototype.clear=function(){this.length=0},$i.prototype.resize=function(e){this.reserve(e),this.length=e},$i.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},$i.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var xl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var m=2*r;return this.int16[m+0]=f,this.int16[m+1]=v,r},t}($i);xl.prototype.bytesPerElement=4,Tn("StructArrayLayout2i4",xl);var bc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,m)},t.prototype.emplace=function(r,f,v,m,x){var A=4*r;return this.int16[A+0]=f,this.int16[A+1]=v,this.int16[A+2]=m,this.int16[A+3]=x,r},t}($i);bc.prototype.bytesPerElement=8,Tn("StructArrayLayout4i8",bc);var Iu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A){var D=this.length;return this.resize(D+1),this.emplace(D,r,f,v,m,x,A)},t.prototype.emplace=function(r,f,v,m,x,A,D){var z=6*r;return this.int16[z+0]=f,this.int16[z+1]=v,this.int16[z+2]=m,this.int16[z+3]=x,this.int16[z+4]=A,this.int16[z+5]=D,r},t}($i);Iu.prototype.bytesPerElement=12,Tn("StructArrayLayout2i4i12",Iu);var As=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A){var D=this.length;return this.resize(D+1),this.emplace(D,r,f,v,m,x,A)},t.prototype.emplace=function(r,f,v,m,x,A,D){var z=4*r,W=8*r;return this.int16[z+0]=f,this.int16[z+1]=v,this.uint8[W+4]=m,this.uint8[W+5]=x,this.uint8[W+6]=A,this.uint8[W+7]=D,r},t}($i);As.prototype.bytesPerElement=8,Tn("StructArrayLayout2i4ub8",As);var bl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var m=2*r;return this.float32[m+0]=f,this.float32[m+1]=v,r},t}($i);bl.prototype.bytesPerElement=8,Tn("StructArrayLayout2f8",bl);var Ou=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A,D,z,W,ie){var oe=this.length;return this.resize(oe+1),this.emplace(oe,r,f,v,m,x,A,D,z,W,ie)},t.prototype.emplace=function(r,f,v,m,x,A,D,z,W,ie,oe){var xe=10*r;return this.uint16[xe+0]=f,this.uint16[xe+1]=v,this.uint16[xe+2]=m,this.uint16[xe+3]=x,this.uint16[xe+4]=A,this.uint16[xe+5]=D,this.uint16[xe+6]=z,this.uint16[xe+7]=W,this.uint16[xe+8]=ie,this.uint16[xe+9]=oe,r},t}($i);Ou.prototype.bytesPerElement=20,Tn("StructArrayLayout10ui20",Ou);var Sc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A,D,z,W,ie,oe,xe){var je=this.length;return this.resize(je+1),this.emplace(je,r,f,v,m,x,A,D,z,W,ie,oe,xe)},t.prototype.emplace=function(r,f,v,m,x,A,D,z,W,ie,oe,xe,je){var ze=12*r;return this.int16[ze+0]=f,this.int16[ze+1]=v,this.int16[ze+2]=m,this.int16[ze+3]=x,this.uint16[ze+4]=A,this.uint16[ze+5]=D,this.uint16[ze+6]=z,this.uint16[ze+7]=W,this.int16[ze+8]=ie,this.int16[ze+9]=oe,this.int16[ze+10]=xe,this.int16[ze+11]=je,r},t}($i);Sc.prototype.bytesPerElement=24,Tn("StructArrayLayout4i4ui4i24",Sc);var ic=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var x=3*r;return this.float32[x+0]=f,this.float32[x+1]=v,this.float32[x+2]=m,r},t}($i);ic.prototype.bytesPerElement=12,Tn("StructArrayLayout3f12",ic);var Ec=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}($i);Ec.prototype.bytesPerElement=4,Tn("StructArrayLayout1ul4",Ec);var Yc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A,D,z,W){var ie=this.length;return this.resize(ie+1),this.emplace(ie,r,f,v,m,x,A,D,z,W)},t.prototype.emplace=function(r,f,v,m,x,A,D,z,W,ie){var oe=10*r,xe=5*r;return this.int16[oe+0]=f,this.int16[oe+1]=v,this.int16[oe+2]=m,this.int16[oe+3]=x,this.int16[oe+4]=A,this.int16[oe+5]=D,this.uint32[xe+3]=z,this.uint16[oe+8]=W,this.uint16[oe+9]=ie,r},t}($i);Yc.prototype.bytesPerElement=20,Tn("StructArrayLayout6i1ul2ui20",Yc);var ac=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A){var D=this.length;return this.resize(D+1),this.emplace(D,r,f,v,m,x,A)},t.prototype.emplace=function(r,f,v,m,x,A,D){var z=6*r;return this.int16[z+0]=f,this.int16[z+1]=v,this.int16[z+2]=m,this.int16[z+3]=x,this.int16[z+4]=A,this.int16[z+5]=D,r},t}($i);ac.prototype.bytesPerElement=12,Tn("StructArrayLayout2i2i2i12",ac);var al=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x){var A=this.length;return this.resize(A+1),this.emplace(A,r,f,v,m,x)},t.prototype.emplace=function(r,f,v,m,x,A){var D=4*r,z=8*r;return this.float32[D+0]=f,this.float32[D+1]=v,this.float32[D+2]=m,this.int16[z+6]=x,this.int16[z+7]=A,r},t}($i);al.prototype.bytesPerElement=16,Tn("StructArrayLayout2f1f2i16",al);var wc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,m)},t.prototype.emplace=function(r,f,v,m,x){var A=12*r,D=3*r;return this.uint8[A+0]=f,this.uint8[A+1]=v,this.float32[D+1]=m,this.float32[D+2]=x,r},t}($i);wc.prototype.bytesPerElement=12,Tn("StructArrayLayout2ub2f12",wc);var ma=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var x=3*r;return this.uint16[x+0]=f,this.uint16[x+1]=v,this.uint16[x+2]=m,r},t}($i);ma.prototype.bytesPerElement=6,Tn("StructArrayLayout3ui6",ma);var Hu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A,D,z,W,ie,oe,xe,je,ze,at,ut,Ot){var Yt=this.length;return this.resize(Yt+1),this.emplace(Yt,r,f,v,m,x,A,D,z,W,ie,oe,xe,je,ze,at,ut,Ot)},t.prototype.emplace=function(r,f,v,m,x,A,D,z,W,ie,oe,xe,je,ze,at,ut,Ot,Yt){var ir=24*r,Lr=12*r,Er=48*r;return this.int16[ir+0]=f,this.int16[ir+1]=v,this.uint16[ir+2]=m,this.uint16[ir+3]=x,this.uint32[Lr+2]=A,this.uint32[Lr+3]=D,this.uint32[Lr+4]=z,this.uint16[ir+10]=W,this.uint16[ir+11]=ie,this.uint16[ir+12]=oe,this.float32[Lr+7]=xe,this.float32[Lr+8]=je,this.uint8[Er+36]=ze,this.uint8[Er+37]=at,this.uint8[Er+38]=ut,this.uint32[Lr+10]=Ot,this.int16[ir+22]=Yt,r},t}($i);Hu.prototype.bytesPerElement=48,Tn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Hu);var Sl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A,D,z,W,ie,oe,xe,je,ze,at,ut,Ot,Yt,ir,Lr,Er,tn,cn,Ln,Gn,Dn,xn,ei){var Jn=this.length;return this.resize(Jn+1),this.emplace(Jn,r,f,v,m,x,A,D,z,W,ie,oe,xe,je,ze,at,ut,Ot,Yt,ir,Lr,Er,tn,cn,Ln,Gn,Dn,xn,ei)},t.prototype.emplace=function(r,f,v,m,x,A,D,z,W,ie,oe,xe,je,ze,at,ut,Ot,Yt,ir,Lr,Er,tn,cn,Ln,Gn,Dn,xn,ei,Jn){var Hn=34*r,Hi=17*r;return this.int16[Hn+0]=f,this.int16[Hn+1]=v,this.int16[Hn+2]=m,this.int16[Hn+3]=x,this.int16[Hn+4]=A,this.int16[Hn+5]=D,this.int16[Hn+6]=z,this.int16[Hn+7]=W,this.uint16[Hn+8]=ie,this.uint16[Hn+9]=oe,this.uint16[Hn+10]=xe,this.uint16[Hn+11]=je,this.uint16[Hn+12]=ze,this.uint16[Hn+13]=at,this.uint16[Hn+14]=ut,this.uint16[Hn+15]=Ot,this.uint16[Hn+16]=Yt,this.uint16[Hn+17]=ir,this.uint16[Hn+18]=Lr,this.uint16[Hn+19]=Er,this.uint16[Hn+20]=tn,this.uint16[Hn+21]=cn,this.uint16[Hn+22]=Ln,this.uint32[Hi+12]=Gn,this.float32[Hi+13]=Dn,this.float32[Hi+14]=xn,this.float32[Hi+15]=ei,this.float32[Hi+16]=Jn,r},t}($i);Sl.prototype.bytesPerElement=68,Tn("StructArrayLayout8i15ui1ul4f68",Sl);var nu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}($i);nu.prototype.bytesPerElement=4,Tn("StructArrayLayout1f4",nu);var Hs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var x=3*r;return this.int16[x+0]=f,this.int16[x+1]=v,this.int16[x+2]=m,r},t}($i);Hs.prototype.bytesPerElement=6,Tn("StructArrayLayout3i6",Hs);var Tc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var x=4*r;return this.uint32[2*r+0]=f,this.uint16[x+2]=v,this.uint16[x+3]=m,r},t}($i);Tc.prototype.bytesPerElement=8,Tn("StructArrayLayout1ul2ui8",Tc);var oc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var m=2*r;return this.uint16[m+0]=f,this.uint16[m+1]=v,r},t}($i);oc.prototype.bytesPerElement=4,Tn("StructArrayLayout2ui4",oc);var hf=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}($i);hf.prototype.bytesPerElement=2,Tn("StructArrayLayout1ui2",hf);var $c=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,m)},t.prototype.emplace=function(r,f,v,m,x){var A=4*r;return this.float32[A+0]=f,this.float32[A+1]=v,this.float32[A+2]=m,this.float32[A+3]=x,r},t}($i);$c.prototype.bytesPerElement=16,Tn("StructArrayLayout4f16",$c);var c=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new te(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(Gl);c.prototype.size=20;var o=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new c(this,r)},t}(Yc);Tn("CollisionBoxArray",o);var i=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(Gl);i.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new i(this,r)},t}(Hu);Tn("PlacedSymbolArray",h);var g=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(Gl);g.prototype.size=68;var E=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new g(this,r)},t}(Sl);Tn("SymbolInstanceArray",E);var C=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(nu);Tn("GlyphOffsetArray",C);var L=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(Hs);Tn("SymbolLineVertexArray",L);var Z=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(Gl);Z.prototype.size=8;var ne=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new Z(this,r)},t}(Tc);Tn("FeatureIndexArray",ne);var me=So([{name:"a_pos",components:2,type:"Int16"}],4).members,ye=function(t){t===void 0&&(t=[]),this.segments=t};function Se(e,t){return 256*(e=Oe(Math.floor(e),0,255))+Oe(Math.floor(t),0,255)}ye.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>ye.MAX_VERTEX_ARRAY_LENGTH&&Me("Max vertices per segment is "+ye.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>ye.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},ye.prototype.get=function(){return this.segments},ye.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},ye.simpleSegment=function(e,t,r,f){return new ye([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},ye.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tn("SegmentVector",ye);var Ye=So([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Xe=G(function(e){e.exports=function(t,r){var f,v,m,x,A,D,z,W;for(v=t.length-(f=3&t.length),m=r,A=3432918353,D=461845907,W=0;W<v;)z=255&t.charCodeAt(W)|(255&t.charCodeAt(++W))<<8|(255&t.charCodeAt(++W))<<16|(255&t.charCodeAt(++W))<<24,++W,m=27492+(65535&(x=5*(65535&(m=(m^=z=(65535&(z=(z=(65535&z)*A+(((z>>>16)*A&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(z=0,f){case 3:z^=(255&t.charCodeAt(W+2))<<16;case 2:z^=(255&t.charCodeAt(W+1))<<8;case 1:m^=z=(65535&(z=(z=(65535&(z^=255&t.charCodeAt(W)))*A+(((z>>>16)*A&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295}return m^=t.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),ct=G(function(e){e.exports=function(t,r){for(var f,v=t.length,m=r^v,x=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24))+((1540483477*(f>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++x;switch(v){case 3:m^=(255&t.charCodeAt(x+2))<<16;case 2:m^=(255&t.charCodeAt(x+1))<<8;case 1:m=1540483477*(65535&(m^=255&t.charCodeAt(x)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),$e=Xe,tt=ct;$e.murmur3=Xe,$e.murmur2=tt;var It=function(){this.ids=[],this.positions=[],this.indexed=!1};It.prototype.add=function(e,t,r,f){this.ids.push(Sr(e)),this.positions.push(t,r,f)},It.prototype.getPositions=function(e){for(var t=Sr(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var m=[];this.ids[r]===t;)m.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return m},It.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(m,x,A,D){for(;A<D;){for(var z=m[A+D>>1],W=A-1,ie=D+1;;){do W++;while(m[W]<z);do ie--;while(m[ie]>z);if(W>=ie)break;nr(m,W,ie),nr(x,3*W,3*ie),nr(x,3*W+1,3*ie+1),nr(x,3*W+2,3*ie+2)}ie-A<D-ie?(v(m,x,A,ie),A=ie+1):(v(m,x,ie+1,D),D=ie)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},It.deserialize=function(e){var t=new It;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Mt=Math.pow(2,53)-1;function Sr(e){var t=+e;return!isNaN(t)&&t<=Mt?t:$e(String(e))}function nr(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}Tn("FeaturePositionMap",It);var xr=function(t,r){this.gl=t.gl,this.location=r},Cr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(xr),an=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(xr),Xr=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(xr),vn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(xr),An=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(xr),Xn=function(e){function t(r,f){e.call(this,r,f),this.current=Zn.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(xr),Qn=new Float32Array(16),Ci=function(e){function t(r,f){e.call(this,r,f),this.current=Qn}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(xr);function Ji(e){return[Se(255*e.r,255*e.g),Se(255*e.b,255*e.a)]}var Sn=function(t,r,f){this.value=t,this.uniformNames=r.map(function(v){return"u_"+v}),this.type=f};Sn.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},Sn.prototype.getBinding=function(e,t,r){return this.type==="color"?new Xn(e,t):new an(e,t)};var fi=function(t,r){this.uniformNames=r.map(function(f){return"u_"+f}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};fi.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},fi.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},fi.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new An(e,t):new an(e,t)};var gi=function(t,r,f,v){this.expression=t,this.type=f,this.maxValue=0,this.paintVertexAttributes=r.map(function(m){return{name:"a_"+m,type:"Float32",components:f==="color"?2:1,offset:0}}),this.paintVertexArray=new v};gi.prototype.populatePaintArray=function(e,t,r,f,v){var m=this.paintVertexArray.length,x=this.expression.evaluate(new Oi(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(m,e,x)},gi.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},gi.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=Ji(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var m=e;m<t;m++)this.paintVertexArray.emplace(m,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},gi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},gi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Un=function(t,r,f,v,m,x){this.expression=t,this.uniformNames=r.map(function(A){return"u_"+A+"_t"}),this.type=f,this.useIntegerZoom=v,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=r.map(function(A){return{name:"a_"+A,type:"Float32",components:f==="color"?4:2,offset:0}}),this.paintVertexArray=new x};Un.prototype.populatePaintArray=function(e,t,r,f,v){var m=this.expression.evaluate(new Oi(this.zoom),t,{},f,[],v),x=this.expression.evaluate(new Oi(this.zoom+1),t,{},f,[],v),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,m,x)},Un.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),m=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,m)},Un.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=Ji(r),m=Ji(f),x=e;x<t;x++)this.paintVertexArray.emplace(x,v[0],v[1],m[0],m[1]);else{for(var A=e;A<t;A++)this.paintVertexArray.emplace(A,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},Un.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Un.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Un.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=Oe(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},Un.prototype.getBinding=function(e,t,r){return new an(e,t)};var di=function(t,r,f,v,m,x){this.expression=t,this.type=r,this.useIntegerZoom=f,this.zoom=v,this.layerId=x,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m};di.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},di.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},di.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],m=f[r.mid],x=f[r.max];if(v&&m&&x)for(var A=e;A<t;A++)this.zoomInPaintVertexArray.emplace(A,m.tl[0],m.tl[1],m.br[0],m.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],m.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(A,m.tl[0],m.tl[1],m.br[0],m.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],m.pixelRatio,x.pixelRatio)}},di.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ye.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ye.members,this.expression.isStateDependent))},di.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Kn=function(t,r,f){this.binders={},this._buffers=[];var v=[];for(var m in t.paint._values)if(f(m)){var x=t.paint.get(m);if(x instanceof as&&hl(x.property.specification)){var A=Gi(m,t.type),D=x.value,z=x.property.specification.type,W=x.property.useIntegerZoom,ie=x.property.specification["property-type"],oe=ie==="cross-faded"||ie==="cross-faded-data-driven";if(D.kind==="constant")this.binders[m]=oe?new fi(D.value,A):new Sn(D.value,A,z),v.push("/u_"+m);else if(D.kind==="source"||oe){var xe=yo(m,z,"source");this.binders[m]=oe?new di(D,z,W,r,xe,t.id):new gi(D,A,z,xe),v.push("/a_"+m)}else{var je=yo(m,z,"composite");this.binders[m]=new Un(D,A,z,W,r,je),v.push("/z_"+m)}}}this.cacheKey=v.sort().join("")};Kn.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof gi||t instanceof Un?t.maxValue:0},Kn.prototype.populatePaintArrays=function(e,t,r,f,v){for(var m in this.binders){var x=this.binders[m];(x instanceof gi||x instanceof Un||x instanceof di)&&x.populatePaintArray(e,t,r,f,v)}},Kn.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof fi&&f.setConstantPatternPositions(e,t)}},Kn.prototype.updatePaintArrays=function(e,t,r,f,v){var m=!1;for(var x in e)for(var A=0,D=t.getPositions(x);A<D.length;A+=1){var z=D[A],W=r.feature(z.index);for(var ie in this.binders){var oe=this.binders[ie];if((oe instanceof gi||oe instanceof Un||oe instanceof di)&&oe.expression.isStateDependent===!0){var xe=f.paint.get(ie);oe.expression=xe.value,oe.updatePaintArray(z.start,z.end,W,e[x],v),m=!0}}}return m},Kn.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof Sn||r instanceof fi)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},Kn.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof gi||r instanceof Un)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof di)for(var v=0;v<Ye.members.length;v++)e.push(Ye.members[v].name)}return e},Kn.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof Sn||r instanceof fi||r instanceof Un)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},Kn.prototype.getPaintVertexBuffers=function(){return this._buffers},Kn.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof Sn||v instanceof fi||v instanceof Un)for(var m=0,x=v.uniformNames;m<x.length;m+=1){var A=x[m];if(t[A]){var D=v.getBinding(e,t[A],A);r.push({name:A,property:f,binding:D})}}}return r},Kn.prototype.setUniforms=function(e,t,r,f){for(var v=0,m=t;v<m.length;v+=1){var x=m[v],A=x.name,D=x.property;this.binders[D].setUniform(x.binding,f,r.get(D),A)}},Kn.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof di){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof gi||r instanceof Un)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},Kn.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof gi||r instanceof Un||r instanceof di)&&r.upload(e)}this.updatePaintBuffers()},Kn.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof gi||t instanceof Un||t instanceof di)&&t.destroy()}};var Si=function(t,r,f){f===void 0&&(f=function(){return!0}),this.programConfigurations={};for(var v=0,m=t;v<m.length;v+=1){var x=m[v];this.programConfigurations[x.id]=new Kn(x,r,f)}this.needsUpload=!1,this._featureMap=new It,this._bufferOffset=0};function Gi(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function yo(e,t,r){var f={color:{source:bl,composite:$c},number:{source:nu,composite:bl}},v=function(m){return{"line-pattern":{source:Ou,composite:Ou},"fill-pattern":{source:Ou,composite:Ou},"fill-extrusion-pattern":{source:Ou,composite:Ou}}[m]}(e);return v&&v[r]||f[t][r]}Si.prototype.populatePaintArrays=function(e,t,r,f,v,m){for(var x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,t,f,v,m);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},Si.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,m=r;v<m.length;v+=1){var x=m[v];this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,t,x,f)||this.needsUpload}},Si.prototype.get=function(e){return this.programConfigurations[e]},Si.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},Si.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Tn("ConstantBinder",Sn),Tn("CrossFadedConstantBinder",fi),Tn("SourceExpressionBinder",gi),Tn("CrossFadedCompositeBinder",di),Tn("CompositeExpressionBinder",Un),Tn("ProgramConfiguration",Kn,{omit:["_buffers"]}),Tn("ProgramConfigurationSet",Si);var uo=Math.pow(2,14)-1,Oo=-uo-1;function Ua(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],m=0;m<v.length;m++){var x=v[m],A=Math.round(x.x*t),D=Math.round(x.y*t);x.x=Oe(A,Oo,uo),x.y=Oe(D,Oo,uo),(A<x.x||A>x.x+1||D<x.y||D>x.y+1)&&Me("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function Xa(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ua(e):[]}}function Cs(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var Ko=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new xl,this.indexArray=new ma,this.segments=new ye,this.programConfigurations=new Si(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};function Wu(e,t){for(var r=0;r<e.length;r++)if(Du(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(Du(e,t[f]))return!0;return!!El(e,t)}function Lu(e,t,r){return!!Du(e,t)||!!Ru(t,e,r)}function ss(e,t){if(e.length===1)return Hl(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(Du(e,f[v]))return!0;for(var m=0;m<e.length;m++)if(Hl(t,e[m]))return!0;for(var x=0;x<t.length;x++)if(El(e,t[x]))return!0;return!1}function zs(e,t,r){if(e.length>1){if(El(e,t))return!0;for(var f=0;f<t.length;f++)if(Ru(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(Ru(e[v],t,r))return!0;return!1}function El(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],m=0;m<t.length-1;m++)if(Ac(f,v,t[m],t[m+1]))return!0;return!1}function Ac(e,t,r,f){return Te(e,r,f)!==Te(t,r,f)&&Te(e,t,r)!==Te(e,t,f)}function Ru(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(ol(e,t[v-1],t[v])<f)return!0;return!1}function ol(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function Hl(e,t){for(var r,f,v,m=!1,x=0;x<e.length;x++)for(var A=0,D=(r=e[x]).length-1;A<r.length;D=A++)(f=r[A]).y>t.y!=(v=r[D]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(m=!m);return m}function Du(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var m=e[f],x=e[v];m.y>t.y!=x.y>t.y&&t.x<(x.x-m.x)*(t.y-m.y)/(x.y-m.y)+m.x&&(r=!r)}return r}function sc(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var m=Te(e,t,r[0]);return m!==Te(e,t,r[1])||m!==Te(e,t,r[2])||m!==Te(e,t,r[3])}function fu(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function lo(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function hu(e,t,r,f,v){if(!t[0]&&!t[1])return e;var m=te.convert(t)._mult(v);r==="viewport"&&m._rotate(-f);for(var x=[],A=0;A<e.length;A++)x.push(e[A].sub(m));return x}Ko.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],m=null;f.type==="circle"&&(m=f.layout.get("circle-sort-key"));for(var x=0,A=e;x<A.length;x+=1){var D=A[x],z=D.feature,W=D.id,ie=D.index,oe=D.sourceLayerIndex,xe=this.layers[0]._featureFilter.needGeometry,je=Xa(z,xe);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),je,r)){var ze=m?m.evaluate(je,{},r):void 0,at={id:W,properties:z.properties,type:z.type,sourceLayerIndex:oe,index:ie,geometry:xe?je.geometry:Ua(z),patterns:{},sortKey:ze};v.push(at)}}m&&v.sort(function(cn,Ln){return cn.sortKey-Ln.sortKey});for(var ut=0,Ot=v;ut<Ot.length;ut+=1){var Yt=Ot[ut],ir=Yt.geometry,Lr=Yt.index,Er=Yt.sourceLayerIndex,tn=e[Lr].feature;this.addFeature(Yt,ir,Lr,r),t.featureIndex.insert(tn,ir,Lr,Er,this.index)}},Ko.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Ko.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ko.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ko.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,me),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Ko.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ko.prototype.addFeature=function(e,t,r,f){for(var v=0,m=t;v<m.length;v+=1)for(var x=0,A=m[v];x<A.length;x+=1){var D=A[x],z=D.x,W=D.y;if(!(z<0||z>=8192||W<0||W>=8192)){var ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),oe=ie.vertexLength;Cs(this.layoutVertexArray,z,W,-1,-1),Cs(this.layoutVertexArray,z,W,1,-1),Cs(this.layoutVertexArray,z,W,1,1),Cs(this.layoutVertexArray,z,W,-1,1),this.indexArray.emplaceBack(oe,oe+1,oe+2),this.indexArray.emplaceBack(oe,oe+3,oe+2),ie.vertexLength+=4,ie.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},Tn("CircleBucket",Ko,{omit:["layers"]});var wl=new Fo({"circle-sort-key":new On(he.layout_circle["circle-sort-key"])}),Ps={paint:new Fo({"circle-radius":new On(he.paint_circle["circle-radius"]),"circle-color":new On(he.paint_circle["circle-color"]),"circle-blur":new On(he.paint_circle["circle-blur"]),"circle-opacity":new On(he.paint_circle["circle-opacity"]),"circle-translate":new Bn(he.paint_circle["circle-translate"]),"circle-translate-anchor":new Bn(he.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Bn(he.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Bn(he.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new On(he.paint_circle["circle-stroke-width"]),"circle-stroke-color":new On(he.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new On(he.paint_circle["circle-stroke-opacity"])}),layout:wl},Eo=typeof Float32Array!="undefined"?Float32Array:Array;function No(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Lo(e,t,r){var f=t[0],v=t[1],m=t[2],x=t[3],A=t[4],D=t[5],z=t[6],W=t[7],ie=t[8],oe=t[9],xe=t[10],je=t[11],ze=t[12],at=t[13],ut=t[14],Ot=t[15],Yt=r[0],ir=r[1],Lr=r[2],Er=r[3];return e[0]=Yt*f+ir*A+Lr*ie+Er*ze,e[1]=Yt*v+ir*D+Lr*oe+Er*at,e[2]=Yt*m+ir*z+Lr*xe+Er*ut,e[3]=Yt*x+ir*W+Lr*je+Er*Ot,e[4]=(Yt=r[4])*f+(ir=r[5])*A+(Lr=r[6])*ie+(Er=r[7])*ze,e[5]=Yt*v+ir*D+Lr*oe+Er*at,e[6]=Yt*m+ir*z+Lr*xe+Er*ut,e[7]=Yt*x+ir*W+Lr*je+Er*Ot,e[8]=(Yt=r[8])*f+(ir=r[9])*A+(Lr=r[10])*ie+(Er=r[11])*ze,e[9]=Yt*v+ir*D+Lr*oe+Er*at,e[10]=Yt*m+ir*z+Lr*xe+Er*ut,e[11]=Yt*x+ir*W+Lr*je+Er*Ot,e[12]=(Yt=r[12])*f+(ir=r[13])*A+(Lr=r[14])*ie+(Er=r[15])*ze,e[13]=Yt*v+ir*D+Lr*oe+Er*at,e[14]=Yt*m+ir*z+Lr*xe+Er*ut,e[15]=Yt*x+ir*W+Lr*je+Er*Ot,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var us,Ro=Lo;function Ws(e,t,r){var f=t[0],v=t[1],m=t[2],x=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*m+r[12]*x,e[1]=r[1]*f+r[5]*v+r[9]*m+r[13]*x,e[2]=r[2]*f+r[6]*v+r[10]*m+r[14]*x,e[3]=r[3]*f+r[7]*v+r[11]*m+r[15]*x,e}us=new Eo(3),Eo!=Float32Array&&(us[0]=0,us[1]=0,us[2]=0),function(){var e=new Eo(4);Eo!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var Tl=(function(){var e=new Eo(2);Eo!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,Ps)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Ko(r)},t.prototype.queryRadius=function(r){var f=r;return fu("circle-radius",this,f)+fu("circle-stroke-width",this,f)+lo(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,m,x,A,D,z){for(var W=hu(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),A.angle,D),ie=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),oe=this.paint.get("circle-pitch-alignment")==="map",xe=oe?W:function(tn,cn){return tn.map(function(Ln){return uc(Ln,cn)})}(W,z),je=oe?ie*D:ie,ze=0,at=m;ze<at.length;ze+=1)for(var ut=0,Ot=at[ze];ut<Ot.length;ut+=1){var Yt=Ot[ut],ir=oe?Yt:uc(Yt,z),Lr=je,Er=Ws([],[Yt.x,Yt.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Lr*=Er[3]/A.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Lr*=A.cameraToCenterDistance/Er[3]),Lu(xe,ir,Lr))return!0}return!1},t}(Vs));function uc(e,t){var r=Ws([],[e.x,e.y,0,1],t);return new te(r[0]/r[3],r[1]/r[3])}var Xu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Ko);function ku(e,t,r,f){var v=t.width,m=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*m*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*m*r);return e.width=v,e.height=m,e.data=f,e}function Cc(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var m=ku({},{width:f,height:v},r);Al(e,m,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=m.data}}function Al(e,t,r,f,v,m){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var x=e.data,A=t.data,D=0;D<v.height;D++)for(var z=((r.y+D)*e.width+r.x)*m,W=((f.y+D)*t.width+f.x)*m,ie=0;ie<v.width*m;ie++)A[W+ie]=x[z+ie];return t}Tn("HeatmapBucket",Xu,{omit:["layers"]});var Ms=function(t,r){ku(this,t,1,r)};Ms.prototype.resize=function(e){Cc(this,e,1)},Ms.prototype.clone=function(){return new Ms({width:this.width,height:this.height},new Uint8Array(this.data))},Ms.copy=function(e,t,r,f,v){Al(e,t,r,f,v,1)};var zo=function(t,r){ku(this,t,4,r)};zo.prototype.resize=function(e){Cc(this,e,4)},zo.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},zo.prototype.clone=function(){return new zo({width:this.width,height:this.height},new Uint8Array(this.data))},zo.copy=function(e,t,r,f,v){Al(e,t,r,f,v,4)},Tn("AlphaImage",Ms),Tn("RGBAImage",zo);var xh={paint:new Fo({"heatmap-radius":new On(he.paint_heatmap["heatmap-radius"]),"heatmap-weight":new On(he.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Bn(he.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bo(he.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Bn(he.paint_heatmap["heatmap-opacity"])})};function Jf(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new zo({width:r,height:f}),m=function(ze,at,ut){t[e.evaluationKey]=ut;var Ot=e.expression.evaluate(t);v.data[ze+at+0]=Math.floor(255*Ot.r/Ot.a),v.data[ze+at+1]=Math.floor(255*Ot.g/Ot.a),v.data[ze+at+2]=Math.floor(255*Ot.b/Ot.a),v.data[ze+at+3]=Math.floor(255*Ot.a)};if(e.clips)for(var x=0,A=0;x<f;++x,A+=4*r)for(var D=0,z=0;D<r;D++,z+=4){var W=D/(r-1),ie=e.clips[x];m(A,z,ie.start*(1-W)+ie.end*W)}else for(var oe=0,xe=0;oe<r;oe++,xe+=4)m(0,xe,oe/(r-1));return v}var Qf=function(e){function t(r){e.call(this,r,xh),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Xu(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=Jf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(Vs),Ff={paint:new Fo({"hillshade-illumination-direction":new Bn(he.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Bn(he.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Bn(he.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Bn(he.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Bn(he.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Bn(he.paint_hillshade["hillshade-accent-color"])})},Af=function(e){function t(r){e.call(this,r,Ff)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(Vs),Jc=So([{name:"a_pos",components:2,type:"Int16"}],4).members,Wl=Qc,Cf=Qc;function Qc(e,t,r){r=r||2;var f,v,m,x,A,D,z,W=t&&t.length,ie=W?t[0]*r:e.length,oe=Nf(e,0,ie,r,!0),xe=[];if(!oe||oe.next===oe.prev)return xe;if(W&&(oe=function(ze,at,ut,Ot){var Yt,ir,Lr,Er=[];for(Yt=0,ir=at.length;Yt<ir;Yt++)(Lr=Nf(ze,at[Yt]*Ot,Yt<ir-1?at[Yt+1]*Ot:ze.length,Ot,!1))===Lr.next&&(Lr.steiner=!0),Er.push(Sh(Lr));for(Er.sort(Bf),Yt=0;Yt<Er.length;Yt++)th(Er[Yt],ut),ut=Cl(ut,ut.next);return ut}(e,t,oe,r)),e.length>80*r){f=m=e[0],v=x=e[1];for(var je=r;je<ie;je+=r)(A=e[je])<f&&(f=A),(D=e[je+1])<v&&(v=D),A>m&&(m=A),D>x&&(x=D);z=(z=Math.max(m-f,x-v))!==0?1/z:0}return qc(oe,xe,r,f,v,z),xe}function Nf(e,t,r,f,v){var m,x;if(v===ee(e,t,r,f)>0)for(m=t;m<r;m+=f)x=U(m,e[m],e[m+1],x);else for(m=r-f;m>=t;m-=f)x=U(m,e[m],e[m+1],x);return x&&Pc(x,x.next)&&(M(x),x=x.next),x}function Cl(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!Pc(f,f.next)&&co(f.prev,f,f.next)!==0)f=f.next;else{if(M(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function qc(e,t,r,f,v,m,x){if(e){!x&&m&&function(W,ie,oe,xe){var je=W;do je.z===null&&(je.z=Uf(je.x,je.y,ie,oe,xe)),je.prevZ=je.prev,je.nextZ=je.next,je=je.next;while(je!==W);je.prevZ.nextZ=null,je.prevZ=null,function(ze){var at,ut,Ot,Yt,ir,Lr,Er,tn,cn=1;do{for(ut=ze,ze=null,ir=null,Lr=0;ut;){for(Lr++,Ot=ut,Er=0,at=0;at<cn&&(Er++,Ot=Ot.nextZ);at++);for(tn=cn;Er>0||tn>0&&Ot;)Er!==0&&(tn===0||!Ot||ut.z<=Ot.z)?(Yt=ut,ut=ut.nextZ,Er--):(Yt=Ot,Ot=Ot.nextZ,tn--),ir?ir.nextZ=Yt:ze=Yt,Yt.prevZ=ir,ir=Yt;ut=Ot}ir.nextZ=null,cn*=2}while(Lr>1)}(je)}(e,f,v,m);for(var A,D,z=e;e.prev!==e.next;)if(A=e.prev,D=e.next,m?bh(e,f,v,m):zf(e))t.push(A.i/r),t.push(e.i/r),t.push(D.i/r),M(e),e=D.next,z=D.next;else if((e=D)===z){x?x===1?qc(e=qf(Cl(e),t,r),t,r,f,v,m,2):x===2&&eh(e,t,r,f,v,m):qc(Cl(e),t,r,f,v,m,1);break}}}function zf(e){var t=e.prev,r=e,f=e.next;if(co(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(pu(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&co(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function bh(e,t,r,f){var v=e.prev,m=e,x=e.next;if(co(v,m,x)>=0)return!1;for(var A=v.x>m.x?v.x>x.x?v.x:x.x:m.x>x.x?m.x:x.x,D=v.y>m.y?v.y>x.y?v.y:x.y:m.y>x.y?m.y:x.y,z=Uf(v.x<m.x?v.x<x.x?v.x:x.x:m.x<x.x?m.x:x.x,v.y<m.y?v.y<x.y?v.y:x.y:m.y<x.y?m.y:x.y,t,r,f),W=Uf(A,D,t,r,f),ie=e.prevZ,oe=e.nextZ;ie&&ie.z>=z&&oe&&oe.z<=W;){if(ie!==e.prev&&ie!==e.next&&pu(v.x,v.y,m.x,m.y,x.x,x.y,ie.x,ie.y)&&co(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,oe!==e.prev&&oe!==e.next&&pu(v.x,v.y,m.x,m.y,x.x,x.y,oe.x,oe.y)&&co(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;ie&&ie.z>=z;){if(ie!==e.prev&&ie!==e.next&&pu(v.x,v.y,m.x,m.y,x.x,x.y,ie.x,ie.y)&&co(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;oe&&oe.z<=W;){if(oe!==e.prev&&oe!==e.next&&pu(v.x,v.y,m.x,m.y,x.x,x.y,oe.x,oe.y)&&co(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function qf(e,t,r){var f=e;do{var v=f.prev,m=f.next.next;!Pc(v,m)&&Pf(v,f,f.next,m)&&Xl(v,m)&&Xl(m,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(m.i/r),M(f),M(f.next),f=e=m),f=f.next}while(f!==e);return Cl(f)}function eh(e,t,r,f,v,m){var x=e;do{for(var A=x.next.next;A!==x.prev;){if(x.i!==A.i&&pf(x,A)){var D=B(x,A);return x=Cl(x,x.next),D=Cl(D,D.next),qc(x,t,r,f,v,m),void qc(D,t,r,f,v,m)}A=A.next}x=x.next}while(x!==e)}function Bf(e,t){return e.x-t.x}function th(e,t){if(t=function(f,v){var m,x=v,A=f.x,D=f.y,z=-1/0;do{if(D<=x.y&&D>=x.next.y&&x.next.y!==x.y){var W=x.x+(D-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(W<=A&&W>z){if(z=W,W===A){if(D===x.y)return x;if(D===x.next.y)return x.next}m=x.x<x.next.x?x:x.next}}x=x.next}while(x!==v);if(!m)return null;if(A===z)return m;var ie,oe=m,xe=m.x,je=m.y,ze=1/0;x=m;do A>=x.x&&x.x>=xe&&A!==x.x&&pu(D<je?A:z,D,xe,je,D<je?z:A,D,x.x,x.y)&&(ie=Math.abs(D-x.y)/(A-x.x),Xl(x,f)&&(ie<ze||ie===ze&&(x.x>m.x||x.x===m.x&&rh(m,x)))&&(m=x,ze=ie)),x=x.next;while(x!==oe);return m}(e,t)){var r=B(t,e);Cl(t,t.next),Cl(r,r.next)}}function rh(e,t){return co(e.prev,e,t.prev)<0&&co(t.next,e,e.next)<0}function Uf(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Sh(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function pu(e,t,r,f,v,m,x,A){return(v-x)*(t-A)-(e-x)*(m-A)>=0&&(e-x)*(f-A)-(r-x)*(t-A)>=0&&(r-x)*(m-A)-(v-x)*(f-A)>=0}function pf(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&Pf(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(Xl(e,t)&&Xl(t,e)&&function(r,f){var v=r,m=!1,x=(r.x+f.x)/2,A=(r.y+f.y)/2;do v.y>A!=v.next.y>A&&v.next.y!==v.y&&x<(v.next.x-v.x)*(A-v.y)/(v.next.y-v.y)+v.x&&(m=!m),v=v.next;while(v!==r);return m}(e,t)&&(co(e.prev,e,t.prev)||co(e,t.prev,t))||Pc(e,t)&&co(e.prev,e,e.next)>0&&co(t.prev,t,t.next)>0)}function co(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Pc(e,t){return e.x===t.x&&e.y===t.y}function Pf(e,t,r,f){var v=lc(co(e,t,r)),m=lc(co(e,t,f)),x=lc(co(r,f,e)),A=lc(co(r,f,t));return v!==m&&x!==A||!(v!==0||!Mc(e,r,t))||!(m!==0||!Mc(e,f,t))||!(x!==0||!Mc(r,e,f))||!(A!==0||!Mc(r,t,f))}function Mc(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function lc(e){return e>0?1:e<0?-1:0}function Xl(e,t){return co(e.prev,e,e.next)<0?co(e,t,e.next)>=0&&co(e,e.prev,t)>=0:co(e,t,e.prev)<0||co(e,e.next,t)<0}function B(e,t){var r=new R(e.i,e.x,e.y),f=new R(t.i,t.x,t.y),v=e.next,m=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,m.next=f,f.prev=m,f}function U(e,t,r,f){var v=new R(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function R(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ee(e,t,r,f){for(var v=0,m=t,x=r-f;m<r;m+=f)v+=(e[x]-e[m])*(e[m+1]+e[x+1]),x=m;return v}function ge(e,t,r,f,v){(function m(x,A,D,z,W){for(;z>D;){if(z-D>600){var ie=z-D+1,oe=A-D+1,xe=Math.log(ie),je=.5*Math.exp(2*xe/3),ze=.5*Math.sqrt(xe*je*(ie-je)/ie)*(oe-ie/2<0?-1:1);m(x,A,Math.max(D,Math.floor(A-oe*je/ie+ze)),Math.min(z,Math.floor(A+(ie-oe)*je/ie+ze)),W)}var at=x[A],ut=D,Ot=z;for(rt(x,D,A),W(x[z],at)>0&&rt(x,D,z);ut<Ot;){for(rt(x,ut,Ot),ut++,Ot--;W(x[ut],at)<0;)ut++;for(;W(x[Ot],at)>0;)Ot--}W(x[D],at)===0?rt(x,D,Ot):rt(x,++Ot,z),Ot<=A&&(D=Ot+1),A<=Ot&&(z=Ot-1)}})(e,t,r||0,f||e.length-1,v||wt)}function rt(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function wt(e,t){return e<t?-1:e>t?1:0}function Et(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,m=[],x=0;x<r;x++){var A=Ie(e[x]);A!==0&&(e[x].area=Math.abs(A),v===void 0&&(v=A<0),v===A<0?(f&&m.push(f),f=[e[x]]):f.push(e[x]))}if(f&&m.push(f),t>1)for(var D=0;D<m.length;D++)m[D].length<=t||(ge(m[D],t,1,m[D].length-1,vr),m[D]=m[D].slice(0,t));return m}function vr(e,t){return t.area-e.area}function Vr(e,t,r){for(var f=r.patternDependencies,v=!1,m=0,x=t;m<x.length;m+=1){var A=x[m].paint.get(e+"-pattern");A.isConstant()||(v=!0);var D=A.constantOr(null);D&&(v=!0,f[D.to]=!0,f[D.from]=!0)}return v}function In(e,t,r,f,v){for(var m=v.patternDependencies,x=0,A=t;x<A.length;x+=1){var D=A[x],z=D.paint.get(e+"-pattern").value;if(z.kind!=="constant"){var W=z.evaluate({zoom:f-1},r,{},v.availableImages),ie=z.evaluate({zoom:f},r,{},v.availableImages),oe=z.evaluate({zoom:f+1},r,{},v.availableImages);ie=ie&&ie.name?ie.name:ie,oe=oe&&oe.name?oe.name:oe,m[W=W&&W.name?W.name:W]=!0,m[ie]=!0,m[oe]=!0,r.patterns[D.id]={min:W,mid:ie,max:oe}}}return r}Qc.deviation=function(e,t,r,f){var v=t&&t.length,m=Math.abs(ee(e,0,v?t[0]*r:e.length,r));if(v)for(var x=0,A=t.length;x<A;x++)m-=Math.abs(ee(e,t[x]*r,x<A-1?t[x+1]*r:e.length,r));var D=0;for(x=0;x<f.length;x+=3){var z=f[x]*r,W=f[x+1]*r,ie=f[x+2]*r;D+=Math.abs((e[z]-e[ie])*(e[W+1]-e[z+1])-(e[z]-e[W])*(e[ie+1]-e[z+1]))}return m===0&&D===0?0:Math.abs((D-m)/m)},Qc.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var m=0;m<e[v].length;m++)for(var x=0;x<t;x++)r.vertices.push(e[v][m][x]);v>0&&r.holes.push(f+=e[v-1].length)}return r},Wl.default=Cf;var Nn=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xl,this.indexArray=new ma,this.indexArray2=new oc,this.programConfigurations=new Si(t.layers,t.zoom),this.segments=new ye,this.segments2=new ye,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};Nn.prototype.populate=function(e,t,r){this.hasPattern=Vr("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],m=0,x=e;m<x.length;m+=1){var A=x[m],D=A.feature,z=A.id,W=A.index,ie=A.sourceLayerIndex,oe=this.layers[0]._featureFilter.needGeometry,xe=Xa(D,oe);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),xe,r)){var je=f?f.evaluate(xe,{},r,t.availableImages):void 0,ze={id:z,properties:D.properties,type:D.type,sourceLayerIndex:ie,index:W,geometry:oe?xe.geometry:Ua(D),patterns:{},sortKey:je};v.push(ze)}}f&&v.sort(function(tn,cn){return tn.sortKey-cn.sortKey});for(var at=0,ut=v;at<ut.length;at+=1){var Ot=ut[at],Yt=Ot.geometry,ir=Ot.index,Lr=Ot.sourceLayerIndex;if(this.hasPattern){var Er=In("fill",this.layers,Ot,this.zoom,t);this.patternFeatures.push(Er)}else this.addFeature(Ot,Yt,ir,r,{});t.featureIndex.insert(e[ir].feature,Yt,ir,Lr,this.index)}},Nn.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Nn.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var m=v[f];this.addFeature(m,m.geometry,m.index,t,r)}},Nn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Nn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Nn.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jc),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},Nn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Nn.prototype.addFeature=function(e,t,r,f,v){for(var m=0,x=Et(t,500);m<x.length;m+=1){for(var A=x[m],D=0,z=0,W=A;z<W.length;z+=1)D+=W[z].length;for(var ie=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),oe=ie.vertexLength,xe=[],je=[],ze=0,at=A;ze<at.length;ze+=1){var ut=at[ze];if(ut.length!==0){ut!==A[0]&&je.push(xe.length/2);var Ot=this.segments2.prepareSegment(ut.length,this.layoutVertexArray,this.indexArray2),Yt=Ot.vertexLength;this.layoutVertexArray.emplaceBack(ut[0].x,ut[0].y),this.indexArray2.emplaceBack(Yt+ut.length-1,Yt),xe.push(ut[0].x),xe.push(ut[0].y);for(var ir=1;ir<ut.length;ir++)this.layoutVertexArray.emplaceBack(ut[ir].x,ut[ir].y),this.indexArray2.emplaceBack(Yt+ir-1,Yt+ir),xe.push(ut[ir].x),xe.push(ut[ir].y);Ot.vertexLength+=ut.length,Ot.primitiveLength+=ut.length}}for(var Lr=Wl(xe,je),Er=0;Er<Lr.length;Er+=3)this.indexArray.emplaceBack(oe+Lr[Er],oe+Lr[Er+1],oe+Lr[Er+2]);ie.vertexLength+=D,ie.primitiveLength+=Lr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Tn("FillBucket",Nn,{omit:["layers","patternFeatures"]});var si=new Fo({"fill-sort-key":new On(he.layout_fill["fill-sort-key"])}),Pi={paint:new Fo({"fill-antialias":new Bn(he.paint_fill["fill-antialias"]),"fill-opacity":new On(he.paint_fill["fill-opacity"]),"fill-color":new On(he.paint_fill["fill-color"]),"fill-outline-color":new On(he.paint_fill["fill-outline-color"]),"fill-translate":new Bn(he.paint_fill["fill-translate"]),"fill-translate-anchor":new Bn(he.paint_fill["fill-translate-anchor"]),"fill-pattern":new xc(he.paint_fill["fill-pattern"])}),layout:si},Ei=function(e){function t(r){e.call(this,r,Pi)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new Nn(r)},t.prototype.queryRadius=function(){return lo(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,m,x,A,D){return ss(hu(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),A.angle,D),m)},t.prototype.isTileClipped=function(){return!0},t}(Vs),pa=So([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,wi=ja;function ja(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(Bo,this,t)}function Bo(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var m=f.readVarint()+f.pos;f.pos<m;){var x=v._keys[f.readVarint()],A=v._values[f.readVarint()];v.properties[x]=A}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Uo(e){for(var t,r,f=0,v=0,m=e.length,x=m-1;v<m;x=v++)f+=((r=e[x]).x-(t=e[v]).x)*(t.y+r.y);return f}ja.types=["Unknown","Point","LineString","Polygon"],ja.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,m=0,x=0,A=[];e.pos<r;){if(v<=0){var D=e.readVarint();f=7&D,v=D>>3}if(v--,f===1||f===2)m+=e.readSVarint(),x+=e.readSVarint(),f===1&&(t&&A.push(t),t=[]),t.push(new te(m,x));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&A.push(t),A},ja.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,m=0,x=1/0,A=-1/0,D=1/0,z=-1/0;e.pos<t;){if(f<=0){var W=e.readVarint();r=7&W,f=W>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<x&&(x=v),v>A&&(A=v),(m+=e.readSVarint())<D&&(D=m),m>z&&(z=m);else if(r!==7)throw new Error("unknown command "+r)}return[x,D,A,z]},ja.prototype.toGeoJSON=function(e,t,r){var f,v,m=this.extent*Math.pow(2,r),x=this.extent*e,A=this.extent*t,D=this.loadGeometry(),z=ja.types[this.type];function W(xe){for(var je=0;je<xe.length;je++){var ze=xe[je];xe[je]=[360*(ze.x+x)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(ze.y+A)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var ie=[];for(f=0;f<D.length;f++)ie[f]=D[f][0];W(D=ie);break;case 2:for(f=0;f<D.length;f++)W(D[f]);break;case 3:for(D=function(xe){var je=xe.length;if(je<=1)return[xe];for(var ze,at,ut=[],Ot=0;Ot<je;Ot++){var Yt=Uo(xe[Ot]);Yt!==0&&(at===void 0&&(at=Yt<0),at===Yt<0?(ze&&ut.push(ze),ze=[xe[Ot]]):ze.push(xe[Ot]))}return ze&&ut.push(ze),ut}(D),f=0;f<D.length;f++)for(v=0;v<D[f].length;v++)W(D[f][v])}D.length===1?D=D[0]:z="Multi"+z;var oe={type:"Feature",geometry:{type:z,coordinates:D},properties:this.properties};return"id"in this&&(oe.id=this.id),oe};var Yo=fo;function fo(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Sa,this,t),this.length=this._features.length}function Sa(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,m=f.readVarint()+f.pos;f.pos<m;){var x=f.readVarint()>>3;v=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return v}(r))}function ga(e,t,r){if(e===3){var f=new Yo(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}fo.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new wi(this._pbf,t,this.extent,this._keys,this._values)};var wo={VectorTile:function(t,r){this.layers=t.readFields(ga,{},r)},VectorTileFeature:wi,VectorTileLayer:Yo},ho=wo.VectorTileFeature.types,Za=Math.pow(2,13);function $o(e,t,r,f,v,m,x,A){e.emplaceBack(t,r,2*Math.floor(f*Za)+x,v*Za*2,m*Za*2,Math.round(A))}var Jo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Iu,this.indexArray=new ma,this.programConfigurations=new Si(t.layers,t.zoom),this.segments=new ye,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};function Ic(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}Jo.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=Vr("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var m=v[f],x=m.feature,A=m.id,D=m.index,z=m.sourceLayerIndex,W=this.layers[0]._featureFilter.needGeometry,ie=Xa(x,W);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),ie,r)){var oe={id:A,sourceLayerIndex:z,index:D,geometry:W?ie.geometry:Ua(x),properties:x.properties,type:x.type,patterns:{}};this.hasPattern?this.features.push(In("fill-extrusion",this.layers,oe,this.zoom,t)):this.addFeature(oe,oe.geometry,D,r,{}),t.featureIndex.insert(x,oe.geometry,D,z,this.index,!0)}}},Jo.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var m=v[f];this.addFeature(m,m.geometry,m.index,t,r)}},Jo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Jo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Jo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Jo.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pa),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Jo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Jo.prototype.addFeature=function(e,t,r,f,v){for(var m=0,x=Et(t,500);m<x.length;m+=1){for(var A=x[m],D=0,z=0,W=A;z<W.length;z+=1)D+=W[z].length;for(var ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),oe=0,xe=A;oe<xe.length;oe+=1){var je=xe[oe];if(je.length!==0&&!((Hi=je).every(function(Ti){return Ti.x<0})||Hi.every(function(Ti){return Ti.x>8192})||Hi.every(function(Ti){return Ti.y<0})||Hi.every(function(Ti){return Ti.y>8192})))for(var ze=0,at=0;at<je.length;at++){var ut=je[at];if(at>=1){var Ot=je[at-1];if(!Ic(ut,Ot)){ie.vertexLength+4>ye.MAX_VERTEX_ARRAY_LENGTH&&(ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Yt=ut.sub(Ot)._perp()._unit(),ir=Ot.dist(ut);ze+ir>32768&&(ze=0),$o(this.layoutVertexArray,ut.x,ut.y,Yt.x,Yt.y,0,0,ze),$o(this.layoutVertexArray,ut.x,ut.y,Yt.x,Yt.y,0,1,ze),$o(this.layoutVertexArray,Ot.x,Ot.y,Yt.x,Yt.y,0,0,ze+=ir),$o(this.layoutVertexArray,Ot.x,Ot.y,Yt.x,Yt.y,0,1,ze);var Lr=ie.vertexLength;this.indexArray.emplaceBack(Lr,Lr+2,Lr+1),this.indexArray.emplaceBack(Lr+1,Lr+2,Lr+3),ie.vertexLength+=4,ie.primitiveLength+=2}}}}if(ie.vertexLength+D>ye.MAX_VERTEX_ARRAY_LENGTH&&(ie=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),ho[e.type]==="Polygon"){for(var Er=[],tn=[],cn=ie.vertexLength,Ln=0,Gn=A;Ln<Gn.length;Ln+=1){var Dn=Gn[Ln];if(Dn.length!==0){Dn!==A[0]&&tn.push(Er.length/2);for(var xn=0;xn<Dn.length;xn++){var ei=Dn[xn];$o(this.layoutVertexArray,ei.x,ei.y,0,0,1,1,0),Er.push(ei.x),Er.push(ei.y)}}}for(var Jn=Wl(Er,tn),Hn=0;Hn<Jn.length;Hn+=3)this.indexArray.emplaceBack(cn+Jn[Hn],cn+Jn[Hn+2],cn+Jn[Hn+1]);ie.primitiveLength+=Jn.length/3,ie.vertexLength+=D}}var Hi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Tn("FillExtrusionBucket",Jo,{omit:["layers","features"]});var Kl={paint:new Fo({"fill-extrusion-opacity":new Bn(he["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new On(he["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Bn(he["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Bn(he["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new xc(he["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new On(he["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new On(he["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Bn(he["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},_s=function(e){function t(r){e.call(this,r,Kl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Jo(r)},t.prototype.queryRadius=function(){return lo(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,m,x,A,D,z){var W=hu(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),A.angle,D),ie=this.paint.get("fill-extrusion-height").evaluate(f,v),oe=this.paint.get("fill-extrusion-base").evaluate(f,v),xe=function(ze,at,ut,Ot){for(var Yt=[],ir=0,Lr=ze;ir<Lr.length;ir+=1){var Er=Lr[ir],tn=[Er.x,Er.y,0,1];Ws(tn,tn,at),Yt.push(new te(tn[0]/tn[3],tn[1]/tn[3]))}return Yt}(W,z),je=function(ze,at,ut,Ot){for(var Yt=[],ir=[],Lr=Ot[8]*at,Er=Ot[9]*at,tn=Ot[10]*at,cn=Ot[11]*at,Ln=Ot[8]*ut,Gn=Ot[9]*ut,Dn=Ot[10]*ut,xn=Ot[11]*ut,ei=0,Jn=ze;ei<Jn.length;ei+=1){for(var Hn=[],Hi=[],Ti=0,Ea=Jn[ei];Ti<Ea.length;Ti+=1){var li=Ea[Ti],Xi=li.x,eo=li.y,to=Ot[0]*Xi+Ot[4]*eo+Ot[12],Ao=Ot[1]*Xi+Ot[5]*eo+Ot[13],po=Ot[2]*Xi+Ot[6]*eo+Ot[14],Do=Ot[3]*Xi+Ot[7]*eo+Ot[15],Js=po+tn,bs=Do+cn,du=to+Ln,Ls=Ao+Gn,au=po+Dn,Ss=Do+xn,Rs=new te((to+Lr)/bs,(Ao+Er)/bs);Rs.z=Js/bs,Hn.push(Rs);var Us=new te(du/Ss,Ls/Ss);Us.z=au/Ss,Hi.push(Us)}Yt.push(Hn),ir.push(Hi)}return[Yt,ir]}(m,oe,ie,z);return function(ze,at,ut){var Ot=1/0;ss(ut,at)&&(Ot=jo(ut,at[0]));for(var Yt=0;Yt<at.length;Yt++)for(var ir=at[Yt],Lr=ze[Yt],Er=0;Er<ir.length-1;Er++){var tn=ir[Er],cn=[tn,ir[Er+1],Lr[Er+1],Lr[Er],tn];Wu(ut,cn)&&(Ot=Math.min(Ot,jo(ut,cn)))}return Ot!==1/0&&Ot}(je[0],je[1],xe)},t}(Vs);function Bs(e,t){return e.x*t.x+e.y*t.y}function jo(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var m=t[f],x=e[0],A=r.sub(v),D=m.sub(v),z=x.sub(v),W=Bs(A,A),ie=Bs(A,D),oe=Bs(D,D),xe=Bs(z,A),je=Bs(z,D),ze=W*oe-ie*ie,at=(oe*xe-ie*je)/ze,ut=(W*je-ie*xe)/ze,Ot=v.z*(1-at-ut)+r.z*at+m.z*ut;if(isFinite(Ot))return Ot}return 1/0}for(var Yt=1/0,ir=0,Lr=t;ir<Lr.length;ir+=1)Yt=Math.min(Yt,Lr[ir].z);return Yt}var Fu=So([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Eh=So([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Jh=wo.VectorTileFeature.types,Qh=Math.cos(Math.PI/180*37.5),wh=Math.pow(2,14)/.5,ls=function(t){var r=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(f){return f.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(f){r.gradients[f.id]={}}),this.layoutVertexArray=new As,this.layoutVertexArray2=new bl,this.indexArray=new ma,this.programConfigurations=new Si(t.layers,t.zoom),this.segments=new ye,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(f){return f.isStateDependent()}).map(function(f){return f.id})};ls.prototype.populate=function(e,t,r){this.hasPattern=Vr("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],m=0,x=e;m<x.length;m+=1){var A=x[m],D=A.feature,z=A.id,W=A.index,ie=A.sourceLayerIndex,oe=this.layers[0]._featureFilter.needGeometry,xe=Xa(D,oe);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),xe,r)){var je=f?f.evaluate(xe,{},r):void 0,ze={id:z,properties:D.properties,type:D.type,sourceLayerIndex:ie,index:W,geometry:oe?xe.geometry:Ua(D),patterns:{},sortKey:je};v.push(ze)}}f&&v.sort(function(tn,cn){return tn.sortKey-cn.sortKey});for(var at=0,ut=v;at<ut.length;at+=1){var Ot=ut[at],Yt=Ot.geometry,ir=Ot.index,Lr=Ot.sourceLayerIndex;if(this.hasPattern){var Er=In("line",this.layers,Ot,this.zoom,t);this.patternFeatures.push(Er)}else this.addFeature(Ot,Yt,ir,r,{});t.featureIndex.insert(e[ir].feature,Yt,ir,Lr,this.index)}},ls.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},ls.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var m=v[f];this.addFeature(m,m.geometry,m.index,t,r)}},ls.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ls.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ls.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Eh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fu),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},ls.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ls.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},ls.prototype.addFeature=function(e,t,r,f,v){var m=this.layers[0].layout,x=m.get("line-join").evaluate(e,{}),A=m.get("line-cap"),D=m.get("line-miter-limit"),z=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var W=0,ie=t;W<ie.length;W+=1)this.addLine(ie[W],e,x,A,D,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},ls.prototype.addLine=function(e,t,r,f,v,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var x=0;x<e.length-1;x++)this.totalDistance+=e[x].dist(e[x+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var A=Jh[t.type]==="Polygon",D=e.length;D>=2&&e[D-1].equals(e[D-2]);)D--;for(var z=0;z<D-1&&e[z].equals(e[z+1]);)z++;if(!(D<(A?3:2))){r==="bevel"&&(v=1.05);var W,ie=this.overscaling<=16?122880/(512*this.overscaling):0,oe=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),xe=void 0,je=void 0,ze=void 0,at=void 0;this.e1=this.e2=-1,A&&(at=e[z].sub(W=e[D-2])._unit()._perp());for(var ut=z;ut<D;ut++)if(!(je=ut===D-1?A?e[z+1]:void 0:e[ut+1])||!e[ut].equals(je)){at&&(ze=at),W&&(xe=W),W=e[ut],at=je?je.sub(W)._unit()._perp():ze;var Ot=(ze=ze||at).add(at);Ot.x===0&&Ot.y===0||Ot._unit();var Yt=ze.x*at.x+ze.y*at.y,ir=Ot.x*at.x+Ot.y*at.y,Lr=ir!==0?1/ir:1/0,Er=2*Math.sqrt(2-2*ir),tn=ir<Qh&&xe&&je,cn=ze.x*at.y-ze.y*at.x>0;if(tn&&ut>z){var Ln=W.dist(xe);if(Ln>2*ie){var Gn=W.sub(W.sub(xe)._mult(ie/Ln)._round());this.updateDistance(xe,Gn),this.addCurrentVertex(Gn,ze,0,0,oe),xe=Gn}}var Dn=xe&&je,xn=Dn?r:A?"butt":f;if(Dn&&xn==="round"&&(Lr<m?xn="miter":Lr<=2&&(xn="fakeround")),xn==="miter"&&Lr>v&&(xn="bevel"),xn==="bevel"&&(Lr>2&&(xn="flipbevel"),Lr<v&&(xn="miter")),xe&&this.updateDistance(xe,W),xn==="miter")Ot._mult(Lr),this.addCurrentVertex(W,Ot,0,0,oe);else if(xn==="flipbevel"){if(Lr>100)Ot=at.mult(-1);else{var ei=Lr*ze.add(at).mag()/ze.sub(at).mag();Ot._perp()._mult(ei*(cn?-1:1))}this.addCurrentVertex(W,Ot,0,0,oe),this.addCurrentVertex(W,Ot.mult(-1),0,0,oe)}else if(xn==="bevel"||xn==="fakeround"){var Jn=-Math.sqrt(Lr*Lr-1),Hn=cn?Jn:0,Hi=cn?0:Jn;if(xe&&this.addCurrentVertex(W,ze,Hn,Hi,oe),xn==="fakeround")for(var Ti=Math.round(180*Er/Math.PI/20),Ea=1;Ea<Ti;Ea++){var li=Ea/Ti;if(li!==.5){var Xi=li-.5;li+=li*Xi*(li-1)*((1.0904+Yt*(Yt*(3.55645-1.43519*Yt)-3.2452))*Xi*Xi+(.848013+Yt*(.215638*Yt-1.06021)))}var eo=at.sub(ze)._mult(li)._add(ze)._unit()._mult(cn?-1:1);this.addHalfVertex(W,eo.x,eo.y,!1,cn,0,oe)}je&&this.addCurrentVertex(W,at,-Hn,-Hi,oe)}else if(xn==="butt")this.addCurrentVertex(W,Ot,0,0,oe);else if(xn==="square"){var to=xe?1:-1;this.addCurrentVertex(W,Ot,to,to,oe)}else xn==="round"&&(xe&&(this.addCurrentVertex(W,ze,0,0,oe),this.addCurrentVertex(W,ze,1,1,oe,!0)),je&&(this.addCurrentVertex(W,at,-1,-1,oe,!0),this.addCurrentVertex(W,at,0,0,oe)));if(tn&&ut<D-1){var Ao=W.dist(je);if(Ao>2*ie){var po=W.add(je.sub(W)._mult(ie/Ao)._round());this.updateDistance(W,po),this.addCurrentVertex(po,at,0,0,oe),W=po}}}}},ls.prototype.addCurrentVertex=function(e,t,r,f,v,m){m===void 0&&(m=!1);var x=t.y*f-t.x,A=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,m,!1,r,v),this.addHalfVertex(e,x,A,m,!0,-f,v),this.distance>wh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,m))},ls.prototype.addHalfVertex=function(e,t,r,f,v,m,x){var A=.5*(this.lineClips?this.scaledDistance*(wh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(m===0?0:m<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),x.primitiveLength++),v?this.e2=D:this.e1=D},ls.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ls.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Tn("LineBucket",ls,{omit:["layers","patternFeatures"]});var Th=new Fo({"line-cap":new Bn(he.layout_line["line-cap"]),"line-join":new On(he.layout_line["line-join"]),"line-miter-limit":new Bn(he.layout_line["line-miter-limit"]),"line-round-limit":new Bn(he.layout_line["line-round-limit"]),"line-sort-key":new On(he.layout_line["line-sort-key"])}),Ah={paint:new Fo({"line-opacity":new On(he.paint_line["line-opacity"]),"line-color":new On(he.paint_line["line-color"]),"line-translate":new Bn(he.paint_line["line-translate"]),"line-translate-anchor":new Bn(he.paint_line["line-translate-anchor"]),"line-width":new On(he.paint_line["line-width"]),"line-gap-width":new On(he.paint_line["line-gap-width"]),"line-offset":new On(he.paint_line["line-offset"]),"line-blur":new On(he.paint_line["line-blur"]),"line-dasharray":new os(he.paint_line["line-dasharray"]),"line-pattern":new xc(he.paint_line["line-pattern"]),"line-gradient":new bo(he.paint_line["line-gradient"])}),layout:Th},Ch=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new Oi(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,m){return f=Xt({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,m)},t}(On))(Ah.paint.properties["line-width"].specification);Ch.useIntegerZoom=!0;var qh=function(e){function t(r){e.call(this,r,Ah),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ja,this.gradientVersion=(this.gradientVersion+1)%we)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=Ch.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new ls(r)},t.prototype.queryRadius=function(r){var f=r,v=Ph(fu("line-width",this,f),fu("line-gap-width",this,f)),m=fu("line-offset",this,f);return v/2+Math.abs(m)+lo(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,m,x,A,D){var z=hu(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),A.angle,D),W=D/2*Ph(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),ie=this.paint.get("line-offset").evaluate(f,v);return ie&&(m=function(oe,xe){for(var je=[],ze=new te(0,0),at=0;at<oe.length;at++){for(var ut=oe[at],Ot=[],Yt=0;Yt<ut.length;Yt++){var ir=ut[Yt],Lr=ut[Yt+1],Er=Yt===0?ze:ir.sub(ut[Yt-1])._unit()._perp(),tn=Yt===ut.length-1?ze:Lr.sub(ir)._unit()._perp(),cn=Er._add(tn)._unit();cn._mult(1/(cn.x*tn.x+cn.y*tn.y)),Ot.push(cn._mult(xe)._add(ir))}je.push(Ot)}return je}(m,ie*D)),function(oe,xe,je){for(var ze=0;ze<xe.length;ze++){var at=xe[ze];if(oe.length>=3){for(var ut=0;ut<at.length;ut++)if(Du(oe,at[ut]))return!0}if(zs(oe,at,je))return!0}return!1}(z,m,W)},t.prototype.isTileClipped=function(){return!0},t}(Vs);function Ph(e,t){return t>0?t+2*e:e}var ep=So([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tp=So([{name:"a_projected_pos",components:3,type:"Float32"}],4),rp=(So([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),So([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),nh=(So([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),So([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),np=So([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ip(e,t,r){return e.sections.forEach(function(f){f.text=function(v,m,x){var A=m.layout.get("text-transform").evaluate(x,{});return A==="uppercase"?v=v.toLocaleUpperCase():A==="lowercase"&&(v=v.toLocaleLowerCase()),Ts.applyArabicShaping&&(v=Ts.applyArabicShaping(v)),v}(f.text,t,r)}),e}So([{name:"triangle",components:3,type:"Uint16"}]),So([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),So([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),So([{type:"Float32",name:"offsetX"}]),So([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var cc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},ap=function(t,r,f,v,m){var x,A,D=8*m-v-1,z=(1<<D)-1,W=z>>1,ie=-7,oe=f?m-1:0,xe=f?-1:1,je=t[r+oe];for(oe+=xe,x=je&(1<<-ie)-1,je>>=-ie,ie+=D;ie>0;x=256*x+t[r+oe],oe+=xe,ie-=8);for(A=x&(1<<-ie)-1,x>>=-ie,ie+=v;ie>0;A=256*A+t[r+oe],oe+=xe,ie-=8);if(x===0)x=1-W;else{if(x===z)return A?NaN:1/0*(je?-1:1);A+=Math.pow(2,v),x-=W}return(je?-1:1)*A*Math.pow(2,x-v)},J=function(t,r,f,v,m,x){var A,D,z,W=8*x-m-1,ie=(1<<W)-1,oe=ie>>1,xe=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,je=v?0:x-1,ze=v?1:-1,at=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(D=isNaN(r)?1:0,A=ie):(A=Math.floor(Math.log(r)/Math.LN2),r*(z=Math.pow(2,-A))<1&&(A--,z*=2),(r+=A+oe>=1?xe/z:xe*Math.pow(2,1-oe))*z>=2&&(A++,z/=2),A+oe>=ie?(D=0,A=ie):A+oe>=1?(D=(r*z-1)*Math.pow(2,m),A+=oe):(D=r*Math.pow(2,oe-1)*Math.pow(2,m),A=0));m>=8;t[f+je]=255&D,je+=ze,D/=256,m-=8);for(A=A<<m|D,W+=m;W>0;t[f+je]=255&A,je+=ze,A/=256,W-=8);t[f+je-ze]|=128*at},fe=Ue;function Ue(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Ue.Varint=0,Ue.Fixed64=1,Ue.Bytes=2,Ue.Fixed32=5;var Jt=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function mr(e){return e.type===Ue.Bytes?e.readVarint()+e.pos:e.pos+1}function pr(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function rr(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function Zr(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function nn(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function zr(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function Jr(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function sn(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function mn(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function on(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function rn(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function or(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function er(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Gr(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function En(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Pr(e,t,r){e===1&&r.readMessage(Yn,t)}function Yn(e,t,r){if(e===3){var f=r.readMessage(Kr,{}),v=f.width,m=f.height,x=f.left,A=f.top,D=f.advance;t.push({id:f.id,bitmap:new Ms({width:v+6,height:m+6},f.bitmap),metrics:{width:v,height:m,left:x,top:A,advance:D}})}}function Kr(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function Br(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var m=v[f];t+=m.w*m.h,r=Math.max(r,m.w)}e.sort(function(ze,at){return at.h-ze.h});for(var x=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],A=0,D=0,z=0,W=e;z<W.length;z+=1)for(var ie=W[z],oe=x.length-1;oe>=0;oe--){var xe=x[oe];if(!(ie.w>xe.w||ie.h>xe.h)){if(ie.x=xe.x,ie.y=xe.y,D=Math.max(D,ie.y+ie.h),A=Math.max(A,ie.x+ie.w),ie.w===xe.w&&ie.h===xe.h){var je=x.pop();oe<x.length&&(x[oe]=je)}else ie.h===xe.h?(xe.x+=ie.w,xe.w-=ie.w):ie.w===xe.w?(xe.y+=ie.h,xe.h-=ie.h):(x.push({x:xe.x+ie.w,y:xe.y,w:xe.w-ie.w,h:ie.h}),xe.y+=ie.h,xe.h-=ie.h);break}}return{w:A,h:D,fill:t/(A*D)||0}}Ue.prototype={destroy:function(){this.buf=null},readFields:function(t,r,f){for(f=f||this.length;this.pos<f;){var v=this.readVarint(),m=v>>3,x=this.pos;this.type=7&v,t(m,r,this),this.pos===x&&this.skip(v)}return r},readMessage:function(t,r){return this.readFields(t,r,this.readVarint()+this.pos)},readFixed32:function(){var t=er(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=En(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=er(this.buf,this.pos)+4294967296*er(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=er(this.buf,this.pos)+4294967296*En(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=ap(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ap(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var r,f,v=this.buf;return r=127&(f=v[this.pos++]),f<128?r:(r|=(127&(f=v[this.pos++]))<<7,f<128?r:(r|=(127&(f=v[this.pos++]))<<14,f<128?r:(r|=(127&(f=v[this.pos++]))<<21,f<128?r:function(m,x,A){var D,z,W=A.buf;if(D=(112&(z=W[A.pos++]))>>4,z<128||(D|=(127&(z=W[A.pos++]))<<3,z<128)||(D|=(127&(z=W[A.pos++]))<<10,z<128)||(D|=(127&(z=W[A.pos++]))<<17,z<128)||(D|=(127&(z=W[A.pos++]))<<24,z<128)||(D|=(1&(z=W[A.pos++]))<<31,z<128))return pr(m,D,x);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(f=v[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,r=this.pos;return this.pos=t,t-r>=12&&Jt?function(f,v,m){return Jt.decode(f.subarray(v,m))}(this.buf,r,t):function(f,v,m){for(var x="",A=v;A<m;){var D,z,W,ie=f[A],oe=null,xe=ie>239?4:ie>223?3:ie>191?2:1;if(A+xe>m)break;xe===1?ie<128&&(oe=ie):xe===2?(192&(D=f[A+1]))==128&&(oe=(31&ie)<<6|63&D)<=127&&(oe=null):xe===3?(z=f[A+2],(192&(D=f[A+1]))==128&&(192&z)==128&&((oe=(15&ie)<<12|(63&D)<<6|63&z)<=2047||oe>=55296&&oe<=57343)&&(oe=null)):xe===4&&(z=f[A+2],W=f[A+3],(192&(D=f[A+1]))==128&&(192&z)==128&&(192&W)==128&&((oe=(15&ie)<<18|(63&D)<<12|(63&z)<<6|63&W)<=65535||oe>=1114112)&&(oe=null)),oe===null?(oe=65533,xe=1):oe>65535&&(oe-=65536,x+=String.fromCharCode(oe>>>10&1023|55296),oe=56320|1023&oe),x+=String.fromCharCode(oe),A+=xe}return x}(this.buf,r,t)},readBytes:function(){var t=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,t);return this.pos=t,r},readPackedVarint:function(t,r){if(this.type!==Ue.Bytes)return t.push(this.readVarint(r));var f=mr(this);for(t=t||[];this.pos<f;)t.push(this.readVarint(r));return t},readPackedSVarint:function(t){if(this.type!==Ue.Bytes)return t.push(this.readSVarint());var r=mr(this);for(t=t||[];this.pos<r;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ue.Bytes)return t.push(this.readBoolean());var r=mr(this);for(t=t||[];this.pos<r;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ue.Bytes)return t.push(this.readFloat());var r=mr(this);for(t=t||[];this.pos<r;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ue.Bytes)return t.push(this.readDouble());var r=mr(this);for(t=t||[];this.pos<r;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ue.Bytes)return t.push(this.readFixed32());var r=mr(this);for(t=t||[];this.pos<r;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ue.Bytes)return t.push(this.readSFixed32());var r=mr(this);for(t=t||[];this.pos<r;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ue.Bytes)return t.push(this.readFixed64());var r=mr(this);for(t=t||[];this.pos<r;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ue.Bytes)return t.push(this.readSFixed64());var r=mr(this);for(t=t||[];this.pos<r;)t.push(this.readSFixed64());return t},skip:function(t){var r=7&t;if(r===Ue.Varint)for(;this.buf[this.pos++]>127;);else if(r===Ue.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Ue.Fixed32)this.pos+=4;else{if(r!==Ue.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(t,r){this.writeVarint(t<<3|r)},realloc:function(t){for(var r=this.length||16;r<this.pos+t;)r*=2;if(r!==this.length){var f=new Uint8Array(r);f.set(this.buf),this.buf=f,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Gr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Gr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Gr(this.buf,-1&t,this.pos),Gr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Gr(this.buf,-1&t,this.pos),Gr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(r,f){var v,m;if(r>=0?(v=r%4294967296|0,m=r/4294967296|0):(m=~(-r/4294967296),4294967295^(v=~(-r%4294967296))?v=v+1|0:(v=0,m=m+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(x,A,D){D.buf[D.pos++]=127&x|128,x>>>=7,D.buf[D.pos++]=127&x|128,x>>>=7,D.buf[D.pos++]=127&x|128,x>>>=7,D.buf[D.pos++]=127&x|128,D.buf[D.pos]=127&(x>>>=7)}(v,0,f),function(x,A){var D=(7&x)<<4;A.buf[A.pos++]|=D|((x>>>=3)?128:0),x&&(A.buf[A.pos++]=127&x|((x>>>=7)?128:0),x&&(A.buf[A.pos++]=127&x|((x>>>=7)?128:0),x&&(A.buf[A.pos++]=127&x|((x>>>=7)?128:0),x&&(A.buf[A.pos++]=127&x|((x>>>=7)?128:0),x&&(A.buf[A.pos++]=127&x)))))}(m,f)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var r=this.pos;this.pos=function(v,m,x){for(var A,D,z=0;z<m.length;z++){if((A=m.charCodeAt(z))>55295&&A<57344){if(!D){A>56319||z+1===m.length?(v[x++]=239,v[x++]=191,v[x++]=189):D=A;continue}if(A<56320){v[x++]=239,v[x++]=191,v[x++]=189,D=A;continue}A=D-55296<<10|A-56320|65536,D=null}else D&&(v[x++]=239,v[x++]=191,v[x++]=189,D=null);A<128?v[x++]=A:(A<2048?v[x++]=A>>6|192:(A<65536?v[x++]=A>>12|224:(v[x++]=A>>18|240,v[x++]=A>>12&63|128),v[x++]=A>>6&63|128),v[x++]=63&A|128)}return x}(this.buf,t,this.pos);var f=this.pos-r;f>=128&&rr(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeFloat:function(t){this.realloc(4),J(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),J(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var r=t.length;this.writeVarint(r),this.realloc(r);for(var f=0;f<r;f++)this.buf[this.pos++]=t[f]},writeRawMessage:function(t,r){this.pos++;var f=this.pos;t(r,this);var v=this.pos-f;v>=128&&rr(f,v,this),this.pos=f-1,this.writeVarint(v),this.pos+=v},writeMessage:function(t,r,f){this.writeTag(t,Ue.Bytes),this.writeRawMessage(r,f)},writePackedVarint:function(t,r){r.length&&this.writeMessage(t,Zr,r)},writePackedSVarint:function(t,r){r.length&&this.writeMessage(t,nn,r)},writePackedBoolean:function(t,r){r.length&&this.writeMessage(t,sn,r)},writePackedFloat:function(t,r){r.length&&this.writeMessage(t,zr,r)},writePackedDouble:function(t,r){r.length&&this.writeMessage(t,Jr,r)},writePackedFixed32:function(t,r){r.length&&this.writeMessage(t,mn,r)},writePackedSFixed32:function(t,r){r.length&&this.writeMessage(t,on,r)},writePackedFixed64:function(t,r){r.length&&this.writeMessage(t,rn,r)},writePackedSFixed64:function(t,r){r.length&&this.writeMessage(t,or,r)},writeBytesField:function(t,r){this.writeTag(t,Ue.Bytes),this.writeBytes(r)},writeFixed32Field:function(t,r){this.writeTag(t,Ue.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(t,r){this.writeTag(t,Ue.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(t,r){this.writeTag(t,Ue.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(t,r){this.writeTag(t,Ue.Fixed64),this.writeSFixed64(r)},writeVarintField:function(t,r){this.writeTag(t,Ue.Varint),this.writeVarint(r)},writeSVarintField:function(t,r){this.writeTag(t,Ue.Varint),this.writeSVarint(r)},writeStringField:function(t,r){this.writeTag(t,Ue.Bytes),this.writeString(r)},writeFloatField:function(t,r){this.writeTag(t,Ue.Fixed32),this.writeFloat(r)},writeDoubleField:function(t,r){this.writeTag(t,Ue.Fixed64),this.writeDouble(r)},writeBooleanField:function(t,r){this.writeVarintField(t,Boolean(r))}};var Fr=function(t,r){var f=r.pixelRatio,v=r.version,m=r.stretchX,x=r.stretchY,A=r.content;this.paddedRect=t,this.pixelRatio=f,this.stretchX=m,this.stretchY=x,this.content=A,this.version=v},Yr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Yr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Yr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Yr.tlbr.get=function(){return this.tl.concat(this.br)},Yr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Fr.prototype,Yr);var jn=function(t,r){var f={},v={};this.haveRenderCallbacks=[];var m=[];this.addImages(t,f,m),this.addImages(r,v,m);var x=Br(m),A=new zo({width:x.w||1,height:x.h||1});for(var D in t){var z=t[D],W=f[D].paddedRect;zo.copy(z.data,A,{x:0,y:0},{x:W.x+1,y:W.y+1},z.data)}for(var ie in r){var oe=r[ie],xe=v[ie].paddedRect,je=xe.x+1,ze=xe.y+1,at=oe.data.width,ut=oe.data.height;zo.copy(oe.data,A,{x:0,y:0},{x:je,y:ze},oe.data),zo.copy(oe.data,A,{x:0,y:ut-1},{x:je,y:ze-1},{width:at,height:1}),zo.copy(oe.data,A,{x:0,y:0},{x:je,y:ze+ut},{width:at,height:1}),zo.copy(oe.data,A,{x:at-1,y:0},{x:je-1,y:ze},{width:1,height:ut}),zo.copy(oe.data,A,{x:0,y:0},{x:je+at,y:ze},{width:1,height:ut})}this.image=A,this.iconPositions=f,this.patternPositions=v};jn.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],m={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(m),t[f]=new Fr(m,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},jn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},jn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},Tn("ImagePosition",Fr),Tn("ImageAtlas",jn);var $n={horizontal:1,vertical:2,horizontalOnly:3},un=function(){this.scale=1,this.fontStack="",this.imageName=null};un.forText=function(e,t){var r=new un;return r.scale=e||1,r.fontStack=t,r},un.forImage=function(e){var t=new un;return t.imageName=e,t};var Ur=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Dr(e,t,r,f,v,m,x,A,D,z,W,ie,oe,xe,je,ze){var at,ut=Ur.fromFeature(e,v);ie===$n.vertical&&ut.verticalizePunctuation();var Ot=Ts.processBidirectionalText,Yt=Ts.processStyledBidirectionalText;if(Ot&&ut.sections.length===1){at=[];for(var ir=0,Lr=Ot(ut.toString(),na(ut,z,m,t,f,xe,je));ir<Lr.length;ir+=1){var Er=Lr[ir],tn=new Ur;tn.text=Er,tn.sections=ut.sections;for(var cn=0;cn<Er.length;cn++)tn.sectionIndex.push(0);at.push(tn)}}else if(Yt){at=[];for(var Ln=0,Gn=Yt(ut.text,ut.sectionIndex,na(ut,z,m,t,f,xe,je));Ln<Gn.length;Ln+=1){var Dn=Gn[Ln],xn=new Ur;xn.text=Dn[0],xn.sectionIndex=Dn[1],xn.sections=ut.sections,at.push(xn)}}else at=function(Hn,Hi){for(var Ti=[],Ea=Hn.text,li=0,Xi=0,eo=Hi;Xi<eo.length;Xi+=1){var to=eo[Xi];Ti.push(Hn.substring(li,to)),li=to}return li<Ea.length&&Ti.push(Hn.substring(li,Ea.length)),Ti}(ut,na(ut,z,m,t,f,xe,je));var ei=[],Jn={positionedLines:ei,text:ut.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:ie,iconsInText:!1,verticalizable:!1};return function(Hn,Hi,Ti,Ea,li,Xi,eo,to,Ao,po,Do,Js){for(var bs=0,du=-17,Ls=0,au=0,Ss=to==="right"?1:to==="left"?0:.5,Rs=0,Us=0,va=li;Us<va.length;Us+=1){var ia=va[Us];ia.trim();var Va=ia.getMaxScale(),Da=24*(Va-1),vu={positionedGlyphs:[],lineOffset:0};Hn.positionedLines[Rs]=vu;var Ka=vu.positionedGlyphs,vo=0;if(ia.length()){for(var ou=0;ou<ia.length();ou++){var ca=ia.getSection(ou),vf=ia.getSectionIndex(ou),$l=ia.getCharCode(ou),Lc=0,Ku=null,Qs=null,mf=null,Rc=24,tf=!(Ao===$n.horizontal||!Do&&!yc($l)||Do&&(ni[$l]||(Of=$l,en.Arabic(Of)||en["Arabic Supplement"](Of)||en["Arabic Extended-A"](Of)||en["Arabic Presentation Forms-A"](Of)||en["Arabic Presentation Forms-B"](Of))));if(ca.imageName){var Yu=Ea[ca.imageName];if(!Yu)continue;mf=ca.imageName,Hn.iconsInText=Hn.iconsInText||!0,Qs=Yu.paddedRect;var fc=Yu.displaySize;ca.scale=24*ca.scale/Js,Lc=Da+(24-fc[1]*ca.scale),Rc=(Ku={width:fc[0],height:fc[1],left:1,top:-3,advance:tf?fc[1]:fc[0]}).advance;var oh=tf?fc[0]*ca.scale-24*Va:fc[1]*ca.scale-24*Va;oh>0&&oh>vo&&(vo=oh)}else{var Oh=Ti[ca.fontStack],sh=Oh&&Oh[$l];if(sh&&sh.rect)Qs=sh.rect,Ku=sh.metrics;else{var Gf=Hi[ca.fontStack],Hf=Gf&&Gf[$l];if(!Hf)continue;Ku=Hf.metrics}Lc=24*(Va-ca.scale)}tf?(Hn.verticalizable=!0,Ka.push({glyph:$l,imageName:mf,x:bs,y:du+Lc,vertical:tf,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:vf,metrics:Ku,rect:Qs}),bs+=Rc*ca.scale+po):(Ka.push({glyph:$l,imageName:mf,x:bs,y:du+Lc,vertical:tf,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:vf,metrics:Ku,rect:Qs}),bs+=Ku.advance*ca.scale+po)}Ka.length!==0&&(Ls=Math.max(bs-po,Ls),Is(Ka,0,Ka.length-1,Ss,vo)),bs=0;var Lh=Xi*Va+vo;vu.lineOffset=Math.max(vo,Da),du+=Lh,au=Math.max(Lh,au),++Rs}else du+=Xi,++Rs}var Of,gf=du- -17,uh=Qo(eo),lh=uh.horizontalAlign,Dc=uh.verticalAlign;(function(rf,lp,cp,ch,fp,Rh,fh,Dh,hh){var ph,dh=(lp-cp)*fp;ph=Rh!==fh?-Dh*ch- -17:(-ch*hh+.5)*fh;for(var Wf=0,kh=rf;Wf<kh.length;Wf+=1)for(var yf=0,Lf=kh[Wf].positionedGlyphs;yf<Lf.length;yf+=1){var vh=Lf[yf];vh.x+=dh,vh.y+=ph}})(Hn.positionedLines,Ss,lh,Dc,Ls,au,Xi,gf,li.length),Hn.top+=-Dc*gf,Hn.bottom=Hn.top+gf,Hn.left+=-lh*Ls,Hn.right=Hn.left+Ls}(Jn,t,r,f,at,x,A,D,ie,z,oe,ze),!function(Hn){for(var Hi=0,Ti=Hn;Hi<Ti.length;Hi+=1)if(Ti[Hi].positionedGlyphs.length!==0)return!1;return!0}(ei)&&Jn}Ur.fromFeature=function(e,t){for(var r=new Ur,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},Ur.prototype.length=function(){return this.text.length},Ur.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},Ur.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},Ur.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},Ur.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&Vu(f)&&!cc[e[r+1]]||v&&Vu(v)&&!cc[e[r-1]]||!cc[e[r]]?e[r]:cc[e[r]]}return t}(this.text)},Ur.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&ni[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&ni[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},Ur.prototype.substring=function(e,t){var r=new Ur;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},Ur.prototype.toString=function(){return this.text},Ur.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},Ur.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(un.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},Ur.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(un.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Me("Reached maximum number of images 6401")}else Me("Can't add FormattedSection with an empty image.")},Ur.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var ni={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ii={};function Rn(e,t,r,f,v,m){if(t.imageName){var x=f[t.imageName];return x?x.displaySize[0]*t.scale*24/m+v:0}var A=r[t.fontStack],D=A&&A[e];return D?D.metrics.advance*t.scale+v:0}function Ui(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function Mi(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function ji(e,t,r,f,v,m){for(var x=null,A=Ui(t,r,v,m),D=0,z=f;D<z.length;D+=1){var W=z[D],ie=Ui(t-W.x,r,v,m)+W.badness;ie<=A&&(x=W,A=ie)}return{index:e,x:t,priorBreak:x,badness:A}}function na(e,t,r,f,v,m,x){if(m!=="point")return[];if(!e)return[];for(var A,D=[],z=function(at,ut,Ot,Yt,ir,Lr){for(var Er=0,tn=0;tn<at.length();tn++){var cn=at.getSection(tn);Er+=Rn(at.getCharCode(tn),cn,Yt,ir,ut,Lr)}return Er/Math.max(1,Math.ceil(Er/Ot))}(e,t,r,f,v,x),W=e.text.indexOf("\u200B")>=0,ie=0,oe=0;oe<e.length();oe++){var xe=e.getSection(oe),je=e.getCharCode(oe);if(ni[je]||(ie+=Rn(je,xe,f,v,t,x)),oe<e.length()-1){var ze=!((A=je)<11904||!(en["Bopomofo Extended"](A)||en.Bopomofo(A)||en["CJK Compatibility Forms"](A)||en["CJK Compatibility Ideographs"](A)||en["CJK Compatibility"](A)||en["CJK Radicals Supplement"](A)||en["CJK Strokes"](A)||en["CJK Symbols and Punctuation"](A)||en["CJK Unified Ideographs Extension A"](A)||en["CJK Unified Ideographs"](A)||en["Enclosed CJK Letters and Months"](A)||en["Halfwidth and Fullwidth Forms"](A)||en.Hiragana(A)||en["Ideographic Description Characters"](A)||en["Kangxi Radicals"](A)||en["Katakana Phonetic Extensions"](A)||en.Katakana(A)||en["Vertical Forms"](A)||en["Yi Radicals"](A)||en["Yi Syllables"](A)));(ii[je]||ze||xe.imageName)&&D.push(ji(oe+1,ie,z,D,Mi(je,e.getCharCode(oe+1),ze&&W),!1))}}return function at(ut){return ut?at(ut.priorBreak).concat(ut.index):[]}(ji(e.length(),ie,z,D,0,!0))}function Qo(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Is(e,t,r,f,v){if(f||v)for(var m=e[r],x=(e[r].x+m.metrics.advance*m.scale)*f,A=t;A<=r;A++)e[A].x-=x,e[A].y+=v}function ea(e,t,r,f,v,m){var x,A=e.image;if(A.content){var D=A.content,z=A.pixelRatio||1;x=[D[0]/z,D[1]/z,A.displaySize[0]-D[2]/z,A.displaySize[1]-D[3]/z]}var W,ie,oe,xe,je=t.left*m,ze=t.right*m;r==="width"||r==="both"?(xe=v[0]+je-f[3],ie=v[0]+ze+f[1]):ie=(xe=v[0]+(je+ze-A.displaySize[0])/2)+A.displaySize[0];var at=t.top*m,ut=t.bottom*m;return r==="height"||r==="both"?(W=v[1]+at-f[0],oe=v[1]+ut+f[2]):oe=(W=v[1]+(at+ut-A.displaySize[1])/2)+A.displaySize[1],{image:A,top:W,right:ie,bottom:oe,left:xe,collisionPadding:x}}ii[10]=!0,ii[32]=!0,ii[38]=!0,ii[40]=!0,ii[41]=!0,ii[43]=!0,ii[45]=!0,ii[47]=!0,ii[173]=!0,ii[183]=!0,ii[8203]=!0,ii[8208]=!0,ii[8211]=!0,ii[8231]=!0;var To=function(e){function t(r,f,v,m){e.call(this,r,f),this.angle=v,m!==void 0&&(this.segment=m)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(te);function qa(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Oi(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,m=0;m<f.length&&f[m]<=e;)m++;for(var x=m=Math.max(0,m-1);x<f.length&&f[x]<e+1;)x++;x=Math.min(f.length-1,x);var A=f[m],D=f[x];return r.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:D,interpolationType:v}:{kind:"camera",minZoom:A,maxZoom:D,minSize:r.evaluate(new Oi(A)),maxSize:r.evaluate(new Oi(D)),interpolationType:v}}function cs(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?ba(v/128,r.upperSize/128,t.uSizeT):f}function qo(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,m=v?Oe(ha.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=ba(e.minSize,e.maxSize,m):r=m}return{uSizeT:r,uSize:f}}Tn("Anchor",To);var Os=Object.freeze({__proto__:null,getSizeData:qa,evaluateSizeForFeature:cs,evaluateSizeForZoom:qo,SIZE_PACK_FACTOR:128});function es(e,t,r,f,v){if(t.segment===void 0)return!0;for(var m=t,x=t.segment+1,A=0;A>-r/2;){if(--x<0)return!1;A-=e[x].dist(m),m=e[x]}A+=e[x].dist(e[x+1]),x++;for(var D=[],z=0;A<r/2;){var W=e[x],ie=e[x+1];if(!ie)return!1;var oe=e[x-1].angleTo(W)-W.angleTo(ie);for(oe=Math.abs((oe+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:A,angleDelta:oe}),z+=oe;A-D[0].distance>f;)z-=D.shift().angleDelta;if(z>v)return!1;x++,A+=W.dist(ie)}return!0}function Xs(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Zo(e,t,r){return e?.6*t*r:0}function ki(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Ks(e,t,r,f,v,m){for(var x=Zo(r,v,m),A=ki(r,f)*m,D=0,z=Xs(e)/2,W=0;W<e.length-1;W++){var ie=e[W],oe=e[W+1],xe=ie.dist(oe);if(D+xe>z){var je=(z-D)/xe,ze=ba(ie.x,oe.x,je),at=ba(ie.y,oe.y,je),ut=new To(ze,at,oe.angleTo(ie),W);return ut._round(),!x||es(e,ut,A,x,t)?ut:void 0}D+=xe}}function wa(e,t,r,f,v,m,x,A,D){var z=Zo(f,m,x),W=ki(f,v),ie=W*x,oe=e[0].x===0||e[0].x===D||e[0].y===0||e[0].y===D;return t-ie<t/4&&(t=ie+t/4),function xe(je,ze,at,ut,Ot,Yt,ir,Lr,Er){for(var tn=Yt/2,cn=Xs(je),Ln=0,Gn=ze-at,Dn=[],xn=0;xn<je.length-1;xn++){for(var ei=je[xn],Jn=je[xn+1],Hn=ei.dist(Jn),Hi=Jn.angleTo(ei);Gn+at<Ln+Hn;){var Ti=((Gn+=at)-Ln)/Hn,Ea=ba(ei.x,Jn.x,Ti),li=ba(ei.y,Jn.y,Ti);if(Ea>=0&&Ea<Er&&li>=0&&li<Er&&Gn-tn>=0&&Gn+tn<=cn){var Xi=new To(Ea,li,Hi,xn);Xi._round(),ut&&!es(je,Xi,Yt,ut,Ot)||Dn.push(Xi)}}Ln+=Hn}return Lr||Dn.length||ir||(Dn=xe(je,Ln/2,at,ut,Ot,Yt,ir,!0,Er)),Dn}(e,oe?t/2*A%t:(W/2+2*m)*x*A%t,t,z,r,ie,oe,!1,D)}function ui(e,t,r,f,v){for(var m=[],x=0;x<e.length;x++)for(var A=e[x],D=void 0,z=0;z<A.length-1;z++){var W=A[z],ie=A[z+1];W.x<t&&ie.x<t||(W.x<t?W=new te(t,W.y+(t-W.x)/(ie.x-W.x)*(ie.y-W.y))._round():ie.x<t&&(ie=new te(t,W.y+(t-W.x)/(ie.x-W.x)*(ie.y-W.y))._round()),W.y<r&&ie.y<r||(W.y<r?W=new te(W.x+(r-W.y)/(ie.y-W.y)*(ie.x-W.x),r)._round():ie.y<r&&(ie=new te(W.x+(r-W.y)/(ie.y-W.y)*(ie.x-W.x),r)._round()),W.x>=f&&ie.x>=f||(W.x>=f?W=new te(f,W.y+(f-W.x)/(ie.x-W.x)*(ie.y-W.y))._round():ie.x>=f&&(ie=new te(f,W.y+(f-W.x)/(ie.x-W.x)*(ie.y-W.y))._round()),W.y>=v&&ie.y>=v||(W.y>=v?W=new te(W.x+(v-W.y)/(ie.y-W.y)*(ie.x-W.x),v)._round():ie.y>=v&&(ie=new te(W.x+(v-W.y)/(ie.y-W.y)*(ie.x-W.x),v)._round()),D&&W.equals(D[D.length-1])||m.push(D=[W]),D.push(ie)))))}return m}function Li(e,t,r,f){var v=[],m=e.image,x=m.pixelRatio,A=m.paddedRect.w-2,D=m.paddedRect.h-2,z=e.right-e.left,W=e.bottom-e.top,ie=m.stretchX||[[0,A]],oe=m.stretchY||[[0,D]],xe=function(li,Xi){return li+Xi[1]-Xi[0]},je=ie.reduce(xe,0),ze=oe.reduce(xe,0),at=A-je,ut=D-ze,Ot=0,Yt=je,ir=0,Lr=ze,Er=0,tn=at,cn=0,Ln=ut;if(m.content&&f){var Gn=m.content;Ot=ta(ie,0,Gn[0]),ir=ta(oe,0,Gn[1]),Yt=ta(ie,Gn[0],Gn[2]),Lr=ta(oe,Gn[1],Gn[3]),Er=Gn[0]-Ot,cn=Gn[1]-ir,tn=Gn[2]-Gn[0]-Yt,Ln=Gn[3]-Gn[1]-Lr}var Dn=function(li,Xi,eo,to){var Ao=Ys(li.stretch-Ot,Yt,z,e.left),po=Yl(li.fixed-Er,tn,li.stretch,je),Do=Ys(Xi.stretch-ir,Lr,W,e.top),Js=Yl(Xi.fixed-cn,Ln,Xi.stretch,ze),bs=Ys(eo.stretch-Ot,Yt,z,e.left),du=Yl(eo.fixed-Er,tn,eo.stretch,je),Ls=Ys(to.stretch-ir,Lr,W,e.top),au=Yl(to.fixed-cn,Ln,to.stretch,ze),Ss=new te(Ao,Do),Rs=new te(bs,Do),Us=new te(bs,Ls),va=new te(Ao,Ls),ia=new te(po/x,Js/x),Va=new te(du/x,au/x),Da=t*Math.PI/180;if(Da){var vu=Math.sin(Da),Ka=Math.cos(Da),vo=[Ka,-vu,vu,Ka];Ss._matMult(vo),Rs._matMult(vo),va._matMult(vo),Us._matMult(vo)}var ou=li.stretch+li.fixed,ca=Xi.stretch+Xi.fixed;return{tl:Ss,tr:Rs,bl:va,br:Us,tex:{x:m.paddedRect.x+1+ou,y:m.paddedRect.y+1+ca,w:eo.stretch+eo.fixed-ou,h:to.stretch+to.fixed-ca},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ia,pixelOffsetBR:Va,minFontScaleX:tn/x/z,minFontScaleY:Ln/x/W,isSDF:r}};if(f&&(m.stretchX||m.stretchY))for(var xn=xs(ie,at,je),ei=xs(oe,ut,ze),Jn=0;Jn<xn.length-1;Jn++)for(var Hn=xn[Jn],Hi=xn[Jn+1],Ti=0;Ti<ei.length-1;Ti++)v.push(Dn(Hn,ei[Ti],Hi,ei[Ti+1]));else v.push(Dn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:D+1}));return v}function ta(e,t,r){for(var f=0,v=0,m=e;v<m.length;v+=1){var x=m[v];f+=Math.max(t,Math.min(r,x[1]))-Math.max(t,Math.min(r,x[0]))}return f}function xs(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,m=e;v<m.length;v+=1){var x=m[v],A=x[0],D=x[1],z=f[f.length-1];f.push({fixed:A-z.stretch,stretch:z.stretch}),f.push({fixed:A-z.stretch,stretch:z.stretch+(D-A)})}return f.push({fixed:t+1,stretch:r}),f}function Ys(e,t,r,f){return e/t*r+f}function Yl(e,t,r,f){return e-t*r/f}var We=function(t,r,f,v,m,x,A,D,z,W){if(this.boxStartIndex=t.length,z){var ie=x.top,oe=x.bottom,xe=x.collisionPadding;xe&&(ie-=xe[1],oe+=xe[3]);var je=oe-ie;je>0&&(je=Math.max(10,je),this.circleDiameter=je)}else{var ze=x.top*A-D,at=x.bottom*A+D,ut=x.left*A-D,Ot=x.right*A+D,Yt=x.collisionPadding;if(Yt&&(ut-=Yt[0]*A,ze-=Yt[1]*A,Ot+=Yt[2]*A,at+=Yt[3]*A),W){var ir=new te(ut,ze),Lr=new te(Ot,ze),Er=new te(ut,at),tn=new te(Ot,at),cn=W*Math.PI/180;ir._rotate(cn),Lr._rotate(cn),Er._rotate(cn),tn._rotate(cn),ut=Math.min(ir.x,Lr.x,Er.x,tn.x),Ot=Math.max(ir.x,Lr.x,Er.x,tn.x),ze=Math.min(ir.y,Lr.y,Er.y,tn.y),at=Math.max(ir.y,Lr.y,Er.y,tn.y)}t.emplaceBack(r.x,r.y,ut,ze,Ot,at,f,v,m)}this.boxEndIndex=t.length},lr=function(t,r){if(t===void 0&&(t=[]),r===void 0&&(r=Qt),this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(var f=(this.length>>1)-1;f>=0;f--)this._down(f)};function Qt(e,t){return e<t?-1:e>t?1:0}function Pn(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,m=-1/0,x=-1/0,A=e[0],D=0;D<A.length;D++){var z=A[D];(!D||z.x<f)&&(f=z.x),(!D||z.y<v)&&(v=z.y),(!D||z.x>m)&&(m=z.x),(!D||z.y>x)&&(x=z.y)}var W=Math.min(m-f,x-v),ie=W/2,oe=new lr([],Fi);if(W===0)return new te(f,v);for(var xe=f;xe<m;xe+=W)for(var je=v;je<x;je+=W)oe.push(new Re(xe+ie,je+ie,ie,e));for(var ze=function(Ot){for(var Yt=0,ir=0,Lr=0,Er=Ot[0],tn=0,cn=Er.length,Ln=cn-1;tn<cn;Ln=tn++){var Gn=Er[tn],Dn=Er[Ln],xn=Gn.x*Dn.y-Dn.x*Gn.y;ir+=(Gn.x+Dn.x)*xn,Lr+=(Gn.y+Dn.y)*xn,Yt+=3*xn}return new Re(ir/Yt,Lr/Yt,0,Ot)}(e),at=oe.length;oe.length;){var ut=oe.pop();(ut.d>ze.d||!ze.d)&&(ze=ut,r&&console.log("found best %d after %d probes",Math.round(1e4*ut.d)/1e4,at)),ut.max-ze.d<=t||(oe.push(new Re(ut.p.x-(ie=ut.h/2),ut.p.y-ie,ie,e)),oe.push(new Re(ut.p.x+ie,ut.p.y-ie,ie,e)),oe.push(new Re(ut.p.x-ie,ut.p.y+ie,ie,e)),oe.push(new Re(ut.p.x+ie,ut.p.y+ie,ie,e)),at+=4)}return r&&(console.log("num probes: "+at),console.log("best distance: "+ze.d)),ze.p}function Fi(e,t){return t.max-e.max}function Re(e,t,r,f){this.p=new te(e,t),this.h=r,this.d=function(v,m){for(var x=!1,A=1/0,D=0;D<m.length;D++)for(var z=m[D],W=0,ie=z.length,oe=ie-1;W<ie;oe=W++){var xe=z[W],je=z[oe];xe.y>v.y!=je.y>v.y&&v.x<(je.x-xe.x)*(v.y-xe.y)/(je.y-xe.y)+xe.x&&(x=!x),A=Math.min(A,ol(v,xe,je))}return(x?1:-1)*Math.sqrt(A)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}lr.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},lr.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},lr.prototype.peek=function(){return this.data[0]},lr.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,m=t[v];if(r(f,m)>=0)break;t[e]=m,e=v}t[e]=f},lr.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var m=1+(e<<1),x=t[m],A=m+1;if(A<this.length&&r(t[A],x)<0&&(m=A,x=t[A]),r(x,v)>=0)break;t[e]=x,e=m}t[e]=v};var be=Number.POSITIVE_INFINITY;function ht(e,t){return t[1]!==be?function(r,f,v){var m=0,x=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":x=v-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-v}switch(r){case"top-right":case"bottom-right":case"right":m=-f;break;case"top-left":case"bottom-left":case"left":m=f}return[m,x]}(e,t[0],t[1]):function(r,f){var v=0,m=0;f<0&&(f=0);var x=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":m=x-7;break;case"bottom-right":case"bottom-left":m=7-x;break;case"bottom":m=7-f;break;case"top":m=f-7}switch(r){case"top-right":case"bottom-right":v=-x;break;case"top-left":case"bottom-left":v=x;break;case"left":v=f;break;case"right":v=-f}return[v,m]}(e,t[0])}function zt(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Zt(e,t,r,f,v,m,x,A,D,z,W,ie,oe,xe,je){var ze=function(ir,Lr,Er,tn,cn,Ln,Gn,Dn){for(var xn=tn.layout.get("text-rotate").evaluate(Ln,{})*Math.PI/180,ei=[],Jn=0,Hn=Lr.positionedLines;Jn<Hn.length;Jn+=1)for(var Hi=Hn[Jn],Ti=0,Ea=Hi.positionedGlyphs;Ti<Ea.length;Ti+=1){var li=Ea[Ti];if(li.rect){var Xi=li.rect||{},eo=4,to=!0,Ao=1,po=0,Do=(cn||Dn)&&li.vertical,Js=li.metrics.advance*li.scale/2;if(Dn&&Lr.verticalizable&&(po=Hi.lineOffset/2-(li.imageName?-(24-li.metrics.width*li.scale)/2:24*(li.scale-1))),li.imageName){var bs=Gn[li.imageName];to=bs.sdf,eo=1/(Ao=bs.pixelRatio)}var du=cn?[li.x+Js,li.y]:[0,0],Ls=cn?[0,0]:[li.x+Js+Er[0],li.y+Er[1]-po],au=[0,0];Do&&(au=Ls,Ls=[0,0]);var Ss=(li.metrics.left-eo)*li.scale-Js+Ls[0],Rs=(-li.metrics.top-eo)*li.scale+Ls[1],Us=Ss+Xi.w*li.scale/Ao,va=Rs+Xi.h*li.scale/Ao,ia=new te(Ss,Rs),Va=new te(Us,Rs),Da=new te(Ss,va),vu=new te(Us,va);if(Do){var Ka=new te(-Js,Js- -17),vo=-Math.PI/2,ou=12-Js,ca=new te(22-ou,-(li.imageName?ou:0)),vf=new(Function.prototype.bind.apply(te,[null].concat(au)));ia._rotateAround(vo,Ka)._add(ca)._add(vf),Va._rotateAround(vo,Ka)._add(ca)._add(vf),Da._rotateAround(vo,Ka)._add(ca)._add(vf),vu._rotateAround(vo,Ka)._add(ca)._add(vf)}if(xn){var $l=Math.sin(xn),Lc=Math.cos(xn),Ku=[Lc,-$l,$l,Lc];ia._matMult(Ku),Va._matMult(Ku),Da._matMult(Ku),vu._matMult(Ku)}var Qs=new te(0,0),mf=new te(0,0);ei.push({tl:ia,tr:Va,bl:Da,br:vu,tex:Xi,writingMode:Lr.writingMode,glyphOffset:du,sectionIndex:li.sectionIndex,isSDF:to,pixelOffsetTL:Qs,pixelOffsetBR:mf,minFontScaleX:0,minFontScaleY:0})}}return ei}(0,r,A,v,m,x,f,e.allowVerticalPlacement),at=e.textSizeData,ut=null;at.kind==="source"?(ut=[128*v.layout.get("text-size").evaluate(x,{})])[0]>32640&&Me(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):at.kind==="composite"&&((ut=[128*xe.compositeTextSizes[0].evaluate(x,{},je),128*xe.compositeTextSizes[1].evaluate(x,{},je)])[0]>32640||ut[1]>32640)&&Me(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,ze,ut,A,m,x,z,t,D.lineStartIndex,D.lineLength,oe,je);for(var Ot=0,Yt=W;Ot<Yt.length;Ot+=1)ie[Yt[Ot]]=e.text.placedSymbolArray.length-1;return 4*ze.length}function vt(e){for(var t in e)return e[t];return null}function pt(e,t,r,f){var v=e.compareText;if(t in v){for(var m=v[t],x=m.length-1;x>=0;x--)if(f.dist(m[x])<r)return!0}else v[t]=[];return v[t].push(f),!1}var Pt=wo.VectorTileFeature.types,Fe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function lt(e,t,r,f,v,m,x,A,D,z,W,ie,oe){var xe=A?Math.min(32640,Math.round(A[0])):0,je=A?Math.min(32640,Math.round(A[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),m,x,(xe<<1)+(D?1:0),je,16*z,16*W,256*ie,256*oe)}function Ce(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function kt(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(Tu(r[t].text))return!0;return!1}var Ht=function(t){this.layoutVertexArray=new Sc,this.indexArray=new ma,this.programConfigurations=t,this.segments=new ye,this.dynamicLayoutVertexArray=new ic,this.opacityVertexArray=new Ec,this.placedSymbolArray=new h};Ht.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Ht.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ep.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,tp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Fe,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},Ht.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Tn("SymbolBuffers",Ht);var Mr=function(t,r,f){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new f,this.segments=new ye,this.collisionVertexArray=new wc};Mr.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,rp.members,!0)},Mr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Tn("CollisionBuffers",Mr);var ur=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(x){return x.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=No([]),this.placementViewportMatrix=No([]);var r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qa(this.zoom,r["text-size"]),this.iconSizeData=qa(this.zoom,r["icon-size"]);var f=this.layers[0].layout,v=f.get("symbol-sort-key"),m=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&v.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(function(x){return $n[x]})),this.stateDependentLayerIds=this.layers.filter(function(x){return x.isStateDependent()}).map(function(x){return x.id}),this.sourceID=t.sourceID};ur.prototype.createArrays=function(){this.text=new Ht(new Si(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new Ht(new Si(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new C,this.lineVertexArray=new L,this.symbolInstances=new E},ur.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var m=0;m<e.length;m++)if(t[e.charCodeAt(m)]=!0,(r||f)&&v){var x=cc[e.charAt(m)];x&&(t[x.charCodeAt(0)]=!0)}},ur.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,m=v.get("text-font"),x=v.get("text-field"),A=v.get("icon-image"),D=(x.value.kind!=="constant"||x.value.value instanceof ua&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),z=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,W=v.get("symbol-sort-key");if(this.features=[],D||z){for(var ie=t.iconDependencies,oe=t.glyphDependencies,xe=t.availableImages,je=new Oi(this.zoom),ze=0,at=e;ze<at.length;ze+=1){var ut=at[ze],Ot=ut.feature,Yt=ut.id,ir=ut.index,Lr=ut.sourceLayerIndex,Er=f._featureFilter.needGeometry,tn=Xa(Ot,Er);if(f._featureFilter.filter(je,tn,r)){Er||(tn.geometry=Ua(Ot));var cn=void 0;if(D){var Ln=f.getValueAndResolveTokens("text-field",tn,r,xe),Gn=ua.factory(Ln);kt(Gn)&&(this.hasRTLText=!0),(!this.hasRTLText||_c()==="unavailable"||this.hasRTLText&&Ts.isParsed())&&(cn=ip(Gn,f,tn))}var Dn=void 0;if(z){var xn=f.getValueAndResolveTokens("icon-image",tn,r,xe);Dn=xn instanceof Ki?xn:Ki.fromString(xn)}if(cn||Dn){var ei=this.sortFeaturesByKey?W.evaluate(tn,{},r):void 0;if(this.features.push({id:Yt,text:cn,icon:Dn,index:ir,sourceLayerIndex:Lr,geometry:tn.geometry,properties:Ot.properties,type:Pt[Ot.type],sortKey:ei}),Dn&&(ie[Dn.name]=!0),cn){var Jn=m.evaluate(tn,{},r).join(","),Hn=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf($n.vertical)>=0;for(var Hi=0,Ti=cn.sections;Hi<Ti.length;Hi+=1){var Ea=Ti[Hi];if(Ea.image)ie[Ea.image.name]=!0;else{var li=Xc(cn.toString()),Xi=Ea.fontStack||Jn,eo=oe[Xi]=oe[Xi]||{};this.calculateGlyphDependencies(Ea.text,eo,Hn,this.allowVerticalPlacement,li)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(to){var Ao={},po={},Do=[],Js=0;function bs(Ka){Do.push(to[Ka]),Js++}function du(Ka,vo,ou){var ca=po[Ka];return delete po[Ka],po[vo]=ca,Do[ca].geometry[0].pop(),Do[ca].geometry[0]=Do[ca].geometry[0].concat(ou[0]),ca}function Ls(Ka,vo,ou){var ca=Ao[vo];return delete Ao[vo],Ao[Ka]=ca,Do[ca].geometry[0].shift(),Do[ca].geometry[0]=ou[0].concat(Do[ca].geometry[0]),ca}function au(Ka,vo,ou){var ca=ou?vo[0][vo[0].length-1]:vo[0][0];return Ka+":"+ca.x+":"+ca.y}for(var Ss=0;Ss<to.length;Ss++){var Rs=to[Ss],Us=Rs.geometry,va=Rs.text?Rs.text.toString():null;if(va){var ia=au(va,Us),Va=au(va,Us,!0);if(ia in po&&Va in Ao&&po[ia]!==Ao[Va]){var Da=Ls(ia,Va,Us),vu=du(ia,Va,Do[Da].geometry);delete Ao[ia],delete po[Va],po[au(va,Do[vu].geometry,!0)]=vu,Do[Da].geometry=null}else ia in po?du(ia,Va,Us):Va in Ao?Ls(ia,Va,Us):(bs(Ss),Ao[ia]=Js-1,po[Va]=Js-1)}else bs(Ss)}return Do.filter(function(Ka){return Ka.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(to,Ao){return to.sortKey-Ao.sortKey})}},ur.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},ur.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},ur.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},ur.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},ur.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},ur.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},ur.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),m={},x=e.segment+1;x<t.length;x++)m[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:f},x<t.length-1&&(f+=t[x+1].dist(t[x]));for(var A=e.segment||0;A>=0;A--)m[A]={x:t[A].x,y:t[A].y,tileUnitDistanceFromAnchor:v},A>0&&(v+=t[A-1].dist(t[A]));for(var D=0;D<t.length;D++){var z=m[D];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},ur.prototype.addSymbols=function(e,t,r,f,v,m,x,A,D,z,W,ie){for(var oe=e.indexArray,xe=e.layoutVertexArray,je=e.segments.prepareSegment(4*t.length,xe,oe,this.canOverlap?m.sortKey:void 0),ze=this.glyphOffsetArray.length,at=je.vertexLength,ut=this.allowVerticalPlacement&&x===$n.vertical?Math.PI/2:0,Ot=m.text&&m.text.sections,Yt=0;Yt<t.length;Yt++){var ir=t[Yt],Lr=ir.tl,Er=ir.tr,tn=ir.bl,cn=ir.br,Ln=ir.tex,Gn=ir.pixelOffsetTL,Dn=ir.pixelOffsetBR,xn=ir.minFontScaleX,ei=ir.minFontScaleY,Jn=ir.glyphOffset,Hn=ir.isSDF,Hi=ir.sectionIndex,Ti=je.vertexLength,Ea=Jn[1];lt(xe,A.x,A.y,Lr.x,Ea+Lr.y,Ln.x,Ln.y,r,Hn,Gn.x,Gn.y,xn,ei),lt(xe,A.x,A.y,Er.x,Ea+Er.y,Ln.x+Ln.w,Ln.y,r,Hn,Dn.x,Gn.y,xn,ei),lt(xe,A.x,A.y,tn.x,Ea+tn.y,Ln.x,Ln.y+Ln.h,r,Hn,Gn.x,Dn.y,xn,ei),lt(xe,A.x,A.y,cn.x,Ea+cn.y,Ln.x+Ln.w,Ln.y+Ln.h,r,Hn,Dn.x,Dn.y,xn,ei),Ce(e.dynamicLayoutVertexArray,A,ut),oe.emplaceBack(Ti,Ti+1,Ti+2),oe.emplaceBack(Ti+1,Ti+2,Ti+3),je.vertexLength+=4,je.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Jn[0]),Yt!==t.length-1&&Hi===t[Yt+1].sectionIndex||e.programConfigurations.populatePaintArrays(xe.length,m,m.index,{},ie,Ot&&Ot[Hi])}e.placedSymbolArray.emplaceBack(A.x,A.y,ze,this.glyphOffsetArray.length-ze,at,D,z,A.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],x,0,!1,0,W)},ur.prototype._addCollisionDebugVertex=function(e,t,r,f,v,m){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(m.x),Math.round(m.y))},ur.prototype.addCollisionDebugVertices=function(e,t,r,f,v,m,x){var A=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),D=A.vertexLength,z=v.layoutVertexArray,W=v.collisionVertexArray,ie=x.anchorX,oe=x.anchorY;this._addCollisionDebugVertex(z,W,m,ie,oe,new te(e,t)),this._addCollisionDebugVertex(z,W,m,ie,oe,new te(r,t)),this._addCollisionDebugVertex(z,W,m,ie,oe,new te(r,f)),this._addCollisionDebugVertex(z,W,m,ie,oe,new te(e,f)),A.vertexLength+=4;var xe=v.indexArray;xe.emplaceBack(D,D+1),xe.emplaceBack(D+1,D+2),xe.emplaceBack(D+2,D+3),xe.emplaceBack(D+3,D),A.primitiveLength+=4},ur.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var m=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,f?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,r)}},ur.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Mr(ac,nh.members,oc),this.iconCollisionBox=new Mr(ac,nh.members,oc);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},ur.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,m,x,A,D){for(var z={},W=t;W<r;W++){var ie=e.get(W);z.textBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},z.textFeatureIndex=ie.featureIndex;break}for(var oe=f;oe<v;oe++){var xe=e.get(oe);z.verticalTextBox={x1:xe.x1,y1:xe.y1,x2:xe.x2,y2:xe.y2,anchorPointX:xe.anchorPointX,anchorPointY:xe.anchorPointY},z.verticalTextFeatureIndex=xe.featureIndex;break}for(var je=m;je<x;je++){var ze=e.get(je);z.iconBox={x1:ze.x1,y1:ze.y1,x2:ze.x2,y2:ze.y2,anchorPointX:ze.anchorPointX,anchorPointY:ze.anchorPointY},z.iconFeatureIndex=ze.featureIndex;break}for(var at=A;at<D;at++){var ut=e.get(at);z.verticalIconBox={x1:ut.x1,y1:ut.y1,x2:ut.x2,y2:ut.y2,anchorPointX:ut.anchorPointX,anchorPointY:ut.anchorPointY},z.verticalIconFeatureIndex=ut.featureIndex;break}return z},ur.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},ur.prototype.hasTextData=function(){return this.text.segments.get().length>0},ur.prototype.hasIconData=function(){return this.icon.segments.get().length>0},ur.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},ur.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},ur.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},ur.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},ur.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],m=[],x=0;x<this.symbolInstances.length;++x){m.push(x);var A=this.symbolInstances.get(x);f.push(0|Math.round(t*A.anchorX+r*A.anchorY)),v.push(A.featureIndex)}return m.sort(function(D,z){return f[D]-f[z]||v[z]-v[D]}),m},ur.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},ur.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(m,x,A){m>=0&&A.indexOf(m)===x&&t.addIndicesForPlacedSymbol(t.text,m)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Tn("SymbolBucket",ur,{omit:["layers","collisionBoxArray","features","compareText"]}),ur.MAX_GLYPHS=65535,ur.addDynamicAttributes=Ce;var Tr=new Fo({"symbol-placement":new Bn(he.layout_symbol["symbol-placement"]),"symbol-spacing":new Bn(he.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Bn(he.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new On(he.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Bn(he.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Bn(he.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Bn(he.layout_symbol["icon-ignore-placement"]),"icon-optional":new Bn(he.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Bn(he.layout_symbol["icon-rotation-alignment"]),"icon-size":new On(he.layout_symbol["icon-size"]),"icon-text-fit":new Bn(he.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bn(he.layout_symbol["icon-text-fit-padding"]),"icon-image":new On(he.layout_symbol["icon-image"]),"icon-rotate":new On(he.layout_symbol["icon-rotate"]),"icon-padding":new Bn(he.layout_symbol["icon-padding"]),"icon-keep-upright":new Bn(he.layout_symbol["icon-keep-upright"]),"icon-offset":new On(he.layout_symbol["icon-offset"]),"icon-anchor":new On(he.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Bn(he.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Bn(he.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Bn(he.layout_symbol["text-rotation-alignment"]),"text-field":new On(he.layout_symbol["text-field"]),"text-font":new On(he.layout_symbol["text-font"]),"text-size":new On(he.layout_symbol["text-size"]),"text-max-width":new On(he.layout_symbol["text-max-width"]),"text-line-height":new Bn(he.layout_symbol["text-line-height"]),"text-letter-spacing":new On(he.layout_symbol["text-letter-spacing"]),"text-justify":new On(he.layout_symbol["text-justify"]),"text-radial-offset":new On(he.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Bn(he.layout_symbol["text-variable-anchor"]),"text-anchor":new On(he.layout_symbol["text-anchor"]),"text-max-angle":new Bn(he.layout_symbol["text-max-angle"]),"text-writing-mode":new Bn(he.layout_symbol["text-writing-mode"]),"text-rotate":new On(he.layout_symbol["text-rotate"]),"text-padding":new Bn(he.layout_symbol["text-padding"]),"text-keep-upright":new Bn(he.layout_symbol["text-keep-upright"]),"text-transform":new On(he.layout_symbol["text-transform"]),"text-offset":new On(he.layout_symbol["text-offset"]),"text-allow-overlap":new Bn(he.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Bn(he.layout_symbol["text-ignore-placement"]),"text-optional":new Bn(he.layout_symbol["text-optional"])}),Qr={paint:new Fo({"icon-opacity":new On(he.paint_symbol["icon-opacity"]),"icon-color":new On(he.paint_symbol["icon-color"]),"icon-halo-color":new On(he.paint_symbol["icon-halo-color"]),"icon-halo-width":new On(he.paint_symbol["icon-halo-width"]),"icon-halo-blur":new On(he.paint_symbol["icon-halo-blur"]),"icon-translate":new Bn(he.paint_symbol["icon-translate"]),"icon-translate-anchor":new Bn(he.paint_symbol["icon-translate-anchor"]),"text-opacity":new On(he.paint_symbol["text-opacity"]),"text-color":new On(he.paint_symbol["text-color"],{runtimeType:fn,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new On(he.paint_symbol["text-halo-color"]),"text-halo-width":new On(he.paint_symbol["text-halo-width"]),"text-halo-blur":new On(he.paint_symbol["text-halo-blur"]),"text-translate":new Bn(he.paint_symbol["text-translate"]),"text-translate-anchor":new Bn(he.paint_symbol["text-translate-anchor"])}),layout:Tr},Vn=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:gn,this.defaultValue=t};Vn.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Vn.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Vn.prototype.outputDefined=function(){return!1},Vn.prototype.serialize=function(){return null},Tn("FormatSectionOverride",Vn,{omit:["defaultValue"]});var Ri=function(e){function t(r){e.call(this,r,Qr)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var m=[],x=0,A=v;x<A.length;x+=1){var D=A[x];m.indexOf(D)<0&&m.push(D)}this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,m){var x=this.layout.get(r).evaluate(f,{},v,m),A=this._unevaluatedLayout._values[r];return A.isDataDriven()||cu(A.value)||!x?x:function(D,z){return z.replace(/{([^{}]+)}/g,function(W,ie){return ie in D?String(D[ie]):""})}(f.properties,x)},t.prototype.createBucket=function(r){return new ur(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=Qr.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var m,x=this.paint.get(v),A=new Vn(x),D=new lu(A,x.property.specification);m=x.value.kind==="constant"||x.value.kind==="source"?new Nl("source",D):new pl("composite",D,x.value.zoomStops,x.value._interpolationType),this.paint._values[v]=new as(x.property,m,x.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),m=Qr.paint.properties[f],x=!1,A=function(ie){for(var oe=0,xe=ie;oe<xe.length;oe+=1)if(m.overrides&&m.overrides.hasOverride(xe[oe]))return void(x=!0)};if(v.value.kind==="constant"&&v.value.value instanceof ua)A(v.value.value.sections);else if(v.value.kind==="source"){var D=function W(ie){x||(ie instanceof Ya&&ya(ie.value)===Bi?A(ie.value.sections):ie instanceof Ga?A(ie.sections):ie.eachChild(W))},z=v.value;z._styleExpression&&D(z._styleExpression.expression)}return x},t}(Vs),zn={paint:new Fo({"background-color":new Bn(he.paint_background["background-color"]),"background-pattern":new os(he.paint_background["background-pattern"]),"background-opacity":new Bn(he.paint_background["background-opacity"])})},ti=function(e){function t(r){e.call(this,r,zn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Vs),yi={paint:new Fo({"raster-opacity":new Bn(he.paint_raster["raster-opacity"]),"raster-hue-rotate":new Bn(he.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Bn(he.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Bn(he.paint_raster["raster-brightness-max"]),"raster-saturation":new Bn(he.paint_raster["raster-saturation"]),"raster-contrast":new Bn(he.paint_raster["raster-contrast"]),"raster-resampling":new Bn(he.paint_raster["raster-resampling"]),"raster-fade-duration":new Bn(he.paint_raster["raster-fade-duration"])})},da=function(e){function t(r){e.call(this,r,yi)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Vs),Vo=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(Vs),Nu={circle:Tl,heatmap:Qf,hillshade:Af,fill:Ei,"fill-extrusion":_s,line:qh,symbol:Ri,background:ti,raster:da},ih=q.HTMLImageElement,sl=q.HTMLCanvasElement,Mh=q.HTMLVideoElement,iu=q.ImageData,jf=q.ImageBitmap,Zf=function(t,r,f,v){this.context=t,this.format=f,this.texture=t.gl.createTexture(),this.update(r,v)};Zf.prototype.update=function(e,t,r){var f=e.width,v=e.height,m=!(this.size&&this.size[0]===f&&this.size[1]===v||r),x=this.context,A=x.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!t||t.premultiply!==!1)),m)this.size=[f,v],e instanceof ih||e instanceof sl||e instanceof Mh||e instanceof iu||jf&&e instanceof jf?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,e):A.texImage2D(A.TEXTURE_2D,0,this.format,f,v,0,this.format,A.UNSIGNED_BYTE,e.data);else{var D=r||{x:0,y:0},z=D.x,W=D.y;e instanceof ih||e instanceof sl||e instanceof Mh||e instanceof iu||jf&&e instanceof jf?A.texSubImage2D(A.TEXTURE_2D,0,z,W,A.RGBA,A.UNSIGNED_BYTE,e):A.texSubImage2D(A.TEXTURE_2D,0,z,W,f,v,A.RGBA,A.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)},Zf.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},Zf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Zf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Cp=function(t){var r=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){r._triggered=!1,r._callback()})};Cp.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Cp.prototype.remove=function(){delete this._channel,this._callback=function(){}};var ah=function(t,r,f){this.target=t,this.parent=r,this.mapId=f,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},cr(["receive","process"],this),this.invoker=new Cp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=bt()?t:q};function Pp(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}ah.prototype.send=function(e,t,r,f,v){var m=this;v===void 0&&(v=!1);var x=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[x]=r);var A=Ee(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:eu(t,A)},A),{cancel:function(){r&&delete m.callbacks[x],m.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:m.mapId})}}},ah.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else bt()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},ah.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},ah.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(Zs(t.error)):f(null,Zs(t.data)))}else{var v=!1,m=Ee(this.globalScope)?void 0:[],x=t.hasCallback?function(W,ie){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:W?eu(W):null,data:eu(ie,m)},m)}:function(W){v=!0},A=null,D=Zs(t.data);if(this.parent[t.type])A=this.parent[t.type](t.sourceMapId,D,x);else if(this.parent.getWorkerSource){var z=t.type.split(".");A=this.parent.getWorkerSource(t.sourceMapId,z[0],D.source)[z[1]](D,x)}else x(new Error("Could not find function "+t.type));!v&&A&&A.cancel&&(this.cancelCallbacks[e]=A.cancel)}},ah.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var fs=function(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};fs.prototype.setNorthEast=function(e){return this._ne=e instanceof _o?new _o(e.lng,e.lat):_o.convert(e),this},fs.prototype.setSouthWest=function(e){return this._sw=e instanceof _o?new _o(e.lng,e.lat):_o.convert(e),this},fs.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof _o)t=e,r=e;else{if(!(e instanceof fs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(fs.convert(e)):this.extend(_o.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new _o(t.lng,t.lat),this._ne=new _o(r.lng,r.lat)),this},fs.prototype.getCenter=function(){return new _o((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},fs.prototype.getSouthWest=function(){return this._sw},fs.prototype.getNorthEast=function(){return this._ne},fs.prototype.getNorthWest=function(){return new _o(this.getWest(),this.getNorth())},fs.prototype.getSouthEast=function(){return new _o(this.getEast(),this.getSouth())},fs.prototype.getWest=function(){return this._sw.lng},fs.prototype.getSouth=function(){return this._sw.lat},fs.prototype.getEast=function(){return this._ne.lng},fs.prototype.getNorth=function(){return this._ne.lat},fs.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},fs.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},fs.prototype.isEmpty=function(){return!(this._sw&&this._ne)},fs.prototype.contains=function(e){var t=_o.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},fs.convert=function(e){return!e||e instanceof fs?e:new fs(e)};var _o=function(t,r){if(isNaN(t)||isNaN(r))throw new Error("Invalid LngLat object: ("+t+", "+r+")");if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};_o.prototype.wrap=function(){return new _o(Nt(this.lng,-180,180),this.lat)},_o.prototype.toArray=function(){return[this.lng,this.lat]},_o.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},_o.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},_o.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new fs(new _o(this.lng-r,this.lat-t),new _o(this.lng+r,this.lat+t))},_o.convert=function(e){if(e instanceof _o)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new _o(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new _o(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var od=2*Math.PI*63710088e-1;function Mp(e){return od*Math.cos(e*Math.PI/180)}function Ip(e){return(180+e)/360}function sd(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ud(e,t){return e/Mp(t)}function ld(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Vf=function(t,r,f){f===void 0&&(f=0),this.x=+t,this.y=+r,this.z=+f};Vf.fromLngLat=function(e,t){t===void 0&&(t=0);var r=_o.convert(e);return new Vf(Ip(r.lng),sd(r.lat),ud(t,r.lat))},Vf.prototype.toLngLat=function(){return new _o(360*this.x-180,ld(this.y))},Vf.prototype.toAltitude=function(){return this.z*Mp(ld(this.y))},Vf.prototype.meterInMercatorCoordinateUnits=function(){return 1/od*(e=ld(this.y),1/Math.cos(e*Math.PI/180));var e};var Mf=function(t,r,f){this.z=t,this.x=r,this.y=f,this.key=Ih(0,t,t,r,f)};Mf.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Mf.prototype.url=function(e,t){var r,f,v,m,x,A=(f=this.y,v=this.z,m=Pp(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),x=Pp(256*(r+1),256*(f+1),v),m[0]+","+m[1]+","+x[0]+","+x[1]),D=function(z,W,ie){for(var oe,xe="",je=z;je>0;je--)xe+=(W&(oe=1<<je-1)?1:0)+(ie&oe?2:0);return xe}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",A)},Mf.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new te(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Mf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Op=function(t,r){this.wrap=t,this.canonical=r,this.key=Ih(t,r.z,r.z,r.x,r.y)},hs=function(t,r,f,v,m){this.overscaledZ=t,this.wrap=r,this.canonical=new Mf(f,+v,+m),this.key=Ih(r,t,f,v,m)};function Ih(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var m=1<<r;return(m*m*e+m*v+f).toString(36)+r.toString(36)+t.toString(36)}hs.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},hs.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new hs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hs(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},hs.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?Ih(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Ih(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},hs.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},hs.prototype.children=function(e){if(this.overscaledZ>=e)return[new hs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new hs(t,this.wrap,t,r,f),new hs(t,this.wrap,t,r+1,f),new hs(t,this.wrap,t,r,f+1),new hs(t,this.wrap,t,r+1,f+1)]},hs.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},hs.prototype.wrapped=function(){return new hs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},hs.prototype.unwrapTo=function(e){return new hs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},hs.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},hs.prototype.toUnwrapped=function(){return new Op(this.wrap,this.canonical)},hs.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},hs.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Vf(e.x-this.wrap,e.y))},Tn("CanonicalTileID",Mf),Tn("OverscaledTileID",hs,{omit:["posMatrix"]});var df=function(t,r,f){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return Me('"'+f+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=r.height;var v=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=f||"mapbox";for(var m=0;m<v;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(v,m)]=this.data[this._idx(v-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,v)]=this.data[this._idx(m,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)]};df.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},df.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},df.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},df.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},df.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},df.prototype.getPixels=function(){return new zo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},df.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,m=r*this.dim,x=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:m=x-1;break;case 1:x=m+1}for(var A=-t*this.dim,D=-r*this.dim,z=m;z<x;z++)for(var W=f;W<v;W++)this.data[this._idx(W,z)]=e.data[this._idx(W+A,z+D)]},Tn("DEMData",df);var op=function(t){this._stringToNumber={},this._numberToString=[];for(var r=0;r<t.length;r++){var f=t[r];this._stringToNumber[f]=r,this._numberToString[r]=f}};op.prototype.encode=function(e){return this._stringToNumber[e]},op.prototype.decode=function(e){return this._numberToString[e]};var sp=function(t,r,f,v,m){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=f,t._y=v,this.properties=t.properties,this.id=m},up={geometry:{configurable:!0}};up.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},up.geometry.set=function(e){this._geometry=e},sp.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(sp.prototype,up);var If=function(){this.state={},this.stateChanges={},this.deletedStates={}};If.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Xt(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var m in this.deletedStates[e][f]={},this.state[e][f])r[m]||(this.deletedStates[e][f][m]=null);else for(var x in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][x]===null&&delete this.deletedStates[e][f][x]},If.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},If.prototype.getState=function(e,t){var r=String(t),f=Xt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var m in v)delete f[m]}return f},If.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},If.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var m in this.stateChanges[f])this.state[f][m]||(this.state[f][m]={}),Xt(this.state[f][m],this.stateChanges[f][m]),v[m]=this.state[f][m];r[f]=v}for(var x in this.deletedStates){this.state[x]=this.state[x]||{};var A={};if(this.deletedStates[x]===null)for(var D in this.state[x])A[D]={},this.state[x][D]={};else for(var z in this.deletedStates[x]){if(this.deletedStates[x][z]===null)this.state[x][z]={};else for(var W=0,ie=Object.keys(this.deletedStates[x][z]);W<ie.length;W+=1)delete this.state[x][z][ie[W]];A[z]=this.state[x][z]}r[x]=r[x]||{},Xt(r[x],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var oe in e)e[oe].setFeatureState(r,t)};var ef=function(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Zu(8192,16,0),this.grid3D=new Zu(8192,16,0),this.featureIndexArray=new ne,this.promoteId=r};function cd(e,t,r,f,v){return Gt(e,function(m,x){var A=t instanceof Mu?t.get(x):null;return A&&A.evaluate?A.evaluate(r,f,v):A})}function Lp(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,m=0,x=e;m<x.length;m+=1){var A=x[m];t=Math.min(t,A.x),r=Math.min(r,A.y),f=Math.max(f,A.x),v=Math.max(v,A.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function Fd(e,t){return t-e}ef.prototype.insert=function(e,t,r,f,v,m){var x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var A=m?this.grid3D:this.grid,D=0;D<t.length;D++){for(var z=t[D],W=[1/0,1/0,-1/0,-1/0],ie=0;ie<z.length;ie++){var oe=z[ie];W[0]=Math.min(W[0],oe.x),W[1]=Math.min(W[1],oe.y),W[2]=Math.max(W[2],oe.x),W[3]=Math.max(W[3],oe.y)}W[0]<8192&&W[1]<8192&&W[2]>=0&&W[3]>=0&&A.insert(x,W[0],W[1],W[2],W[3])}},ef.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new wo.VectorTile(new fe(this.rawTileData)).layers,this.sourceLayerCoder=new op(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ef.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var m=e.params||{},x=8192/e.tileSize/e.scale,A=Bl(m.filter),D=e.queryGeometry,z=e.queryPadding*x,W=Lp(D),ie=this.grid.query(W.minX-z,W.minY-z,W.maxX+z,W.maxY+z),oe=Lp(e.cameraQueryGeometry),xe=this.grid3D.query(oe.minX-z,oe.minY-z,oe.maxX+z,oe.maxY+z,function(ir,Lr,Er,tn){return function(cn,Ln,Gn,Dn,xn){for(var ei=0,Jn=cn;ei<Jn.length;ei+=1){var Hn=Jn[ei];if(Ln<=Hn.x&&Gn<=Hn.y&&Dn>=Hn.x&&xn>=Hn.y)return!0}var Hi=[new te(Ln,Gn),new te(Ln,xn),new te(Dn,xn),new te(Dn,Gn)];if(cn.length>2){for(var Ti=0,Ea=Hi;Ti<Ea.length;Ti+=1)if(Du(cn,Ea[Ti]))return!0}for(var li=0;li<cn.length-1;li++)if(sc(cn[li],cn[li+1],Hi))return!0;return!1}(e.cameraQueryGeometry,ir-z,Lr-z,Er+z,tn+z)}),je=0,ze=xe;je<ze.length;je+=1)ie.push(ze[je]);ie.sort(Fd);for(var at,ut={},Ot=function(Lr){var Er=ie[Lr];if(Er!==at){at=Er;var tn=v.featureIndexArray.get(Er),cn=null;v.loadMatchingFeature(ut,tn.bucketIndex,tn.sourceLayerIndex,tn.featureIndex,A,m.layers,m.availableImages,t,r,f,function(Ln,Gn,Dn){return cn||(cn=Ua(Ln)),Gn.queryIntersectsFeature(D,Ln,Dn,cn,v.z,e.transform,x,e.pixelPosMatrix)})}},Yt=0;Yt<ie.length;Yt++)Ot(Yt);return ut},ef.prototype.loadMatchingFeature=function(e,t,r,f,v,m,x,A,D,z,W){var ie=this.bucketLayerIDs[t];if(!m||function(cn,Ln){for(var Gn=0;Gn<cn.length;Gn++)if(Ln.indexOf(cn[Gn])>=0)return!0;return!1}(m,ie)){var oe=this.sourceLayerCoder.decode(r),xe=this.vtLayers[oe].feature(f);if(v.needGeometry){var je=Xa(xe,!0);if(!v.filter(new Oi(this.tileID.overscaledZ),je,this.tileID.canonical))return}else if(!v.filter(new Oi(this.tileID.overscaledZ),xe))return;for(var ze=this.getId(xe,oe),at=0;at<ie.length;at++){var ut=ie[at];if(!(m&&m.indexOf(ut)<0)){var Ot=A[ut];if(Ot){var Yt={};ze!==void 0&&z&&(Yt=z.getState(Ot.sourceLayer||"_geojsonTileLayer",ze));var ir=Xt({},D[ut]);ir.paint=cd(ir.paint,Ot.paint,xe,Yt,x),ir.layout=cd(ir.layout,Ot.layout,xe,Yt,x);var Lr=!W||W(xe,Ot,Yt);if(Lr){var Er=new sp(xe,this.z,this.x,this.y,ze);Er.layer=ir;var tn=e[ut];tn===void 0&&(tn=e[ut]=[]),tn.push({featureIndex:f,feature:Er,intersectionZ:Lr})}}}}}},ef.prototype.lookupSymbolFeatures=function(e,t,r,f,v,m,x,A){var D={};this.loadVTLayers();for(var z=Bl(v),W=0,ie=e;W<ie.length;W+=1)this.loadMatchingFeature(D,r,f,ie[W],z,m,x,A,t);return D},ef.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},ef.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Tn("FeatureIndex",ef,{omit:["rawTileData","sourceLayerCoder"]});var $s=function(t,r){this.tileID=t,this.uid=Qe(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};$s.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<Nr.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},$s.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},$s.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(z,W){var ie={};if(!W)return ie;for(var oe=function(){var at=je[xe],ut=at.layerIds.map(function(ir){return W.getLayer(ir)}).filter(Boolean);if(ut.length!==0){at.layers=ut,at.stateDependentLayerIds&&(at.stateDependentLayers=at.stateDependentLayerIds.map(function(ir){return ut.filter(function(Lr){return Lr.id===ir})[0]}));for(var Ot=0,Yt=ut;Ot<Yt.length;Ot+=1)ie[Yt[Ot].id]=at}},xe=0,je=z;xe<je.length;xe+=1)oe();return ie}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof ur){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var m in this.buckets){var x=this.buckets[m];if(x instanceof ur&&x.hasRTLText){this.hasRTLText=!0,Ts.isLoading()||Ts.isLoaded()||_c()!=="deferred"||ws();break}}for(var A in this.queryPadding=0,this.buckets){var D=this.buckets[A];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(A).queryRadius(D))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new o},$s.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},$s.prototype.getBucket=function(e){return this.buckets[e.id]},$s.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Zf(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Zf(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},$s.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},$s.prototype.queryRenderedFeatures=function(e,t,r,f,v,m,x,A,D,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:m,tileSize:this.tileSize,pixelPosMatrix:z,transform:A,params:x,queryPadding:this.queryPadding*D},e,t,r):{}},$s.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",m=f._geojsonTileLayer||f[v];if(m)for(var x=Bl(t&&t.filter),A=this.tileID.canonical,D=A.z,z=A.x,W=A.y,ie={z:D,x:z,y:W},oe=0;oe<m.length;oe++){var xe=m.feature(oe);if(x.needGeometry){var je=Xa(xe,!0);if(!x.filter(new Oi(this.tileID.overscaledZ),je,this.tileID.canonical))continue}else if(!x.filter(new Oi(this.tileID.overscaledZ),xe))continue;var ze=r.getId(xe,v),at=new sp(xe,D,z,W,ze);at.tile=ie,e.push(at)}}},$s.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},$s.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},$s.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=tr(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var m=this.expirationTime-t;m?this.expirationTime=f+Math.max(m,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},$s.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},$s.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],m=v.layers[0].sourceLayer||"_geojsonTileLayer",x=r[m],A=e[m];if(x&&A&&Object.keys(A).length!==0){v.update(A,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=t&&t.style&&t.style.getLayer(f);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(v)))}}}},$s.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},$s.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Nr.now()},$s.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},$s.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=Nr.now()+e},$s.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},$s.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var m=0,x=t;m<x.length;m+=1)if(v[x[m]])return!0}}return!1};var Oc=q.performance,fd=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Oc.mark(this._marks.start)};fd.prototype.finish=function(){Oc.mark(this._marks.end);var e=Oc.getEntriesByName(this._marks.measure);return e.length===0&&(Oc.measure(this._marks.measure,this._marks.start,this._marks.end),e=Oc.getEntriesByName(this._marks.measure),Oc.clearMarks(this._marks.start),Oc.clearMarks(this._marks.end),Oc.clearMeasures(this._marks.measure)),e},p.Actor=ah,p.AlphaImage=Ms,p.CanonicalTileID=Mf,p.CollisionBoxArray=o,p.Color=Zn,p.DEMData=df,p.DataConstantProperty=Bn,p.DictionaryCoder=op,p.EXTENT=8192,p.ErrorEvent=De,p.EvaluationParameters=Oi,p.Event=ue,p.Evented=He,p.FeatureIndex=ef,p.FillBucket=Nn,p.FillExtrusionBucket=Jo,p.ImageAtlas=jn,p.ImagePosition=Fr,p.LineBucket=ls,p.LngLat=_o,p.LngLatBounds=fs,p.MercatorCoordinate=Vf,p.ONE_EM=24,p.OverscaledTileID=hs,p.Point=te,p.Point$1=te,p.Properties=Fo,p.Protobuf=fe,p.RGBAImage=zo,p.RequestManager=jt,p.RequestPerformance=fd,p.ResourceType=sr,p.SegmentVector=ye,p.SourceFeatureState=If,p.StructArrayLayout1ui2=hf,p.StructArrayLayout2f1f2i16=al,p.StructArrayLayout2i4=xl,p.StructArrayLayout3ui6=ma,p.StructArrayLayout4i8=bc,p.SymbolBucket=ur,p.Texture=Zf,p.Tile=$s,p.Transitionable=Io,p.Uniform1f=an,p.Uniform1i=Cr,p.Uniform2f=Xr,p.Uniform3f=vn,p.Uniform4f=An,p.UniformColor=Xn,p.UniformMatrix4f=Ci,p.UnwrappedTileID=Op,p.ValidationError=Ne,p.WritingMode=$n,p.ZoomHistory=gl,p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},p.addDynamicAttributes=Ce,p.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),m=null;e.forEach(function(x,A){t(x,function(D,z){D&&(m=D),v[A]=z,--f==0&&r(m,v)})})},p.bezier=Pe,p.bindAll=cr,p.browser=Nr,p.cacheEntryPossiblyAdded=function(e){++Dt>dt&&(e.getActor().send("enforceCacheSizeLimit",gt),Dt=0)},p.clamp=Oe,p.clearTileCache=function(e){var t=q.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=ui,p.clone=function(e){var t=new Eo(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=Ze,p.clone$2=function(e){var t=new Eo(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=np,p.config=Vt,p.create=function(){var e=new Eo(16);return Eo!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new Eo(9);return Eo!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new Eo(4);return Eo!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=G,p.createExpression=Ql,p.createLayout=So,p.createStyleLayer=function(e){return e.type==="custom"?new Vo(e):new Nu[e.type](e)},p.cross=function(e,t,r){var f=t[0],v=t[1],m=t[2],x=r[0],A=r[1],D=r[2];return e[0]=v*D-m*A,e[1]=m*x-f*D,e[2]=f*A-v*x,e},p.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=Be,p.emitValidationErrors=ju,p.endsWith=At,p.enforceCacheSizeLimit=function(e){fr(),Tt&&Tt.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},p.evaluateSizeForFeature=cs,p.evaluateSizeForZoom=qo,p.evaluateVariableOffset=ht,p.evented=Kc,p.extend=Xt,p.featureFilter=Bl,p.filterObject=St,p.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=Qo,p.getAnchorJustification=zt,p.getArrayBuffer=Zi,p.getImage=I,p.getJSON=function(e,t){return Di(Xt(e,{type:"json"}),t)},p.getRTLTextPluginStatus=_c,p.getReferrer=_n,p.getVideo=function(e,t){var r,f,v=q.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var m=0;m<e.length;m++){var x=q.document.createElement("source");r=e[m],f=void 0,(f=q.document.createElement("a")).href=r,(f.protocol!==q.document.location.protocol||f.host!==q.document.location.host)&&(v.crossOrigin="Anonymous"),x.src=e[m],v.appendChild(x)}return{cancel:function(){}}},p.identity=No,p.invert=function(e,t){var r=t[0],f=t[1],v=t[2],m=t[3],x=t[4],A=t[5],D=t[6],z=t[7],W=t[8],ie=t[9],oe=t[10],xe=t[11],je=t[12],ze=t[13],at=t[14],ut=t[15],Ot=r*A-f*x,Yt=r*D-v*x,ir=r*z-m*x,Lr=f*D-v*A,Er=f*z-m*A,tn=v*z-m*D,cn=W*ze-ie*je,Ln=W*at-oe*je,Gn=W*ut-xe*je,Dn=ie*at-oe*ze,xn=ie*ut-xe*ze,ei=oe*ut-xe*at,Jn=Ot*ei-Yt*xn+ir*Dn+Lr*Gn-Er*Ln+tn*cn;return Jn?(e[0]=(A*ei-D*xn+z*Dn)*(Jn=1/Jn),e[1]=(v*xn-f*ei-m*Dn)*Jn,e[2]=(ze*tn-at*Er+ut*Lr)*Jn,e[3]=(oe*Er-ie*tn-xe*Lr)*Jn,e[4]=(D*Gn-x*ei-z*Ln)*Jn,e[5]=(r*ei-v*Gn+m*Ln)*Jn,e[6]=(at*ir-je*tn-ut*Yt)*Jn,e[7]=(W*tn-oe*ir+xe*Yt)*Jn,e[8]=(x*xn-A*Gn+z*cn)*Jn,e[9]=(f*Gn-r*xn-m*cn)*Jn,e[10]=(je*Er-ze*ir+ut*Ot)*Jn,e[11]=(ie*ir-W*Er-xe*Ot)*Jn,e[12]=(A*Ln-x*Dn-D*cn)*Jn,e[13]=(r*Dn-f*Ln+v*cn)*Jn,e[14]=(ze*Yt-je*Lr-at*Ot)*Jn,e[15]=(W*Lr-ie*Yt+oe*Ot)*Jn,e):null},p.isChar=en,p.isMapboxURL=w,p.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},p.makeRequest=Di,p.mapObject=Gt,p.mercatorXfromLng=Ip,p.mercatorYfromLat=sd,p.mercatorZfromAltitude=ud,p.mul=Ro,p.multiply=Lo,p.mvt=wo,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],m=r*r+f*f+v*v;return m>0&&(m=1/Math.sqrt(m)),e[0]=t[0]*m,e[1]=t[1]*m,e[2]=t[2]*m,e},p.number=ba,p.offscreenCanvasSupported=ar,p.ortho=function(e,t,r,f,v,m,x){var A=1/(t-r),D=1/(f-v),z=1/(m-x);return e[0]=-2*A,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*D,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*z,e[11]=0,e[12]=(t+r)*A,e[13]=(v+f)*D,e[14]=(x+m)*z,e[15]=1,e},p.parseGlyphPBF=function(e){return new fe(e).readFields(Pr,[])},p.pbf=fe,p.performSymbolLayout=function(e,t,r,f,v,m,x){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var A=e.layers[0].layout,D=e.layers[0]._unevaluatedLayout._values,z={};if(e.textSizeData.kind==="composite"){var W=e.textSizeData,ie=W.maxZoom;z.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Oi(W.minZoom),x),D["text-size"].possiblyEvaluate(new Oi(ie),x)]}if(e.iconSizeData.kind==="composite"){var oe=e.iconSizeData,xe=oe.maxZoom;z.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Oi(oe.minZoom),x),D["icon-size"].possiblyEvaluate(new Oi(xe),x)]}z.layoutTextSize=D["text-size"].possiblyEvaluate(new Oi(e.zoom+1),x),z.layoutIconSize=D["icon-size"].possiblyEvaluate(new Oi(e.zoom+1),x),z.textMaxSize=D["text-size"].possiblyEvaluate(new Oi(18));for(var je=24*A.get("text-line-height"),ze=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",at=A.get("text-keep-upright"),ut=A.get("text-size"),Ot=function(){var Er=ir[Yt],tn=A.get("text-font").evaluate(Er,{},x).join(","),cn=ut.evaluate(Er,{},x),Ln=z.layoutTextSize.evaluate(Er,{},x),Gn=z.layoutIconSize.evaluate(Er,{},x),Dn={horizontal:{},vertical:void 0},xn=Er.text,ei=[0,0];if(xn){var Jn=xn.toString(),Hn=24*A.get("text-letter-spacing").evaluate(Er,{},x),Hi=function(va){for(var ia=0,Va=va;ia<Va.length;ia+=1)if(Da=Va[ia].charCodeAt(0),en.Arabic(Da)||en["Arabic Supplement"](Da)||en["Arabic Extended-A"](Da)||en["Arabic Presentation Forms-A"](Da)||en["Arabic Presentation Forms-B"](Da))return!1;var Da;return!0}(Jn)?Hn:0,Ti=A.get("text-anchor").evaluate(Er,{},x),Ea=A.get("text-variable-anchor");if(!Ea){var li=A.get("text-radial-offset").evaluate(Er,{},x);ei=li?ht(Ti,[24*li,be]):A.get("text-offset").evaluate(Er,{},x).map(function(va){return 24*va})}var Xi=ze?"center":A.get("text-justify").evaluate(Er,{},x),eo=A.get("symbol-placement"),to=eo==="point"?24*A.get("text-max-width").evaluate(Er,{},x):0,Ao=function(){e.allowVerticalPlacement&&Xc(Jn)&&(Dn.vertical=Dr(xn,t,r,v,tn,to,je,Ti,"left",Hi,ei,$n.vertical,!0,eo,Ln,cn))};if(!ze&&Ea){for(var po=Xi==="auto"?Ea.map(function(va){return zt(va)}):[Xi],Do=!1,Js=0;Js<po.length;Js++){var bs=po[Js];if(!Dn.horizontal[bs])if(Do)Dn.horizontal[bs]=Dn.horizontal[0];else{var du=Dr(xn,t,r,v,tn,to,je,"center",bs,Hi,ei,$n.horizontal,!1,eo,Ln,cn);du&&(Dn.horizontal[bs]=du,Do=du.positionedLines.length===1)}}Ao()}else{Xi==="auto"&&(Xi=zt(Ti));var Ls=Dr(xn,t,r,v,tn,to,je,Ti,Xi,Hi,ei,$n.horizontal,!1,eo,Ln,cn);Ls&&(Dn.horizontal[Xi]=Ls),Ao(),Xc(Jn)&&ze&&at&&(Dn.vertical=Dr(xn,t,r,v,tn,to,je,Ti,Xi,Hi,ei,$n.vertical,!1,eo,Ln,cn))}}var au=void 0,Ss=!1;if(Er.icon&&Er.icon.name){var Rs=f[Er.icon.name];Rs&&(au=function(va,ia,Va){var Da=Qo(Va),vu=ia[0]-va.displaySize[0]*Da.horizontalAlign,Ka=ia[1]-va.displaySize[1]*Da.verticalAlign;return{image:va,top:Ka,bottom:Ka+va.displaySize[1],left:vu,right:vu+va.displaySize[0]}}(v[Er.icon.name],A.get("icon-offset").evaluate(Er,{},x),A.get("icon-anchor").evaluate(Er,{},x)),Ss=Rs.sdf,e.sdfIcons===void 0?e.sdfIcons=Rs.sdf:e.sdfIcons!==Rs.sdf&&Me("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Rs.pixelRatio!==e.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Us=vt(Dn.horizontal)||Dn.vertical;e.iconsInText=!!Us&&Us.iconsInText,(Us||au)&&function(va,ia,Va,Da,vu,Ka,vo,ou,ca,vf,$l){var Lc=Ka.textMaxSize.evaluate(ia,{});Lc===void 0&&(Lc=vo);var Ku,Qs=va.layers[0].layout,mf=Qs.get("icon-offset").evaluate(ia,{},$l),Rc=vt(Va.horizontal),tf=vo/24,Yu=va.tilePixelRatio*tf,fc=va.tilePixelRatio*Lc/24,oh=va.tilePixelRatio*ou,Oh=va.tilePixelRatio*Qs.get("symbol-spacing"),sh=Qs.get("text-padding")*va.tilePixelRatio,Gf=Qs.get("icon-padding")*va.tilePixelRatio,Hf=Qs.get("text-max-angle")/180*Math.PI,Lh=Qs.get("text-rotation-alignment")==="map"&&Qs.get("symbol-placement")!=="point",Of=Qs.get("icon-rotation-alignment")==="map"&&Qs.get("symbol-placement")!=="point",gf=Qs.get("symbol-placement"),uh=Oh/2,lh=Qs.get("icon-text-fit");Da&&lh!=="none"&&(va.allowVerticalPlacement&&Va.vertical&&(Ku=ea(Da,Va.vertical,lh,Qs.get("icon-text-fit-padding"),mf,tf)),Rc&&(Da=ea(Da,Rc,lh,Qs.get("icon-text-fit-padding"),mf,tf)));var Dc=function(pd,mh){mh.x<0||mh.x>=8192||mh.y<0||mh.y>=8192||function(Go,kc,zd,Rf,Fp,dd,Nh,nf,zh,gh,Bh,pp,Np,zp,Uh,vd,md,dp,Bd,Bp,ul,jh,vp,hc,ll){var mp,pc,Zh,Xf,yh,Vh=Go.addToLineVertexArray(kc,zd),Gh=0,_h=0,Up=0,jp=0,gp=-1,_f=-1,Fc={},Hh=$e(""),Zp=0,Vp=0;if(nf._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Zp=(mp=nf.layout.get("text-offset").evaluate(ul,{},hc).map(function(Wh){return 24*Wh}))[0],Vp=mp[1]):(Zp=24*nf.layout.get("text-radial-offset").evaluate(ul,{},hc),Vp=be),Go.allowVerticalPlacement&&Rf.vertical){var Kf=nf.layout.get("text-rotate").evaluate(ul,{},hc)+90;Xf=new We(zh,kc,gh,Bh,pp,Rf.vertical,Np,zp,Uh,Kf),Nh&&(yh=new We(zh,kc,gh,Bh,pp,Nh,md,dp,Uh,Kf))}if(Fp){var Gp=nf.layout.get("icon-rotate").evaluate(ul,{}),gd=nf.layout.get("icon-text-fit")!=="none",Ud=Li(Fp,Gp,vp,gd),yd=Nh?Li(Nh,Gp,vp,gd):void 0;Zh=new We(zh,kc,gh,Bh,pp,Fp,md,dp,!1,Gp),Gh=4*Ud.length;var jd=Go.iconSizeData,yp=null;jd.kind==="source"?(yp=[128*nf.layout.get("icon-size").evaluate(ul,{})])[0]>32640&&Me(Go.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):jd.kind==="composite"&&((yp=[128*jh.compositeIconSizes[0].evaluate(ul,{},hc),128*jh.compositeIconSizes[1].evaluate(ul,{},hc)])[0]>32640||yp[1]>32640)&&Me(Go.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Go.addSymbols(Go.icon,Ud,yp,Bp,Bd,ul,!1,kc,Vh.lineStartIndex,Vh.lineLength,-1,hc),gp=Go.icon.placedSymbolArray.length-1,yd&&(_h=4*yd.length,Go.addSymbols(Go.icon,yd,yp,Bp,Bd,ul,$n.vertical,kc,Vh.lineStartIndex,Vh.lineLength,-1,hc),_f=Go.icon.placedSymbolArray.length-1)}for(var Zd in Rf.horizontal){var Hp=Rf.horizontal[Zd];if(!pc){Hh=$e(Hp.text);var av=nf.layout.get("text-rotate").evaluate(ul,{},hc);pc=new We(zh,kc,gh,Bh,pp,Hp,Np,zp,Uh,av)}var Wp=Hp.positionedLines.length===1;if(Up+=Zt(Go,kc,Hp,dd,nf,Uh,ul,vd,Vh,Rf.vertical?$n.horizontal:$n.horizontalOnly,Wp?Object.keys(Rf.horizontal):[Zd],Fc,gp,jh,hc),Wp)break}Rf.vertical&&(jp+=Zt(Go,kc,Rf.vertical,dd,nf,Uh,ul,vd,Vh,$n.vertical,["vertical"],Fc,_f,jh,hc));var Xp=pc?pc.boxStartIndex:Go.collisionBoxArray.length,ov=pc?pc.boxEndIndex:Go.collisionBoxArray.length,_d=Xf?Xf.boxStartIndex:Go.collisionBoxArray.length,Vd=Xf?Xf.boxEndIndex:Go.collisionBoxArray.length,sv=Zh?Zh.boxStartIndex:Go.collisionBoxArray.length,xd=Zh?Zh.boxEndIndex:Go.collisionBoxArray.length,Gd=yh?yh.boxStartIndex:Go.collisionBoxArray.length,uv=yh?yh.boxEndIndex:Go.collisionBoxArray.length,Nc=-1,_p=function(Kp,Wd){return Kp&&Kp.circleDiameter?Math.max(Kp.circleDiameter,Wd):Wd};Nc=_p(pc,Nc),Nc=_p(Xf,Nc),Nc=_p(Zh,Nc);var Hd=(Nc=_p(yh,Nc))>-1?1:0;Hd&&(Nc*=ll/24),Go.glyphOffsetArray.length>=ur.MAX_GLYPHS&&Me("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ul.sortKey!==void 0&&Go.addToSortKeyRanges(Go.symbolInstances.length,ul.sortKey),Go.symbolInstances.emplaceBack(kc.x,kc.y,Fc.right>=0?Fc.right:-1,Fc.center>=0?Fc.center:-1,Fc.left>=0?Fc.left:-1,Fc.vertical||-1,gp,_f,Hh,Xp,ov,_d,Vd,sv,xd,Gd,uv,gh,Up,jp,Gh,_h,Hd,0,Np,Zp,Vp,Nc)}(va,mh,pd,Va,Da,vu,Ku,va.layers[0],va.collisionBoxArray,ia.index,ia.sourceLayerIndex,va.index,Yu,sh,Lh,ca,oh,Gf,Of,mf,ia,Ka,vf,$l,vo)};if(gf==="line")for(var rf=0,lp=ui(ia.geometry,0,0,8192,8192);rf<lp.length;rf+=1)for(var cp=lp[rf],ch=0,fp=wa(cp,Oh,Hf,Va.vertical||Rc,Da,24,fc,va.overscaling,8192);ch<fp.length;ch+=1){var Rh=fp[ch];Rc&&pt(va,Rc.text,uh,Rh)||Dc(cp,Rh)}else if(gf==="line-center")for(var fh=0,Dh=ia.geometry;fh<Dh.length;fh+=1){var hh=Dh[fh];if(hh.length>1){var ph=Ks(hh,Hf,Va.vertical||Rc,Da,24,fc);ph&&Dc(hh,ph)}}else if(ia.type==="Polygon")for(var dh=0,Wf=Et(ia.geometry,0);dh<Wf.length;dh+=1){var kh=Wf[dh],yf=Pn(kh,16);Dc(kh[0],new To(yf.x,yf.y,0))}else if(ia.type==="LineString")for(var Lf=0,vh=ia.geometry;Lf<vh.length;Lf+=1){var Rp=vh[Lf];Dc(Rp,new To(Rp[0].x,Rp[0].y,0))}else if(ia.type==="Point")for(var Dp=0,hd=ia.geometry;Dp<hd.length;Dp+=1)for(var kp=0,Fh=hd[Dp];kp<Fh.length;kp+=1){var hp=Fh[kp];Dc([hp],new To(hp.x,hp.y,0))}}(e,Er,Dn,au,f,z,Ln,Gn,ei,Ss,x)},Yt=0,ir=e.features;Yt<ir.length;Yt+=1)Ot();m&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,r,f,v){var m,x=1/Math.tan(t/2);return e[0]=x/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(m=1/(f-v)),e[14]=2*v*f*m):(e[10]=-1,e[14]=-2*f),e},p.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},p.plugin=Ts,p.polygonIntersectsPolygon=Wu,p.postMapLoadEvent=et,p.postTurnstileEvent=Ar,p.potpack=Br,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=Tn,p.registerForPluginStateChange=function(e){return e({pluginStatus:Wo,pluginURL:Cu}),Kc.on("pluginStateChange",e),e},p.renderColorRamp=Jf,p.rotate=function(e,t,r){var f=t[0],v=t[1],m=t[2],x=t[3],A=Math.sin(r),D=Math.cos(r);return e[0]=f*D+m*A,e[1]=v*D+x*A,e[2]=f*-A+m*D,e[3]=v*-A+x*D,e},p.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),m=t[4],x=t[5],A=t[6],D=t[7],z=t[8],W=t[9],ie=t[10],oe=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=m*v+z*f,e[5]=x*v+W*f,e[6]=A*v+ie*f,e[7]=D*v+oe*f,e[8]=z*v-m*f,e[9]=W*v-x*f,e[10]=ie*v-A*f,e[11]=oe*v-D*f,e},p.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),m=t[0],x=t[1],A=t[2],D=t[3],z=t[4],W=t[5],ie=t[6],oe=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=m*v+z*f,e[1]=x*v+W*f,e[2]=A*v+ie*f,e[3]=D*v+oe*f,e[4]=z*v-m*f,e[5]=W*v-x*f,e[6]=ie*v-A*f,e[7]=oe*v-D*f,e},p.scale=function(e,t,r){var f=r[0],v=r[1],m=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*m,e[9]=t[9]*m,e[10]=t[10]*m,e[11]=t[11]*m,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},p.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},p.setCacheLimits=function(e,t){gt=e,dt=t},p.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Wo==="deferred"||Wo==="loading"||Wo==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Cu=Nr.resolveURL(e),Wo="deferred",Au=t,yl(),r||ws()},p.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},p.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},p.styleSpec=he,p.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p.symbolSize=Os,p.transformMat3=function(e,t,r){var f=t[0],v=t[1],m=t[2];return e[0]=f*r[0]+v*r[3]+m*r[6],e[1]=f*r[1]+v*r[4]+m*r[7],e[2]=f*r[2]+v*r[5]+m*r[8],e},p.transformMat4=Ws,p.translate=function(e,t,r){var f,v,m,x,A,D,z,W,ie,oe,xe,je,ze=r[0],at=r[1],ut=r[2];return t===e?(e[12]=t[0]*ze+t[4]*at+t[8]*ut+t[12],e[13]=t[1]*ze+t[5]*at+t[9]*ut+t[13],e[14]=t[2]*ze+t[6]*at+t[10]*ut+t[14],e[15]=t[3]*ze+t[7]*at+t[11]*ut+t[15]):(v=t[1],m=t[2],x=t[3],A=t[4],D=t[5],z=t[6],W=t[7],ie=t[8],oe=t[9],xe=t[10],je=t[11],e[0]=f=t[0],e[1]=v,e[2]=m,e[3]=x,e[4]=A,e[5]=D,e[6]=z,e[7]=W,e[8]=ie,e[9]=oe,e[10]=xe,e[11]=je,e[12]=f*ze+A*at+ie*ut+t[12],e[13]=v*ze+D*at+oe*ut+t[13],e[14]=m*ze+z*at+xe*ut+t[14],e[15]=x*ze+W*at+je*ut+t[15]),e},p.triggerPluginCompletionEvent=il,p.uniqueId=Qe,p.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=wf,p.validateStyle=rc,p.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},p.vectorTile=wo,p.version="1.13.1",p.warnOnce=Me,p.webpSupported=se,p.window=q,p.wrap=Nt}),b(["./shared"],function(p){"use strict";function G($){var I=typeof $;if(I==="number"||I==="boolean"||I==="string"||$==null)return JSON.stringify($);if(Array.isArray($)){for(var j="[",Y=0,ue=$;Y<ue.length;Y+=1)j+=G(ue[Y])+",";return j+"]"}for(var De=Object.keys($).sort(),He="{",he=0;he<De.length;he++)He+=JSON.stringify(De[he])+":"+G($[De[he]])+",";return He+"}"}function S($){for(var I="",j=0,Y=p.refProperties;j<Y.length;j+=1)I+="/"+G($[Y[j]]);return I}var F=function(I){this.keyCache={},I&&this.replace(I)};F.prototype.replace=function($){this._layerConfigs={},this._layers={},this.update($,[])},F.prototype.update=function($,I){for(var j=this,Y=0,ue=$;Y<ue.length;Y+=1){var De=ue[Y];this._layerConfigs[De.id]=De;var He=this._layers[De.id]=p.createStyleLayer(De);He._featureFilter=p.featureFilter(He.filter),this.keyCache[De.id]&&delete this.keyCache[De.id]}for(var he=0,Ne=I;he<Ne.length;he+=1){var Ct=Ne[he];delete this.keyCache[Ct],delete this._layerConfigs[Ct],delete this._layers[Ct]}this.familiesBySource={};for(var kr=0,jr=function(ln,fn){for(var ri={},dn=0;dn<ln.length;dn++){var ci=fn&&fn[ln[dn].id]||S(ln[dn]);fn&&(fn[ln[dn].id]=ci);var Bi=ri[ci];Bi||(Bi=ri[ci]=[]),Bi.push(ln[dn])}var pi=[];for(var _i in ri)pi.push(ri[_i]);return pi}(p.values(this._layerConfigs),this.keyCache);kr<jr.length;kr+=1){var $t=jr[kr].map(function(ln){return j._layers[ln.id]}),yr=$t[0];if(yr.visibility!=="none"){var qr=yr.source||"",gn=this.familiesBySource[qr];gn||(gn=this.familiesBySource[qr]={});var dr=yr.sourceLayer||"_geojsonTileLayer",hn=gn[dr];hn||(hn=gn[dr]=[]),hn.push($t)}}};var te=function(I){var j={},Y=[];for(var ue in I){var De=I[ue],He=j[ue]={};for(var he in De){var Ne=De[+he];if(Ne&&Ne.bitmap.width!==0&&Ne.bitmap.height!==0){var Ct={x:0,y:0,w:Ne.bitmap.width+2,h:Ne.bitmap.height+2};Y.push(Ct),He[he]={rect:Ct,metrics:Ne.metrics}}}}var kr=p.potpack(Y),jr=new p.AlphaImage({width:kr.w||1,height:kr.h||1});for(var $t in I){var yr=I[$t];for(var qr in yr){var gn=yr[+qr];if(gn&&gn.bitmap.width!==0&&gn.bitmap.height!==0){var dr=j[$t][qr].rect;p.AlphaImage.copy(gn.bitmap,jr,{x:0,y:0},{x:dr.x+1,y:dr.y+1},gn.bitmap)}}}this.image=jr,this.positions=j};p.register("GlyphAtlas",te);var ce=function(I){this.tileID=new p.OverscaledTileID(I.tileID.overscaledZ,I.tileID.wrap,I.tileID.canonical.z,I.tileID.canonical.x,I.tileID.canonical.y),this.uid=I.uid,this.zoom=I.zoom,this.pixelRatio=I.pixelRatio,this.tileSize=I.tileSize,this.source=I.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=I.showCollisionBoxes,this.collectResourceTiming=!!I.collectResourceTiming,this.returnDependencies=!!I.returnDependencies,this.promoteId=I.promoteId};function q($,I,j){for(var Y=new p.EvaluationParameters(I),ue=0,De=$;ue<De.length;ue+=1)De[ue].recalculate(Y,j)}function we($,I){var j=p.getArrayBuffer($.request,function(Y,ue,De,He){Y?I(Y):ue&&I(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(ue)),rawData:ue,cacheControl:De,expires:He})});return function(){j.cancel(),I()}}ce.prototype.parse=function($,I,j,Y,ue){var De=this;this.status="parsing",this.data=$,this.collisionBoxArray=new p.CollisionBoxArray;var He=new p.DictionaryCoder(Object.keys($.layers).sort()),he=new p.FeatureIndex(this.tileID,this.promoteId);he.bucketLayerIDs=[];var Ne,Ct,kr,jr,$t={},yr={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},qr=I.familiesBySource[this.source];for(var gn in qr){var dr=$.layers[gn];if(dr){dr.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+gn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var hn=He.encode(gn),ln=[],fn=0;fn<dr.length;fn++){var ri=dr.feature(fn),dn=he.getId(ri,gn);ln.push({feature:ri,id:dn,index:fn,sourceLayerIndex:hn})}for(var ci=0,Bi=qr[gn];ci<Bi.length;ci+=1){var pi=Bi[ci],_i=pi[0];_i.minzoom&&this.zoom<Math.floor(_i.minzoom)||_i.maxzoom&&this.zoom>=_i.maxzoom||_i.visibility!=="none"&&(q(pi,this.zoom,j),($t[_i.id]=_i.createBucket({index:he.bucketLayerIDs.length,layers:pi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:hn,sourceID:this.source})).populate(ln,yr,this.tileID.canonical),he.bucketLayerIDs.push(pi.map(function(Fn){return Fn.id})))}}}var Ai=p.mapObject(yr.glyphDependencies,function(Fn){return Object.keys(Fn).map(Number)});Object.keys(Ai).length?Y.send("getGlyphs",{uid:this.uid,stacks:Ai},function(Fn,kn){Ne||(Ne=Fn,Ct=kn,mi.call(De))}):Ct={};var xo=Object.keys(yr.iconDependencies);xo.length?Y.send("getImages",{icons:xo,source:this.source,tileID:this.tileID,type:"icons"},function(Fn,kn){Ne||(Ne=Fn,kr=kn,mi.call(De))}):kr={};var Wi=Object.keys(yr.patternDependencies);function mi(){if(Ne)return ue(Ne);if(Ct&&kr&&jr){var Fn=new te(Ct),kn=new p.ImageAtlas(kr,jr);for(var Zn in $t){var ra=$t[Zn];ra instanceof p.SymbolBucket?(q(ra.layers,this.zoom,j),p.performSymbolLayout(ra,Ct,Fn.positions,kr,kn.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ra.hasPattern&&(ra instanceof p.LineBucket||ra instanceof p.FillBucket||ra instanceof p.FillExtrusionBucket)&&(q(ra.layers,this.zoom,j),ra.addFeatures(yr,this.tileID.canonical,kn.patternPositions))}this.status="done",ue(null,{buckets:p.values($t).filter(function(js){return!js.isEmpty()}),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Fn.image,imageAtlas:kn,glyphMap:this.returnDependencies?Ct:null,iconMap:this.returnDependencies?kr:null,glyphPositions:this.returnDependencies?Fn.positions:null})}}Wi.length?Y.send("getImages",{icons:Wi,source:this.source,tileID:this.tileID,type:"patterns"},function(Fn,kn){Ne||(Ne=Fn,jr=kn,mi.call(De))}):jr={},mi.call(this)};var Pe=function(I,j,Y,ue){this.actor=I,this.layerIndex=j,this.availableImages=Y,this.loadVectorData=ue||we,this.loading={},this.loaded={}};Pe.prototype.loadTile=function($,I){var j=this,Y=$.uid;this.loading||(this.loading={});var ue=!!($&&$.request&&$.request.collectResourceTiming)&&new p.RequestPerformance($.request),De=this.loading[Y]=new ce($);De.abort=this.loadVectorData($,function(He,he){if(delete j.loading[Y],He||!he)return De.status="done",j.loaded[Y]=De,I(He);var Ne=he.rawData,Ct={};he.expires&&(Ct.expires=he.expires),he.cacheControl&&(Ct.cacheControl=he.cacheControl);var kr={};if(ue){var jr=ue.finish();jr&&(kr.resourceTiming=JSON.parse(JSON.stringify(jr)))}De.vectorTile=he.vectorTile,De.parse(he.vectorTile,j.layerIndex,j.availableImages,j.actor,function($t,yr){if($t||!yr)return I($t);I(null,p.extend({rawTileData:Ne.slice(0)},yr,Ct,kr))}),j.loaded=j.loaded||{},j.loaded[Y]=De})},Pe.prototype.reloadTile=function($,I){var j=this,Y=this.loaded,ue=$.uid,De=this;if(Y&&Y[ue]){var He=Y[ue];He.showCollisionBoxes=$.showCollisionBoxes;var he=function(Ct,kr){var jr=He.reloadCallback;jr&&(delete He.reloadCallback,He.parse(He.vectorTile,De.layerIndex,j.availableImages,De.actor,jr)),I(Ct,kr)};He.status==="parsing"?He.reloadCallback=he:He.status==="done"&&(He.vectorTile?He.parse(He.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}},Pe.prototype.abortTile=function($,I){var j=this.loading,Y=$.uid;j&&j[Y]&&j[Y].abort&&(j[Y].abort(),delete j[Y]),I()},Pe.prototype.removeTile=function($,I){var j=this.loaded,Y=$.uid;j&&j[Y]&&delete j[Y],I()};var Be=p.window.ImageBitmap,Oe=function(){this.loaded={}};function Nt($,I){if($.length!==0){Xt($[0],I);for(var j=1;j<$.length;j++)Xt($[j],!I)}}function Xt($,I){for(var j=0,Y=0,ue=$.length,De=ue-1;Y<ue;De=Y++)j+=($[Y][0]-$[De][0])*($[De][1]+$[Y][1]);j>=0!=!!I&&$.reverse()}Oe.prototype.loadTile=function($,I){var j=$.uid,Y=$.encoding,ue=$.rawImageData,De=Be&&ue instanceof Be?this.getImageData(ue):ue,He=new p.DEMData(j,De,Y);this.loaded=this.loaded||{},this.loaded[j]=He,I(null,He)},Oe.prototype.getImageData=function($){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);var I=this.offscreenCanvasContext.getImageData(-1,-1,$.width+2,$.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:I.width,height:I.height},I.data)},Oe.prototype.removeTile=function($){var I=this.loaded,j=$.uid;I&&I[j]&&delete I[j]};var Bt=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,Qe=function(I){this._feature=I,this.extent=p.EXTENT,this.type=I.type,this.properties=I.tags,"id"in I&&!isNaN(I.id)&&(this.id=parseInt(I.id,10))};Qe.prototype.loadGeometry=function(){if(this._feature.type===1){for(var $=[],I=0,j=this._feature.geometry;I<j.length;I+=1){var Y=j[I];$.push([new p.Point$1(Y[0],Y[1])])}return $}for(var ue=[],De=0,He=this._feature.geometry;De<He.length;De+=1){for(var he=[],Ne=0,Ct=He[De];Ne<Ct.length;Ne+=1){var kr=Ct[Ne];he.push(new p.Point$1(kr[0],kr[1]))}ue.push(he)}return ue},Qe.prototype.toGeoJSON=function($,I,j){return Bt.call(this,$,I,j)};var xt=function(I){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=I.length,this._features=I};xt.prototype.feature=function($){return new Qe(this._features[$])};var nt=p.vectorTile.VectorTileFeature,cr=At;function At($,I){this.options=I||{},this.features=$,this.length=$.length}function Gt($,I){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=I||4096}At.prototype.feature=function($){return new Gt(this.features[$],this.options.extent)},Gt.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var I=0;I<$.length;I++){for(var j=$[I],Y=[],ue=0;ue<j.length;ue++)Y.push(new p.Point$1(j[ue][0],j[ue][1]));this.geometry.push(Y)}return this.geometry},Gt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,I=1/0,j=-1/0,Y=1/0,ue=-1/0,De=0;De<$.length;De++)for(var He=$[De],he=0;he<He.length;he++){var Ne=He[he];I=Math.min(I,Ne.x),j=Math.max(j,Ne.x),Y=Math.min(Y,Ne.y),ue=Math.max(ue,Ne.y)}return[I,Y,j,ue]},Gt.prototype.toGeoJSON=nt.prototype.toGeoJSON;var St=yt,Ze=cr;function yt($){var I=new p.pbf;return function(j,Y){for(var ue in j.layers)Y.writeMessage(3,Me,j.layers[ue])}($,I),I.finish()}function Me($,I){var j;I.writeVarintField(15,$.version||1),I.writeStringField(1,$.name||""),I.writeVarintField(5,$.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<$.length;j++)Y.feature=$.feature(j),I.writeMessage(2,Te,Y);var ue=Y.keys;for(j=0;j<ue.length;j++)I.writeStringField(3,ue[j]);var De=Y.values;for(j=0;j<De.length;j++)I.writeMessage(4,Ee,De[j])}function Te($,I){var j=$.feature;j.id!==void 0&&I.writeVarintField(1,j.id),I.writeMessage(2,Ie,$),I.writeVarintField(3,j.type),I.writeMessage(4,ae,j)}function Ie($,I){var j=$.feature,Y=$.keys,ue=$.values,De=$.keycache,He=$.valuecache;for(var he in j.properties){var Ne=De[he];Ne===void 0&&(Y.push(he),De[he]=Ne=Y.length-1),I.writeVarint(Ne);var Ct=j.properties[he],kr=typeof Ct;kr!=="string"&&kr!=="boolean"&&kr!=="number"&&(Ct=JSON.stringify(Ct));var jr=kr+":"+Ct,$t=He[jr];$t===void 0&&(ue.push(Ct),He[jr]=$t=ue.length-1),I.writeVarint($t)}}function bt($,I){return(I<<3)+(7&$)}function tr($){return $<<1^$>>31}function ae($,I){for(var j=$.loadGeometry(),Y=$.type,ue=0,De=0,He=j.length,he=0;he<He;he++){var Ne=j[he],Ct=1;Y===1&&(Ct=Ne.length),I.writeVarint(bt(1,Ct));for(var kr=Y===3?Ne.length-1:Ne.length,jr=0;jr<kr;jr++){jr===1&&Y!==1&&I.writeVarint(bt(2,kr-1));var $t=Ne[jr].x-ue,yr=Ne[jr].y-De;I.writeVarint(tr($t)),I.writeVarint(tr(yr)),ue+=$t,De+=yr}Y===3&&I.writeVarint(bt(7,1))}}function Ee($,I){var j=typeof $;j==="string"?I.writeStringField(1,$):j==="boolean"?I.writeBooleanField(7,$):j==="number"&&($%1!=0?I.writeDoubleField(3,$):$<0?I.writeSVarintField(6,$):I.writeVarintField(5,$))}function le($,I,j,Y){Q($,j,Y),Q(I,2*j,2*Y),Q(I,2*j+1,2*Y+1)}function Q($,I,j){var Y=$[I];$[I]=$[j],$[j]=Y}function re($,I,j,Y){var ue=$-j,De=I-Y;return ue*ue+De*De}St.fromVectorTileJs=yt,St.fromGeojsonVt=function($,I){I=I||{};var j={};for(var Y in $)j[Y]=new cr($[Y].features,I),j[Y].name=Y,j[Y].version=I.version,j[Y].extent=I.extent;return yt({layers:j})},St.GeoJSONWrapper=Ze;var ke=function(I){return I[0]},qe=function(I){return I[1]},Wt=function(I,j,Y,ue,De){j===void 0&&(j=ke),Y===void 0&&(Y=qe),ue===void 0&&(ue=64),De===void 0&&(De=Float64Array),this.nodeSize=ue,this.points=I;for(var He=I.length<65536?Uint16Array:Uint32Array,he=this.ids=new He(I.length),Ne=this.coords=new De(2*I.length),Ct=0;Ct<I.length;Ct++)he[Ct]=Ct,Ne[2*Ct]=j(I[Ct]),Ne[2*Ct+1]=Y(I[Ct]);(function kr(jr,$t,yr,qr,gn,dr){if(!(gn-qr<=yr)){var hn=qr+gn>>1;(function ln(fn,ri,dn,ci,Bi,pi){for(;Bi>ci;){if(Bi-ci>600){var _i=Bi-ci+1,Ai=dn-ci+1,xo=Math.log(_i),Wi=.5*Math.exp(2*xo/3),mi=.5*Math.sqrt(xo*Wi*(_i-Wi)/_i)*(Ai-_i/2<0?-1:1);ln(fn,ri,dn,Math.max(ci,Math.floor(dn-Ai*Wi/_i+mi)),Math.min(Bi,Math.floor(dn+(_i-Ai)*Wi/_i+mi)),pi)}var Fn=ri[2*dn+pi],kn=ci,Zn=Bi;for(le(fn,ri,ci,dn),ri[2*Bi+pi]>Fn&&le(fn,ri,ci,Bi);kn<Zn;){for(le(fn,ri,kn,Zn),kn++,Zn--;ri[2*kn+pi]<Fn;)kn++;for(;ri[2*Zn+pi]>Fn;)Zn--}ri[2*ci+pi]===Fn?le(fn,ri,ci,Zn):le(fn,ri,++Zn,Bi),Zn<=dn&&(ci=Zn+1),dn<=Zn&&(Bi=Zn-1)}})(jr,$t,hn,qr,gn,dr%2),kr(jr,$t,yr,qr,hn-1,dr+1),kr(jr,$t,yr,hn+1,gn,dr+1)}})(he,Ne,ue,0,he.length-1,0)};Wt.prototype.range=function($,I,j,Y){return function(ue,De,He,he,Ne,Ct,kr){for(var jr,$t,yr=[0,ue.length-1,0],qr=[];yr.length;){var gn=yr.pop(),dr=yr.pop(),hn=yr.pop();if(dr-hn<=kr)for(var ln=hn;ln<=dr;ln++)$t=De[2*ln+1],(jr=De[2*ln])>=He&&jr<=Ne&&$t>=he&&$t<=Ct&&qr.push(ue[ln]);else{var fn=Math.floor((hn+dr)/2);$t=De[2*fn+1],(jr=De[2*fn])>=He&&jr<=Ne&&$t>=he&&$t<=Ct&&qr.push(ue[fn]);var ri=(gn+1)%2;(gn===0?He<=jr:he<=$t)&&(yr.push(hn),yr.push(fn-1),yr.push(ri)),(gn===0?Ne>=jr:Ct>=$t)&&(yr.push(fn+1),yr.push(dr),yr.push(ri))}}return qr}(this.ids,this.coords,$,I,j,Y,this.nodeSize)},Wt.prototype.within=function($,I,j){return function(Y,ue,De,He,he,Ne){for(var Ct=[0,Y.length-1,0],kr=[],jr=he*he;Ct.length;){var $t=Ct.pop(),yr=Ct.pop(),qr=Ct.pop();if(yr-qr<=Ne)for(var gn=qr;gn<=yr;gn++)re(ue[2*gn],ue[2*gn+1],De,He)<=jr&&kr.push(Y[gn]);else{var dr=Math.floor((qr+yr)/2),hn=ue[2*dr],ln=ue[2*dr+1];re(hn,ln,De,He)<=jr&&kr.push(Y[dr]);var fn=($t+1)%2;($t===0?De-he<=hn:He-he<=ln)&&(Ct.push(qr),Ct.push(dr-1),Ct.push(fn)),($t===0?De+he>=hn:He+he>=ln)&&(Ct.push(dr+1),Ct.push(yr),Ct.push(fn))}}return kr}(this.ids,this.coords,$,I,j,this.nodeSize)};var Or={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(I){return I}},wr=function(I){this.options=Rt(Object.create(Or),I),this.trees=new Array(this.options.maxZoom+1)};function Nr($,I,j,Y,ue){return{x:$,y:I,zoom:1/0,id:j,parentId:-1,numPoints:Y,properties:ue}}function Vt($,I){var j=$.geometry.coordinates,Y=j[1];return{x:Le(j[0]),y:ot(Y),zoom:1/0,index:I,parentId:-1}}function se($){return{type:"Feature",id:$.id,properties:_e($),geometry:{type:"Point",coordinates:[(Y=$.x,360*(Y-.5)),(I=$.y,j=(180-360*I)*Math.PI/180,360*Math.atan(Math.exp(j))/Math.PI-90)]}};var I,j,Y}function _e($){var I=$.numPoints,j=I>=1e4?Math.round(I/1e3)+"k":I>=1e3?Math.round(I/100)/10+"k":I;return Rt(Rt({},$.properties),{cluster:!0,cluster_id:$.id,point_count:I,point_count_abbreviated:j})}function Le($){return $/360+.5}function ot($){var I=Math.sin($*Math.PI/180),j=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return j<0?0:j>1?1:j}function Rt($,I){for(var j in I)$[j]=I[j];return $}function jt($){return $.x}function w($){return $.y}function N($,I,j,Y,ue,De){var He=ue-j,he=De-Y;if(He!==0||he!==0){var Ne=(($-j)*He+(I-Y)*he)/(He*He+he*he);Ne>1?(j=ue,Y=De):Ne>0&&(j+=He*Ne,Y+=he*Ne)}return(He=$-j)*He+(he=I-Y)*he}function ve($,I,j,Y){var ue={id:$===void 0?null:$,type:I,geometry:j,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(De){var He=De.geometry,he=De.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")Ae(De,He);else if(he==="Polygon"||he==="MultiLineString")for(var Ne=0;Ne<He.length;Ne++)Ae(De,He[Ne]);else if(he==="MultiPolygon")for(Ne=0;Ne<He.length;Ne++)for(var Ct=0;Ct<He[Ne].length;Ct++)Ae(De,He[Ne][Ct])}(ue),ue}function Ae($,I){for(var j=0;j<I.length;j+=3)$.minX=Math.min($.minX,I[j]),$.minY=Math.min($.minY,I[j+1]),$.maxX=Math.max($.maxX,I[j]),$.maxY=Math.max($.maxY,I[j+1])}function Je($,I,j,Y){if(I.geometry){var ue=I.geometry.coordinates,De=I.geometry.type,He=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),he=[],Ne=I.id;if(j.promoteId?Ne=I.properties[j.promoteId]:j.generateId&&(Ne=Y||0),De==="Point")st(ue,he);else if(De==="MultiPoint")for(var Ct=0;Ct<ue.length;Ct++)st(ue[Ct],he);else if(De==="LineString")Lt(ue,he,He,!1);else if(De==="MultiLineString"){if(j.lineMetrics){for(Ct=0;Ct<ue.length;Ct++)Lt(ue[Ct],he=[],He,!1),$.push(ve(Ne,"LineString",he,I.properties));return}X(ue,he,He,!1)}else if(De==="Polygon")X(ue,he,He,!0);else{if(De!=="MultiPolygon"){if(De==="GeometryCollection"){for(Ct=0;Ct<I.geometry.geometries.length;Ct++)Je($,{id:Ne,geometry:I.geometry.geometries[Ct],properties:I.properties},j,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ct=0;Ct<ue.length;Ct++){var kr=[];X(ue[Ct],kr,He,!0),he.push(kr)}}$.push(ve(Ne,De,he,I.properties))}}function st($,I){I.push(Tt($[0])),I.push(Kt($[1])),I.push(0)}function Lt($,I,j,Y){for(var ue,De,He=0,he=0;he<$.length;he++){var Ne=Tt($[he][0]),Ct=Kt($[he][1]);I.push(Ne),I.push(Ct),I.push(0),he>0&&(He+=Y?(ue*Ct-Ne*De)/2:Math.sqrt(Math.pow(Ne-ue,2)+Math.pow(Ct-De,2))),ue=Ne,De=Ct}var kr=I.length-3;I[2]=1,function jr($t,yr,qr,gn){for(var dr,hn=gn,ln=qr-yr>>1,fn=qr-yr,ri=$t[yr],dn=$t[yr+1],ci=$t[qr],Bi=$t[qr+1],pi=yr+3;pi<qr;pi+=3){var _i=N($t[pi],$t[pi+1],ri,dn,ci,Bi);if(_i>hn)dr=pi,hn=_i;else if(_i===hn){var Ai=Math.abs(pi-ln);Ai<fn&&(dr=pi,fn=Ai)}}hn>gn&&(dr-yr>3&&jr($t,yr,dr,gn),$t[dr+2]=hn,qr-dr>3&&jr($t,dr,qr,gn))}(I,0,kr,j),I[kr+2]=1,I.size=Math.abs(He),I.start=0,I.end=I.size}function X($,I,j,Y){for(var ue=0;ue<$.length;ue++){var De=[];Lt($[ue],De,j,Y),I.push(De)}}function Tt($){return $/360+.5}function Kt($){var I=Math.sin($*Math.PI/180),j=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return j<0?0:j>1?1:j}function hr($,I,j,Y,ue,De,He,he){if(Y/=I,De>=(j/=I)&&He<Y)return $;if(He<j||De>=Y)return null;for(var Ne=[],Ct=0;Ct<$.length;Ct++){var kr=$[Ct],jr=kr.geometry,$t=kr.type,yr=ue===0?kr.minX:kr.minY,qr=ue===0?kr.maxX:kr.maxY;if(yr>=j&&qr<Y)Ne.push(kr);else if(!(qr<j||yr>=Y)){var gn=[];if($t==="Point"||$t==="MultiPoint")_r(jr,gn,j,Y,ue);else if($t==="LineString")Ar(jr,gn,j,Y,ue,!1,he.lineMetrics);else if($t==="MultiLineString")et(jr,gn,j,Y,ue,!1);else if($t==="Polygon")et(jr,gn,j,Y,ue,!0);else if($t==="MultiPolygon")for(var dr=0;dr<jr.length;dr++){var hn=[];et(jr[dr],hn,j,Y,ue,!0),hn.length&&gn.push(hn)}if(gn.length){if(he.lineMetrics&&$t==="LineString"){for(dr=0;dr<gn.length;dr++)Ne.push(ve(kr.id,$t,gn[dr],kr.tags));continue}$t!=="LineString"&&$t!=="MultiLineString"||(gn.length===1?($t="LineString",gn=gn[0]):$t="MultiLineString"),$t!=="Point"&&$t!=="MultiPoint"||($t=gn.length===3?"Point":"MultiPoint"),Ne.push(ve(kr.id,$t,gn,kr.tags))}}}return Ne.length?Ne:null}function _r($,I,j,Y,ue){for(var De=0;De<$.length;De+=3){var He=$[De+ue];He>=j&&He<=Y&&(I.push($[De]),I.push($[De+1]),I.push($[De+2]))}}function Ar($,I,j,Y,ue,De,He){for(var he,Ne,Ct=Rr($),kr=ue===0?dt:fr,jr=$.start,$t=0;$t<$.length-3;$t+=3){var yr=$[$t],qr=$[$t+1],gn=$[$t+2],dr=$[$t+3],hn=$[$t+4],ln=ue===0?yr:qr,fn=ue===0?dr:hn,ri=!1;He&&(he=Math.sqrt(Math.pow(yr-dr,2)+Math.pow(qr-hn,2))),ln<j?fn>j&&(Ne=kr(Ct,yr,qr,dr,hn,j),He&&(Ct.start=jr+he*Ne)):ln>Y?fn<Y&&(Ne=kr(Ct,yr,qr,dr,hn,Y),He&&(Ct.start=jr+he*Ne)):gt(Ct,yr,qr,gn),fn<j&&ln>=j&&(Ne=kr(Ct,yr,qr,dr,hn,j),ri=!0),fn>Y&&ln<=Y&&(Ne=kr(Ct,yr,qr,dr,hn,Y),ri=!0),!De&&ri&&(He&&(Ct.end=jr+he*Ne),I.push(Ct),Ct=Rr($)),He&&(jr+=he)}var dn=$.length-3;yr=$[dn],qr=$[dn+1],gn=$[dn+2],(ln=ue===0?yr:qr)>=j&&ln<=Y&&gt(Ct,yr,qr,gn),dn=Ct.length-3,De&&dn>=3&&(Ct[dn]!==Ct[0]||Ct[dn+1]!==Ct[1])&&gt(Ct,Ct[0],Ct[1],Ct[2]),Ct.length&&I.push(Ct)}function Rr($){var I=[];return I.size=$.size,I.start=$.start,I.end=$.end,I}function et($,I,j,Y,ue,De){for(var He=0;He<$.length;He++)Ar($[He],I,j,Y,ue,De,!1)}function gt($,I,j,Y){$.push(I),$.push(j),$.push(Y)}function dt($,I,j,Y,ue,De){var He=(De-I)/(Y-I);return $.push(De),$.push(j+(ue-j)*He),$.push(1),He}function fr($,I,j,Y,ue,De){var He=(De-j)/(ue-j);return $.push(I+(Y-I)*He),$.push(De),$.push(1),He}function $r($,I){for(var j=[],Y=0;Y<$.length;Y++){var ue,De=$[Y],He=De.type;if(He==="Point"||He==="MultiPoint"||He==="LineString")ue=mt(De.geometry,I);else if(He==="MultiLineString"||He==="Polygon"){ue=[];for(var he=0;he<De.geometry.length;he++)ue.push(mt(De.geometry[he],I))}else if(He==="MultiPolygon")for(ue=[],he=0;he<De.geometry.length;he++){for(var Ne=[],Ct=0;Ct<De.geometry[he].length;Ct++)Ne.push(mt(De.geometry[he][Ct],I));ue.push(Ne)}j.push(ve(De.id,He,ue,De.tags))}return j}function mt($,I){var j=[];j.size=$.size,$.start!==void 0&&(j.start=$.start,j.end=$.end);for(var Y=0;Y<$.length;Y+=3)j.push($[Y]+I,$[Y+1],$[Y+2]);return j}function Dt($,I){if($.transformed)return $;var j,Y,ue,De=1<<$.z,He=$.x,he=$.y;for(j=0;j<$.features.length;j++){var Ne=$.features[j],Ct=Ne.geometry,kr=Ne.type;if(Ne.geometry=[],kr===1)for(Y=0;Y<Ct.length;Y+=2)Ne.geometry.push(ar(Ct[Y],Ct[Y+1],I,De,He,he));else for(Y=0;Y<Ct.length;Y++){var jr=[];for(ue=0;ue<Ct[Y].length;ue+=2)jr.push(ar(Ct[Y][ue],Ct[Y][ue+1],I,De,He,he));Ne.geometry.push(jr)}}return $.transformed=!0,$}function ar($,I,j,Y,ue,De){return[Math.round(j*($*Y-ue)),Math.round(j*(I*Y-De))]}function sr($,I,j,Y,ue){for(var De=I===ue.maxZoom?0:ue.tolerance/((1<<I)*ue.extent),He={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:Y,z:I,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<$.length;he++){He.numFeatures++,yn(He,$[he],De,ue);var Ne=$[he].minX,Ct=$[he].minY,kr=$[he].maxX,jr=$[he].maxY;Ne<He.minX&&(He.minX=Ne),Ct<He.minY&&(He.minY=Ct),kr>He.maxX&&(He.maxX=kr),jr>He.maxY&&(He.maxY=jr)}return He}function yn($,I,j,Y){var ue=I.geometry,De=I.type,He=[];if(De==="Point"||De==="MultiPoint")for(var he=0;he<ue.length;he+=3)He.push(ue[he]),He.push(ue[he+1]),$.numPoints++,$.numSimplified++;else if(De==="LineString")_n(He,ue,$,j,!1,!1);else if(De==="MultiLineString"||De==="Polygon")for(he=0;he<ue.length;he++)_n(He,ue[he],$,j,De==="Polygon",he===0);else if(De==="MultiPolygon")for(var Ne=0;Ne<ue.length;Ne++){var Ct=ue[Ne];for(he=0;he<Ct.length;he++)_n(He,Ct[he],$,j,!0,he===0)}if(He.length){var kr=I.tags||null;if(De==="LineString"&&Y.lineMetrics){for(var jr in kr={},I.tags)kr[jr]=I.tags[jr];kr.mapbox_clip_start=ue.start/ue.size,kr.mapbox_clip_end=ue.end/ue.size}var $t={geometry:He,type:De==="Polygon"||De==="MultiPolygon"?3:De==="LineString"||De==="MultiLineString"?2:1,tags:kr};I.id!==null&&($t.id=I.id),$.features.push($t)}}function _n($,I,j,Y,ue,De){var He=Y*Y;if(Y>0&&I.size<(ue?He:Y))j.numPoints+=I.length/3;else{for(var he=[],Ne=0;Ne<I.length;Ne+=3)(Y===0||I[Ne+2]>He)&&(j.numSimplified++,he.push(I[Ne]),he.push(I[Ne+1])),j.numPoints++;ue&&function(Ct,kr){for(var jr=0,$t=0,yr=Ct.length,qr=yr-2;$t<yr;qr=$t,$t+=2)jr+=(Ct[$t]-Ct[qr])*(Ct[$t+1]+Ct[qr+1]);if(jr>0===kr)for($t=0,yr=Ct.length;$t<yr/2;$t+=2){var gn=Ct[$t],dr=Ct[$t+1];Ct[$t]=Ct[yr-2-$t],Ct[$t+1]=Ct[yr-1-$t],Ct[yr-2-$t]=gn,Ct[yr-1-$t]=dr}}(he,De),$.push(he)}}function ai($,I){var j=(I=this.options=function(ue,De){for(var He in De)ue[He]=De[He];return ue}(Object.create(this.options),I)).debug;if(j&&console.time("preprocess data"),I.maxZoom<0||I.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(I.promoteId&&I.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y=function(ue,De){var He=[];if(ue.type==="FeatureCollection")for(var he=0;he<ue.features.length;he++)Je(He,ue.features[he],De,he);else Je(He,ue.type==="Feature"?ue:{geometry:ue},De);return He}($,I);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",I.indexMaxZoom,I.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Y=function(ue,De){var He=De.buffer/De.extent,he=ue,Ne=hr(ue,1,-1-He,He,0,-1,2,De),Ct=hr(ue,1,1-He,2+He,0,-1,2,De);return(Ne||Ct)&&(he=hr(ue,1,-He,1+He,0,-1,2,De)||[],Ne&&(he=$r(Ne,1).concat(he)),Ct&&(he=he.concat($r(Ct,-1)))),he}(Y,I)).length&&this.splitTile(Y,0,0,0),j&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function vi($,I,j){return 32*((1<<$)*j+I)+$}function Di($,I){var j=$.tileID.canonical;if(!this._geoJSONIndex)return I(null,null);var Y=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!Y)return I(null,null);var ue=new xt(Y.features),De=St(ue);De.byteOffset===0&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),I(null,{vectorTile:ue,rawData:De.buffer})}wr.prototype.load=function($){var I=this.options,j=I.log,Y=I.minZoom,ue=I.maxZoom,De=I.nodeSize;j&&console.time("total time");var He="prepare "+$.length+" points";j&&console.time(He),this.points=$;for(var he=[],Ne=0;Ne<$.length;Ne++)$[Ne].geometry&&he.push(Vt($[Ne],Ne));this.trees[ue+1]=new Wt(he,jt,w,De,Float32Array),j&&console.timeEnd(He);for(var Ct=ue;Ct>=Y;Ct--){var kr=+Date.now();he=this._cluster(he,Ct),this.trees[Ct]=new Wt(he,jt,w,De,Float32Array),j&&console.log("z%d: %d clusters in %dms",Ct,he.length,+Date.now()-kr)}return j&&console.timeEnd("total time"),this},wr.prototype.getClusters=function($,I){var j=(($[0]+180)%360+360)%360-180,Y=Math.max(-90,Math.min(90,$[1])),ue=$[2]===180?180:(($[2]+180)%360+360)%360-180,De=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)j=-180,ue=180;else if(j>ue){var He=this.getClusters([j,Y,180,De],I),he=this.getClusters([-180,Y,ue,De],I);return He.concat(he)}for(var Ne=this.trees[this._limitZoom(I)],Ct=[],kr=0,jr=Ne.range(Le(j),ot(De),Le(ue),ot(Y));kr<jr.length;kr+=1){var $t=Ne.points[jr[kr]];Ct.push($t.numPoints?se($t):this.points[$t.index])}return Ct},wr.prototype.getChildren=function($){var I=this._getOriginId($),j=this._getOriginZoom($),Y="No cluster with the specified id.",ue=this.trees[j];if(!ue)throw new Error(Y);var De=ue.points[I];if(!De)throw new Error(Y);for(var He=this.options.radius/(this.options.extent*Math.pow(2,j-1)),he=[],Ne=0,Ct=ue.within(De.x,De.y,He);Ne<Ct.length;Ne+=1){var kr=ue.points[Ct[Ne]];kr.parentId===$&&he.push(kr.numPoints?se(kr):this.points[kr.index])}if(he.length===0)throw new Error(Y);return he},wr.prototype.getLeaves=function($,I,j){var Y=[];return this._appendLeaves(Y,$,I=I||10,j=j||0,0),Y},wr.prototype.getTile=function($,I,j){var Y=this.trees[this._limitZoom($)],ue=Math.pow(2,$),De=this.options,He=De.radius/De.extent,he=(j-He)/ue,Ne=(j+1+He)/ue,Ct={features:[]};return this._addTileFeatures(Y.range((I-He)/ue,he,(I+1+He)/ue,Ne),Y.points,I,j,ue,Ct),I===0&&this._addTileFeatures(Y.range(1-He/ue,he,1,Ne),Y.points,ue,j,ue,Ct),I===ue-1&&this._addTileFeatures(Y.range(0,he,He/ue,Ne),Y.points,-1,j,ue,Ct),Ct.features.length?Ct:null},wr.prototype.getClusterExpansionZoom=function($){for(var I=this._getOriginZoom($)-1;I<=this.options.maxZoom;){var j=this.getChildren($);if(I++,j.length!==1)break;$=j[0].properties.cluster_id}return I},wr.prototype._appendLeaves=function($,I,j,Y,ue){for(var De=0,He=this.getChildren(I);De<He.length;De+=1){var he=He[De],Ne=he.properties;if(Ne&&Ne.cluster?ue+Ne.point_count<=Y?ue+=Ne.point_count:ue=this._appendLeaves($,Ne.cluster_id,j,Y,ue):ue<Y?ue++:$.push(he),$.length===j)break}return ue},wr.prototype._addTileFeatures=function($,I,j,Y,ue,De){for(var He=0,he=$;He<he.length;He+=1){var Ne=I[he[He]],Ct=Ne.numPoints,kr={type:1,geometry:[[Math.round(this.options.extent*(Ne.x*ue-j)),Math.round(this.options.extent*(Ne.y*ue-Y))]],tags:Ct?_e(Ne):this.points[Ne.index].properties},jr=void 0;Ct?jr=Ne.id:this.options.generateId?jr=Ne.index:this.points[Ne.index].id&&(jr=this.points[Ne.index].id),jr!==void 0&&(kr.id=jr),De.features.push(kr)}},wr.prototype._limitZoom=function($){return Math.max(this.options.minZoom,Math.min(+$,this.options.maxZoom+1))},wr.prototype._cluster=function($,I){for(var j=[],Y=this.options,ue=Y.reduce,De=Y.minPoints,He=Y.radius/(Y.extent*Math.pow(2,I)),he=0;he<$.length;he++){var Ne=$[he];if(!(Ne.zoom<=I)){Ne.zoom=I;for(var Ct=this.trees[I+1],kr=Ct.within(Ne.x,Ne.y,He),jr=Ne.numPoints||1,$t=jr,yr=0,qr=kr;yr<qr.length;yr+=1){var gn=Ct.points[qr[yr]];gn.zoom>I&&($t+=gn.numPoints||1)}if($t>=De){for(var dr=Ne.x*jr,hn=Ne.y*jr,ln=ue&&jr>1?this._map(Ne,!0):null,fn=(he<<5)+(I+1)+this.points.length,ri=0,dn=kr;ri<dn.length;ri+=1){var ci=Ct.points[dn[ri]];if(!(ci.zoom<=I)){ci.zoom=I;var Bi=ci.numPoints||1;dr+=ci.x*Bi,hn+=ci.y*Bi,ci.parentId=fn,ue&&(ln||(ln=this._map(Ne,!0)),ue(ln,this._map(ci)))}}Ne.parentId=fn,j.push(Nr(dr/$t,hn/$t,fn,$t,ln))}else if(j.push(Ne),$t>1)for(var pi=0,_i=kr;pi<_i.length;pi+=1){var Ai=Ct.points[_i[pi]];Ai.zoom<=I||(Ai.zoom=I,j.push(Ai))}}}return j},wr.prototype._getOriginId=function($){return $-this.points.length>>5},wr.prototype._getOriginZoom=function($){return($-this.points.length)%32},wr.prototype._map=function($,I){if($.numPoints)return I?Rt({},$.properties):$.properties;var j=this.points[$.index].properties,Y=this.options.map(j);return I&&Y===j?Rt({},Y):Y},ai.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ai.prototype.splitTile=function($,I,j,Y,ue,De,He){for(var he=[$,I,j,Y],Ne=this.options,Ct=Ne.debug;he.length;){Y=he.pop(),j=he.pop(),I=he.pop(),$=he.pop();var kr=1<<I,jr=vi(I,j,Y),$t=this.tiles[jr];if(!$t&&(Ct>1&&console.time("creation"),$t=this.tiles[jr]=sr($,I,j,Y,Ne),this.tileCoords.push({z:I,x:j,y:Y}),Ct)){Ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",I,j,Y,$t.numFeatures,$t.numPoints,$t.numSimplified),console.timeEnd("creation"));var yr="z"+I;this.stats[yr]=(this.stats[yr]||0)+1,this.total++}if($t.source=$,ue){if(I===Ne.maxZoom||I===ue)continue;var qr=1<<ue-I;if(j!==Math.floor(De/qr)||Y!==Math.floor(He/qr))continue}else if(I===Ne.indexMaxZoom||$t.numPoints<=Ne.indexMaxPoints)continue;if($t.source=null,$.length!==0){Ct>1&&console.time("clipping");var gn,dr,hn,ln,fn,ri,dn=.5*Ne.buffer/Ne.extent,ci=.5-dn,Bi=.5+dn,pi=1+dn;gn=dr=hn=ln=null,fn=hr($,kr,j-dn,j+Bi,0,$t.minX,$t.maxX,Ne),ri=hr($,kr,j+ci,j+pi,0,$t.minX,$t.maxX,Ne),$=null,fn&&(gn=hr(fn,kr,Y-dn,Y+Bi,1,$t.minY,$t.maxY,Ne),dr=hr(fn,kr,Y+ci,Y+pi,1,$t.minY,$t.maxY,Ne),fn=null),ri&&(hn=hr(ri,kr,Y-dn,Y+Bi,1,$t.minY,$t.maxY,Ne),ln=hr(ri,kr,Y+ci,Y+pi,1,$t.minY,$t.maxY,Ne),ri=null),Ct>1&&console.timeEnd("clipping"),he.push(gn||[],I+1,2*j,2*Y),he.push(dr||[],I+1,2*j,2*Y+1),he.push(hn||[],I+1,2*j+1,2*Y),he.push(ln||[],I+1,2*j+1,2*Y+1)}}},ai.prototype.getTile=function($,I,j){var Y=this.options,ue=Y.extent,De=Y.debug;if($<0||$>24)return null;var He=1<<$,he=vi($,I=(I%He+He)%He,j);if(this.tiles[he])return Dt(this.tiles[he],ue);De>1&&console.log("drilling down to z%d-%d-%d",$,I,j);for(var Ne,Ct=$,kr=I,jr=j;!Ne&&Ct>0;)Ct--,kr=Math.floor(kr/2),jr=Math.floor(jr/2),Ne=this.tiles[vi(Ct,kr,jr)];return Ne&&Ne.source?(De>1&&console.log("found parent tile z%d-%d-%d",Ct,kr,jr),De>1&&console.time("drilling down"),this.splitTile(Ne.source,Ct,kr,jr,$,I,j),De>1&&console.timeEnd("drilling down"),this.tiles[he]?Dt(this.tiles[he],ue):null):null};var Zi=function($){function I(j,Y,ue,De){$.call(this,j,Y,ue,Di),De&&(this.loadGeoJSON=De)}return $&&(I.__proto__=$),(I.prototype=Object.create($&&$.prototype)).constructor=I,I.prototype.loadData=function(j,Y){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Y,this._pendingLoadDataParams=j,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},I.prototype._loadData=function(){var j=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Y=this._pendingCallback,ue=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var De=!!(ue&&ue.request&&ue.request.collectResourceTiming)&&new p.RequestPerformance(ue.request);this.loadGeoJSON(ue,function(He,he){if(He||!he)return Y(He);if(typeof he!="object")return Y(new Error("Input data given to '"+ue.source+"' is not a valid GeoJSON object."));(function $t(yr,qr){var gn,dr=yr&&yr.type;if(dr==="FeatureCollection")for(gn=0;gn<yr.features.length;gn++)$t(yr.features[gn],qr);else if(dr==="GeometryCollection")for(gn=0;gn<yr.geometries.length;gn++)$t(yr.geometries[gn],qr);else if(dr==="Feature")$t(yr.geometry,qr);else if(dr==="Polygon")Nt(yr.coordinates,qr);else if(dr==="MultiPolygon")for(gn=0;gn<yr.coordinates.length;gn++)Nt(yr.coordinates[gn],qr);return yr})(he,!0);try{if(ue.filter){var Ne=p.createExpression(ue.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ne.result==="error")throw new Error(Ne.value.map(function($t){return $t.key+": "+$t.message}).join(", "));var Ct=he.features.filter(function($t){return Ne.value.evaluate({zoom:0},$t)});he={type:"FeatureCollection",features:Ct}}j._geoJSONIndex=ue.cluster?new wr(function($t){var yr=$t.superclusterOptions,qr=$t.clusterProperties;if(!qr||!yr)return yr;for(var gn={},dr={},hn={accumulated:null,zoom:0},ln={properties:null},fn=Object.keys(qr),ri=0,dn=fn;ri<dn.length;ri+=1){var ci=dn[ri],Bi=qr[ci],pi=Bi[0],_i=p.createExpression(Bi[1]),Ai=p.createExpression(typeof pi=="string"?[pi,["accumulated"],["get",ci]]:pi);gn[ci]=_i.value,dr[ci]=Ai.value}return yr.map=function(xo){ln.properties=xo;for(var Wi={},mi=0,Fn=fn;mi<Fn.length;mi+=1){var kn=Fn[mi];Wi[kn]=gn[kn].evaluate(hn,ln)}return Wi},yr.reduce=function(xo,Wi){ln.properties=Wi;for(var mi=0,Fn=fn;mi<Fn.length;mi+=1){var kn=Fn[mi];hn.accumulated=xo[kn],xo[kn]=dr[kn].evaluate(hn,ln)}},yr}(ue)).load(he.features):function($t,yr){return new ai($t,yr)}(he,ue.geojsonVtOptions)}catch($t){return Y($t)}j.loaded={};var kr={};if(De){var jr=De.finish();jr&&(kr.resourceTiming={},kr.resourceTiming[ue.source]=JSON.parse(JSON.stringify(jr)))}Y(null,kr)})}},I.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},I.prototype.reloadTile=function(j,Y){var ue=this.loaded;return ue&&ue[j.uid]?$.prototype.reloadTile.call(this,j,Y):this.loadTile(j,Y)},I.prototype.loadGeoJSON=function(j,Y){if(j.request)p.getJSON(j.request,Y);else{if(typeof j.data!="string")return Y(new Error("Input data given to '"+j.source+"' is not a valid GeoJSON object."));try{return Y(null,JSON.parse(j.data))}catch(ue){return Y(new Error("Input data given to '"+j.source+"' is not a valid GeoJSON object."))}}},I.prototype.removeSource=function(j,Y){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Y()},I.prototype.getClusterExpansionZoom=function(j,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(j.clusterId))}catch(ue){Y(ue)}},I.prototype.getClusterChildren=function(j,Y){try{Y(null,this._geoJSONIndex.getChildren(j.clusterId))}catch(ue){Y(ue)}},I.prototype.getClusterLeaves=function(j,Y){try{Y(null,this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset))}catch(ue){Y(ue)}},I}(Pe),oi=function(I){var j=this;this.self=I,this.actor=new p.Actor(I,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Pe,geojson:Zi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(Y,ue){if(j.workerSourceTypes[Y])throw new Error('Worker source with name "'+Y+'" already registered.');j.workerSourceTypes[Y]=ue},this.self.registerRTLTextPlugin=function(Y){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=Y.applyArabicShaping,p.plugin.processBidirectionalText=Y.processBidirectionalText,p.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}};return oi.prototype.setReferrer=function($,I){this.referrer=I},oi.prototype.setImages=function($,I,j){for(var Y in this.availableImages[$]=I,this.workerSources[$]){var ue=this.workerSources[$][Y];for(var De in ue)ue[De].availableImages=I}j()},oi.prototype.setLayers=function($,I,j){this.getLayerIndex($).replace(I),j()},oi.prototype.updateLayers=function($,I,j){this.getLayerIndex($).update(I.layers,I.removedIds),j()},oi.prototype.loadTile=function($,I,j){this.getWorkerSource($,I.type,I.source).loadTile(I,j)},oi.prototype.loadDEMTile=function($,I,j){this.getDEMWorkerSource($,I.source).loadTile(I,j)},oi.prototype.reloadTile=function($,I,j){this.getWorkerSource($,I.type,I.source).reloadTile(I,j)},oi.prototype.abortTile=function($,I,j){this.getWorkerSource($,I.type,I.source).abortTile(I,j)},oi.prototype.removeTile=function($,I,j){this.getWorkerSource($,I.type,I.source).removeTile(I,j)},oi.prototype.removeDEMTile=function($,I){this.getDEMWorkerSource($,I.source).removeTile(I)},oi.prototype.removeSource=function($,I,j){if(this.workerSources[$]&&this.workerSources[$][I.type]&&this.workerSources[$][I.type][I.source]){var Y=this.workerSources[$][I.type][I.source];delete this.workerSources[$][I.type][I.source],Y.removeSource!==void 0?Y.removeSource(I,j):j()}},oi.prototype.loadWorkerSource=function($,I,j){try{this.self.importScripts(I.url),j()}catch(Y){j(Y.toString())}},oi.prototype.syncRTLPluginState=function($,I,j){try{p.plugin.setState(I);var Y=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&Y!=null){this.self.importScripts(Y);var ue=p.plugin.isParsed();j(ue?void 0:new Error("RTL Text Plugin failed to import scripts from "+Y),ue)}}catch(De){j(De.toString())}},oi.prototype.getAvailableImages=function($){var I=this.availableImages[$];return I||(I=[]),I},oi.prototype.getLayerIndex=function($){var I=this.layerIndexes[$];return I||(I=this.layerIndexes[$]=new F),I},oi.prototype.getWorkerSource=function($,I,j){var Y=this;return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][I]||(this.workerSources[$][I]={}),this.workerSources[$][I][j]||(this.workerSources[$][I][j]=new this.workerSourceTypes[I]({send:function(De,He,he){Y.actor.send(De,He,he,$)}},this.getLayerIndex($),this.getAvailableImages($))),this.workerSources[$][I][j]},oi.prototype.getDEMWorkerSource=function($,I){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][I]||(this.demWorkerSources[$][I]=new Oe),this.demWorkerSources[$][I]},oi.prototype.enforceCacheSizeLimit=function($,I){p.enforceCacheSizeLimit(I)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new oi(self)),oi}),b(["./shared"],function(p){"use strict";var G=p.createCommonjsModule(function(c){function o(g){return!i(g)}function i(g){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var C,L,Z=new Blob([""],{type:"text/javascript"}),ne=URL.createObjectURL(Z);try{L=new Worker(ne),C=!0}catch(me){C=!1}return L&&L.terminate(),URL.revokeObjectURL(ne),C}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var C=document.createElement("canvas");C.width=C.height=1;var L=C.getContext("2d");if(!L)return!1;var Z=L.getImageData(0,0,1,1);return Z&&Z.width===C.width}()?(h[E=g&&g.failIfMajorPerformanceCaveat]===void 0&&(h[E]=function(C){var L=function(ne){var me=document.createElement("canvas"),ye=Object.create(o.webGLContextAttributes);return ye.failIfMajorPerformanceCaveat=ne,me.probablySupportsContext?me.probablySupportsContext("webgl",ye)||me.probablySupportsContext("experimental-webgl",ye):me.supportsContext?me.supportsContext("webgl",ye)||me.supportsContext("experimental-webgl",ye):me.getContext("webgl",ye)||me.getContext("experimental-webgl",ye)}(C);if(!L)return!1;var Z=L.createShader(L.VERTEX_SHADER);return!(!Z||L.isContextLost())&&(L.shaderSource(Z,"void main() {}"),L.compileShader(Z),L.getShaderParameter(Z,L.COMPILE_STATUS)===!0)}(E)),h[E]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var E}c.exports?c.exports=o:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=o,window.mapboxgl.notSupportedReason=i);var h={};o.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),S={create:function(o,i,h){var g=p.window.document.createElement(o);return i!==void 0&&(g.className=i),h&&h.appendChild(g),g},createNS:function(o,i){return p.window.document.createElementNS(o,i)}},F=p.window.document&&p.window.document.documentElement.style;function te(c){if(!F)return c[0];for(var o=0;o<c.length;o++)if(c[o]in F)return c[o];return c[0]}var ce,q=te(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);S.disableDrag=function(){F&&q&&(ce=F[q],F[q]="none")},S.enableDrag=function(){F&&q&&(F[q]=ce)};var we=te(["transform","WebkitTransform"]);S.setTransform=function(c,o){c.style[we]=o};var Pe=!1;try{var Be=Object.defineProperty({},"passive",{get:function(){Pe=!0}});p.window.addEventListener("test",Be,Be),p.window.removeEventListener("test",Be,Be)}catch(c){Pe=!1}S.addEventListener=function(c,o,i,h){h===void 0&&(h={}),c.addEventListener(o,i,"passive"in h&&Pe?h:h.capture)},S.removeEventListener=function(c,o,i,h){h===void 0&&(h={}),c.removeEventListener(o,i,"passive"in h&&Pe?h:h.capture)};var Oe=function c(o){o.preventDefault(),o.stopPropagation(),p.window.removeEventListener("click",c,!0)};function Nt(c){var o=c.userImage;return!!(o&&o.render&&o.render())&&(c.data.replace(new Uint8Array(o.data.buffer)),!0)}S.suppressClick=function(){p.window.addEventListener("click",Oe,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",Oe,!0)},0)},S.mousePos=function(c,o){var i=c.getBoundingClientRect();return new p.Point(o.clientX-i.left-c.clientLeft,o.clientY-i.top-c.clientTop)},S.touchPos=function(c,o){for(var i=c.getBoundingClientRect(),h=[],g=0;g<o.length;g++)h.push(new p.Point(o[g].clientX-i.left-c.clientLeft,o[g].clientY-i.top-c.clientTop));return h},S.mouseButton=function(c){return p.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button},S.remove=function(c){c.parentNode&&c.parentNode.removeChild(c)};var Xt=function(c){function o(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.isLoaded=function(){return this.loaded},o.prototype.setLoaded=function(i){if(this.loaded!==i&&(this.loaded=i,i)){for(var h=0,g=this.requestors;h<g.length;h+=1){var E=g[h];this._notify(E.ids,E.callback)}this.requestors=[]}},o.prototype.getImage=function(i){return this.images[i]},o.prototype.addImage=function(i,h){this._validate(i,h)&&(this.images[i]=h)},o.prototype._validate=function(i,h){var g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+i+'" has invalid "stretchX" value'))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+i+'" has invalid "stretchY" value'))),g=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+i+'" has invalid "content" value'))),g=!1),g},o.prototype._validateStretch=function(i,h){if(!i)return!0;for(var g=0,E=0,C=i;E<C.length;E+=1){var L=C[E];if(L[0]<g||L[1]<L[0]||h<L[1])return!1;g=L[1]}return!0},o.prototype._validateContent=function(i,h){return!(i&&(i.length!==4||i[0]<0||h.data.width<i[0]||i[1]<0||h.data.height<i[1]||i[2]<0||h.data.width<i[2]||i[3]<0||h.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))},o.prototype.updateImage=function(i,h){h.version=this.images[i].version+1,this.images[i]=h,this.updatedImages[i]=!0},o.prototype.removeImage=function(i){var h=this.images[i];delete this.images[i],delete this.patterns[i],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},o.prototype.listImages=function(){return Object.keys(this.images)},o.prototype.getImages=function(i,h){var g=!0;if(!this.isLoaded())for(var E=0,C=i;E<C.length;E+=1)this.images[C[E]]||(g=!1);this.isLoaded()||g?this._notify(i,h):this.requestors.push({ids:i,callback:h})},o.prototype._notify=function(i,h){for(var g={},E=0,C=i;E<C.length;E+=1){var L=C[E];this.images[L]||this.fire(new p.Event("styleimagemissing",{id:L}));var Z=this.images[L];Z?g[L]={data:Z.data.clone(),pixelRatio:Z.pixelRatio,sdf:Z.sdf,version:Z.version,stretchX:Z.stretchX,stretchY:Z.stretchY,content:Z.content,hasRenderCallback:Boolean(Z.userImage&&Z.userImage.render)}:p.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,g)},o.prototype.getPixelSize=function(){var i=this.atlasImage;return{width:i.width,height:i.height}},o.prototype.getPattern=function(i){var h=this.patterns[i],g=this.getImage(i);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{var E={w:g.data.width+2,h:g.data.height+2,x:0,y:0},C=new p.ImagePosition(E,g);this.patterns[i]={bin:E,position:C}}return this._updatePatternAtlas(),this.patterns[i].position},o.prototype.bind=function(i){var h=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(i,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},o.prototype._updatePatternAtlas=function(){var i=[];for(var h in this.patterns)i.push(this.patterns[h].bin);var g=p.potpack(i),E=g.w,C=g.h,L=this.atlasImage;for(var Z in L.resize({width:E||1,height:C||1}),this.patterns){var ne=this.patterns[Z].bin,me=ne.x+1,ye=ne.y+1,Se=this.images[Z].data,Ye=Se.width,Xe=Se.height;p.RGBAImage.copy(Se,L,{x:0,y:0},{x:me,y:ye},{width:Ye,height:Xe}),p.RGBAImage.copy(Se,L,{x:0,y:Xe-1},{x:me,y:ye-1},{width:Ye,height:1}),p.RGBAImage.copy(Se,L,{x:0,y:0},{x:me,y:ye+Xe},{width:Ye,height:1}),p.RGBAImage.copy(Se,L,{x:Ye-1,y:0},{x:me-1,y:ye},{width:1,height:Xe}),p.RGBAImage.copy(Se,L,{x:0,y:0},{x:me+Ye,y:ye},{width:1,height:Xe})}this.dirty=!0},o.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},o.prototype.dispatchRenderCallbacks=function(i){for(var h=0,g=i;h<g.length;h+=1){var E=g[h];if(!this.callbackDispatchedThisFrame[E]){this.callbackDispatchedThisFrame[E]=!0;var C=this.images[E];Nt(C)&&this.updateImage(E,C)}}},o}(p.Evented),Bt=nt,Qe=nt,xt=1e20;function nt(c,o,i,h,g,E){this.fontSize=c||24,this.buffer=o===void 0?3:o,this.cutoff=h||.25,this.fontFamily=g||"sans-serif",this.fontWeight=E||"normal",this.radius=i||8;var C=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=C,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.d=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Int16Array(C),this.middle=Math.round(C/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function cr(c,o,i,h,g,E,C){for(var L=0;L<o;L++){for(var Z=0;Z<i;Z++)h[Z]=c[Z*o+L];for(At(h,g,E,C,i),Z=0;Z<i;Z++)c[Z*o+L]=g[Z]}for(Z=0;Z<i;Z++){for(L=0;L<o;L++)h[L]=c[Z*o+L];for(At(h,g,E,C,o),L=0;L<o;L++)c[Z*o+L]=Math.sqrt(g[L])}}function At(c,o,i,h,g){i[0]=0,h[0]=-xt,h[1]=+xt;for(var E=1,C=0;E<g;E++){for(var L=(c[E]+E*E-(c[i[C]]+i[C]*i[C]))/(2*E-2*i[C]);L<=h[C];)C--,L=(c[E]+E*E-(c[i[C]]+i[C]*i[C]))/(2*E-2*i[C]);i[++C]=E,h[C]=L,h[C+1]=+xt}for(E=0,C=0;E<g;E++){for(;h[C+1]<E;)C++;o[E]=(E-i[C])*(E-i[C])+c[i[C]]}}nt.prototype.draw=function(c){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(c,this.buffer,this.middle);for(var o=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var g=o.data[4*h+3]/255;this.gridOuter[h]=g===1?0:g===0?xt:Math.pow(Math.max(0,.5-g),2),this.gridInner[h]=g===1?xt:g===0?0:Math.pow(Math.max(0,g-.5),2)}for(cr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),cr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)i[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return i},Bt.default=Qe;var Gt=function(o,i){this.requestManager=o,this.localIdeographFontFamily=i,this.entries={}};Gt.prototype.setURL=function(c){this.url=c},Gt.prototype.getGlyphs=function(c,o){var i=this,h=[];for(var g in c)for(var E=0,C=c[g];E<C.length;E+=1)h.push({stack:g,id:C[E]});p.asyncAll(h,function(L,Z){var ne=L.stack,me=L.id,ye=i.entries[ne];ye||(ye=i.entries[ne]={glyphs:{},requests:{},ranges:{}});var Se=ye.glyphs[me];if(Se===void 0){if(Se=i._tinySDF(ye,ne,me))return ye.glyphs[me]=Se,void Z(null,{stack:ne,id:me,glyph:Se});var Ye=Math.floor(me/256);if(256*Ye>65535)Z(new Error("glyphs > 65535 not supported"));else if(ye.ranges[Ye])Z(null,{stack:ne,id:me,glyph:Se});else{var Xe=ye.requests[Ye];Xe||(Xe=ye.requests[Ye]=[],Gt.loadGlyphRange(ne,Ye,i.url,i.requestManager,function(ct,$e){if($e){for(var tt in $e)i._doesCharSupportLocalGlyph(+tt)||(ye.glyphs[+tt]=$e[+tt]);ye.ranges[Ye]=!0}for(var It=0,Mt=Xe;It<Mt.length;It+=1)(0,Mt[It])(ct,$e);delete ye.requests[Ye]})),Xe.push(function(ct,$e){ct?Z(ct):$e&&Z(null,{stack:ne,id:me,glyph:$e[me]||null})})}}else Z(null,{stack:ne,id:me,glyph:Se})},function(L,Z){if(L)o(L);else if(Z){for(var ne={},me=0,ye=Z;me<ye.length;me+=1){var Se=ye[me],Ye=Se.stack,Xe=Se.id,ct=Se.glyph;(ne[Ye]||(ne[Ye]={}))[Xe]=ct&&{id:ct.id,bitmap:ct.bitmap.clone(),metrics:ct.metrics}}o(null,ne)}})},Gt.prototype._doesCharSupportLocalGlyph=function(c){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](c)||p.isChar["Hangul Syllables"](c)||p.isChar.Hiragana(c)||p.isChar.Katakana(c))},Gt.prototype._tinySDF=function(c,o,i){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(i)){var g=c.tinySDF;if(!g){var E="400";/bold/i.test(o)?E="900":/medium/i.test(o)?E="500":/light/i.test(o)&&(E="200"),g=c.tinySDF=new Gt.TinySDF(24,3,8,.25,h,E)}return{id:i,bitmap:new p.AlphaImage({width:30,height:30},g.draw(String.fromCharCode(i))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Gt.loadGlyphRange=function(c,o,i,h,g){var E=256*o,C=E+255,L=h.transformRequest(h.normalizeGlyphsURL(i).replace("{fontstack}",c).replace("{range}",E+"-"+C),p.ResourceType.Glyphs);p.getArrayBuffer(L,function(Z,ne){if(Z)g(Z);else if(ne){for(var me={},ye=0,Se=p.parseGlyphPBF(ne);ye<Se.length;ye+=1){var Ye=Se[ye];me[Ye.id]=Ye}g(null,me)}})},Gt.TinySDF=Bt;var St=function(){this.specification=p.styleSpec.light.position};St.prototype.possiblyEvaluate=function(c,o){return p.sphericalToCartesian(c.expression.evaluate(o))},St.prototype.interpolate=function(c,o,i){return{x:p.number(c.x,o.x,i),y:p.number(c.y,o.y,i),z:p.number(c.z,o.z,i)}};var Ze=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new St,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),yt=function(c){function o(i){c.call(this),this._transitionable=new p.Transitionable(Ze),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getLight=function(){return this._transitionable.serialize()},o.prototype.setLight=function(i,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,i,h))for(var g in i){var E=i[g];p.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-"-transition".length),E):this._transitionable.setValue(g,E)}},o.prototype.updateTransitions=function(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)},o.prototype.hasTransition=function(){return this._transitioning.hasTransition()},o.prototype.recalculate=function(i){this.properties=this._transitioning.possiblyEvaluate(i)},o.prototype._validate=function(i,h,g){return(!g||g.validate!==!1)&&p.emitValidationErrors(this,i.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},o}(p.Evented),Me=function(o,i){this.width=o,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Me.prototype.getDash=function(c,o){var i=c.join(",")+String(o);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(c,o)),this.dashEntry[i]},Me.prototype.getDashRanges=function(c,o,i){var h=[],g=c.length%2==1?-c[c.length-1]*i:0,E=c[0]*i,C=!0;h.push({left:g,right:E,isDash:C,zeroLength:c[0]===0});for(var L=c[0],Z=1;Z<c.length;Z++){var ne=c[Z];h.push({left:g=L*i,right:E=(L+=ne)*i,isDash:C=!C,zeroLength:ne===0})}return h},Me.prototype.addRoundDash=function(c,o,i){for(var h=o/2,g=-i;g<=i;g++)for(var E=this.width*(this.nextRow+i+g),C=0,L=c[C],Z=0;Z<this.width;Z++){Z/L.right>1&&(L=c[++C]);var ne=Math.abs(Z-L.left),me=Math.abs(Z-L.right),ye=Math.min(ne,me),Se=void 0,Ye=g/i*(h+1);if(L.isDash){var Xe=h-Math.abs(Ye);Se=Math.sqrt(ye*ye+Xe*Xe)}else Se=h-Math.sqrt(ye*ye+Ye*Ye);this.data[E+Z]=Math.max(0,Math.min(255,Se+128))}},Me.prototype.addRegularDash=function(c){for(var o=c.length-1;o>=0;--o){var i=c[o],h=c[o+1];i.zeroLength?c.splice(o,1):h&&h.isDash===i.isDash&&(h.left=i.left,c.splice(o,1))}var g=c[0],E=c[c.length-1];g.isDash===E.isDash&&(g.left=E.left-this.width,E.right=g.right+this.width);for(var C=this.width*this.nextRow,L=0,Z=c[L],ne=0;ne<this.width;ne++){ne/Z.right>1&&(Z=c[++L]);var me=Math.abs(ne-Z.left),ye=Math.abs(ne-Z.right),Se=Math.min(me,ye);this.data[C+ne]=Math.max(0,Math.min(255,(Z.isDash?Se:-Se)+128))}},Me.prototype.addDash=function(c,o){var i=o?7:0,h=2*i+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var g=0,E=0;E<c.length;E++)g+=c[E];if(g!==0){var C=this.width/g,L=this.getDashRanges(c,this.width,C);o?this.addRoundDash(L,C,i):this.addRegularDash(L)}var Z={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:g};return this.nextRow+=h,this.dirty=!0,Z},Me.prototype.bind=function(c){var o=c.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))};var Te=function c(o,i){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),g=0;g<h.length;g++){var E=new c.Actor(h[g],i,this.id);E.name="Worker "+g,this.actors.push(E)}};function Ie(c,o,i){var h=function(E,C){if(E)return i(E);if(C){var L=p.pick(p.extend(C,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(L.vectorLayers=C.vector_layers,L.vectorLayerIds=L.vectorLayers.map(function(Z){return Z.id})),L.tiles=o.canonicalizeTileset(L,c.url),i(null,L)}};return c.url?p.getJSON(o.transformRequest(o.normalizeSourceURL(c.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,c)})}Te.prototype.broadcast=function(c,o,i){p.asyncAll(this.actors,function(h,g){h.send(c,o,g)},i=i||function(){})},Te.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Te.prototype.remove=function(){this.actors.forEach(function(c){c.remove()}),this.actors=[],this.workerPool.release(this.id)},Te.Actor=p.Actor;var bt=function(o,i,h){this.bounds=p.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=i||0,this.maxzoom=h||24};bt.prototype.validateBounds=function(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]},bt.prototype.contains=function(c){var o=Math.pow(2,c.z),i=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*o),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*o),g=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*o),E=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*o);return c.x>=i&&c.x<g&&c.y>=h&&c.y<E};var tr=function(c){function o(i,h,g,E){if(c.call(this),this.id=i,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(E)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.load=function(){var i=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ie(this._options,this.map._requestManager,function(h,g){i._tileJSONRequest=null,i._loaded=!0,h?i.fire(new p.ErrorEvent(h)):g&&(p.extend(i,g),g.bounds&&(i.tileBounds=new bt(g.bounds,i.minzoom,i.maxzoom)),p.postTurnstileEvent(g.tiles,i.map._requestManager._customAccessToken),p.postMapLoadEvent(g.tiles,i.map._getMapId(),i.map._requestManager._skuToken,i.map._requestManager._customAccessToken),i.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),i.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},o.prototype.loaded=function(){return this._loaded},o.prototype.hasTile=function(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)},o.prototype.onAdd=function(i){this.map=i,this.load()},o.prototype.setSourceProperty=function(i){this._tileJSONRequest&&this._tileJSONRequest.cancel(),i(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},o.prototype.setTiles=function(i){var h=this;return this.setSourceProperty(function(){h._options.tiles=i}),this},o.prototype.setUrl=function(i){var h=this;return this.setSourceProperty(function(){h.url=i,h._options.url=i}),this},o.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},o.prototype.serialize=function(){return p.extend({},this._options)},o.prototype.loadTile=function(i,h){var g=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),E={request:this.map._requestManager.transformRequest(g,p.ResourceType.Tile),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function C(L,Z){return delete i.request,i.aborted?h(null):L&&L.status!==404?h(L):(Z&&Z.resourceTiming&&(i.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&i.setExpiryData(Z),i.loadVectorData(Z,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}E.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired"?i.state==="loading"?i.reloadCallback=h:i.request=i.actor.send("reloadTile",E,C.bind(this)):(i.actor=this.dispatcher.getActor(),i.request=i.actor.send("loadTile",E,C.bind(this)))},o.prototype.abortTile=function(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id},void 0)},o.prototype.unloadTile=function(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id},void 0)},o.prototype.hasTransition=function(){return!1},o}(p.Evented),ae=function(c){function o(i,h,g,E){c.call(this),this.id=i,this.dispatcher=g,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.load=function(){var i=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ie(this._options,this.map._requestManager,function(h,g){i._tileJSONRequest=null,i._loaded=!0,h?i.fire(new p.ErrorEvent(h)):g&&(p.extend(i,g),g.bounds&&(i.tileBounds=new bt(g.bounds,i.minzoom,i.maxzoom)),p.postTurnstileEvent(g.tiles),p.postMapLoadEvent(g.tiles,i.map._getMapId(),i.map._requestManager._skuToken),i.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),i.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},o.prototype.loaded=function(){return this._loaded},o.prototype.onAdd=function(i){this.map=i,this.load()},o.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},o.prototype.serialize=function(){return p.extend({},this._options)},o.prototype.hasTile=function(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)},o.prototype.loadTile=function(i,h){var g=this,E=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);i.request=p.getImage(this.map._requestManager.transformRequest(E,p.ResourceType.Tile),function(C,L){if(delete i.request,i.aborted)i.state="unloaded",h(null);else if(C)i.state="errored",h(C);else if(L){g.map._refreshExpiredTiles&&i.setExpiryData(L),delete L.cacheControl,delete L.expires;var Z=g.map.painter.context,ne=Z.gl;i.texture=g.map.painter.getTileTexture(L.width),i.texture?i.texture.update(L,{useMipmap:!0}):(i.texture=new p.Texture(Z,L,ne.RGBA,{useMipmap:!0}),i.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE,ne.LINEAR_MIPMAP_NEAREST),Z.extTextureFilterAnisotropic&&ne.texParameterf(ne.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax)),i.state="loaded",p.cacheEntryPossiblyAdded(g.dispatcher),h(null)}})},o.prototype.abortTile=function(i,h){i.request&&(i.request.cancel(),delete i.request),h()},o.prototype.unloadTile=function(i,h){i.texture&&this.map.painter.saveTileTexture(i.texture),h()},o.prototype.hasTransition=function(){return!1},o}(p.Evented),Ee=function(c){function o(i,h,g,E){c.call(this,i,h,g,E),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},o.prototype.loadTile=function(i,h){var g=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function E(C,L){C&&(i.state="errored",h(C)),L&&(i.dem=L,i.needsHillshadePrepare=!0,i.state="loaded",h(null))}i.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(C,L){if(delete i.request,i.aborted)i.state="unloaded",h(null);else if(C)i.state="errored",h(C);else if(L){this.map._refreshExpiredTiles&&i.setExpiryData(L),delete L.cacheControl,delete L.expires;var Z=p.window.ImageBitmap&&L instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?L:p.browser.getImageData(L,1),ne={uid:i.uid,coord:i.tileID,source:this.id,rawImageData:Z,encoding:this.encoding};i.actor&&i.state!=="expired"||(i.actor=this.dispatcher.getActor(),i.actor.send("loadDEMTile",ne,E.bind(this)))}}.bind(this)),i.neighboringTiles=this._getNeighboringTiles(i.tileID)},o.prototype._getNeighboringTiles=function(i){var h=i.canonical,g=Math.pow(2,h.z),E=(h.x-1+g)%g,C=h.x===0?i.wrap-1:i.wrap,L=(h.x+1+g)%g,Z=h.x+1===g?i.wrap+1:i.wrap,ne={};return ne[new p.OverscaledTileID(i.overscaledZ,C,h.z,E,h.y).key]={backfilled:!1},ne[new p.OverscaledTileID(i.overscaledZ,Z,h.z,L,h.y).key]={backfilled:!1},h.y>0&&(ne[new p.OverscaledTileID(i.overscaledZ,C,h.z,E,h.y-1).key]={backfilled:!1},ne[new p.OverscaledTileID(i.overscaledZ,i.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},ne[new p.OverscaledTileID(i.overscaledZ,Z,h.z,L,h.y-1).key]={backfilled:!1}),h.y+1<g&&(ne[new p.OverscaledTileID(i.overscaledZ,C,h.z,E,h.y+1).key]={backfilled:!1},ne[new p.OverscaledTileID(i.overscaledZ,i.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},ne[new p.OverscaledTileID(i.overscaledZ,Z,h.z,L,h.y+1).key]={backfilled:!1}),ne},o.prototype.unloadTile=function(i){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&i.actor.send("removeDEMTile",{uid:i.uid,source:this.id})},o}(ae),le=function(c){function o(i,h,g,E){c.call(this),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(E),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var C=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*C,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*C,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*C,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.load=function(){var i=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)i.fire(new p.ErrorEvent(h));else{var g={dataType:"source",sourceDataType:"metadata"};i._collectResourceTiming&&i._resourceTiming&&i._resourceTiming.length>0&&(g.resourceTiming=i._resourceTiming,i._resourceTiming=[]),i.fire(new p.Event("data",g))}})},o.prototype.onAdd=function(i){this.map=i,this.load()},o.prototype.setData=function(i){var h=this;return this._data=i,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new p.ErrorEvent(g));else{var E={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(E.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",E))}}),this},o.prototype.getClusterExpansionZoom=function(i,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:i,source:this.id},h),this},o.prototype.getClusterChildren=function(i,h){return this.actor.send("geojson.getClusterChildren",{clusterId:i,source:this.id},h),this},o.prototype.getClusterLeaves=function(i,h,g,E){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:i,limit:h,offset:g},E),this},o.prototype._updateWorkerData=function(i){var h=this;this._loaded=!1;var g=p.extend({},this.workerOptions),E=this._data;typeof E=="string"?(g.request=this.map._requestManager.transformRequest(p.browser.resolveURL(E),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(E),this.actor.send(this.type+".loadData",g,function(C,L){h._removed||L&&L.abandoned||(h._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[h.id]&&(h._resourceTiming=L.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:g.source},null),i(C))})},o.prototype.loaded=function(){return this._loaded},o.prototype.loadTile=function(i,h){var g=this,E=i.actor?"reloadTile":"loadTile";i.actor=this.actor,i.request=this.actor.send(E,{type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(C,L){return delete i.request,i.unloadVectorData(),i.aborted?h(null):C?h(C):(i.loadVectorData(L,g.map.painter,E==="reloadTile"),h(null))})},o.prototype.abortTile=function(i){i.request&&(i.request.cancel(),delete i.request),i.aborted=!0},o.prototype.unloadTile=function(i){i.unloadVectorData(),this.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})},o.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},o.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},o.prototype.hasTransition=function(){return!1},o}(p.Evented),Q=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),re=function(c){function o(i,h,g,E){c.call(this),this.id=i,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(E),this.options=h}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.load=function(i,h){var g=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(E,C){g._loaded=!0,E?g.fire(new p.ErrorEvent(E)):C&&(g.image=C,i&&(g.coordinates=i),h&&h(),g._finishLoading())})},o.prototype.loaded=function(){return this._loaded},o.prototype.updateImage=function(i){var h=this;return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,function(){h.texture=null}),this):this},o.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},o.prototype.onAdd=function(i){this.map=i,this.load()},o.prototype.setCoordinates=function(i){var h=this;this.coordinates=i;var g=i.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(C){for(var L=1/0,Z=1/0,ne=-1/0,me=-1/0,ye=0,Se=C;ye<Se.length;ye+=1){var Ye=Se[ye];L=Math.min(L,Ye.x),Z=Math.min(Z,Ye.y),ne=Math.max(ne,Ye.x),me=Math.max(me,Ye.y)}var Xe=Math.max(ne-L,me-Z),ct=Math.max(0,Math.floor(-Math.log(Xe)/Math.LN2)),$e=Math.pow(2,ct);return new p.CanonicalTileID(ct,Math.floor((L+ne)/2*$e),Math.floor((Z+me)/2*$e))}(g),this.minzoom=this.maxzoom=this.tileID.z;var E=g.map(function(C){return h.tileID.getTilePoint(C)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(E[0].x,E[0].y,0,0),this._boundsArray.emplaceBack(E[1].x,E[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(E[3].x,E[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(E[2].x,E[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},o.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var i=this.map.painter.context,h=i.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Q.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(i,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var E=this.tiles[g];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}},o.prototype.loadTile=function(i,h){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},h(null)):(i.state="errored",h(null))},o.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},o.prototype.hasTransition=function(){return!1},o}(p.Evented),ke=function(c){function o(i,h,g,E){c.call(this,i,h,g,E),this.roundZoom=!0,this.type="video",this.options=h}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.load=function(){var i=this;this._loaded=!1;var h=this.options;this.urls=[];for(var g=0,E=h.urls;g<E.length;g+=1)this.urls.push(this.map._requestManager.transformRequest(E[g],p.ResourceType.Source).url);p.getVideo(this.urls,function(C,L){i._loaded=!0,C?i.fire(new p.ErrorEvent(C)):L&&(i.video=L,i.video.loop=!0,i.video.addEventListener("playing",function(){i.map.triggerRepaint()}),i.map&&i.video.play(),i._finishLoading())})},o.prototype.pause=function(){this.video&&this.video.pause()},o.prototype.play=function(){this.video&&this.video.play()},o.prototype.seek=function(i){if(this.video){var h=this.video.seekable;i<h.start(0)||i>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=i}},o.prototype.getVideo=function(){return this.video},o.prototype.onAdd=function(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},o.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var i=this.map.painter.context,h=i.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Q.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(i,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var E=this.tiles[g];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}},o.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},o.prototype.hasTransition=function(){return this.video&&!this.video.paused},o}(re),qe=function(c){function o(i,h,g,E){c.call(this,i,h,g,E),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(C){return!Array.isArray(C)||C.length!==2||C.some(function(L){return typeof L!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+i,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+i,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+i,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+i,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+i,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},o.prototype.getCanvas=function(){return this.canvas},o.prototype.onAdd=function(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()},o.prototype.onRemove=function(){this.pause()},o.prototype.prepare=function(){var i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,g=h.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Q.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,g.RGBA,{premultiply:!0}),this.tiles){var C=this.tiles[E];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},o.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},o.prototype.hasTransition=function(){return this._playing},o.prototype._hasInvalidDimensions=function(){for(var i=0,h=[this.canvas.width,this.canvas.height];i<h.length;i+=1){var g=h[i];if(isNaN(g)||g<=0)return!0}return!1},o}(re),Wt={vector:tr,raster:ae,"raster-dem":Ee,geojson:le,video:ke,image:re,canvas:qe};function Or(c,o){var i=p.identity([]);return p.translate(i,i,[1,1,0]),p.scale(i,i,[.5*c.width,.5*c.height,1]),p.multiply(i,i,c.calculatePosMatrix(o.toUnwrapped()))}function wr(c,o,i,h,g,E){var C=function(ct,$e,tt){if(ct)for(var It=0,Mt=ct;It<Mt.length;It+=1){var Sr=$e[Mt[It]];if(Sr&&Sr.source===tt&&Sr.type==="fill-extrusion")return!0}else for(var nr in $e){var xr=$e[nr];if(xr.source===tt&&xr.type==="fill-extrusion")return!0}return!1}(g&&g.layers,o,c.id),L=E.maxPitchScaleFactor(),Z=c.tilesIn(h,L,C);Z.sort(Nr);for(var ne=[],me=0,ye=Z;me<ye.length;me+=1){var Se=ye[me];ne.push({wrappedTileID:Se.tileID.wrapped().key,queryResults:Se.tile.queryRenderedFeatures(o,i,c._state,Se.queryGeometry,Se.cameraQueryGeometry,Se.scale,g,E,L,Or(c.transform,Se.tileID))})}var Ye=function(ct){for(var $e={},tt={},It=0,Mt=ct;It<Mt.length;It+=1){var Sr=Mt[It],nr=Sr.queryResults,xr=Sr.wrappedTileID,Cr=tt[xr]=tt[xr]||{};for(var an in nr)for(var Xr=nr[an],vn=Cr[an]=Cr[an]||{},An=$e[an]=$e[an]||[],Xn=0,Qn=Xr;Xn<Qn.length;Xn+=1){var Ci=Qn[Xn];vn[Ci.featureIndex]||(vn[Ci.featureIndex]=!0,An.push(Ci))}}return $e}(ne);for(var Xe in Ye)Ye[Xe].forEach(function(ct){var $e=ct.feature,tt=c.getFeatureState($e.layer["source-layer"],$e.id);$e.source=$e.layer.source,$e.layer["source-layer"]&&($e.sourceLayer=$e.layer["source-layer"]),$e.state=tt});return Ye}function Nr(c,o){var i=c.tileID,h=o.tileID;return i.overscaledZ-h.overscaledZ||i.canonical.y-h.canonical.y||i.wrap-h.wrap||i.canonical.x-h.canonical.x}var Vt=function(o,i){this.max=o,this.onRemove=i,this.reset()};Vt.prototype.reset=function(){for(var c in this.data)for(var o=0,i=this.data[c];o<i.length;o+=1){var h=i[o];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},Vt.prototype.add=function(c,o,i){var h=this,g=c.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);var E={value:o,timeout:void 0};if(i!==void 0&&(E.timeout=setTimeout(function(){h.remove(c,E)},i)),this.data[g].push(E),this.order.push(g),this.order.length>this.max){var C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this},Vt.prototype.has=function(c){return c.wrapped().key in this.data},Vt.prototype.getAndRemove=function(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null},Vt.prototype._getAndRemoveByKey=function(c){var o=this.data[c].shift();return o.timeout&&clearTimeout(o.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),o.value},Vt.prototype.getByKey=function(c){var o=this.data[c];return o?o[0].value:null},Vt.prototype.get=function(c){return this.has(c)?this.data[c.wrapped().key][0].value:null},Vt.prototype.remove=function(c,o){if(!this.has(c))return this;var i=c.wrapped().key,h=o===void 0?0:this.data[i].indexOf(o),g=this.data[i][h];return this.data[i].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(g.value),this.order.splice(this.order.indexOf(i),1),this},Vt.prototype.setMaxSize=function(c){for(this.max=c;this.order.length>this.max;){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this},Vt.prototype.filter=function(c){var o=[];for(var i in this.data)for(var h=0,g=this.data[i];h<g.length;h+=1){var E=g[h];c(E.value)||o.push(E)}for(var C=0,L=o;C<L.length;C+=1){var Z=L[C];this.remove(Z.value.tileID,Z)}};var se=function(o,i,h){this.context=o;var g=o.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer};se.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},se.prototype.updateData=function(c){var o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)},se.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var _e={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Le=function(o,i,h,g){this.length=i.length,this.attributes=h,this.itemSize=i.bytesPerElement,this.dynamicDraw=g,this.context=o;var E=o.gl;this.buffer=E.createBuffer(),o.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer};Le.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Le.prototype.updateData=function(c){var o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,c.arrayBuffer)},Le.prototype.enableAttributes=function(c,o){for(var i=0;i<this.attributes.length;i++){var h=o.attributes[this.attributes[i].name];h!==void 0&&c.enableVertexAttribArray(h)}},Le.prototype.setVertexAttribPointers=function(c,o,i){for(var h=0;h<this.attributes.length;h++){var g=this.attributes[h],E=o.attributes[g.name];E!==void 0&&c.vertexAttribPointer(E,g.components,c[_e[g.type]],!1,this.itemSize,g.offset+this.itemSize*(i||0))}},Le.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ot=function(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ot.prototype.get=function(){return this.current},ot.prototype.set=function(c){},ot.prototype.getDefault=function(){return this.default},ot.prototype.setDefault=function(){this.set(this.default)};var Rt=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return p.Color.transparent},o.prototype.set=function(i){var h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)},o}(ot),jt=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return 1},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)},o}(ot),w=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return 0},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)},o}(ot),N=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return[!0,!0,!0,!0]},o.prototype.set=function(i){var h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)},o}(ot),ve=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return!0},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)},o}(ot),Ae=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return 255},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)},o}(ot),Je=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},o.prototype.set=function(i){var h=this.current;(i.func!==h.func||i.ref!==h.ref||i.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)},o}(ot),st=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){var i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]},o.prototype.set=function(i){var h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)},o}(ot),Lt=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var h=this.gl;i?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=i,this.dirty=!1}},o}(ot),X=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return[0,1]},o.prototype.set=function(i){var h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)},o}(ot),Tt=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var h=this.gl;i?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=i,this.dirty=!1}},o}(ot),Kt=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.LESS},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)},o}(ot),hr=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var h=this.gl;i?h.enable(h.BLEND):h.disable(h.BLEND),this.current=i,this.dirty=!1}},o}(ot),_r=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){var i=this.gl;return[i.ONE,i.ZERO]},o.prototype.set=function(i){var h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)},o}(ot),Ar=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return p.Color.transparent},o.prototype.set=function(i){var h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)},o}(ot),Rr=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.FUNC_ADD},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)},o}(ot),et=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var h=this.gl;i?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=i,this.dirty=!1}},o}(ot),gt=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.BACK},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)},o}(ot),dt=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.CCW},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)},o}(ot),fr=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)},o}(ot),$r=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.TEXTURE0},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)},o}(ot),mt=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){var i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]},o.prototype.set=function(i){var h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)},o}(ot),Dt=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){if(i!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,i),this.current=i,this.dirty=!1}},o}(ot),ar=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){if(i!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,i),this.current=i,this.dirty=!1}},o}(ot),sr=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){if(i!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,i),this.current=i,this.dirty=!1}},o}(ot),yn=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){if(i!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}},o}(ot),_n=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1},o}(ot),ai=function(c){function o(i){c.call(this,i),this.vao=i.extVertexArrayObject}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)},o}(ot),vi=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return 4},o.prototype.set=function(i){if(i!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}},o}(ot),Di=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}},o}(ot),Zi=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}},o}(ot),oi=function(c){function o(i,h){c.call(this,i),this.context=i,this.parent=h}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o}(ot),$=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.setDirty=function(){this.dirty=!0},o.prototype.set=function(i){if(i!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}},o}(oi),I=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.set=function(i){if(i!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}},o}(oi),j=function(o,i,h,g){this.context=o,this.width=i,this.height=h;var E=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new $(o,E),g&&(this.depthAttachment=new I(o,E))};j.prototype.destroy=function(){var c=this.context.gl,o=this.colorAttachment.get();if(o&&c.deleteTexture(o),this.depthAttachment){var i=this.depthAttachment.get();i&&c.deleteRenderbuffer(i)}c.deleteFramebuffer(this.framebuffer)};var Y=function(o,i,h){this.func=o,this.mask=i,this.range=h};Y.ReadOnly=!1,Y.ReadWrite=!0,Y.disabled=new Y(519,Y.ReadOnly,[0,1]);var ue=function(o,i,h,g,E,C){this.test=o,this.ref=i,this.mask=h,this.fail=g,this.depthFail=E,this.pass=C};ue.disabled=new ue({func:519,mask:0},0,0,7680,7680,7680);var De=function(o,i,h){this.blendFunction=o,this.blendColor=i,this.mask=h};De.disabled=new De(De.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),De.unblended=new De(De.Replace,p.Color.transparent,[!0,!0,!0,!0]),De.alphaBlended=new De([1,771],p.Color.transparent,[!0,!0,!0,!0]);var He=function(o,i,h){this.enable=o,this.mode=i,this.frontFace=h};He.disabled=new He(!1,1029,2305),He.backCCW=new He(!0,1029,2305);var he=function(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Rt(this),this.clearDepth=new jt(this),this.clearStencil=new w(this),this.colorMask=new N(this),this.depthMask=new ve(this),this.stencilMask=new Ae(this),this.stencilFunc=new Je(this),this.stencilOp=new st(this),this.stencilTest=new Lt(this),this.depthRange=new X(this),this.depthTest=new Tt(this),this.depthFunc=new Kt(this),this.blend=new hr(this),this.blendFunc=new _r(this),this.blendColor=new Ar(this),this.blendEquation=new Rr(this),this.cullFace=new et(this),this.cullFaceSide=new gt(this),this.frontFace=new dt(this),this.program=new fr(this),this.activeTexture=new $r(this),this.viewport=new mt(this),this.bindFramebuffer=new Dt(this),this.bindRenderbuffer=new ar(this),this.bindTexture=new sr(this),this.bindVertexBuffer=new yn(this),this.bindElementBuffer=new _n(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ai(this),this.pixelStoreUnpack=new vi(this),this.pixelStoreUnpackPremultiplyAlpha=new Di(this),this.pixelStoreUnpackFlipY=new Zi(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)};he.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},he.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},he.prototype.createIndexBuffer=function(c,o){return new se(this,c,o)},he.prototype.createVertexBuffer=function(c,o,i){return new Le(this,c,o,i)},he.prototype.createRenderbuffer=function(c,o,i){var h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,c,o,i),this.bindRenderbuffer.set(null),g},he.prototype.createFramebuffer=function(c,o,i){return new j(this,c,o,i)},he.prototype.clear=function(c){var o=c.color,i=c.depth,h=this.gl,g=0;o&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),h.clear(g)},he.prototype.setCullFace=function(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))},he.prototype.setDepthMode=function(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)},he.prototype.setStencilMode=function(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)},he.prototype.setColorMode=function(c){p.deepEqual(c.blendFunction,De.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)},he.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ne=function(c){function o(i,h,g){var E=this;c.call(this),this.id=i,this.dispatcher=g,this.on("data",function(C){C.dataType==="source"&&C.sourceDataType==="metadata"&&(E._sourceLoaded=!0),E._sourceLoaded&&!E._paused&&C.dataType==="source"&&C.sourceDataType==="content"&&(E.reload(),E.transform&&E.update(E.transform))}),this.on("error",function(){E._sourceErrored=!0}),this._source=function(C,L,Z,ne){var me=new Wt[L.type](C,L,Z,ne);if(me.id!==C)throw new Error("Expected Source id to be "+C+" instead of "+me.id);return p.bindAll(["load","abort","unload","serialize","prepare"],me),me}(i,h,g,this),this._tiles={},this._cache=new Vt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.onAdd=function(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(i)},o.prototype.onRemove=function(i){this._source&&this._source.onRemove&&this._source.onRemove(i)},o.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var i in this._tiles){var h=this._tiles[i];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},o.prototype.getSource=function(){return this._source},o.prototype.pause=function(){this._paused=!0},o.prototype.resume=function(){if(this._paused){var i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}},o.prototype._loadTile=function(i,h){return this._source.loadTile(i,h)},o.prototype._unloadTile=function(i){if(this._source.unloadTile)return this._source.unloadTile(i,function(){})},o.prototype._abortTile=function(i){if(this._source.abortTile)return this._source.abortTile(i,function(){})},o.prototype.serialize=function(){return this._source.serialize()},o.prototype.prepare=function(i){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var g=this._tiles[h];g.upload(i),g.prepare(this.map.style.imageManager)}},o.prototype.getIds=function(){return p.values(this._tiles).map(function(i){return i.tileID}).sort(Ct).map(function(i){return i.key})},o.prototype.getRenderableIds=function(i){var h=this,g=[];for(var E in this._tiles)this._isIdRenderable(E,i)&&g.push(this._tiles[E]);return i?g.sort(function(C,L){var Z=C.tileID,ne=L.tileID,me=new p.Point(Z.canonical.x,Z.canonical.y)._rotate(h.transform.angle),ye=new p.Point(ne.canonical.x,ne.canonical.y)._rotate(h.transform.angle);return Z.overscaledZ-ne.overscaledZ||ye.y-me.y||ye.x-me.x}).map(function(C){return C.tileID.key}):g.map(function(C){return C.tileID}).sort(Ct).map(function(C){return C.key})},o.prototype.hasRenderableParent=function(i){var h=this.findLoadedParent(i,0);return!!h&&this._isIdRenderable(h.tileID.key)},o.prototype._isIdRenderable=function(i,h){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(h||!this._tiles[i].holdingForFade())},o.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var i in this._cache.reset(),this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")},o.prototype._reloadTile=function(i,h){var g=this._tiles[i];g&&(g.state!=="loading"&&(g.state=h),this._loadTile(g,this._tileLoaded.bind(this,g,i,h)))},o.prototype._tileLoaded=function(i,h,g,E){if(E)return i.state="errored",void(E.status!==404?this._source.fire(new p.ErrorEvent(E,{tile:i})):this.update(this.transform));i.timeAdded=p.browser.now(),g==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(h,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:i,coord:i.tileID}))},o.prototype._backfillDEM=function(i){for(var h=this.getRenderableIds(),g=0;g<h.length;g++){var E=h[g];if(i.neighboringTiles&&i.neighboringTiles[E]){var C=this.getTileByID(E);L(i,C),L(C,i)}}function L(Z,ne){Z.needsHillshadePrepare=!0;var me=ne.tileID.canonical.x-Z.tileID.canonical.x,ye=ne.tileID.canonical.y-Z.tileID.canonical.y,Se=Math.pow(2,Z.tileID.canonical.z),Ye=ne.tileID.key;me===0&&ye===0||Math.abs(ye)>1||(Math.abs(me)>1&&(Math.abs(me+Se)===1?me+=Se:Math.abs(me-Se)===1&&(me-=Se)),ne.dem&&Z.dem&&(Z.dem.backfillBorder(ne.dem,me,ye),Z.neighboringTiles&&Z.neighboringTiles[Ye]&&(Z.neighboringTiles[Ye].backfilled=!0)))}},o.prototype.getTile=function(i){return this.getTileByID(i.key)},o.prototype.getTileByID=function(i){return this._tiles[i]},o.prototype._retainLoadedChildren=function(i,h,g,E){for(var C in this._tiles){var L=this._tiles[C];if(!(E[C]||!L.hasData()||L.tileID.overscaledZ<=h||L.tileID.overscaledZ>g)){for(var Z=L.tileID;L&&L.tileID.overscaledZ>h+1;){var ne=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[ne.key])&&L.hasData()&&(Z=ne)}for(var me=Z;me.overscaledZ>h;)if(i[(me=me.scaledTo(me.overscaledZ-1)).key]){E[Z.key]=Z;break}}}},o.prototype.findLoadedParent=function(i,h){if(i.key in this._loadedParentTiles){var g=this._loadedParentTiles[i.key];return g&&g.tileID.overscaledZ>=h?g:null}for(var E=i.overscaledZ-1;E>=h;E--){var C=i.scaledTo(E),L=this._getLoadedTile(C);if(L)return L}},o.prototype._getLoadedTile=function(i){var h=this._tiles[i.key];return h&&h.hasData()?h:this._cache.getByKey(i.wrapped().key)},o.prototype.updateCacheSize=function(i){var h=Math.ceil(i.width/this._source.tileSize)+1,g=Math.ceil(i.height/this._source.tileSize)+1,E=Math.floor(h*g*5),C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(C)},o.prototype.handleWrapJump=function(i){var h=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,h){var g={};for(var E in this._tiles){var C=this._tiles[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),g[C.tileID.key]=C}for(var L in this._tiles=g,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var Z in this._tiles)this._setTileReloadTimer(Z,this._tiles[Z])}},o.prototype.update=function(i){var h=this;if(this.transform=i,this._sourceLoaded&&!this._paused){var g;this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?g=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Cr){return new p.OverscaledTileID(Cr.canonical.z,Cr.wrap,Cr.canonical.z,Cr.canonical.x,Cr.canonical.y)}):(g=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(g=g.filter(function(Cr){return h._source.hasTile(Cr)}))):g=[];var E=i.coveringZoomLevel(this._source),C=Math.max(E-o.maxOverzooming,this._source.minzoom),L=Math.max(E+o.maxUnderzooming,this._source.minzoom),Z=this._updateRetainedTiles(g,E);if(kr(this._source.type)){for(var ne={},me={},ye=0,Se=Object.keys(Z);ye<Se.length;ye+=1){var Ye=Se[ye],Xe=Z[Ye],ct=this._tiles[Ye];if(ct&&!(ct.fadeEndTime&&ct.fadeEndTime<=p.browser.now())){var $e=this.findLoadedParent(Xe,C);$e&&(this._addTile($e.tileID),ne[$e.tileID.key]=$e.tileID),me[Ye]=Xe}}for(var tt in this._retainLoadedChildren(me,E,L,Z),ne)Z[tt]||(this._coveredTiles[tt]=!0,Z[tt]=ne[tt])}for(var It in Z)this._tiles[It].clearFadeHold();for(var Mt=0,Sr=p.keysDifference(this._tiles,Z);Mt<Sr.length;Mt+=1){var nr=Sr[Mt],xr=this._tiles[nr];xr.hasSymbolBuckets&&!xr.holdingForFade()?xr.setHoldDuration(this.map._fadeDuration):xr.hasSymbolBuckets&&!xr.symbolFadeFinished()||this._removeTile(nr)}this._updateLoadedParentTileCache()}},o.prototype.releaseSymbolFadeTiles=function(){for(var i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)},o.prototype._updateRetainedTiles=function(i,h){for(var g={},E={},C=Math.max(h-o.maxOverzooming,this._source.minzoom),L=Math.max(h+o.maxUnderzooming,this._source.minzoom),Z={},ne=0,me=i;ne<me.length;ne+=1){var ye=me[ne],Se=this._addTile(ye);g[ye.key]=ye,Se.hasData()||h<this._source.maxzoom&&(Z[ye.key]=ye)}this._retainLoadedChildren(Z,h,L,g);for(var Ye=0,Xe=i;Ye<Xe.length;Ye+=1){var ct=Xe[Ye],$e=this._tiles[ct.key];if(!$e.hasData()){if(h+1>this._source.maxzoom){var tt=ct.children(this._source.maxzoom)[0],It=this.getTile(tt);if(It&&It.hasData()){g[tt.key]=tt;continue}}else{var Mt=ct.children(this._source.maxzoom);if(g[Mt[0].key]&&g[Mt[1].key]&&g[Mt[2].key]&&g[Mt[3].key])continue}for(var Sr=$e.wasRequested(),nr=ct.overscaledZ-1;nr>=C;--nr){var xr=ct.scaledTo(nr);if(E[xr.key]||(E[xr.key]=!0,!($e=this.getTile(xr))&&Sr&&($e=this._addTile(xr)),$e&&(g[xr.key]=xr,Sr=$e.wasRequested(),$e.hasData())))break}}}return g},o.prototype._updateLoadedParentTileCache=function(){for(var i in this._loadedParentTiles={},this._tiles){for(var h=[],g=void 0,E=this._tiles[i].tileID;E.overscaledZ>0;){if(E.key in this._loadedParentTiles){g=this._loadedParentTiles[E.key];break}h.push(E.key);var C=E.scaledTo(E.overscaledZ-1);if(g=this._getLoadedTile(C))break;E=C}for(var L=0,Z=h;L<Z.length;L+=1)this._loadedParentTiles[Z[L]]=g}},o.prototype._addTile=function(i){var h=this._tiles[i.key];if(h)return h;(h=this._cache.getAndRemove(i))&&(this._setTileReloadTimer(i.key,h),h.tileID=i,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,h)));var g=Boolean(h);return g||(h=new p.Tile(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,i.key,h.state))),h?(h.uses++,this._tiles[i.key]=h,g||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},o.prototype._setTileReloadTimer=function(i,h){var g=this;i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);var E=h.getExpiryTimeout();E&&(this._timers[i]=setTimeout(function(){g._reloadTile(i,"expired"),delete g._timers[i]},E))},o.prototype._removeTile=function(i){var h=this._tiles[i];h&&(h.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},o.prototype.clearTiles=function(){for(var i in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(i);this._cache.reset()},o.prototype.tilesIn=function(i,h,g){var E=this,C=[],L=this.transform;if(!L)return C;for(var Z=g?L.getCameraQueryGeometry(i):i,ne=i.map(function(nr){return L.pointCoordinate(nr)}),me=Z.map(function(nr){return L.pointCoordinate(nr)}),ye=this.getIds(),Se=1/0,Ye=1/0,Xe=-1/0,ct=-1/0,$e=0,tt=me;$e<tt.length;$e+=1){var It=tt[$e];Se=Math.min(Se,It.x),Ye=Math.min(Ye,It.y),Xe=Math.max(Xe,It.x),ct=Math.max(ct,It.y)}for(var Mt=function(xr){var Cr=E._tiles[ye[xr]];if(!Cr.holdingForFade()){var an=Cr.tileID,Xr=Math.pow(2,L.zoom-Cr.tileID.overscaledZ),vn=h*Cr.queryPadding*p.EXTENT/Cr.tileSize/Xr,An=[an.getTilePoint(new p.MercatorCoordinate(Se,Ye)),an.getTilePoint(new p.MercatorCoordinate(Xe,ct))];if(An[0].x-vn<p.EXTENT&&An[0].y-vn<p.EXTENT&&An[1].x+vn>=0&&An[1].y+vn>=0){var Xn=ne.map(function(Ci){return an.getTilePoint(Ci)}),Qn=me.map(function(Ci){return an.getTilePoint(Ci)});C.push({tile:Cr,tileID:an,queryGeometry:Xn,cameraQueryGeometry:Qn,scale:Xr})}}},Sr=0;Sr<ye.length;Sr++)Mt(Sr);return C},o.prototype.getVisibleCoordinates=function(i){for(var h=this,g=this.getRenderableIds(i).map(function(Z){return h._tiles[Z].tileID}),E=0,C=g;E<C.length;E+=1){var L=C[E];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return g},o.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(kr(this._source.type))for(var i in this._tiles){var h=this._tiles[i];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},o.prototype.setFeatureState=function(i,h,g){this._state.updateState(i=i||"_geojsonTileLayer",h,g)},o.prototype.removeFeatureState=function(i,h,g){this._state.removeFeatureState(i=i||"_geojsonTileLayer",h,g)},o.prototype.getFeatureState=function(i,h){return this._state.getState(i=i||"_geojsonTileLayer",h)},o.prototype.setDependencies=function(i,h,g){var E=this._tiles[i];E&&E.setDependencies(h,g)},o.prototype.reloadTilesForDependencies=function(i,h){for(var g in this._tiles)this._tiles[g].hasDependency(i,h)&&this._reloadTile(g,"reloading");this._cache.filter(function(E){return!E.hasDependency(i,h)})},o}(p.Evented);function Ct(c,o){var i=Math.abs(2*c.wrap)-+(c.wrap<0),h=Math.abs(2*o.wrap)-+(o.wrap<0);return c.overscaledZ-o.overscaledZ||h-i||o.canonical.y-c.canonical.y||o.canonical.x-c.canonical.x}function kr(c){return c==="raster"||c==="image"||c==="video"}function jr(){return new p.window.Worker($c.workerUrl)}Ne.maxOverzooming=10,Ne.maxUnderzooming=3;var $t="mapboxgl_preloaded_worker_pool",yr=function(){this.active={}};yr.prototype.acquire=function(c){if(!this.workers)for(this.workers=[];this.workers.length<yr.workerCount;)this.workers.push(new jr);return this.active[c]=!0,this.workers.slice()},yr.prototype.release=function(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(function(o){o.terminate()}),this.workers=null)},yr.prototype.isPreloaded=function(){return!!this.active[$t]},yr.prototype.numActive=function(){return Object.keys(this.active).length};var qr,gn=Math.floor(p.browser.hardwareConcurrency/2);function dr(){return qr||(qr=new yr),qr}function hn(c,o){var i={};for(var h in c)h!=="ref"&&(i[h]=c[h]);return p.refProperties.forEach(function(g){g in o&&(i[g]=o[g])}),i}function ln(c){c=c.slice();for(var o=Object.create(null),i=0;i<c.length;i++)o[c[i].id]=c[i];for(var h=0;h<c.length;h++)"ref"in c[h]&&(c[h]=hn(c[h],o[c[h].ref]));return c}yr.workerCount=Math.max(Math.min(gn,6),1);var fn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ri(c,o,i){i.push({command:fn.addSource,args:[c,o[c]]})}function dn(c,o,i){o.push({command:fn.removeSource,args:[c]}),i[c]=!0}function ci(c,o,i,h){dn(c,i,h),ri(c,o,i)}function Bi(c,o,i){var h;for(h in c[i])if(c[i].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(c[i][h],o[i][h]))return!1;for(h in o[i])if(o[i].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(c[i][h],o[i][h]))return!1;return!0}function pi(c,o,i,h,g,E){var C;for(C in o=o||{},c=c||{})c.hasOwnProperty(C)&&(p.deepEqual(c[C],o[C])||i.push({command:E,args:[h,C,o[C],g]}));for(C in o)o.hasOwnProperty(C)&&!c.hasOwnProperty(C)&&(p.deepEqual(c[C],o[C])||i.push({command:E,args:[h,C,o[C],g]}))}function _i(c){return c.id}function Ai(c,o){return c[o.id]=o,c}var xo=function(o,i){this.reset(o,i)};xo.prototype.reset=function(c,o){this.points=c||[],this._distances=[0];for(var i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding},xo.prototype.lerp=function(c){if(this.points.length===1)return this.points[0];c=p.clamp(c,0,1);for(var o=1,i=this._distances[o],h=c*this.paddedLength+this.padding;i<h&&o<this._distances.length;)i=this._distances[++o];var g=o-1,E=this._distances[g],C=i-E,L=C>0?(h-E)/C:0;return this.points[g].mult(1-L).add(this.points[o].mult(L))};var Wi=function(o,i,h){var g=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(o/h),this.yCellCount=Math.ceil(i/h);for(var C=0;C<this.xCellCount*this.yCellCount;C++)g.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=i,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0};function mi(c,o,i,h,g){var E=p.create();return o?(p.scale(E,E,[1/g,1/g,1]),i||p.rotateZ(E,E,h.angle)):p.multiply(E,h.labelPlaneMatrix,c),E}function Fn(c,o,i,h,g){if(o){var E=p.clone(c);return p.scale(E,E,[g,g,1]),i||p.rotateZ(E,E,-h.angle),E}return h.glCoordMatrix}function kn(c,o){var i=[c.x,c.y,0,1];Na(i,i,o);var h=i[3];return{point:new p.Point(i[0]/h,i[1]/h),signedDistanceFromCamera:h}}function Zn(c,o){return .5+c/o*.5}function ra(c,o){var i=c[0]/c[3],h=c[1]/c[3];return i>=-o[0]&&i<=o[0]&&h>=-o[1]&&h<=o[1]}function js(c,o,i,h,g,E,C,L){var Z=h?c.textSizeData:c.iconSizeData,ne=p.evaluateSizeForZoom(Z,i.transform.zoom),me=[256/i.width*2+1,256/i.height*2+1],ye=h?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;ye.clear();for(var Se=c.lineVertexArray,Ye=h?c.text.placedSymbolArray:c.icon.placedSymbolArray,Xe=i.transform.width/i.transform.height,ct=!1,$e=0;$e<Ye.length;$e++){var tt=Ye.get($e);if(tt.hidden||tt.writingMode===p.WritingMode.vertical&&!ct)Ya(tt.numGlyphs,ye);else{ct=!1;var It=[tt.anchorX,tt.anchorY,0,1];if(p.transformMat4(It,It,o),ra(It,me)){var Mt=Zn(i.transform.cameraToCenterDistance,It[3]),Sr=p.evaluateSizeForFeature(Z,ne,tt),nr=C?Sr/Mt:Sr*Mt,xr=new p.Point(tt.anchorX,tt.anchorY),Cr=kn(xr,g).point,an={},Xr=mu(tt,nr,!1,L,o,g,E,c.glyphOffsetArray,Se,ye,Cr,xr,an,Xe);ct=Xr.useVertical,(Xr.notEnoughRoom||ct||Xr.needsFlipping&&mu(tt,nr,!0,L,o,g,E,c.glyphOffsetArray,Se,ye,Cr,xr,an,Xe).notEnoughRoom)&&Ya(tt.numGlyphs,ye)}else Ya(tt.numGlyphs,ye)}}h?c.text.dynamicLayoutVertexBuffer.updateData(ye):c.icon.dynamicLayoutVertexBuffer.updateData(ye)}function ua(c,o,i,h,g,E,C,L,Z,ne,me){var ye=L.glyphStartIndex+L.numGlyphs,Se=L.lineStartIndex,Ye=L.lineStartIndex+L.lineLength,Xe=o.getoffsetX(L.glyphStartIndex),ct=o.getoffsetX(ye-1),$e=ya(c*Xe,i,h,g,E,C,L.segment,Se,Ye,Z,ne,me);if(!$e)return null;var tt=ya(c*ct,i,h,g,E,C,L.segment,Se,Ye,Z,ne,me);return tt?{first:$e,last:tt}:null}function Ki(c,o,i,h){return c===p.WritingMode.horizontal&&Math.abs(i.y-o.y)>Math.abs(i.x-o.x)*h?{useVertical:!0}:(c===p.WritingMode.vertical?o.y<i.y:o.x>i.x)?{needsFlipping:!0}:null}function mu(c,o,i,h,g,E,C,L,Z,ne,me,ye,Se,Ye){var Xe,ct=o/24,$e=c.lineOffsetX*ct,tt=c.lineOffsetY*ct;if(c.numGlyphs>1){var It=c.glyphStartIndex+c.numGlyphs,Mt=c.lineStartIndex,Sr=c.lineStartIndex+c.lineLength,nr=ua(ct,L,$e,tt,i,me,ye,c,Z,E,Se);if(!nr)return{notEnoughRoom:!0};var xr=kn(nr.first.point,C).point,Cr=kn(nr.last.point,C).point;if(h&&!i){var an=Ki(c.writingMode,xr,Cr,Ye);if(an)return an}Xe=[nr.first];for(var Xr=c.glyphStartIndex+1;Xr<It-1;Xr++)Xe.push(ya(ct*L.getoffsetX(Xr),$e,tt,i,me,ye,c.segment,Mt,Sr,Z,E,Se));Xe.push(nr.last)}else{if(h&&!i){var vn=kn(ye,g).point,An=c.lineStartIndex+c.segment+1,Xn=new p.Point(Z.getx(An),Z.gety(An)),Qn=kn(Xn,g),Ci=Qn.signedDistanceFromCamera>0?Qn.point:gu(ye,Xn,vn,1,g),Ji=Ki(c.writingMode,vn,Ci,Ye);if(Ji)return Ji}var Sn=ya(ct*L.getoffsetX(c.glyphStartIndex),$e,tt,i,me,ye,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,Z,E,Se);if(!Sn)return{notEnoughRoom:!0};Xe=[Sn]}for(var fi=0,gi=Xe;fi<gi.length;fi+=1){var Un=gi[fi];p.addDynamicAttributes(ne,Un.point,Un.angle)}return{}}function gu(c,o,i,h,g){var E=kn(c.add(c.sub(o)._unit()),g).point,C=i.sub(E);return i.add(C._mult(h/C.mag()))}function ya(c,o,i,h,g,E,C,L,Z,ne,me,ye){var Se=h?c-o:c+o,Ye=Se>0?1:-1,Xe=0;h&&(Ye*=-1,Xe=Math.PI),Ye<0&&(Xe+=Math.PI);for(var ct=Ye>0?L+C:L+C+1,$e=g,tt=g,It=0,Mt=0,Sr=Math.abs(Se),nr=[];It+Mt<=Sr;){if((ct+=Ye)<L||ct>=Z)return null;if(tt=$e,nr.push($e),($e=ye[ct])===void 0){var xr=new p.Point(ne.getx(ct),ne.gety(ct)),Cr=kn(xr,me);if(Cr.signedDistanceFromCamera>0)$e=ye[ct]=Cr.point;else{var an=ct-Ye;$e=gu(It===0?E:new p.Point(ne.getx(an),ne.gety(an)),xr,tt,Sr-It+1,me)}}It+=Mt,Mt=tt.dist($e)}var Xr=(Sr-It)/Mt,vn=$e.sub(tt),An=vn.mult(Xr)._add(tt);An._add(vn._unit()._perp()._mult(i*Ye));var Xn=Xe+Math.atan2($e.y-tt.y,$e.x-tt.x);return nr.push(An),{point:An,angle:Xn,path:nr}}Wi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Wi.prototype.insert=function(c,o,i,h,g){this._forEachCell(o,i,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(o),this.bboxes.push(i),this.bboxes.push(h),this.bboxes.push(g)},Wi.prototype.insertCircle=function(c,o,i,h){this._forEachCell(o-h,i-h,o+h,i+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(o),this.circles.push(i),this.circles.push(h)},Wi.prototype._insertBoxCell=function(c,o,i,h,g,E){this.boxCells[g].push(E)},Wi.prototype._insertCircleCell=function(c,o,i,h,g,E){this.circleCells[g].push(E)},Wi.prototype._query=function(c,o,i,h,g,E){if(i<0||c>this.width||h<0||o>this.height)return!g&&[];var C=[];if(c<=0&&o<=0&&this.width<=i&&this.height<=h){if(g)return!0;for(var L=0;L<this.boxKeys.length;L++)C.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var Z=0;Z<this.circleKeys.length;Z++){var ne=this.circles[3*Z],me=this.circles[3*Z+1],ye=this.circles[3*Z+2];C.push({key:this.circleKeys[Z],x1:ne-ye,y1:me-ye,x2:ne+ye,y2:me+ye})}return E?C.filter(E):C}return this._forEachCell(c,o,i,h,this._queryCell,C,{hitTest:g,seenUids:{box:{},circle:{}}},E),g?C.length>0:C},Wi.prototype._queryCircle=function(c,o,i,h,g){var E=c-i,C=c+i,L=o-i,Z=o+i;if(C<0||E>this.width||Z<0||L>this.height)return!h&&[];var ne=[];return this._forEachCell(E,L,C,Z,this._queryCellCircle,ne,{hitTest:h,circle:{x:c,y:o,radius:i},seenUids:{box:{},circle:{}}},g),h?ne.length>0:ne},Wi.prototype.query=function(c,o,i,h,g){return this._query(c,o,i,h,!1,g)},Wi.prototype.hitTest=function(c,o,i,h,g){return this._query(c,o,i,h,!0,g)},Wi.prototype.hitTestCircle=function(c,o,i,h){return this._queryCircle(c,o,i,!0,h)},Wi.prototype._queryCell=function(c,o,i,h,g,E,C,L){var Z=C.seenUids,ne=this.boxCells[g];if(ne!==null)for(var me=this.bboxes,ye=0,Se=ne;ye<Se.length;ye+=1){var Ye=Se[ye];if(!Z.box[Ye]){Z.box[Ye]=!0;var Xe=4*Ye;if(c<=me[Xe+2]&&o<=me[Xe+3]&&i>=me[Xe+0]&&h>=me[Xe+1]&&(!L||L(this.boxKeys[Ye]))){if(C.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[Ye],x1:me[Xe],y1:me[Xe+1],x2:me[Xe+2],y2:me[Xe+3]})}}}var ct=this.circleCells[g];if(ct!==null)for(var $e=this.circles,tt=0,It=ct;tt<It.length;tt+=1){var Mt=It[tt];if(!Z.circle[Mt]){Z.circle[Mt]=!0;var Sr=3*Mt;if(this._circleAndRectCollide($e[Sr],$e[Sr+1],$e[Sr+2],c,o,i,h)&&(!L||L(this.circleKeys[Mt]))){if(C.hitTest)return E.push(!0),!0;var nr=$e[Sr],xr=$e[Sr+1],Cr=$e[Sr+2];E.push({key:this.circleKeys[Mt],x1:nr-Cr,y1:xr-Cr,x2:nr+Cr,y2:xr+Cr})}}}},Wi.prototype._queryCellCircle=function(c,o,i,h,g,E,C,L){var Z=C.circle,ne=C.seenUids,me=this.boxCells[g];if(me!==null)for(var ye=this.bboxes,Se=0,Ye=me;Se<Ye.length;Se+=1){var Xe=Ye[Se];if(!ne.box[Xe]){ne.box[Xe]=!0;var ct=4*Xe;if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,ye[ct+0],ye[ct+1],ye[ct+2],ye[ct+3])&&(!L||L(this.boxKeys[Xe])))return E.push(!0),!0}}var $e=this.circleCells[g];if($e!==null)for(var tt=this.circles,It=0,Mt=$e;It<Mt.length;It+=1){var Sr=Mt[It];if(!ne.circle[Sr]){ne.circle[Sr]=!0;var nr=3*Sr;if(this._circlesCollide(tt[nr],tt[nr+1],tt[nr+2],Z.x,Z.y,Z.radius)&&(!L||L(this.circleKeys[Sr])))return E.push(!0),!0}}},Wi.prototype._forEachCell=function(c,o,i,h,g,E,C,L){for(var Z=this._convertToXCellCoord(c),ne=this._convertToYCellCoord(o),me=this._convertToXCellCoord(i),ye=this._convertToYCellCoord(h),Se=Z;Se<=me;Se++)for(var Ye=ne;Ye<=ye;Ye++)if(g.call(this,c,o,i,h,this.xCellCount*Ye+Se,E,C,L))return},Wi.prototype._convertToXCellCoord=function(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))},Wi.prototype._convertToYCellCoord=function(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))},Wi.prototype._circlesCollide=function(c,o,i,h,g,E){var C=h-c,L=g-o,Z=i+E;return Z*Z>C*C+L*L},Wi.prototype._circleAndRectCollide=function(c,o,i,h,g,E,C){var L=(E-h)/2,Z=Math.abs(c-(h+L));if(Z>L+i)return!1;var ne=(C-g)/2,me=Math.abs(o-(g+ne));if(me>ne+i)return!1;if(Z<=L||me<=ne)return!0;var ye=Z-L,Se=me-ne;return ye*ye+Se*Se<=i*i};var no=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ya(c,o){for(var i=0;i<c;i++){var h=o.length;o.resize(h+4),o.float32.set(no,3*h)}}function Na(c,o,i){var h=o[0],g=o[1];return c[0]=i[0]*h+i[4]*g+i[12],c[1]=i[1]*h+i[5]*g+i[13],c[3]=i[3]*h+i[7]*g+i[15],c}var Ho=function(o,i,h){i===void 0&&(i=new Wi(o.width+200,o.height+200,25)),h===void 0&&(h=new Wi(o.width+200,o.height+200,25)),this.transform=o,this.grid=i,this.ignoredGrid=h,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+100,this.screenBottomBoundary=o.height+100,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200};function aa(c,o,i){return o*(p.EXTENT/(c.tileSize*Math.pow(2,i-c.tileID.overscaledZ)))}Ho.prototype.placeCollisionBox=function(c,o,i,h,g){var E=this.projectAndGetPerspectiveRatio(h,c.anchorPointX,c.anchorPointY),C=i*E.perspectiveRatio,L=c.x1*C+E.point.x,Z=c.y1*C+E.point.y,ne=c.x2*C+E.point.x,me=c.y2*C+E.point.y;return!this.isInsideGrid(L,Z,ne,me)||!o&&this.grid.hitTest(L,Z,ne,me,g)?{box:[],offscreen:!1}:{box:[L,Z,ne,me],offscreen:this.isOffscreen(L,Z,ne,me)}},Ho.prototype.placeCollisionCircles=function(c,o,i,h,g,E,C,L,Z,ne,me,ye,Se){var Ye=[],Xe=new p.Point(o.anchorX,o.anchorY),ct=kn(Xe,E),$e=Zn(this.transform.cameraToCenterDistance,ct.signedDistanceFromCamera),tt=(ne?g/$e:g*$e)/p.ONE_EM,It=kn(Xe,C).point,Mt=ua(tt,h,o.lineOffsetX*tt,o.lineOffsetY*tt,!1,It,Xe,o,i,C,{}),Sr=!1,nr=!1,xr=!0;if(Mt){for(var Cr=.5*ye*$e+Se,an=new p.Point(-100,-100),Xr=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),vn=new xo,An=Mt.first,Xn=Mt.last,Qn=[],Ci=An.path.length-1;Ci>=1;Ci--)Qn.push(An.path[Ci]);for(var Ji=1;Ji<Xn.path.length;Ji++)Qn.push(Xn.path[Ji]);var Sn=2.5*Cr;if(L){var fi=Qn.map(function(zs){return kn(zs,L)});Qn=fi.some(function(zs){return zs.signedDistanceFromCamera<=0})?[]:fi.map(function(zs){return zs.point})}var gi=[];if(Qn.length>0){for(var Un=Qn[0].clone(),di=Qn[0].clone(),Kn=1;Kn<Qn.length;Kn++)Un.x=Math.min(Un.x,Qn[Kn].x),Un.y=Math.min(Un.y,Qn[Kn].y),di.x=Math.max(di.x,Qn[Kn].x),di.y=Math.max(di.y,Qn[Kn].y);gi=Un.x>=an.x&&di.x<=Xr.x&&Un.y>=an.y&&di.y<=Xr.y?[Qn]:di.x<an.x||Un.x>Xr.x||di.y<an.y||Un.y>Xr.y?[]:p.clipLine([Qn],an.x,an.y,Xr.x,Xr.y)}for(var Si=0,Gi=gi;Si<Gi.length;Si+=1){var yo;vn.reset(Gi[Si],.25*Cr),yo=vn.length<=.5*Cr?1:Math.ceil(vn.paddedLength/Sn)+1;for(var uo=0;uo<yo;uo++){var Oo=uo/Math.max(yo-1,1),Ua=vn.lerp(Oo),Xa=Ua.x+100,Cs=Ua.y+100;Ye.push(Xa,Cs,Cr,0);var Ko=Xa-Cr,Wu=Cs-Cr,Lu=Xa+Cr,ss=Cs+Cr;if(xr=xr&&this.isOffscreen(Ko,Wu,Lu,ss),nr=nr||this.isInsideGrid(Ko,Wu,Lu,ss),!c&&this.grid.hitTestCircle(Xa,Cs,Cr,me)&&(Sr=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:Sr}}}}return{circles:!Z&&Sr||!nr?[]:Ye,offscreen:xr,collisionDetected:Sr}},Ho.prototype.queryRenderedSymbols=function(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var o=[],i=1/0,h=1/0,g=-1/0,E=-1/0,C=0,L=c;C<L.length;C+=1){var Z=L[C],ne=new p.Point(Z.x+100,Z.y+100);i=Math.min(i,ne.x),h=Math.min(h,ne.y),g=Math.max(g,ne.x),E=Math.max(E,ne.y),o.push(ne)}for(var me={},ye={},Se=0,Ye=this.grid.query(i,h,g,E).concat(this.ignoredGrid.query(i,h,g,E));Se<Ye.length;Se+=1){var Xe=Ye[Se],ct=Xe.key;if(me[ct.bucketInstanceId]===void 0&&(me[ct.bucketInstanceId]={}),!me[ct.bucketInstanceId][ct.featureIndex]){var $e=[new p.Point(Xe.x1,Xe.y1),new p.Point(Xe.x2,Xe.y1),new p.Point(Xe.x2,Xe.y2),new p.Point(Xe.x1,Xe.y2)];p.polygonIntersectsPolygon(o,$e)&&(me[ct.bucketInstanceId][ct.featureIndex]=!0,ye[ct.bucketInstanceId]===void 0&&(ye[ct.bucketInstanceId]=[]),ye[ct.bucketInstanceId].push(ct.featureIndex))}}return ye},Ho.prototype.insertCollisionBox=function(c,o,i,h,g){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:h,collisionGroupID:g},c[0],c[1],c[2],c[3])},Ho.prototype.insertCollisionCircles=function(c,o,i,h,g){for(var E=o?this.ignoredGrid:this.grid,C={bucketInstanceId:i,featureIndex:h,collisionGroupID:g},L=0;L<c.length;L+=4)E.insertCircle(C,c[L],c[L+1],c[L+2])},Ho.prototype.projectAndGetPerspectiveRatio=function(c,o,i){var h=[o,i,0,1];return Na(h,h,c),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Ho.prototype.isOffscreen=function(c,o,i,h){return i<100||c>=this.screenRightBoundary||h<100||o>this.screenBottomBoundary},Ho.prototype.isInsideGrid=function(c,o,i,h){return i>=0&&c<this.gridRightBoundary&&h>=0&&o<this.gridBottomBoundary},Ho.prototype.getViewportMatrix=function(){var c=p.identity([]);return p.translate(c,c,[-100,-100,0]),c};var Ga=function(o,i,h,g){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?i:-i))):g&&h?1:0,this.placed=h};Ga.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var io=function(o,i,h,g,E){this.text=new Ga(o?o.text:null,i,h,E),this.icon=new Ga(o?o.icon:null,i,g,E)};io.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var oa=function(o,i,h){this.text=o,this.icon=i,this.skipFade=h},qi=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},Pl=function(o,i,h,g,E){this.bucketInstanceId=o,this.featureIndex=i,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=E},ts=function(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}};function $a(c,o,i,h,g){var E=p.getAnchorAlignment(c),C=-(E.horizontalAlign-.5)*o,L=-(E.verticalAlign-.5)*i,Z=p.evaluateVariableOffset(c,h);return new p.Point(C+Z[0]*g,L+Z[1]*g)}function Ha(c,o,i,h,g,E){var C=c.x1,L=c.x2,Z=c.y1,ne=c.y2,me=c.anchorPointX,ye=c.anchorPointY,Se=new p.Point(o,i);return h&&Se._rotate(g?E:-E),{x1:C+Se.x,y1:Z+Se.y,x2:L+Se.x,y2:ne+Se.y,anchorPointX:me,anchorPointY:ye}}ts.prototype.get=function(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){var o=++this.maxGroupID;this.collisionGroups[c]={ID:o,predicate:function(h){return h.collisionGroupID===o}}}return this.collisionGroups[c]};var la=function(o,i,h,g){this.transform=o.clone(),this.collisionIndex=new Ho(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new ts(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function it(c,o,i,h,g){c.emplaceBack(o?1:0,i?1:0,h||0,g||0),c.emplaceBack(o?1:0,i?1:0,h||0,g||0),c.emplaceBack(o?1:0,i?1:0,h||0,g||0),c.emplaceBack(o?1:0,i?1:0,h||0,g||0)}la.prototype.getBucketParts=function(c,o,i,h){var g=i.getBucket(o),E=i.latestFeatureIndex;if(g&&E&&o.id===g.layerIds[0]){var C=i.collisionBoxArray,L=g.layers[0].layout,Z=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),ne=i.tileSize/p.EXTENT,me=this.transform.calculatePosMatrix(i.tileID.toUnwrapped()),ye=L.get("text-pitch-alignment")==="map",Se=L.get("text-rotation-alignment")==="map",Ye=aa(i,1,this.transform.zoom),Xe=mi(me,ye,Se,this.transform,Ye),ct=null;if(ye){var $e=Fn(me,ye,Se,this.transform,Ye);ct=p.multiply([],this.transform.labelPlaneMatrix,$e)}this.retainedQueryData[g.bucketInstanceId]=new Pl(g.bucketInstanceId,E,g.sourceLayerIndex,g.index,i.tileID);var tt={bucket:g,layout:L,posMatrix:me,textLabelPlaneMatrix:Xe,labelToScreenMatrix:ct,scale:Z,textPixelRatio:ne,holdingForFade:i.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(var It=0,Mt=g.sortKeyRanges;It<Mt.length;It+=1){var Sr=Mt[It];c.push({sortKey:Sr.sortKey,symbolInstanceStart:Sr.symbolInstanceStart,symbolInstanceEnd:Sr.symbolInstanceEnd,parameters:tt})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:tt})}},la.prototype.attemptAnchorPlacement=function(c,o,i,h,g,E,C,L,Z,ne,me,ye,Se,Ye,Xe){var ct,$e=[ye.textOffset0,ye.textOffset1],tt=$a(c,i,h,$e,g),It=this.collisionIndex.placeCollisionBox(Ha(o,tt.x,tt.y,E,C,this.transform.angle),me,L,Z,ne.predicate);if(!Xe||this.collisionIndex.placeCollisionBox(Ha(Xe,tt.x,tt.y,E,C,this.transform.angle),me,L,Z,ne.predicate).box.length!==0)return It.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID].text&&(ct=this.prevPlacement.variableOffsets[ye.crossTileID].anchor),this.variableOffsets[ye.crossTileID]={textOffset:$e,width:i,height:h,anchor:c,textBoxScale:g,prevAnchor:ct},this.markUsedJustification(Se,c,ye,Ye),Se.allowVerticalPlacement&&(this.markUsedOrientation(Se,Ye,ye),this.placedOrientations[ye.crossTileID]=Ye),{shift:tt,placedGlyphBoxes:It}):void 0},la.prototype.placeLayerBucketPart=function(c,o,i){var h=this,g=c.parameters,E=g.bucket,C=g.layout,L=g.posMatrix,Z=g.textLabelPlaneMatrix,ne=g.labelToScreenMatrix,me=g.textPixelRatio,ye=g.holdingForFade,Se=g.collisionBoxArray,Ye=g.partiallyEvaluatedTextSize,Xe=g.collisionGroup,ct=C.get("text-optional"),$e=C.get("icon-optional"),tt=C.get("text-allow-overlap"),It=C.get("icon-allow-overlap"),Mt=C.get("text-rotation-alignment")==="map",Sr=C.get("text-pitch-alignment")==="map",nr=C.get("icon-text-fit")!=="none",xr=C.get("symbol-z-order")==="viewport-y",Cr=tt&&(It||!E.hasIconData()||$e),an=It&&(tt||!E.hasTextData()||ct);!E.collisionArrays&&Se&&E.deserializeCollisionBoxes(Se);var Xr=function(Sn,fi){if(!o[Sn.crossTileID])if(ye)h.placements[Sn.crossTileID]=new oa(!1,!1,!1);else{var gi,Un=!1,di=!1,Kn=!0,Si=null,Gi={box:null,offscreen:null},yo={box:null,offscreen:null},uo=null,Oo=null,Ua=0,Xa=0,Cs=0;fi.textFeatureIndex?Ua=fi.textFeatureIndex:Sn.useRuntimeCollisionCircles&&(Ua=Sn.featureIndex),fi.verticalTextFeatureIndex&&(Xa=fi.verticalTextFeatureIndex);var Ko=fi.textBox;if(Ko){var Wu=function(Lo){var us=p.WritingMode.horizontal;if(E.allowVerticalPlacement&&!Lo&&h.prevPlacement){var Ro=h.prevPlacement.placedOrientations[Sn.crossTileID];Ro&&(h.placedOrientations[Sn.crossTileID]=Ro,h.markUsedOrientation(E,us=Ro,Sn))}return us},Lu=function(Lo,us){if(E.allowVerticalPlacement&&Sn.numVerticalGlyphVertices>0&&fi.verticalTextBox)for(var Ro=0,Ws=E.writingModes;Ro<Ws.length&&(Ws[Ro]===p.WritingMode.vertical?(Gi=us(),yo=Gi):Gi=Lo(),!(Gi&&Gi.box&&Gi.box.length));Ro+=1);else Gi=Lo()};if(C.get("text-variable-anchor")){var ss=C.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[Sn.crossTileID]){var zs=h.prevPlacement.variableOffsets[Sn.crossTileID];ss.indexOf(zs.anchor)>0&&(ss=ss.filter(function(No){return No!==zs.anchor})).unshift(zs.anchor)}var El=function(Lo,us,Ro){for(var Ws=Lo.x2-Lo.x1,Tl=Lo.y2-Lo.y1,uc=Sn.textBoxScale,Xu=nr&&!It?us:null,ku={box:[],offscreen:!1},Cc=tt?2*ss.length:ss.length,Al=0;Al<Cc;++Al){var Ms=h.attemptAnchorPlacement(ss[Al%ss.length],Lo,Ws,Tl,uc,Mt,Sr,me,L,Xe,Al>=ss.length,Sn,E,Ro,Xu);if(Ms&&(ku=Ms.placedGlyphBoxes)&&ku.box&&ku.box.length){Un=!0,Si=Ms.shift;break}}return ku};Lu(function(){return El(Ko,fi.iconBox,p.WritingMode.horizontal)},function(){var No=fi.verticalTextBox;return E.allowVerticalPlacement&&!(Gi&&Gi.box&&Gi.box.length)&&Sn.numVerticalGlyphVertices>0&&No?El(No,fi.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),Gi&&(Un=Gi.box,Kn=Gi.offscreen);var Ac=Wu(Gi&&Gi.box);if(!Un&&h.prevPlacement){var Ru=h.prevPlacement.variableOffsets[Sn.crossTileID];Ru&&(h.variableOffsets[Sn.crossTileID]=Ru,h.markUsedJustification(E,Ru.anchor,Sn,Ac))}}else{var ol=function(Lo,us){var Ro=h.collisionIndex.placeCollisionBox(Lo,tt,me,L,Xe.predicate);return Ro&&Ro.box&&Ro.box.length&&(h.markUsedOrientation(E,us,Sn),h.placedOrientations[Sn.crossTileID]=us),Ro};Lu(function(){return ol(Ko,p.WritingMode.horizontal)},function(){var No=fi.verticalTextBox;return E.allowVerticalPlacement&&Sn.numVerticalGlyphVertices>0&&No?ol(No,p.WritingMode.vertical):{box:null,offscreen:null}}),Wu(Gi&&Gi.box&&Gi.box.length)}}if(Un=(gi=Gi)&&gi.box&&gi.box.length>0,Kn=gi&&gi.offscreen,Sn.useRuntimeCollisionCircles){var Hl=E.text.placedSymbolArray.get(Sn.centerJustifiedTextSymbolIndex),Du=p.evaluateSizeForFeature(E.textSizeData,Ye,Hl),sc=C.get("text-padding");uo=h.collisionIndex.placeCollisionCircles(tt,Hl,E.lineVertexArray,E.glyphOffsetArray,Du,L,Z,ne,i,Sr,Xe.predicate,Sn.collisionCircleDiameter,sc),Un=tt||uo.circles.length>0&&!uo.collisionDetected,Kn=Kn&&uo.offscreen}if(fi.iconFeatureIndex&&(Cs=fi.iconFeatureIndex),fi.iconBox){var fu=function(Lo){var us=nr&&Si?Ha(Lo,Si.x,Si.y,Mt,Sr,h.transform.angle):Lo;return h.collisionIndex.placeCollisionBox(us,It,me,L,Xe.predicate)};di=yo&&yo.box&&yo.box.length&&fi.verticalIconBox?(Oo=fu(fi.verticalIconBox)).box.length>0:(Oo=fu(fi.iconBox)).box.length>0,Kn=Kn&&Oo.offscreen}var lo=ct||Sn.numHorizontalGlyphVertices===0&&Sn.numVerticalGlyphVertices===0,hu=$e||Sn.numIconVertices===0;if(lo||hu?hu?lo||(di=di&&Un):Un=di&&Un:di=Un=di&&Un,Un&&gi&&gi.box&&h.collisionIndex.insertCollisionBox(gi.box,C.get("text-ignore-placement"),E.bucketInstanceId,yo&&yo.box&&Xa?Xa:Ua,Xe.ID),di&&Oo&&h.collisionIndex.insertCollisionBox(Oo.box,C.get("icon-ignore-placement"),E.bucketInstanceId,Cs,Xe.ID),uo&&(Un&&h.collisionIndex.insertCollisionCircles(uo.circles,C.get("text-ignore-placement"),E.bucketInstanceId,Ua,Xe.ID),i)){var wl=E.bucketInstanceId,Ps=h.collisionCircleArrays[wl];Ps===void 0&&(Ps=h.collisionCircleArrays[wl]=new qi);for(var Eo=0;Eo<uo.circles.length;Eo+=4)Ps.circles.push(uo.circles[Eo+0]),Ps.circles.push(uo.circles[Eo+1]),Ps.circles.push(uo.circles[Eo+2]),Ps.circles.push(uo.collisionDetected?1:0)}h.placements[Sn.crossTileID]=new oa(Un||Cr,di||an,Kn||E.justReloaded),o[Sn.crossTileID]=!0}};if(xr)for(var vn=E.getSortedSymbolIndexes(this.transform.angle),An=vn.length-1;An>=0;--An){var Xn=vn[An];Xr(E.symbolInstances.get(Xn),E.collisionArrays[Xn])}else for(var Qn=c.symbolInstanceStart;Qn<c.symbolInstanceEnd;Qn++)Xr(E.symbolInstances.get(Qn),E.collisionArrays[Qn]);if(i&&E.bucketInstanceId in this.collisionCircleArrays){var Ci=this.collisionCircleArrays[E.bucketInstanceId];p.invert(Ci.invProjMatrix,L),Ci.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1},la.prototype.markUsedJustification=function(c,o,i,h){var g;g=h===p.WritingMode.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(o)];for(var E=0,C=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];E<C.length;E+=1){var L=C[E];L>=0&&(c.text.placedSymbolArray.get(L).crossTileID=g>=0&&L!==g?0:i.crossTileID)}},la.prototype.markUsedOrientation=function(c,o,i){for(var h=o===p.WritingMode.horizontal||o===p.WritingMode.horizontalOnly?o:0,g=o===p.WritingMode.vertical?o:0,E=0,C=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];E<C.length;E+=1)c.text.placedSymbolArray.get(C[E]).placedOrientation=h;i.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=g)},la.prototype.commit=function(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;var o=this.prevPlacement,i=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;var h=o?o.symbolFadeChange(c):1,g=o?o.opacities:{},E=o?o.variableOffsets:{},C=o?o.placedOrientations:{};for(var L in this.placements){var Z=this.placements[L],ne=g[L];ne?(this.opacities[L]=new io(ne,h,Z.text,Z.icon),i=i||Z.text!==ne.text.placed||Z.icon!==ne.icon.placed):(this.opacities[L]=new io(null,h,Z.text,Z.icon,Z.skipFade),i=i||Z.text||Z.icon)}for(var me in g){var ye=g[me];if(!this.opacities[me]){var Se=new io(ye,h,!1,!1);Se.isHidden()||(this.opacities[me]=Se,i=i||ye.text.placed||ye.icon.placed)}}for(var Ye in E)this.variableOffsets[Ye]||!this.opacities[Ye]||this.opacities[Ye].isHidden()||(this.variableOffsets[Ye]=E[Ye]);for(var Xe in C)this.placedOrientations[Xe]||!this.opacities[Xe]||this.opacities[Xe].isHidden()||(this.placedOrientations[Xe]=C[Xe]);i?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:c)},la.prototype.updateLayerOpacities=function(c,o){for(var i={},h=0,g=o;h<g.length;h+=1){var E=g[h],C=E.getBucket(c);C&&E.latestFeatureIndex&&c.id===C.layerIds[0]&&this.updateBucketOpacities(C,i,E.collisionBoxArray)}},la.prototype.updateBucketOpacities=function(c,o,i){var h=this;c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();var g=c.layers[0].layout,E=new io(null,0,!1,!1,!0),C=g.get("text-allow-overlap"),L=g.get("icon-allow-overlap"),Z=g.get("text-variable-anchor"),ne=g.get("text-rotation-alignment")==="map",me=g.get("text-pitch-alignment")==="map",ye=g.get("icon-text-fit")!=="none",Se=new io(null,0,C&&(L||!c.hasIconData()||g.get("icon-optional")),L&&(C||!c.hasTextData()||g.get("text-optional")),!0);!c.collisionArrays&&i&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(i);for(var Ye=function(It,Mt,Sr){for(var nr=0;nr<Mt/4;nr++)It.opacityVertexArray.emplaceBack(Sr)},Xe=function(It){var Mt=c.symbolInstances.get(It),Sr=Mt.numHorizontalGlyphVertices,nr=Mt.numVerticalGlyphVertices,xr=Mt.crossTileID,Cr=h.opacities[xr];o[xr]?Cr=E:Cr||(h.opacities[xr]=Cr=Se),o[xr]=!0;var an=Mt.numIconVertices>0,Xr=h.placedOrientations[Mt.crossTileID],vn=Xr===p.WritingMode.vertical,An=Xr===p.WritingMode.horizontal||Xr===p.WritingMode.horizontalOnly;if(Sr>0||nr>0){var Xn=Vi(Cr.text);Ye(c.text,Sr,vn?Wa:Xn),Ye(c.text,nr,An?Wa:Xn);var Qn=Cr.text.isHidden();[Mt.rightJustifiedTextSymbolIndex,Mt.centerJustifiedTextSymbolIndex,Mt.leftJustifiedTextSymbolIndex].forEach(function(Gi){Gi>=0&&(c.text.placedSymbolArray.get(Gi).hidden=Qn||vn?1:0)}),Mt.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(Mt.verticalPlacedTextSymbolIndex).hidden=Qn||An?1:0);var Ci=h.variableOffsets[Mt.crossTileID];Ci&&h.markUsedJustification(c,Ci.anchor,Mt,Xr);var Ji=h.placedOrientations[Mt.crossTileID];Ji&&(h.markUsedJustification(c,"left",Mt,Ji),h.markUsedOrientation(c,Ji,Mt))}if(an){var Sn=Vi(Cr.icon),fi=!(ye&&Mt.verticalPlacedIconSymbolIndex&&vn);Mt.placedIconSymbolIndex>=0&&(Ye(c.icon,Mt.numIconVertices,fi?Sn:Wa),c.icon.placedSymbolArray.get(Mt.placedIconSymbolIndex).hidden=Cr.icon.isHidden()),Mt.verticalPlacedIconSymbolIndex>=0&&(Ye(c.icon,Mt.numVerticalIconVertices,fi?Wa:Sn),c.icon.placedSymbolArray.get(Mt.verticalPlacedIconSymbolIndex).hidden=Cr.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){var gi=c.collisionArrays[It];if(gi){var Un=new p.Point(0,0);if(gi.textBox||gi.verticalTextBox){var di=!0;if(Z){var Kn=h.variableOffsets[xr];Kn?(Un=$a(Kn.anchor,Kn.width,Kn.height,Kn.textOffset,Kn.textBoxScale),ne&&Un._rotate(me?h.transform.angle:-h.transform.angle)):di=!1}gi.textBox&&it(c.textCollisionBox.collisionVertexArray,Cr.text.placed,!di||vn,Un.x,Un.y),gi.verticalTextBox&&it(c.textCollisionBox.collisionVertexArray,Cr.text.placed,!di||An,Un.x,Un.y)}var Si=Boolean(!An&&gi.verticalIconBox);gi.iconBox&&it(c.iconCollisionBox.collisionVertexArray,Cr.icon.placed,Si,ye?Un.x:0,ye?Un.y:0),gi.verticalIconBox&&it(c.iconCollisionBox.collisionVertexArray,Cr.icon.placed,!Si,ye?Un.x:0,ye?Un.y:0)}}},ct=0;ct<c.symbolInstances.length;ct++)Xe(ct);if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){var $e=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=$e.invProjMatrix,c.placementViewportMatrix=$e.viewportMatrix,c.collisionCircleArray=$e.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}},la.prototype.symbolFadeChange=function(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},la.prototype.zoomAdjustment=function(c){return Math.max(0,(this.transform.zoom-c)/1.5)},la.prototype.hasTransitions=function(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration},la.prototype.stillRecent=function(c,o){var i=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*i>c},la.prototype.setStale=function(){this.stale=!0};var pe=Math.pow(2,25),Ke=Math.pow(2,24),qt=Math.pow(2,17),Wr=Math.pow(2,16),bn=Math.pow(2,9),xi=Math.pow(2,8),_a=Math.pow(2,1);function Vi(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;var o=c.placed?1:0,i=Math.floor(127*c.opacity);return i*pe+o*Ke+i*qt+o*Wr+i*bn+o*xi+i*_a+o}var Wa=0,ko=function(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ko.prototype.continuePlacement=function(c,o,i,h,g){for(var E=this._bucketParts;this._currentTileIndex<c.length;)if(o.getBucketParts(E,h,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort(function(C,L){return C.sortKey-L.sortKey}));this._currentPartIndex<E.length;)if(o.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,g())return!0;return!1};var yu=function(o,i,h,g,E,C,L){this.placement=new la(o,E,C,L),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1};yu.prototype.isDone=function(){return this._done},yu.prototype.continuePlacement=function(c,o,i){for(var h=this,g=p.browser.now(),E=function(){var ne=p.browser.now()-g;return!h._forceFullPlacement&&ne>2};this._currentPlacementIndex>=0;){var C=o[c[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=L)&&(!C.maxzoom||C.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new ko(C)),this._inProgressLayer.continuePlacement(i[C.source],this.placement,this._showCollisionBoxes,C,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},yu.prototype.commit=function(c){return this.placement.commit(c),this.placement};var _u=512/p.EXTENT/2,Qu=function(o,i,h){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var g=0;g<i.length;g++){var E=i.get(g),C=E.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,o)})}};Qu.prototype.getScaledCoordinates=function(c,o){var i=_u/Math.pow(2,o.canonical.z-this.tileID.canonical.z);return{x:Math.floor((o.canonical.x*p.EXTENT+c.anchorX)*i),y:Math.floor((o.canonical.y*p.EXTENT+c.anchorY)*i)}},Qu.prototype.findMatches=function(c,o,i){for(var h=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),g=0;g<c.length;g++){var E=c.get(g);if(!E.crossTileID){var C=this.indexedSymbolInstances[E.key];if(C)for(var L=this.getScaledCoordinates(E,o),Z=0,ne=C;Z<ne.length;Z+=1){var me=ne[Z];if(Math.abs(me.coord.x-L.x)<=h&&Math.abs(me.coord.y-L.y)<=h&&!i[me.crossTileID]){i[me.crossTileID]=!0,E.crossTileID=me.crossTileID;break}}}}};var rs=function(){this.maxCrossTileID=0};rs.prototype.generate=function(){return++this.maxCrossTileID};var ds=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ds.prototype.handleWrapJump=function(c){var o=Math.round((c-this.lng)/360);if(o!==0)for(var i in this.indexes){var h=this.indexes[i],g={};for(var E in h){var C=h[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+o),g[C.tileID.key]=C}this.indexes[i]=g}this.lng=c},ds.prototype.addBucket=function(c,o,i){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(var h=0;h<o.symbolInstances.length;h++)o.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});var g=this.usedCrossTileIDs[c.overscaledZ];for(var E in this.indexes){var C=this.indexes[E];if(Number(E)>c.overscaledZ)for(var L in C){var Z=C[L];Z.tileID.isChildOf(c)&&Z.findMatches(o.symbolInstances,c,g)}else{var ne=C[c.scaledTo(Number(E)).key];ne&&ne.findMatches(o.symbolInstances,c,g)}}for(var me=0;me<o.symbolInstances.length;me++){var ye=o.symbolInstances.get(me);ye.crossTileID||(ye.crossTileID=i.generate(),g[ye.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Qu(c,o.symbolInstances,o.bucketInstanceId),!0},ds.prototype.removeBucketCrossTileIDs=function(c,o){for(var i in o.indexedSymbolInstances)for(var h=0,g=o.indexedSymbolInstances[i];h<g.length;h+=1)delete this.usedCrossTileIDs[c][g[h].crossTileID]},ds.prototype.removeStaleBuckets=function(c){var o=!1;for(var i in this.indexes){var h=this.indexes[i];for(var g in h)c[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,h[g]),delete h[g],o=!0)}return o};var ao=function(){this.layerIndexes={},this.crossTileIDs=new rs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ao.prototype.addLayer=function(c,o,i){var h=this.layerIndexes[c.id];h===void 0&&(h=this.layerIndexes[c.id]=new ds);var g=!1,E={};h.handleWrapJump(i);for(var C=0,L=o;C<L.length;C+=1){var Z=L[C],ne=Z.getBucket(c);ne&&c.id===ne.layerIds[0]&&(ne.bucketInstanceId||(ne.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(Z.tileID,ne,this.crossTileIDs)&&(g=!0),E[ne.bucketInstanceId]=!0)}return h.removeStaleBuckets(E)&&(g=!0),g},ao.prototype.pruneUnusedLayers=function(c){var o={};for(var i in c.forEach(function(h){o[h]=!0}),this.layerIndexes)o[i]||delete this.layerIndexes[i]};var Ds=function(o,i){return p.emitValidationErrors(o,i&&i.filter(function(h){return h.identifier!=="source.canvas"}))},su=p.pick(fn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),xa=p.pick(fn,["setCenter","setZoom","setBearing","setPitch"]),bi=function(){var c={},o=p.styleSpec.$version;for(var i in p.styleSpec.$root){var h,g=p.styleSpec.$root[i];g.required&&(h=i==="version"?o:g.type==="array"?[]:{})!=null&&(c[i]=h)}return c}(),Ja=function(c){function o(i,h){var g=this;h===void 0&&(h={}),c.call(this),this.map=i,this.dispatcher=new Te(dr(),this),this.imageManager=new Xt,this.imageManager.setEventedParent(this),this.glyphManager=new Gt(i._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Me(256,512),this.crossTileSymbolIndex=new ao,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var E=this;this._rtlTextPluginCallback=o.registerForPluginStateChange(function(C){E.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:C.pluginStatus,pluginURL:C.pluginURL},function(L,Z){if(p.triggerPluginCompletionEvent(L),Z&&Z.every(function(me){return me}))for(var ne in E.sourceCaches)E.sourceCaches[ne].reload()})}),this.on("data",function(C){if(C.dataType==="source"&&C.sourceDataType==="metadata"){var L=g.sourceCaches[C.sourceId];if(L){var Z=L.getSource();if(Z&&Z.vectorLayerIds)for(var ne in g._layers){var me=g._layers[ne];me.source===Z.id&&g._validateLayer(me)}}}})}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.loadURL=function(i,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var E=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,h.accessToken);var C=this.map._requestManager.transformRequest(i,p.ResourceType.Style);this._request=p.getJSON(C,function(L,Z){g._request=null,L?g.fire(new p.ErrorEvent(L)):Z&&g._load(Z,E)})},o.prototype.loadJSON=function(i,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){g._request=null,g._load(i,h.validate!==!1)})},o.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(bi,!1)},o.prototype._load=function(i,h){if(!h||!Ds(this,p.validateStyle(i))){for(var g in this._loaded=!0,this.stylesheet=i,i.sources)this.addSource(g,i.sources[g],{validate:!1});i.sprite?this._loadSprite(i.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(i.glyphs);var E=ln(this.stylesheet.layers);this._order=E.map(function(ne){return ne.id}),this._layers={},this._serializedLayers={};for(var C=0,L=E;C<L.length;C+=1){var Z=L[C];(Z=p.createStyleLayer(Z)).setEventedParent(this,{layer:{id:Z.id}}),this._layers[Z.id]=Z,this._serializedLayers[Z.id]=Z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new yt(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},o.prototype._loadSprite=function(i){var h=this;this._spriteRequest=function(g,E,C){var L,Z,ne,me=p.browser.devicePixelRatio>1?"@2x":"",ye=p.getJSON(E.transformRequest(E.normalizeSpriteURL(g,me,".json"),p.ResourceType.SpriteJSON),function(Xe,ct){ye=null,ne||(ne=Xe,L=ct,Ye())}),Se=p.getImage(E.transformRequest(E.normalizeSpriteURL(g,me,".png"),p.ResourceType.SpriteImage),function(Xe,ct){Se=null,ne||(ne=Xe,Z=ct,Ye())});function Ye(){if(ne)C(ne);else if(L&&Z){var Xe=p.browser.getImageData(Z),ct={};for(var $e in L){var tt=L[$e],It=tt.width,Mt=tt.height,Sr=tt.x,nr=tt.y,xr=tt.sdf,Cr=tt.pixelRatio,an=tt.stretchX,Xr=tt.stretchY,vn=tt.content,An=new p.RGBAImage({width:It,height:Mt});p.RGBAImage.copy(Xe,An,{x:Sr,y:nr},{x:0,y:0},{width:It,height:Mt}),ct[$e]={data:An,pixelRatio:Cr,sdf:xr,stretchX:an,stretchY:Xr,content:vn}}C(null,ct)}}return{cancel:function(){ye&&(ye.cancel(),ye=null),Se&&(Se.cancel(),Se=null)}}}(i,this.map._requestManager,function(g,E){if(h._spriteRequest=null,g)h.fire(new p.ErrorEvent(g));else if(E)for(var C in E)h.imageManager.addImage(C,E[C]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},o.prototype._validateLayer=function(i){var h=this.sourceCaches[i.source];if(h){var g=i.sourceLayer;if(g){var E=h.getSource();(E.type==="geojson"||E.vectorLayerIds&&E.vectorLayerIds.indexOf(g)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+g+'" does not exist on source "'+E.id+'" as specified by style layer "'+i.id+'"')))}}},o.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()},o.prototype._serializeLayers=function(i){for(var h=[],g=0,E=i;g<E.length;g+=1){var C=this._layers[E[g]];C.type!=="custom"&&h.push(C.serialize())}return h},o.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},o.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},o.prototype.update=function(i){if(this._loaded){var h=this._changed;if(this._changed){var g=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);for(var C in(g.length||E.length)&&this._updateWorkerLayers(g,E),this._updatedSources){var L=this._updatedSources[C];L==="reload"?this._reloadSource(C):L==="clear"&&this._clearSource(C)}for(var Z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Z].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}var ne={};for(var me in this.sourceCaches){var ye=this.sourceCaches[me];ne[me]=ye.used,ye.used=!1}for(var Se=0,Ye=this._order;Se<Ye.length;Se+=1){var Xe=this._layers[Ye[Se]];Xe.recalculate(i,this._availableImages),!Xe.isHidden(i.zoom)&&Xe.source&&(this.sourceCaches[Xe.source].used=!0)}for(var ct in ne){var $e=this.sourceCaches[ct];ne[ct]!==$e.used&&$e.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ct}))}this.light.recalculate(i),this.z=i.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},o.prototype._updateTilesForChangedImages=function(){var i=Object.keys(this._changedImages);if(i.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}},o.prototype._updateWorkerLayers=function(i,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:h})},o.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},o.prototype.setState=function(i){var h=this;if(this._checkLoaded(),Ds(this,p.validateStyle(i)))return!1;(i=p.clone$1(i)).layers=ln(i.layers);var g=function(C,L){if(!C)return[{command:fn.setStyle,args:[L]}];var Z=[];try{if(!p.deepEqual(C.version,L.version))return[{command:fn.setStyle,args:[L]}];p.deepEqual(C.center,L.center)||Z.push({command:fn.setCenter,args:[L.center]}),p.deepEqual(C.zoom,L.zoom)||Z.push({command:fn.setZoom,args:[L.zoom]}),p.deepEqual(C.bearing,L.bearing)||Z.push({command:fn.setBearing,args:[L.bearing]}),p.deepEqual(C.pitch,L.pitch)||Z.push({command:fn.setPitch,args:[L.pitch]}),p.deepEqual(C.sprite,L.sprite)||Z.push({command:fn.setSprite,args:[L.sprite]}),p.deepEqual(C.glyphs,L.glyphs)||Z.push({command:fn.setGlyphs,args:[L.glyphs]}),p.deepEqual(C.transition,L.transition)||Z.push({command:fn.setTransition,args:[L.transition]}),p.deepEqual(C.light,L.light)||Z.push({command:fn.setLight,args:[L.light]});var ne={},me=[];(function(Se,Ye,Xe,ct){var $e;for($e in Ye=Ye||{},Se=Se||{})Se.hasOwnProperty($e)&&(Ye.hasOwnProperty($e)||dn($e,Xe,ct));for($e in Ye)Ye.hasOwnProperty($e)&&(Se.hasOwnProperty($e)?p.deepEqual(Se[$e],Ye[$e])||(Se[$e].type==="geojson"&&Ye[$e].type==="geojson"&&Bi(Se,Ye,$e)?Xe.push({command:fn.setGeoJSONSourceData,args:[$e,Ye[$e].data]}):ci($e,Ye,Xe,ct)):ri($e,Ye,Xe))})(C.sources,L.sources,me,ne);var ye=[];C.layers&&C.layers.forEach(function(Se){ne[Se.source]?Z.push({command:fn.removeLayer,args:[Se.id]}):ye.push(Se)}),Z=Z.concat(me),function(Se,Ye,Xe){Ye=Ye||[];var ct,$e,tt,It,Mt,Sr,nr,xr=(Se=Se||[]).map(_i),Cr=Ye.map(_i),an=Se.reduce(Ai,{}),Xr=Ye.reduce(Ai,{}),vn=xr.slice(),An=Object.create(null);for(ct=0,$e=0;ct<xr.length;ct++)Xr.hasOwnProperty(tt=xr[ct])?$e++:(Xe.push({command:fn.removeLayer,args:[tt]}),vn.splice(vn.indexOf(tt,$e),1));for(ct=0,$e=0;ct<Cr.length;ct++)vn[vn.length-1-ct]!==(tt=Cr[Cr.length-1-ct])&&(an.hasOwnProperty(tt)?(Xe.push({command:fn.removeLayer,args:[tt]}),vn.splice(vn.lastIndexOf(tt,vn.length-$e),1)):$e++,Xe.push({command:fn.addLayer,args:[Xr[tt],Sr=vn[vn.length-ct]]}),vn.splice(vn.length-ct,0,tt),An[tt]=!0);for(ct=0;ct<Cr.length;ct++)if(It=an[tt=Cr[ct]],Mt=Xr[tt],!An[tt]&&!p.deepEqual(It,Mt))if(p.deepEqual(It.source,Mt.source)&&p.deepEqual(It["source-layer"],Mt["source-layer"])&&p.deepEqual(It.type,Mt.type)){for(nr in pi(It.layout,Mt.layout,Xe,tt,null,fn.setLayoutProperty),pi(It.paint,Mt.paint,Xe,tt,null,fn.setPaintProperty),p.deepEqual(It.filter,Mt.filter)||Xe.push({command:fn.setFilter,args:[tt,Mt.filter]}),p.deepEqual(It.minzoom,Mt.minzoom)&&p.deepEqual(It.maxzoom,Mt.maxzoom)||Xe.push({command:fn.setLayerZoomRange,args:[tt,Mt.minzoom,Mt.maxzoom]}),It)It.hasOwnProperty(nr)&&nr!=="layout"&&nr!=="paint"&&nr!=="filter"&&nr!=="metadata"&&nr!=="minzoom"&&nr!=="maxzoom"&&(nr.indexOf("paint.")===0?pi(It[nr],Mt[nr],Xe,tt,nr.slice(6),fn.setPaintProperty):p.deepEqual(It[nr],Mt[nr])||Xe.push({command:fn.setLayerProperty,args:[tt,nr,Mt[nr]]}));for(nr in Mt)Mt.hasOwnProperty(nr)&&!It.hasOwnProperty(nr)&&nr!=="layout"&&nr!=="paint"&&nr!=="filter"&&nr!=="metadata"&&nr!=="minzoom"&&nr!=="maxzoom"&&(nr.indexOf("paint.")===0?pi(It[nr],Mt[nr],Xe,tt,nr.slice(6),fn.setPaintProperty):p.deepEqual(It[nr],Mt[nr])||Xe.push({command:fn.setLayerProperty,args:[tt,nr,Mt[nr]]}))}else Xe.push({command:fn.removeLayer,args:[tt]}),Sr=vn[vn.lastIndexOf(tt)+1],Xe.push({command:fn.addLayer,args:[Mt,Sr]})}(ye,L.layers,Z)}catch(Se){console.warn("Unable to compute style diff:",Se),Z=[{command:fn.setStyle,args:[L]}]}return Z}(this.serialize(),i).filter(function(C){return!(C.command in xa)});if(g.length===0)return!1;var E=g.filter(function(C){return!(C.command in su)});if(E.length>0)throw new Error("Unimplemented: "+E.map(function(C){return C.command}).join(", ")+".");return g.forEach(function(C){C.command!=="setTransition"&&h[C.command].apply(h,C.args)}),this.stylesheet=i,!0},o.prototype.addImage=function(i,h){if(this.getImage(i))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(i,h),this._afterImageUpdated(i)},o.prototype.updateImage=function(i,h){this.imageManager.updateImage(i,h)},o.prototype.getImage=function(i){return this.imageManager.getImage(i)},o.prototype.removeImage=function(i){if(!this.getImage(i))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(i),this._afterImageUpdated(i)},o.prototype._afterImageUpdated=function(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},o.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},o.prototype.addSource=function(i,h,g){var E=this;if(g===void 0&&(g={}),this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+i,h,null,g))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var C=this.sourceCaches[i]=new Ne(i,h,this.dispatcher);C.style=this,C.setEventedParent(this,function(){return{isSourceLoaded:E.loaded(),source:C.serialize(),sourceId:i}}),C.onAdd(this.map),this._changed=!0}},o.prototype.removeSource=function(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===i)return this.fire(new p.ErrorEvent(new Error('Source "'+i+'" cannot be removed while layer "'+h+'" is using it.')));var g=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],g.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),g.setEventedParent(null),g.clearTiles(),g.onRemove&&g.onRemove(this.map),this._changed=!0},o.prototype.setGeoJSONSourceData=function(i,h){this._checkLoaded(),this.sourceCaches[i].getSource().setData(h),this._changed=!0},o.prototype.getSource=function(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()},o.prototype.addLayer=function(i,h,g){g===void 0&&(g={}),this._checkLoaded();var E=i.id;if(this.getLayer(E))this.fire(new p.ErrorEvent(new Error('Layer with id "'+E+'" already exists on this map')));else{var C;if(i.type==="custom"){if(Ds(this,p.validateCustomStyleLayer(i)))return;C=p.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(E,i.source),i=p.clone$1(i),i=p.extend(i,{source:E})),this._validate(p.validateStyle.layer,"layers."+E,i,{arrayIndex:-1},g))return;C=p.createStyleLayer(i),this._validateLayer(C),C.setEventedParent(this,{layer:{id:E}}),this._serializedLayers[C.id]=C.serialize()}var L=h?this._order.indexOf(h):this._order.length;if(h&&L===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(L,0,E),this._layerOrderChanged=!0,this._layers[E]=C,this._removedLayers[E]&&C.source&&C.type!=="custom"){var Z=this._removedLayers[E];delete this._removedLayers[E],Z.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",this.sourceCaches[C.source].pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map)}}},o.prototype.moveLayer=function(i,h){if(this._checkLoaded(),this._changed=!0,this._layers[i]){if(i!==h){var g=this._order.indexOf(i);this._order.splice(g,1);var E=h?this._order.indexOf(h):this._order.length;h&&E===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(E,0,i),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be moved.")))},o.prototype.removeLayer=function(i){this._checkLoaded();var h=this._layers[i];if(h){h.setEventedParent(null);var g=this._order.indexOf(i);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=h,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be removed.")))},o.prototype.getLayer=function(i){return this._layers[i]},o.prototype.hasLayer=function(i){return i in this._layers},o.prototype.setLayerZoomRange=function(i,h,g){this._checkLoaded();var E=this.getLayer(i);E?E.minzoom===h&&E.maxzoom===g||(h!=null&&(E.minzoom=h),g!=null&&(E.maxzoom=g),this._updateLayer(E)):this.fire(new p.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot have zoom extent.")))},o.prototype.setFilter=function(i,h,g){g===void 0&&(g={}),this._checkLoaded();var E=this.getLayer(i);if(E){if(!p.deepEqual(E.filter,h))return h==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(p.validateStyle.filter,"layers."+E.id+".filter",h,null,g)||(E.filter=p.clone$1(h),this._updateLayer(E)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be filtered.")))},o.prototype.getFilter=function(i){return p.clone$1(this.getLayer(i).filter)},o.prototype.setLayoutProperty=function(i,h,g,E){E===void 0&&(E={}),this._checkLoaded();var C=this.getLayer(i);C?p.deepEqual(C.getLayoutProperty(h),g)||(C.setLayoutProperty(h,g,E),this._updateLayer(C)):this.fire(new p.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be styled.")))},o.prototype.getLayoutProperty=function(i,h){var g=this.getLayer(i);if(g)return g.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style.")))},o.prototype.setPaintProperty=function(i,h,g,E){E===void 0&&(E={}),this._checkLoaded();var C=this.getLayer(i);C?p.deepEqual(C.getPaintProperty(h),g)||(C.setPaintProperty(h,g,E)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be styled.")))},o.prototype.getPaintProperty=function(i,h){return this.getLayer(i).getPaintProperty(h)},o.prototype.setFeatureState=function(i,h){this._checkLoaded();var g=i.source,E=i.sourceLayer,C=this.sourceCaches[g];if(C!==void 0){var L=C.getSource().type;L==="geojson"&&E?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||E?(i.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),C.setFeatureState(E,i.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},o.prototype.removeFeatureState=function(i,h){this._checkLoaded();var g=i.source,E=this.sourceCaches[g];if(E!==void 0){var C=E.getSource().type,L=C==="vector"?i.sourceLayer:void 0;C!=="vector"||L?h&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):E.removeFeatureState(L,i.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},o.prototype.getFeatureState=function(i){this._checkLoaded();var h=i.source,g=i.sourceLayer,E=this.sourceCaches[h];if(E!==void 0){if(E.getSource().type!=="vector"||g)return i.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),E.getFeatureState(g,i.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},o.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},o.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(i){return i.serialize()}),layers:this._serializeLayers(this._order)},function(i){return i!==void 0})},o.prototype._updateLayer=function(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._changed=!0},o.prototype._flattenAndSortRenderedFeatures=function(i){for(var h=this,g=function(Xr){return h._layers[Xr].type==="fill-extrusion"},E={},C=[],L=this._order.length-1;L>=0;L--){var Z=this._order[L];if(g(Z)){E[Z]=L;for(var ne=0,me=i;ne<me.length;ne+=1){var ye=me[ne][Z];if(ye)for(var Se=0,Ye=ye;Se<Ye.length;Se+=1)C.push(Ye[Se])}}}C.sort(function(an,Xr){return Xr.intersectionZ-an.intersectionZ});for(var Xe=[],ct=this._order.length-1;ct>=0;ct--){var $e=this._order[ct];if(g($e))for(var tt=C.length-1;tt>=0;tt--){var It=C[tt].feature;if(E[It.layer.id]<ct)break;Xe.push(It),C.pop()}else for(var Mt=0,Sr=i;Mt<Sr.length;Mt+=1){var nr=Sr[Mt][$e];if(nr)for(var xr=0,Cr=nr;xr<Cr.length;xr+=1)Xe.push(Cr[xr].feature)}}return Xe},o.prototype.queryRenderedFeatures=function(i,h,g){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var E={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var C=0,L=h.layers;C<L.length;C+=1){var Z=L[C],ne=this._layers[Z];if(!ne)return this.fire(new p.ErrorEvent(new Error("The layer '"+Z+"' does not exist in the map's style and cannot be queried for features."))),[];E[ne.source]=!0}}var me=[];for(var ye in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!E[ye]||me.push(wr(this.sourceCaches[ye],this._layers,this._serializedLayers,i,h,g));return this.placement&&me.push(function(Se,Ye,Xe,ct,$e,tt,It){for(var Mt={},Sr=tt.queryRenderedSymbols(ct),nr=[],xr=0,Cr=Object.keys(Sr).map(Number);xr<Cr.length;xr+=1)nr.push(It[Cr[xr]]);nr.sort(Nr);for(var an=function(){var Ci=vn[Xr],Ji=Ci.featureIndex.lookupSymbolFeatures(Sr[Ci.bucketInstanceId],Ye,Ci.bucketIndex,Ci.sourceLayerIndex,$e.filter,$e.layers,$e.availableImages,Se);for(var Sn in Ji){var fi=Mt[Sn]=Mt[Sn]||[],gi=Ji[Sn];gi.sort(function(Kn,Si){var Gi=Ci.featureSortOrder;if(Gi){var yo=Gi.indexOf(Kn.featureIndex);return Gi.indexOf(Si.featureIndex)-yo}return Si.featureIndex-Kn.featureIndex});for(var Un=0,di=gi;Un<di.length;Un+=1)fi.push(di[Un])}},Xr=0,vn=nr;Xr<vn.length;Xr+=1)an();var An=function(Ci){Mt[Ci].forEach(function(Ji){var Sn=Ji.feature,fi=Xe[Se[Ci].source].getFeatureState(Sn.layer["source-layer"],Sn.id);Sn.source=Sn.layer.source,Sn.layer["source-layer"]&&(Sn.sourceLayer=Sn.layer["source-layer"]),Sn.state=fi})};for(var Xn in Mt)An(Xn);return Mt}(this._layers,this._serializedLayers,this.sourceCaches,i,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(me)},o.prototype.querySourceFeatures=function(i,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var g=this.sourceCaches[i];return g?function(E,C){for(var L=E.getRenderableIds().map(function(Ye){return E.getTileByID(Ye)}),Z=[],ne={},me=0;me<L.length;me++){var ye=L[me],Se=ye.tileID.canonical.key;ne[Se]||(ne[Se]=!0,ye.querySourceFeatures(Z,C))}return Z}(g,h):[]},o.prototype.addSourceType=function(i,h,g){return o.getSourceType(i)?g(new Error('A source type called "'+i+'" already exists.')):(o.setSourceType(i,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:h.workerSourceURL},g):g(null,null))},o.prototype.getLight=function(){return this.light.getLight()},o.prototype.setLight=function(i,h){h===void 0&&(h={}),this._checkLoaded();var g=this.light.getLight(),E=!1;for(var C in i)if(!p.deepEqual(i[C],g[C])){E=!0;break}if(E){var L={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,h),this.light.updateTransitions(L)}},o.prototype._validate=function(i,h,g,E,C){return C===void 0&&(C={}),(!C||C.validate!==!1)&&Ds(this,i.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:g,styleSpec:p.styleSpec},E)))},o.prototype._remove=function(){for(var i in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[i].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},o.prototype._clearSource=function(i){this.sourceCaches[i].clearTiles()},o.prototype._reloadSource=function(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()},o.prototype._updateSources=function(i){for(var h in this.sourceCaches)this.sourceCaches[h].update(i)},o.prototype._generateCollisionBoxes=function(){for(var i in this.sourceCaches)this._reloadSource(i)},o.prototype._updatePlacement=function(i,h,g,E,C){C===void 0&&(C=!1);for(var L=!1,Z=!1,ne={},me=0,ye=this._order;me<ye.length;me+=1){var Se=this._layers[ye[me]];if(Se.type==="symbol"){if(!ne[Se.source]){var Ye=this.sourceCaches[Se.source];ne[Se.source]=Ye.getRenderableIds(!0).map(function(It){return Ye.getTileByID(It)}).sort(function(It,Mt){return Mt.tileID.overscaledZ-It.tileID.overscaledZ||(It.tileID.isLessThan(Mt.tileID)?-1:1)})}var Xe=this.crossTileSymbolIndex.addLayer(Se,ne[Se.source],i.center.lng);L=L||Xe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((C=C||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),i.zoom))&&(this.pauseablePlacement=new yu(i,this._order,C,h,g,E,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ne),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),Z=!0),L&&this.pauseablePlacement.placement.setStale()),Z||L)for(var ct=0,$e=this._order;ct<$e.length;ct+=1){var tt=this._layers[$e[ct]];tt.type==="symbol"&&this.placement.updateLayerOpacities(tt,ne[tt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},o.prototype._releaseSymbolFadeTiles=function(){for(var i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()},o.prototype.getImages=function(i,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();var E=this.sourceCaches[h.source];E&&E.setDependencies(h.tileID.key,h.type,h.icons)},o.prototype.getGlyphs=function(i,h,g){this.glyphManager.getGlyphs(h.stacks,g)},o.prototype.getResource=function(i,h,g){return p.makeRequest(h,g)},o}(p.Evented);Ja.getSourceType=function(c){return Wt[c]},Ja.setSourceType=function(c,o){Wt[c]=o},Ja.registerForPluginStateChange=p.registerForPluginStateChange;var ba=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),Co=Ca(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),oo=Ca(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),cl=Ca(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ve=Ca(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Ft=Ca("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),br=Ca(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Cn=Ca(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Yi=Ca("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Aa=Ca("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),za=Ca("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),sa=Ca(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),La=Ca(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),vs=Ca(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ks=Ca(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ha=Ca(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fl=Ca(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),xu=Ca(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ms=Ca(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Ml=Ca(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),zu=Ca(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),qu=Ca(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Fs=Ca(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Il=Ca(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),gs=Ca(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Jl=Ca(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Df=Ca(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ca(c,o){var i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=o.match(/attribute ([\w]+) ([\w]+)/g),g=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=E?E.concat(g):g,L={};return{fragmentSource:c=c.replace(i,function(Z,ne,me,ye,Se){return L[Se]=!0,ne==="define"?`
#ifndef HAS_UNIFORM_u_`+Se+`
varying `+me+" "+ye+" "+Se+`;
#else
uniform `+me+" "+ye+" u_"+Se+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Se+`
    `+me+" "+ye+" "+Se+" = u_"+Se+`;
#endif
`}),vertexSource:o=o.replace(i,function(Z,ne,me,ye,Se){var Ye=ye==="float"?"vec2":"vec4",Xe=Se.match(/color/)?"color":Ye;return L[Se]?ne==="define"?`
#ifndef HAS_UNIFORM_u_`+Se+`
uniform lowp float u_`+Se+`_t;
attribute `+me+" "+Ye+" a_"+Se+`;
varying `+me+" "+ye+" "+Se+`;
#else
uniform `+me+" "+ye+" u_"+Se+`;
#endif
`:Xe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Se+`
    `+Se+" = a_"+Se+`;
#else
    `+me+" "+ye+" "+Se+" = u_"+Se+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Se+`
    `+Se+" = unpack_mix_"+Xe+"(a_"+Se+", u_"+Se+`_t);
#else
    `+me+" "+ye+" "+Se+" = u_"+Se+`;
#endif
`:ne==="define"?`
#ifndef HAS_UNIFORM_u_`+Se+`
uniform lowp float u_`+Se+`_t;
attribute `+me+" "+Ye+" a_"+Se+`;
#else
uniform `+me+" "+ye+" u_"+Se+`;
#endif
`:Xe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Se+`
    `+me+" "+ye+" "+Se+" = a_"+Se+`;
#else
    `+me+" "+ye+" "+Se+" = u_"+Se+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Se+`
    `+me+" "+ye+" "+Se+" = unpack_mix_"+Xe+"(a_"+Se+", u_"+Se+`_t);
#else
    `+me+" "+ye+" "+Se+" = u_"+Se+`;
#endif
`}),staticAttributes:h,staticUniforms:C}}var $f=Object.freeze({__proto__:null,prelude:Co,background:oo,backgroundPattern:cl,circle:Ve,clippingMask:Ft,heatmap:br,heatmapTexture:Cn,collisionBox:Yi,collisionCircle:Aa,debug:za,fill:sa,fillOutline:La,fillOutlinePattern:vs,fillPattern:ks,fillExtrusion:ha,fillExtrusionPattern:fl,hillshadePrepare:xu,hillshade:ms,line:Ml,lineGradient:zu,linePattern:qu,lineSDF:Fs,raster:Il,symbolIcon:gs,symbolSDF:Jl,symbolTextAndIcon:Df}),Uc=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function af(c){for(var o=[],i=0;i<c.length;i++)if(c[i]!==null){var h=c[i].split(" ");o.push(h.pop())}return o}Uc.prototype.bind=function(c,o,i,h,g,E,C,L){this.context=c;for(var Z=this.boundPaintVertexBuffers.length!==h.length,ne=0;!Z&&ne<h.length;ne++)this.boundPaintVertexBuffers[ne]!==h[ne]&&(Z=!0);c.extVertexArrayObject&&this.vao&&this.boundProgram===o&&this.boundLayoutVertexBuffer===i&&!Z&&this.boundIndexBuffer===g&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===C&&this.boundDynamicVertexBuffer2===L?(c.bindVertexArrayOES.set(this.vao),C&&C.bind(),g&&g.dynamicDraw&&g.bind(),L&&L.bind()):this.freshBind(o,i,h,g,E,C,L)},Uc.prototype.freshBind=function(c,o,i,h,g,E,C){var L,Z=c.numAttributes,ne=this.context,me=ne.gl;if(ne.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ne.extVertexArrayObject.createVertexArrayOES(),ne.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=c,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=C;else{L=ne.currentNumAttributes||0;for(var ye=Z;ye<L;ye++)me.disableVertexAttribArray(ye)}o.enableAttributes(me,c);for(var Se=0,Ye=i;Se<Ye.length;Se+=1)Ye[Se].enableAttributes(me,c);E&&E.enableAttributes(me,c),C&&C.enableAttributes(me,c),o.bind(),o.setVertexAttribPointers(me,c,g);for(var Xe=0,ct=i;Xe<ct.length;Xe+=1){var $e=ct[Xe];$e.bind(),$e.setVertexAttribPointers(me,c,g)}E&&(E.bind(),E.setVertexAttribPointers(me,c,g)),h&&h.bind(),C&&(C.bind(),C.setVertexAttribPointers(me,c,g)),ne.currentNumAttributes=Z},Uc.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Ef=function(o,i,h,g,E,C){var L=o.gl;this.program=L.createProgram();for(var Z=af(h.staticAttributes),ne=g?g.getBinderAttributes():[],me=Z.concat(ne),ye=h.staticUniforms?af(h.staticUniforms):[],Se=g?g.getBinderUniforms():[],Ye=[],Xe=0,ct=ye.concat(Se);Xe<ct.length;Xe+=1){var $e=ct[Xe];Ye.indexOf($e)<0&&Ye.push($e)}var tt=g?g.defines():[];C&&tt.push("#define OVERDRAW_INSPECTOR;");var It=tt.concat(Co.fragmentSource,h.fragmentSource).join(`
`),Mt=tt.concat(Co.vertexSource,h.vertexSource).join(`
`),Sr=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())this.failedToCreate=!0;else{L.shaderSource(Sr,It),L.compileShader(Sr),L.attachShader(this.program,Sr);var nr=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())this.failedToCreate=!0;else{L.shaderSource(nr,Mt),L.compileShader(nr),L.attachShader(this.program,nr),this.attributes={};var xr={};this.numAttributes=me.length;for(var Cr=0;Cr<this.numAttributes;Cr++)me[Cr]&&(L.bindAttribLocation(this.program,Cr,me[Cr]),this.attributes[me[Cr]]=Cr);L.linkProgram(this.program),L.deleteShader(nr),L.deleteShader(Sr);for(var an=0;an<Ye.length;an++){var Xr=Ye[an];if(Xr&&!xr[Xr]){var vn=L.getUniformLocation(this.program,Xr);vn&&(xr[Xr]=vn)}}this.fixedUniforms=E(o,xr),this.binderUniforms=g?g.getUniforms(o,xr):[]}}};function of(c,o,i){var h=1/aa(i,1,o.transform.tileZoom),g=Math.pow(2,i.tileID.overscaledZ),E=i.tileSize*Math.pow(2,o.transform.tileZoom)/g,C=E*(i.tileID.canonical.x+i.tileID.wrap*g),L=E*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[h,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[C>>16,L>>16],u_pixel_coord_lower:[65535&C,65535&L]}}Ef.prototype.draw=function(c,o,i,h,g,E,C,L,Z,ne,me,ye,Se,Ye,Xe,ct){var $e,tt=c.gl;if(!this.failedToCreate){for(var It in c.program.set(this.program),c.setDepthMode(i),c.setStencilMode(h),c.setColorMode(g),c.setCullFace(E),this.fixedUniforms)this.fixedUniforms[It].set(C[It]);Ye&&Ye.setUniforms(c,this.binderUniforms,ye,{zoom:Se});for(var Mt=($e={},$e[tt.LINES]=2,$e[tt.TRIANGLES]=3,$e[tt.LINE_STRIP]=1,$e)[o],Sr=0,nr=me.get();Sr<nr.length;Sr+=1){var xr=nr[Sr],Cr=xr.vaos||(xr.vaos={});(Cr[L]||(Cr[L]=new Uc)).bind(c,this,Z,Ye?Ye.getPaintVertexBuffers():[],ne,xr.vertexOffset,Xe,ct),tt.drawElements(o,xr.primitiveLength*Mt,tt.UNSIGNED_SHORT,xr.primitiveOffset*Mt*2)}}};var go=function(o,i,h,g){var E=i.style.light,C=E.properties.get("position"),L=[C.x,C.y,C.z],Z=p.create$1();E.properties.get("anchor")==="viewport"&&p.fromRotation(Z,-i.transform.angle),p.transformMat3(L,L,Z);var ne=E.properties.get("color");return{u_matrix:o,u_lightpos:L,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+h,u_opacity:g}},Ol=function(o,i,h,g,E,C,L){return p.extend(go(o,i,h,g),of(C,i,L),{u_height_factor:-Math.pow(2,E.overscaledZ)/L.tileSize/8})},Ll=function(o){return{u_matrix:o}},Es=function(o,i,h,g){return p.extend(Ll(o),of(h,i,g))},sf=function(o,i){return{u_matrix:o,u_world:i}},Rl=function(o,i,h,g,E){return p.extend(Es(o,i,h,g),{u_world:E})},Bu=function(o,i,h,g){var E,C,L=o.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var Z=aa(h,1,L.zoom);E=!0,C=[Z,Z]}else E=!1,C=L.pixelsToGLUnits;return{u_camera_to_center_distance:L.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:o.translatePosMatrix(i.posMatrix,h,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:C}},Po=function(o,i,h){var g=aa(h,1,i.zoom),E=Math.pow(2,i.zoom-h.tileID.overscaledZ),C=h.tileID.overscaleFactor();return{u_matrix:o,u_camera_to_center_distance:i.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[i.pixelsToGLUnits[0]/(g*E),i.pixelsToGLUnits[1]/(g*E)],u_overscale_factor:C}},uf=function(o,i,h){return{u_matrix:o,u_inv_matrix:i,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},bu=function(o,i,h){return h===void 0&&(h=1),{u_matrix:o,u_color:i,u_overlay:0,u_overlay_scale:h}},hl=function(o){return{u_matrix:o}},kf=function(o,i,h,g){return{u_matrix:o,u_extrude_scale:aa(i,1,h),u_intensity:g}},Dl=function(o,i,h){var g=o.transform;return{u_matrix:ns(o,i,h),u_ratio:1/aa(i,1,g.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ra=function(o,i,h,g){return p.extend(Dl(o,i,h),{u_image:0,u_image_height:g})},uu=function(o,i,h,g){var E=o.transform,C=Mo(i,E);return{u_matrix:ns(o,i,h),u_texsize:i.imageAtlasTexture.size,u_ratio:1/aa(i,1,E.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[C,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},vc=function(o,i,h,g,E){var C=o.lineAtlas,L=Mo(i,o.transform),Z=h.layout.get("line-cap")==="round",ne=C.getDash(g.from,Z),me=C.getDash(g.to,Z),ye=ne.width*E.fromScale,Se=me.width*E.toScale;return p.extend(Dl(o,i,h),{u_patternscale_a:[L/ye,-ne.height/2],u_patternscale_b:[L/Se,-me.height/2],u_sdfgamma:C.width/(256*Math.min(ye,Se)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:ne.y,u_tex_y_b:me.y,u_mix:E.t})};function Mo(c,o){return 1/aa(c,1,o.tileZoom)}function ns(c,o,i){return c.translatePosMatrix(o.tileID.posMatrix,o,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}var kl=function(o,i,h,g,E){return{u_matrix:o,u_tl_parent:i,u_scale_parent:h,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(L=E.paint.get("raster-saturation"),L>0?1-1/(1.001-L):-L),u_contrast_factor:(C=E.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:Fl(E.paint.get("raster-hue-rotate"))};var C,L};function Fl(c){c*=Math.PI/180;var o=Math.sin(c),i=Math.cos(c);return[(2*i+1)/3,(-Math.sqrt(3)*o-i+1)/3,(Math.sqrt(3)*o-i+1)/3]}var Su,lu=function(o,i,h,g,E,C,L,Z,ne,me){var ye=E.transform;return{u_is_size_zoom_constant:+(o==="constant"||o==="source"),u_is_size_feature_constant:+(o==="constant"||o==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:ye.cameraToCenterDistance,u_pitch:ye.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:ye.width/ye.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:L,u_coord_matrix:Z,u_is_text:+ne,u_pitch_with_map:+g,u_texsize:me,u_texture:0}},cu=function(o,i,h,g,E,C,L,Z,ne,me,ye){var Se=E.transform;return p.extend(lu(o,i,h,g,E,C,L,Z,ne,me),{u_gamma_scale:g?Math.cos(Se._pitch)*Se.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+ye})},Ql=function(o,i,h,g,E,C,L,Z,ne,me){return p.extend(cu(o,i,h,g,E,C,L,Z,!0,ne,!0),{u_texsize_icon:me,u_texture_icon:1})},Nl=function(o,i,h){return{u_matrix:o,u_opacity:i,u_color:h}},pl=function(o,i,h,g,E,C){return p.extend(function(L,Z,ne,me){var ye=ne.imageManager.getPattern(L.from.toString()),Se=ne.imageManager.getPattern(L.to.toString()),Ye=ne.imageManager.getPixelSize(),Xe=Ye.width,ct=Ye.height,$e=Math.pow(2,me.tileID.overscaledZ),tt=me.tileSize*Math.pow(2,ne.transform.tileZoom)/$e,It=tt*(me.tileID.canonical.x+me.tileID.wrap*$e),Mt=tt*me.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ye.tl,u_pattern_br_a:ye.br,u_pattern_tl_b:Se.tl,u_pattern_br_b:Se.br,u_texsize:[Xe,ct],u_mix:Z.t,u_pattern_size_a:ye.displaySize,u_pattern_size_b:Se.displaySize,u_scale_a:Z.fromScale,u_scale_b:Z.toScale,u_tile_units_to_pixels:1/aa(me,1,ne.transform.tileZoom),u_pixel_coord_upper:[It>>16,Mt>>16],u_pixel_coord_lower:[65535&It,65535&Mt]}}(g,C,h,E),{u_matrix:o,u_opacity:i})},ql={fillExtrusion:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_lightpos:new p.Uniform3f(o,i.u_lightpos),u_lightintensity:new p.Uniform1f(o,i.u_lightintensity),u_lightcolor:new p.Uniform3f(o,i.u_lightcolor),u_vertical_gradient:new p.Uniform1f(o,i.u_vertical_gradient),u_opacity:new p.Uniform1f(o,i.u_opacity)}},fillExtrusionPattern:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_lightpos:new p.Uniform3f(o,i.u_lightpos),u_lightintensity:new p.Uniform1f(o,i.u_lightintensity),u_lightcolor:new p.Uniform3f(o,i.u_lightcolor),u_vertical_gradient:new p.Uniform1f(o,i.u_vertical_gradient),u_height_factor:new p.Uniform1f(o,i.u_height_factor),u_image:new p.Uniform1i(o,i.u_image),u_texsize:new p.Uniform2f(o,i.u_texsize),u_pixel_coord_upper:new p.Uniform2f(o,i.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(o,i.u_pixel_coord_lower),u_scale:new p.Uniform3f(o,i.u_scale),u_fade:new p.Uniform1f(o,i.u_fade),u_opacity:new p.Uniform1f(o,i.u_opacity)}},fill:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix)}},fillPattern:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_image:new p.Uniform1i(o,i.u_image),u_texsize:new p.Uniform2f(o,i.u_texsize),u_pixel_coord_upper:new p.Uniform2f(o,i.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(o,i.u_pixel_coord_lower),u_scale:new p.Uniform3f(o,i.u_scale),u_fade:new p.Uniform1f(o,i.u_fade)}},fillOutline:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_world:new p.Uniform2f(o,i.u_world)}},fillOutlinePattern:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_world:new p.Uniform2f(o,i.u_world),u_image:new p.Uniform1i(o,i.u_image),u_texsize:new p.Uniform2f(o,i.u_texsize),u_pixel_coord_upper:new p.Uniform2f(o,i.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(o,i.u_pixel_coord_lower),u_scale:new p.Uniform3f(o,i.u_scale),u_fade:new p.Uniform1f(o,i.u_fade)}},circle:function(o,i){return{u_camera_to_center_distance:new p.Uniform1f(o,i.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(o,i.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(o,i.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(o,i.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(o,i.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(o,i.u_matrix)}},collisionBox:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_camera_to_center_distance:new p.Uniform1f(o,i.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(o,i.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(o,i.u_extrude_scale),u_overscale_factor:new p.Uniform1f(o,i.u_overscale_factor)}},collisionCircle:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_inv_matrix:new p.UniformMatrix4f(o,i.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(o,i.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(o,i.u_viewport_size)}},debug:function(o,i){return{u_color:new p.UniformColor(o,i.u_color),u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_overlay:new p.Uniform1i(o,i.u_overlay),u_overlay_scale:new p.Uniform1f(o,i.u_overlay_scale)}},clippingMask:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix)}},heatmap:function(o,i){return{u_extrude_scale:new p.Uniform1f(o,i.u_extrude_scale),u_intensity:new p.Uniform1f(o,i.u_intensity),u_matrix:new p.UniformMatrix4f(o,i.u_matrix)}},heatmapTexture:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_world:new p.Uniform2f(o,i.u_world),u_image:new p.Uniform1i(o,i.u_image),u_color_ramp:new p.Uniform1i(o,i.u_color_ramp),u_opacity:new p.Uniform1f(o,i.u_opacity)}},hillshade:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_image:new p.Uniform1i(o,i.u_image),u_latrange:new p.Uniform2f(o,i.u_latrange),u_light:new p.Uniform2f(o,i.u_light),u_shadow:new p.UniformColor(o,i.u_shadow),u_highlight:new p.UniformColor(o,i.u_highlight),u_accent:new p.UniformColor(o,i.u_accent)}},hillshadePrepare:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_image:new p.Uniform1i(o,i.u_image),u_dimension:new p.Uniform2f(o,i.u_dimension),u_zoom:new p.Uniform1f(o,i.u_zoom),u_unpack:new p.Uniform4f(o,i.u_unpack)}},line:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_ratio:new p.Uniform1f(o,i.u_ratio),u_device_pixel_ratio:new p.Uniform1f(o,i.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(o,i.u_units_to_pixels)}},lineGradient:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_ratio:new p.Uniform1f(o,i.u_ratio),u_device_pixel_ratio:new p.Uniform1f(o,i.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(o,i.u_units_to_pixels),u_image:new p.Uniform1i(o,i.u_image),u_image_height:new p.Uniform1f(o,i.u_image_height)}},linePattern:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_texsize:new p.Uniform2f(o,i.u_texsize),u_ratio:new p.Uniform1f(o,i.u_ratio),u_device_pixel_ratio:new p.Uniform1f(o,i.u_device_pixel_ratio),u_image:new p.Uniform1i(o,i.u_image),u_units_to_pixels:new p.Uniform2f(o,i.u_units_to_pixels),u_scale:new p.Uniform3f(o,i.u_scale),u_fade:new p.Uniform1f(o,i.u_fade)}},lineSDF:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_ratio:new p.Uniform1f(o,i.u_ratio),u_device_pixel_ratio:new p.Uniform1f(o,i.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(o,i.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(o,i.u_patternscale_a),u_patternscale_b:new p.Uniform2f(o,i.u_patternscale_b),u_sdfgamma:new p.Uniform1f(o,i.u_sdfgamma),u_image:new p.Uniform1i(o,i.u_image),u_tex_y_a:new p.Uniform1f(o,i.u_tex_y_a),u_tex_y_b:new p.Uniform1f(o,i.u_tex_y_b),u_mix:new p.Uniform1f(o,i.u_mix)}},raster:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_tl_parent:new p.Uniform2f(o,i.u_tl_parent),u_scale_parent:new p.Uniform1f(o,i.u_scale_parent),u_buffer_scale:new p.Uniform1f(o,i.u_buffer_scale),u_fade_t:new p.Uniform1f(o,i.u_fade_t),u_opacity:new p.Uniform1f(o,i.u_opacity),u_image0:new p.Uniform1i(o,i.u_image0),u_image1:new p.Uniform1i(o,i.u_image1),u_brightness_low:new p.Uniform1f(o,i.u_brightness_low),u_brightness_high:new p.Uniform1f(o,i.u_brightness_high),u_saturation_factor:new p.Uniform1f(o,i.u_saturation_factor),u_contrast_factor:new p.Uniform1f(o,i.u_contrast_factor),u_spin_weights:new p.Uniform3f(o,i.u_spin_weights)}},symbolIcon:function(o,i){return{u_is_size_zoom_constant:new p.Uniform1i(o,i.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(o,i.u_is_size_feature_constant),u_size_t:new p.Uniform1f(o,i.u_size_t),u_size:new p.Uniform1f(o,i.u_size),u_camera_to_center_distance:new p.Uniform1f(o,i.u_camera_to_center_distance),u_pitch:new p.Uniform1f(o,i.u_pitch),u_rotate_symbol:new p.Uniform1i(o,i.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(o,i.u_aspect_ratio),u_fade_change:new p.Uniform1f(o,i.u_fade_change),u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(o,i.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(o,i.u_coord_matrix),u_is_text:new p.Uniform1i(o,i.u_is_text),u_pitch_with_map:new p.Uniform1i(o,i.u_pitch_with_map),u_texsize:new p.Uniform2f(o,i.u_texsize),u_texture:new p.Uniform1i(o,i.u_texture)}},symbolSDF:function(o,i){return{u_is_size_zoom_constant:new p.Uniform1i(o,i.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(o,i.u_is_size_feature_constant),u_size_t:new p.Uniform1f(o,i.u_size_t),u_size:new p.Uniform1f(o,i.u_size),u_camera_to_center_distance:new p.Uniform1f(o,i.u_camera_to_center_distance),u_pitch:new p.Uniform1f(o,i.u_pitch),u_rotate_symbol:new p.Uniform1i(o,i.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(o,i.u_aspect_ratio),u_fade_change:new p.Uniform1f(o,i.u_fade_change),u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(o,i.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(o,i.u_coord_matrix),u_is_text:new p.Uniform1i(o,i.u_is_text),u_pitch_with_map:new p.Uniform1i(o,i.u_pitch_with_map),u_texsize:new p.Uniform2f(o,i.u_texsize),u_texture:new p.Uniform1i(o,i.u_texture),u_gamma_scale:new p.Uniform1f(o,i.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(o,i.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(o,i.u_is_halo)}},symbolTextAndIcon:function(o,i){return{u_is_size_zoom_constant:new p.Uniform1i(o,i.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(o,i.u_is_size_feature_constant),u_size_t:new p.Uniform1f(o,i.u_size_t),u_size:new p.Uniform1f(o,i.u_size),u_camera_to_center_distance:new p.Uniform1f(o,i.u_camera_to_center_distance),u_pitch:new p.Uniform1f(o,i.u_pitch),u_rotate_symbol:new p.Uniform1i(o,i.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(o,i.u_aspect_ratio),u_fade_change:new p.Uniform1f(o,i.u_fade_change),u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(o,i.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(o,i.u_coord_matrix),u_is_text:new p.Uniform1i(o,i.u_is_text),u_pitch_with_map:new p.Uniform1i(o,i.u_pitch_with_map),u_texsize:new p.Uniform2f(o,i.u_texsize),u_texsize_icon:new p.Uniform2f(o,i.u_texsize_icon),u_texture:new p.Uniform1i(o,i.u_texture),u_texture_icon:new p.Uniform1i(o,i.u_texture_icon),u_gamma_scale:new p.Uniform1f(o,i.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(o,i.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(o,i.u_is_halo)}},background:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_opacity:new p.Uniform1f(o,i.u_opacity),u_color:new p.UniformColor(o,i.u_color)}},backgroundPattern:function(o,i){return{u_matrix:new p.UniformMatrix4f(o,i.u_matrix),u_opacity:new p.Uniform1f(o,i.u_opacity),u_image:new p.Uniform1i(o,i.u_image),u_pattern_tl_a:new p.Uniform2f(o,i.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(o,i.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(o,i.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(o,i.u_pattern_br_b),u_texsize:new p.Uniform2f(o,i.u_texsize),u_mix:new p.Uniform1f(o,i.u_mix),u_pattern_size_a:new p.Uniform2f(o,i.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(o,i.u_pattern_size_b),u_scale_a:new p.Uniform1f(o,i.u_scale_a),u_scale_b:new p.Uniform1f(o,i.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(o,i.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(o,i.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(o,i.u_tile_units_to_pixels)}}};function qs(c,o,i,h,g,E,C){for(var L=c.context,Z=L.gl,ne=c.useProgram("collisionBox"),me=[],ye=0,Se=0,Ye=0;Ye<h.length;Ye++){var Xe=h[Ye],ct=o.getTile(Xe),$e=ct.getBucket(i);if($e){var tt=Xe.posMatrix;g[0]===0&&g[1]===0||(tt=c.translatePosMatrix(Xe.posMatrix,ct,g,E));var It=C?$e.textCollisionBox:$e.iconCollisionBox,Mt=$e.collisionCircleArray;if(Mt.length>0){var Sr=p.create(),nr=tt;p.mul(Sr,$e.placementInvProjMatrix,c.transform.glCoordMatrix),p.mul(Sr,Sr,$e.placementViewportMatrix),me.push({circleArray:Mt,circleOffset:Se,transform:nr,invTransform:Sr}),Se=ye+=Mt.length/4}It&&ne.draw(L,Z.LINES,Y.disabled,ue.disabled,c.colorModeForRenderPass(),He.disabled,Po(tt,c.transform,ct),i.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,null,c.transform.zoom,null,null,It.collisionVertexBuffer)}}if(C&&me.length){var xr=c.useProgram("collisionCircle"),Cr=new p.StructArrayLayout2f1f2i16;Cr.resize(4*ye),Cr._trim();for(var an=0,Xr=0,vn=me;Xr<vn.length;Xr+=1)for(var An=vn[Xr],Xn=0;Xn<An.circleArray.length/4;Xn++){var Qn=4*Xn,Ci=An.circleArray[Qn+0],Ji=An.circleArray[Qn+1],Sn=An.circleArray[Qn+2],fi=An.circleArray[Qn+3];Cr.emplace(an++,Ci,Ji,Sn,fi,0),Cr.emplace(an++,Ci,Ji,Sn,fi,1),Cr.emplace(an++,Ci,Ji,Sn,fi,2),Cr.emplace(an++,Ci,Ji,Sn,fi,3)}(!Su||Su.length<2*ye)&&(Su=function(yo){var uo=2*yo,Oo=new p.StructArrayLayout3ui6;Oo.resize(uo),Oo._trim();for(var Ua=0;Ua<uo;Ua++){var Xa=6*Ua;Oo.uint16[Xa+0]=4*Ua+0,Oo.uint16[Xa+1]=4*Ua+1,Oo.uint16[Xa+2]=4*Ua+2,Oo.uint16[Xa+3]=4*Ua+2,Oo.uint16[Xa+4]=4*Ua+3,Oo.uint16[Xa+5]=4*Ua+0}return Oo}(ye));for(var gi=L.createIndexBuffer(Su,!0),Un=L.createVertexBuffer(Cr,p.collisionCircleLayout.members,!0),di=0,Kn=me;di<Kn.length;di+=1){var Si=Kn[di],Gi=uf(Si.transform,Si.invTransform,c.transform);xr.draw(L,Z.TRIANGLES,Y.disabled,ue.disabled,c.colorModeForRenderPass(),He.disabled,Gi,i.id,Un,gi,p.SegmentVector.simpleSegment(0,2*Si.circleOffset,Si.circleArray.length,Si.circleArray.length/2),null,c.transform.zoom,null,null,null)}Un.destroy(),gi.destroy()}}var is=p.identity(new Float32Array(16));function zl(c,o,i,h,g,E){var C=p.getAnchorAlignment(c),L=-(C.horizontalAlign-.5)*o,Z=-(C.verticalAlign-.5)*i,ne=p.evaluateVariableOffset(c,h);return new p.Point((L/g+ne[0])*E,(Z/g+ne[1])*E)}function jc(c,o,i,h,g,E,C,L,Z,ne,me){var ye=c.text.placedSymbolArray,Se=c.text.dynamicLayoutVertexArray,Ye=c.icon.dynamicLayoutVertexArray,Xe={};Se.clear();for(var ct=0;ct<ye.length;ct++){var $e=ye.get(ct),tt=$e.hidden||!$e.crossTileID||c.allowVerticalPlacement&&!$e.placedOrientation?null:h[$e.crossTileID];if(tt){var It=new p.Point($e.anchorX,$e.anchorY),Mt=kn(It,i?L:C),Sr=Zn(E.cameraToCenterDistance,Mt.signedDistanceFromCamera),nr=g.evaluateSizeForFeature(c.textSizeData,ne,$e)*Sr/p.ONE_EM;i&&(nr*=c.tilePixelRatio/Z);for(var xr=zl(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textBoxScale,nr),Cr=i?kn(It.add(xr),C).point:Mt.point.add(o?xr.rotate(-E.angle):xr),an=c.allowVerticalPlacement&&$e.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,Xr=0;Xr<$e.numGlyphs;Xr++)p.addDynamicAttributes(Se,Cr,an);me&&$e.associatedIconIndex>=0&&(Xe[$e.associatedIconIndex]={shiftedAnchor:Cr,angle:an})}else Ya($e.numGlyphs,Se)}if(me){Ye.clear();for(var vn=c.icon.placedSymbolArray,An=0;An<vn.length;An++){var Xn=vn.get(An);if(Xn.hidden)Ya(Xn.numGlyphs,Ye);else{var Qn=Xe[An];if(Qn)for(var Ci=0;Ci<Xn.numGlyphs;Ci++)p.addDynamicAttributes(Ye,Qn.shiftedAnchor,Qn.angle);else Ya(Xn.numGlyphs,Ye)}}c.icon.dynamicLayoutVertexBuffer.updateData(Ye)}c.text.dynamicLayoutVertexBuffer.updateData(Se)}function dl(c,o,i){return i.iconsInText&&o?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function el(c,o,i,h,g,E,C,L,Z,ne,me,ye){for(var Se=c.context,Ye=Se.gl,Xe=c.transform,ct=L==="map",$e=Z==="map",tt=ct&&i.layout.get("symbol-placement")!=="point",It=ct&&!$e&&!tt,Mt=i.layout.get("symbol-sort-key").constantOr(1)!==void 0,Sr=!1,nr=c.depthModeForSublayer(0,Y.ReadOnly),xr=i.layout.get("text-variable-anchor"),Cr=[],an=0,Xr=h;an<Xr.length;an+=1){var vn=Xr[an],An=o.getTile(vn),Xn=An.getBucket(i);if(Xn){var Qn=g?Xn.text:Xn.icon;if(Qn&&Qn.segments.get().length){var Ci=Qn.programConfigurations.get(i.id),Ji=g||Xn.sdfIcons,Sn=g?Xn.textSizeData:Xn.iconSizeData,fi=$e||Xe.pitch!==0,gi=c.useProgram(dl(Ji,g,Xn),Ci),Un=p.evaluateSizeForZoom(Sn,Xe.zoom),di=void 0,Kn=[0,0],Si=void 0,Gi=void 0,yo=null,uo=void 0;if(g)Si=An.glyphAtlasTexture,Gi=Ye.LINEAR,di=An.glyphAtlasTexture.size,Xn.iconsInText&&(Kn=An.imageAtlasTexture.size,yo=An.imageAtlasTexture,uo=fi||c.options.rotating||c.options.zooming||Sn.kind==="composite"||Sn.kind==="camera"?Ye.LINEAR:Ye.NEAREST);else{var Oo=i.layout.get("icon-size").constantOr(0)!==1||Xn.iconsNeedLinear;Si=An.imageAtlasTexture,Gi=Ji||c.options.rotating||c.options.zooming||Oo||fi?Ye.LINEAR:Ye.NEAREST,di=An.imageAtlasTexture.size}var Ua=aa(An,1,c.transform.zoom),Xa=mi(vn.posMatrix,$e,ct,c.transform,Ua),Cs=Fn(vn.posMatrix,$e,ct,c.transform,Ua),Ko=xr&&Xn.hasTextData(),Wu=i.layout.get("icon-text-fit")!=="none"&&Ko&&Xn.hasIconData();tt&&js(Xn,vn.posMatrix,c,g,Xa,Cs,$e,ne);var Lu=c.translatePosMatrix(vn.posMatrix,An,E,C),ss=tt||g&&xr||Wu?is:Xa,zs=c.translatePosMatrix(Cs,An,E,C,!0),El=Ji&&i.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Ac={program:gi,buffers:Qn,uniformValues:Ji?Xn.iconsInText?Ql(Sn.kind,Un,It,$e,c,Lu,ss,zs,di,Kn):cu(Sn.kind,Un,It,$e,c,Lu,ss,zs,g,di,!0):lu(Sn.kind,Un,It,$e,c,Lu,ss,zs,g,di),atlasTexture:Si,atlasTextureIcon:yo,atlasInterpolation:Gi,atlasInterpolationIcon:uo,isSDF:Ji,hasHalo:El};if(Mt&&Xn.canOverlap){Sr=!0;for(var Ru=0,ol=Qn.segments.get();Ru<ol.length;Ru+=1){var Hl=ol[Ru];Cr.push({segments:new p.SegmentVector([Hl]),sortKey:Hl.sortKey,state:Ac})}}else Cr.push({segments:Qn.segments,sortKey:0,state:Ac})}}}Sr&&Cr.sort(function(wl,Ps){return wl.sortKey-Ps.sortKey});for(var Du=0,sc=Cr;Du<sc.length;Du+=1){var fu=sc[Du],lo=fu.state;if(Se.activeTexture.set(Ye.TEXTURE0),lo.atlasTexture.bind(lo.atlasInterpolation,Ye.CLAMP_TO_EDGE),lo.atlasTextureIcon&&(Se.activeTexture.set(Ye.TEXTURE1),lo.atlasTextureIcon&&lo.atlasTextureIcon.bind(lo.atlasInterpolationIcon,Ye.CLAMP_TO_EDGE)),lo.isSDF){var hu=lo.uniformValues;lo.hasHalo&&(hu.u_is_halo=1,ec(lo.buffers,fu.segments,i,c,lo.program,nr,me,ye,hu)),hu.u_is_halo=0}ec(lo.buffers,fu.segments,i,c,lo.program,nr,me,ye,lo.uniformValues)}}function ec(c,o,i,h,g,E,C,L,Z){var ne=h.context;g.draw(ne,ne.gl.TRIANGLES,E,C,L,He.disabled,Z,i.id,c.layoutVertexBuffer,c.indexBuffer,o,i.paint,h.transform.zoom,c.programConfigurations.get(i.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function Zc(c,o,i,h,g,E,C){var L,Z,ne,me,ye,Se=c.context.gl,Ye=i.paint.get("fill-pattern"),Xe=Ye&&Ye.constantOr(1),ct=i.getCrossfadeParameters();C?(Z=Xe&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=Se.LINES):(Z=Xe?"fillPattern":"fill",L=Se.TRIANGLES);for(var $e=0,tt=h;$e<tt.length;$e+=1){var It=tt[$e],Mt=o.getTile(It);if(!Xe||Mt.patternsLoaded()){var Sr=Mt.getBucket(i);if(Sr){var nr=Sr.programConfigurations.get(i.id),xr=c.useProgram(Z,nr);Xe&&(c.context.activeTexture.set(Se.TEXTURE0),Mt.imageAtlasTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),nr.updatePaintBuffers(ct));var Cr=Ye.constantOr(null);if(Cr&&Mt.imageAtlas){var an=Mt.imageAtlas,Xr=an.patternPositions[Cr.to.toString()],vn=an.patternPositions[Cr.from.toString()];Xr&&vn&&nr.setConstantPatternPositions(Xr,vn)}var An=c.translatePosMatrix(It.posMatrix,Mt,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(C){me=Sr.indexBuffer2,ye=Sr.segments2;var Xn=[Se.drawingBufferWidth,Se.drawingBufferHeight];ne=Z==="fillOutlinePattern"&&Xe?Rl(An,c,ct,Mt,Xn):sf(An,Xn)}else me=Sr.indexBuffer,ye=Sr.segments,ne=Xe?Es(An,c,ct,Mt):Ll(An);xr.draw(c.context,L,g,c.stencilModeForClipping(It),E,He.disabled,ne,i.id,Sr.layoutVertexBuffer,me,ye,i.paint,c.transform.zoom,nr)}}}}function tl(c,o,i,h,g,E,C){for(var L=c.context,Z=L.gl,ne=i.paint.get("fill-extrusion-pattern"),me=ne.constantOr(1),ye=i.getCrossfadeParameters(),Se=i.paint.get("fill-extrusion-opacity"),Ye=0,Xe=h;Ye<Xe.length;Ye+=1){var ct=Xe[Ye],$e=o.getTile(ct),tt=$e.getBucket(i);if(tt){var It=tt.programConfigurations.get(i.id),Mt=c.useProgram(me?"fillExtrusionPattern":"fillExtrusion",It);me&&(c.context.activeTexture.set(Z.TEXTURE0),$e.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),It.updatePaintBuffers(ye));var Sr=ne.constantOr(null);if(Sr&&$e.imageAtlas){var nr=$e.imageAtlas,xr=nr.patternPositions[Sr.to.toString()],Cr=nr.patternPositions[Sr.from.toString()];xr&&Cr&&It.setConstantPatternPositions(xr,Cr)}var an=c.translatePosMatrix(ct.posMatrix,$e,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Xr=i.paint.get("fill-extrusion-vertical-gradient"),vn=me?Ol(an,c,Xr,Se,ct,ye,$e):go(an,c,Xr,Se);Mt.draw(L,L.gl.TRIANGLES,g,E,C,He.backCCW,vn,i.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,i.paint,c.transform.zoom,It)}}}function Bl(c,o,i,h,g,E){var C=c.context,L=C.gl,Z=o.fbo;if(Z){var ne=c.useProgram("hillshade");C.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,Z.colorAttachment.get());var me=function(ye,Se,Ye){var Xe=Ye.paint.get("hillshade-shadow-color"),ct=Ye.paint.get("hillshade-highlight-color"),$e=Ye.paint.get("hillshade-accent-color"),tt=Ye.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ye.paint.get("hillshade-illumination-anchor")==="viewport"&&(tt-=ye.transform.angle);var It,Mt,Sr,nr=!ye.options.moving;return{u_matrix:ye.transform.calculatePosMatrix(Se.tileID.toUnwrapped(),nr),u_image:0,u_latrange:(It=Se.tileID,Mt=Math.pow(2,It.canonical.z),Sr=It.canonical.y,[new p.MercatorCoordinate(0,Sr/Mt).toLngLat().lat,new p.MercatorCoordinate(0,(Sr+1)/Mt).toLngLat().lat]),u_light:[Ye.paint.get("hillshade-exaggeration"),tt],u_shadow:Xe,u_highlight:ct,u_accent:$e}}(c,o,i);ne.draw(C,L.TRIANGLES,h,g,E,He.disabled,me,i.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}}function mc(c,o,i,h,g,E){var C=c.context,L=C.gl,Z=o.dem;if(Z&&Z.data){var ne=Z.dim,me=Z.stride,ye=Z.getPixels();if(C.activeTexture.set(L.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||c.getTileTexture(me),o.demTexture){var Se=o.demTexture;Se.update(ye,{premultiply:!1}),Se.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else o.demTexture=new p.Texture(C,ye,L.RGBA,{premultiply:!1}),o.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);C.activeTexture.set(L.TEXTURE0);var Ye=o.fbo;if(!Ye){var Xe=new p.Texture(C,{width:ne,height:ne,data:null},L.RGBA);Xe.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Ye=o.fbo=C.createFramebuffer(ne,ne,!0)).colorAttachment.set(Xe.texture)}C.bindFramebuffer.set(Ye.framebuffer),C.viewport.set([0,0,ne,ne]),c.useProgram("hillshadePrepare").draw(C,L.TRIANGLES,h,g,E,He.disabled,function(ct,$e){var tt=$e.stride,It=p.create();return p.ortho(It,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(It,It,[0,-p.EXTENT,0]),{u_matrix:It,u_image:1,u_dimension:[tt,tt],u_zoom:ct.overscaledZ,u_unpack:$e.getUnpackVector()}}(o.tileID,Z),i.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function rl(c,o,i,h,g){var E=h.paint.get("raster-fade-duration");if(E>0){var C=p.browser.now(),L=(C-c.timeAdded)/E,Z=o?(C-o.timeAdded)/E:-1,ne=i.getSource(),me=g.coveringZoomLevel({tileSize:ne.tileSize,roundZoom:ne.roundZoom}),ye=!o||Math.abs(o.tileID.overscaledZ-me)>Math.abs(c.tileID.overscaledZ-me),Se=ye&&c.refreshedUponExpiration?1:p.clamp(ye?L:1-Z,0,1);return c.refreshedUponExpiration&&L>=1&&(c.refreshedUponExpiration=!1),o?{opacity:1,mix:1-Se}:{opacity:Se,mix:0}}return{opacity:1,mix:0}}var Vc=new p.Color(1,0,0,1),lf=new p.Color(0,1,0,1),cf=new p.Color(0,0,1,1),Ul=new p.Color(1,0,1,1),Gc=new p.Color(0,1,1,1);function Hc(c,o,i,h){nl(c,0,o+i/2,c.transform.width,i,h)}function gc(c,o,i,h){nl(c,o-i/2,0,i,c.transform.height,h)}function nl(c,o,i,h,g,E){var C=c.context,L=C.gl;L.enable(L.SCISSOR_TEST),L.scissor(o*p.browser.devicePixelRatio,i*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,g*p.browser.devicePixelRatio),C.clear({color:E}),L.disable(L.SCISSOR_TEST)}function Wc(c,o,i){var h=c.context,g=h.gl,E=i.posMatrix,C=c.useProgram("debug"),L=Y.disabled,Z=ue.disabled,ne=c.colorModeForRenderPass();h.activeTexture.set(g.TEXTURE0),c.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),C.draw(h,g.LINE_STRIP,L,Z,ne,He.disabled,bu(E,p.Color.red),"$debug",c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);var me=o.getTileByID(i.key).latestRawTileData,ye=Math.floor((me&&me.byteLength||0)/1024),Se=o.getTile(i).tileSize,Ye=512/Math.min(Se,512)*(i.overscaledZ/c.transform.zoom)*.5,Xe=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(Xe+=" => "+i.overscaledZ),function(ct,$e){ct.initDebugOverlayCanvas();var tt=ct.debugOverlayCanvas,It=ct.context.gl,Mt=ct.debugOverlayCanvas.getContext("2d");Mt.clearRect(0,0,tt.width,tt.height),Mt.shadowColor="white",Mt.shadowBlur=2,Mt.lineWidth=1.5,Mt.strokeStyle="white",Mt.textBaseline="top",Mt.font="bold 36px Open Sans, sans-serif",Mt.fillText($e,5,5),Mt.strokeText($e,5,5),ct.debugOverlayTexture.update(tt),ct.debugOverlayTexture.bind(It.LINEAR,It.CLAMP_TO_EDGE)}(c,Xe+" "+ye+"kb"),C.draw(h,g.TRIANGLES,L,Z,De.alphaBlended,He.disabled,bu(E,p.Color.transparent,Ye),"$debug",c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}var Eu={symbol:function(o,i,h,g,E){if(o.renderPass==="translucent"){var C=ue.disabled,L=o.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(Z,ne,me,ye,Se,Ye,Xe){for(var ct=ne.transform,$e=Se==="map",tt=Ye==="map",It=0,Mt=Z;It<Mt.length;It+=1){var Sr=Mt[It],nr=ye.getTile(Sr),xr=nr.getBucket(me);if(xr&&xr.text&&xr.text.segments.get().length){var Cr=p.evaluateSizeForZoom(xr.textSizeData,ct.zoom),an=aa(nr,1,ne.transform.zoom),Xr=mi(Sr.posMatrix,tt,$e,ne.transform,an),vn=me.layout.get("icon-text-fit")!=="none"&&xr.hasIconData();if(Cr){var An=Math.pow(2,ct.zoom-nr.tileID.overscaledZ);jc(xr,$e,tt,Xe,p.symbolSize,ct,Xr,Sr.posMatrix,An,Cr,vn)}}}}(g,o,h,i,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),E),h.paint.get("icon-opacity").constantOr(1)!==0&&el(o,i,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),C,L),h.paint.get("text-opacity").constantOr(1)!==0&&el(o,i,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),C,L),i.map.showCollisionBoxes&&(qs(o,i,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),qs(o,i,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(o,i,h,g){if(o.renderPass==="translucent"){var E=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),L=h.paint.get("circle-stroke-opacity"),Z=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||C.constantOr(1)!==0&&L.constantOr(1)!==0){for(var ne=o.context,me=ne.gl,ye=o.depthModeForSublayer(0,Y.ReadOnly),Se=ue.disabled,Ye=o.colorModeForRenderPass(),Xe=[],ct=0;ct<g.length;ct++){var $e=g[ct],tt=i.getTile($e),It=tt.getBucket(h);if(It){var Mt=It.programConfigurations.get(h.id),Sr={programConfiguration:Mt,program:o.useProgram("circle",Mt),layoutVertexBuffer:It.layoutVertexBuffer,indexBuffer:It.indexBuffer,uniformValues:Bu(o,$e,tt,h)};if(Z)for(var nr=0,xr=It.segments.get();nr<xr.length;nr+=1){var Cr=xr[nr];Xe.push({segments:new p.SegmentVector([Cr]),sortKey:Cr.sortKey,state:Sr})}else Xe.push({segments:It.segments,sortKey:0,state:Sr})}}Z&&Xe.sort(function(Xn,Qn){return Xn.sortKey-Qn.sortKey});for(var an=0,Xr=Xe;an<Xr.length;an+=1){var vn=Xr[an],An=vn.state;An.program.draw(ne,me.TRIANGLES,ye,Se,Ye,He.disabled,An.uniformValues,h.id,An.layoutVertexBuffer,An.indexBuffer,vn.segments,h.paint,o.transform.zoom,An.programConfiguration)}}}},heatmap:function(o,i,h,g){if(h.paint.get("heatmap-opacity")!==0)if(o.renderPass==="offscreen"){var E=o.context,C=E.gl,L=ue.disabled,Z=new De([C.ONE,C.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Xe,ct,$e){var tt=Xe.gl;Xe.activeTexture.set(tt.TEXTURE1),Xe.viewport.set([0,0,ct.width/4,ct.height/4]);var It=$e.heatmapFbo;if(It)tt.bindTexture(tt.TEXTURE_2D,It.colorAttachment.get()),Xe.bindFramebuffer.set(It.framebuffer);else{var Mt=tt.createTexture();tt.bindTexture(tt.TEXTURE_2D,Mt),tt.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_WRAP_S,tt.CLAMP_TO_EDGE),tt.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_WRAP_T,tt.CLAMP_TO_EDGE),tt.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_MIN_FILTER,tt.LINEAR),tt.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_MAG_FILTER,tt.LINEAR),It=$e.heatmapFbo=Xe.createFramebuffer(ct.width/4,ct.height/4,!1),function(Sr,nr,xr,Cr){var an=Sr.gl;an.texImage2D(an.TEXTURE_2D,0,an.RGBA,nr.width/4,nr.height/4,0,an.RGBA,Sr.extRenderToTextureHalfFloat?Sr.extTextureHalfFloat.HALF_FLOAT_OES:an.UNSIGNED_BYTE,null),Cr.colorAttachment.set(xr)}(Xe,ct,Mt,It)}})(E,o,h),E.clear({color:p.Color.transparent});for(var ne=0;ne<g.length;ne++){var me=g[ne];if(!i.hasRenderableParent(me)){var ye=i.getTile(me),Se=ye.getBucket(h);if(Se){var Ye=Se.programConfigurations.get(h.id);o.useProgram("heatmap",Ye).draw(E,C.TRIANGLES,Y.disabled,L,Z,He.disabled,kf(me.posMatrix,ye,o.transform.zoom,h.paint.get("heatmap-intensity")),h.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,h.paint,o.transform.zoom,Ye)}}}E.viewport.set([0,0,o.width,o.height])}else o.renderPass==="translucent"&&(o.context.setColorMode(o.colorModeForRenderPass()),function(Xe,ct){var $e=Xe.context,tt=$e.gl,It=ct.heatmapFbo;if(It){$e.activeTexture.set(tt.TEXTURE0),tt.bindTexture(tt.TEXTURE_2D,It.colorAttachment.get()),$e.activeTexture.set(tt.TEXTURE1);var Mt=ct.colorRampTexture;Mt||(Mt=ct.colorRampTexture=new p.Texture($e,ct.colorRamp,tt.RGBA)),Mt.bind(tt.LINEAR,tt.CLAMP_TO_EDGE),Xe.useProgram("heatmapTexture").draw($e,tt.TRIANGLES,Y.disabled,ue.disabled,Xe.colorModeForRenderPass(),He.disabled,function(Sr,nr,xr,Cr){var an=p.create();p.ortho(an,0,Sr.width,Sr.height,0,0,1);var Xr=Sr.context.gl;return{u_matrix:an,u_world:[Xr.drawingBufferWidth,Xr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:nr.paint.get("heatmap-opacity")}}(Xe,ct),ct.id,Xe.viewportBuffer,Xe.quadTriangleIndexBuffer,Xe.viewportSegments,ct.paint,Xe.transform.zoom)}}(o,h))},line:function(o,i,h,g){if(o.renderPass==="translucent"){var E=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(E.constantOr(1)!==0&&C.constantOr(1)!==0)for(var L=o.depthModeForSublayer(0,Y.ReadOnly),Z=o.colorModeForRenderPass(),ne=h.paint.get("line-dasharray"),me=h.paint.get("line-pattern"),ye=me.constantOr(1),Se=h.paint.get("line-gradient"),Ye=h.getCrossfadeParameters(),Xe=ye?"linePattern":ne?"lineSDF":Se?"lineGradient":"line",ct=o.context,$e=ct.gl,tt=!0,It=0,Mt=g;It<Mt.length;It+=1){var Sr=Mt[It],nr=i.getTile(Sr);if(!ye||nr.patternsLoaded()){var xr=nr.getBucket(h);if(xr){var Cr=xr.programConfigurations.get(h.id),an=o.context.program.get(),Xr=o.useProgram(Xe,Cr),vn=tt||Xr.program!==an,An=me.constantOr(null);if(An&&nr.imageAtlas){var Xn=nr.imageAtlas,Qn=Xn.patternPositions[An.to.toString()],Ci=Xn.patternPositions[An.from.toString()];Qn&&Ci&&Cr.setConstantPatternPositions(Qn,Ci)}var Ji=ye?uu(o,nr,h,Ye):ne?vc(o,nr,h,ne,Ye):Se?Ra(o,nr,h,xr.lineClipsArray.length):Dl(o,nr,h);if(ye)ct.activeTexture.set($e.TEXTURE0),nr.imageAtlasTexture.bind($e.LINEAR,$e.CLAMP_TO_EDGE),Cr.updatePaintBuffers(Ye);else if(ne&&(vn||o.lineAtlas.dirty))ct.activeTexture.set($e.TEXTURE0),o.lineAtlas.bind(ct);else if(Se){var Sn=xr.gradients[h.id],fi=Sn.texture;if(h.gradientVersion!==Sn.version){var gi=256;if(h.stepInterpolant){var Un=i.getSource().maxzoom,di=Sr.canonical.z===Un?Math.ceil(1<<o.transform.maxZoom-Sr.canonical.z):1;gi=p.clamp(p.nextPowerOfTwo(xr.maxLineLength/p.EXTENT*1024*di),256,ct.maxTextureSize)}Sn.gradient=p.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:gi,image:Sn.gradient||void 0,clips:xr.lineClipsArray}),Sn.texture?Sn.texture.update(Sn.gradient):Sn.texture=new p.Texture(ct,Sn.gradient,$e.RGBA),Sn.version=h.gradientVersion,fi=Sn.texture}ct.activeTexture.set($e.TEXTURE0),fi.bind(h.stepInterpolant?$e.NEAREST:$e.LINEAR,$e.CLAMP_TO_EDGE)}Xr.draw(ct,$e.TRIANGLES,L,o.stencilModeForClipping(Sr),Z,He.disabled,Ji,h.id,xr.layoutVertexBuffer,xr.indexBuffer,xr.segments,h.paint,o.transform.zoom,Cr,xr.layoutVertexBuffer2),tt=!1}}}}},fill:function(o,i,h,g){var E=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(C.constantOr(1)!==0){var L=o.colorModeForRenderPass(),Z=h.paint.get("fill-pattern"),ne=o.opaquePassEnabledForLayer()&&!Z.constantOr(1)&&E.constantOr(p.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(o.renderPass===ne){var me=o.depthModeForSublayer(1,o.renderPass==="opaque"?Y.ReadWrite:Y.ReadOnly);Zc(o,i,h,g,me,L,!1)}if(o.renderPass==="translucent"&&h.paint.get("fill-antialias")){var ye=o.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,Y.ReadOnly);Zc(o,i,h,g,ye,L,!0)}}},"fill-extrusion":function(o,i,h,g){var E=h.paint.get("fill-extrusion-opacity");if(E!==0&&o.renderPass==="translucent"){var C=new Y(o.context.gl.LEQUAL,Y.ReadWrite,o.depthRangeFor3D);if(E!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))tl(o,i,h,g,C,ue.disabled,De.disabled),tl(o,i,h,g,C,o.stencilModeFor3D(),o.colorModeForRenderPass());else{var L=o.colorModeForRenderPass();tl(o,i,h,g,C,ue.disabled,L)}}},hillshade:function(o,i,h,g){if(o.renderPass==="offscreen"||o.renderPass==="translucent"){for(var E=o.context,C=o.depthModeForSublayer(0,Y.ReadOnly),L=o.colorModeForRenderPass(),Z=o.renderPass==="translucent"?o.stencilConfigForOverlap(g):[{},g],ne=Z[0],me=0,ye=Z[1];me<ye.length;me+=1){var Se=ye[me],Ye=i.getTile(Se);Ye.needsHillshadePrepare&&o.renderPass==="offscreen"?mc(o,Ye,h,C,ue.disabled,L):o.renderPass==="translucent"&&Bl(o,Ye,h,C,ne[Se.overscaledZ],L)}E.viewport.set([0,0,o.width,o.height])}},raster:function(o,i,h,g){if(o.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&g.length)for(var E=o.context,C=E.gl,L=i.getSource(),Z=o.useProgram("raster"),ne=o.colorModeForRenderPass(),me=L instanceof re?[{},g]:o.stencilConfigForOverlap(g),ye=me[0],Se=me[1],Ye=Se[Se.length-1].overscaledZ,Xe=!o.options.moving,ct=0,$e=Se;ct<$e.length;ct+=1){var tt=$e[ct],It=o.depthModeForSublayer(tt.overscaledZ-Ye,h.paint.get("raster-opacity")===1?Y.ReadWrite:Y.ReadOnly,C.LESS),Mt=i.getTile(tt),Sr=o.transform.calculatePosMatrix(tt.toUnwrapped(),Xe);Mt.registerFadeDuration(h.paint.get("raster-fade-duration"));var nr=i.findLoadedParent(tt,0),xr=rl(Mt,nr,i,h,o.transform),Cr=void 0,an=void 0,Xr=h.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;E.activeTexture.set(C.TEXTURE0),Mt.texture.bind(Xr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(C.TEXTURE1),nr?(nr.texture.bind(Xr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),Cr=Math.pow(2,nr.tileID.overscaledZ-Mt.tileID.overscaledZ),an=[Mt.tileID.canonical.x*Cr%1,Mt.tileID.canonical.y*Cr%1]):Mt.texture.bind(Xr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var vn=kl(Sr,an||[0,0],Cr||1,xr,h);L instanceof re?Z.draw(E,C.TRIANGLES,It,ue.disabled,ne,He.disabled,vn,h.id,L.boundsBuffer,o.quadTriangleIndexBuffer,L.boundsSegments):Z.draw(E,C.TRIANGLES,It,ye[tt.overscaledZ],ne,He.disabled,vn,h.id,o.rasterBoundsBuffer,o.quadTriangleIndexBuffer,o.rasterBoundsSegments)}},background:function(o,i,h){var g=h.paint.get("background-color"),E=h.paint.get("background-opacity");if(E!==0){var C=o.context,L=C.gl,Z=o.transform,ne=Z.tileSize,me=h.paint.get("background-pattern");if(!o.isPatternMissing(me)){var ye=!me&&g.a===1&&E===1&&o.opaquePassEnabledForLayer()?"opaque":"translucent";if(o.renderPass===ye){var Se=ue.disabled,Ye=o.depthModeForSublayer(0,ye==="opaque"?Y.ReadWrite:Y.ReadOnly),Xe=o.colorModeForRenderPass(),ct=o.useProgram(me?"backgroundPattern":"background"),$e=Z.coveringTiles({tileSize:ne});me&&(C.activeTexture.set(L.TEXTURE0),o.imageManager.bind(o.context));for(var tt=h.getCrossfadeParameters(),It=0,Mt=$e;It<Mt.length;It+=1){var Sr=Mt[It],nr=o.transform.calculatePosMatrix(Sr.toUnwrapped()),xr=me?pl(nr,E,o,me,{tileID:Sr,tileSize:ne},tt):Nl(nr,E,g);ct.draw(C,L.TRIANGLES,Ye,Se,Xe,He.disabled,xr,h.id,o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments)}}}}},debug:function(o,i,h){for(var g=0;g<h.length;g++)Wc(o,i,h[g])},custom:function(o,i,h){var g=o.context,E=h.implementation;if(o.renderPass==="offscreen"){var C=E.prerender;C&&(o.setCustomLayerDefaults(),g.setColorMode(o.colorModeForRenderPass()),C.call(E,g.gl,o.transform.customLayerMatrix()),g.setDirty(),o.setBaseState())}else if(o.renderPass==="translucent"){o.setCustomLayerDefaults(),g.setColorMode(o.colorModeForRenderPass()),g.setStencilMode(ue.disabled);var L=E.renderingMode==="3d"?new Y(o.context.gl.LEQUAL,Y.ReadWrite,o.depthRangeFor3D):o.depthModeForSublayer(0,Y.ReadOnly);g.setDepthMode(L),E.render(g.gl,o.transform.customLayerMatrix()),g.setDirty(),o.setBaseState(),g.bindFramebuffer.set(null)}}},Ia=function(o,i){this.context=new he(o),this.transform=i,this._tileTextures={},this.setup(),this.numSublayers=Ne.maxUnderzooming+Ne.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ao,this.gpuTimers={}};Ia.prototype.resize=function(c,o){if(this.width=c*p.browser.devicePixelRatio,this.height=o*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var i=0,h=this.style._order;i<h.length;i+=1)this.style._layers[h[i]].resize()},Ia.prototype.setup=function(){var c=this.context,o=new p.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(p.EXTENT,0),o.emplaceBack(0,p.EXTENT),o.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(o,ba.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var i=new p.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(p.EXTENT,0),i.emplaceBack(0,p.EXTENT),i.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=c.createVertexBuffer(i,ba.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=c.createVertexBuffer(h,Q.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(g,ba.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var E=new p.StructArrayLayout1ui2;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(E);var C=new p.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(C),this.emptyTexture=new p.Texture(c,{width:1,height:1,data:new Uint8Array([0,0,0,0])},c.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new ue({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Ia.prototype.clearStencil=function(){var c=this.context,o=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var i=p.create();p.ortho(i,0,this.width,this.height,0,0,1),p.scale(i,i,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,o.TRIANGLES,Y.disabled,this.stencilClearMode,De.disabled,He.disabled,hl(i),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ia.prototype._renderTileClippingMasks=function(c,o){if(this.currentStencilSource!==c.source&&c.isTileClipped()&&o&&o.length){this.currentStencilSource=c.source;var i=this.context,h=i.gl;this.nextStencilID+o.length>256&&this.clearStencil(),i.setColorMode(De.disabled),i.setDepthMode(Y.disabled);var g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var E=0,C=o;E<C.length;E+=1){var L=C[E],Z=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;g.draw(i,h.TRIANGLES,Y.disabled,new ue({func:h.ALWAYS,mask:0},Z,255,h.KEEP,h.KEEP,h.REPLACE),De.disabled,He.disabled,hl(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ia.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var c=this.nextStencilID++,o=this.context.gl;return new ue({func:o.NOTEQUAL,mask:255},c,255,o.KEEP,o.KEEP,o.REPLACE)},Ia.prototype.stencilModeForClipping=function(c){var o=this.context.gl;return new ue({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,o.KEEP,o.KEEP,o.REPLACE)},Ia.prototype.stencilConfigForOverlap=function(c){var o,i=this.context.gl,h=c.sort(function(Z,ne){return ne.overscaledZ-Z.overscaledZ}),g=h[h.length-1].overscaledZ,E=h[0].overscaledZ-g+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();for(var C={},L=0;L<E;L++)C[L+g]=new ue({func:i.GEQUAL,mask:255},L+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=E,[C,h]}return[(o={},o[g]=ue.disabled,o),h]},Ia.prototype.colorModeForRenderPass=function(){var c=this.context.gl;return this._showOverdrawInspector?new De([c.CONSTANT_COLOR,c.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?De.unblended:De.alphaBlended},Ia.prototype.depthModeForSublayer=function(c,o,i){if(!this.opaquePassEnabledForLayer())return Y.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new Y(i||this.context.gl.LEQUAL,o,[h,h])},Ia.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ia.prototype.render=function(c,o){var i=this;this.style=c,this.options=o,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,g=this.style.sourceCaches;for(var E in g){var C=g[E];C.used&&C.prepare(this.context)}var L,Z,ne={},me={},ye={};for(var Se in g){var Ye=g[Se];ne[Se]=Ye.getVisibleCoordinates(),me[Se]=ne[Se].slice().reverse(),ye[Se]=Ye.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Xe=0;Xe<h.length;Xe++)if(this.style._layers[h[Xe]].is3D()){this.opaquePassCutoff=Xe;break}this.renderPass="offscreen";for(var ct=0,$e=h;ct<$e.length;ct+=1){var tt=this.style._layers[$e[ct]];if(tt.hasOffscreenPass()&&!tt.isHidden(this.transform.zoom)){var It=me[tt.source];(tt.type==="custom"||It.length)&&this.renderLayer(this,g[tt.source],tt,It)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Mt=this.style._layers[h[this.currentLayer]],Sr=g[Mt.source],nr=ne[Mt.source];this._renderTileClippingMasks(Mt,nr),this.renderLayer(this,Sr,Mt,nr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var xr=this.style._layers[h[this.currentLayer]],Cr=g[xr.source],an=(xr.type==="symbol"?ye:me)[xr.source];this._renderTileClippingMasks(xr,ne[xr.source]),this.renderLayer(this,Cr,xr,an)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(Xr){Xr.source&&!Xr.isHidden(i.transform.zoom)&&(Xr.source!==(Z&&Z.id)&&(Z=i.style.sourceCaches[Xr.source]),(!L||L.getSource().maxzoom<Z.getSource().maxzoom)&&(L=Z))}),L&&Eu.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(Xr){var vn=Xr.transform.padding;Hc(Xr,Xr.transform.height-(vn.top||0),3,Vc),Hc(Xr,vn.bottom||0,3,lf),gc(Xr,vn.left||0,3,cf),gc(Xr,Xr.transform.width-(vn.right||0),3,Ul);var An=Xr.transform.centerPoint;(function(Xn,Qn,Ci,Ji){nl(Xn,Qn-1,Ci-10,2,20,Ji),nl(Xn,Qn-10,Ci-1,20,2,Ji)})(Xr,An.x,Xr.transform.height-An.y,Gc)}(this),this.context.setDefault()},Ia.prototype.renderLayer=function(c,o,i,h){i.isHidden(this.transform.zoom)||(i.type==="background"||i.type==="custom"||h.length)&&(this.id=i.id,this.gpuTimingStart(i),Eu[i.type](c,o,i,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ia.prototype.gpuTimingStart=function(c){if(this.options.gpuTiming){var o=this.context.extTimerQuery,i=this.gpuTimers[c.id];i||(i=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),i.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,i.query)}},Ia.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}},Ia.prototype.collectGpuTimers=function(){var c=this.gpuTimers;return this.gpuTimers={},c},Ia.prototype.queryGpuTimers=function(c){var o={};for(var i in c){var h=c[i],g=this.context.extTimerQuery,E=g.getQueryObjectEXT(h.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(h.query),o[i]=E}return o},Ia.prototype.translatePosMatrix=function(c,o,i,h,g){if(!i[0]&&!i[1])return c;var E=g?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(E){var C=Math.sin(E),L=Math.cos(E);i=[i[0]*L-i[1]*C,i[0]*C+i[1]*L]}var Z=[g?i[0]:aa(o,i[0],this.transform.zoom),g?i[1]:aa(o,i[1],this.transform.zoom),0],ne=new Float32Array(16);return p.translate(ne,c,Z),ne},Ia.prototype.saveTileTexture=function(c){var o=this._tileTextures[c.size[0]];o?o.push(c):this._tileTextures[c.size[0]]=[c]},Ia.prototype.getTileTexture=function(c){var o=this._tileTextures[c];return o&&o.length>0?o.pop():null},Ia.prototype.isPatternMissing=function(c){if(!c)return!1;if(!c.from||!c.to)return!0;var o=this.imageManager.getPattern(c.from.toString()),i=this.imageManager.getPattern(c.to.toString());return!o||!i},Ia.prototype.useProgram=function(c,o){this.cache=this.cache||{};var i=""+c+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=new Ef(this.context,c,$f[c],o,ql[c],this._showOverdrawInspector)),this.cache[i]},Ia.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ia.prototype.setBaseState=function(){var c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)},Ia.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ia.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var jl=function(o,i){this.points=o,this.planes=i};jl.fromInvProjectionMatrix=function(c,o,i){var h=Math.pow(2,i),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(C){return p.transformMat4([],C,c)}).map(function(C){return p.scale$1([],C,1/C[3]/o*h)}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(C){var L=p.sub([],g[C[0]],g[C[1]]),Z=p.sub([],g[C[2]],g[C[1]]),ne=p.normalize([],p.cross([],L,Z)),me=-p.dot(ne,g[C[1]]);return ne.concat(me)});return new jl(g,E)};var wu=function(o,i){this.min=o,this.max=i,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};wu.prototype.quadrant=function(c){for(var o=[c%2==0,c<2],i=p.clone$2(this.min),h=p.clone$2(this.max),g=0;g<o.length;g++)i[g]=o[g]?this.min[g]:this.center[g],h[g]=o[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new wu(i,h)},wu.prototype.distanceX=function(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]},wu.prototype.distanceY=function(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]},wu.prototype.intersects=function(c){for(var o=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],i=!0,h=0;h<c.planes.length;h++){for(var g=c.planes[h],E=0,C=0;C<o.length;C++)E+=p.dot$1(g,o[C])>=0;if(E===0)return 0;E!==o.length&&(i=!1)}if(i)return 2;for(var L=0;L<3;L++){for(var Z=Number.MAX_VALUE,ne=-Number.MAX_VALUE,me=0;me<c.points.length;me++){var ye=c.points[me][L]-this.min[L];Z=Math.min(Z,ye),ne=Math.max(ne,ye)}if(ne<0||Z>this.max[L]-this.min[L])return 0}return 1};var Uu=function(o,i,h,g){if(o===void 0&&(o=0),i===void 0&&(i=0),h===void 0&&(h=0),g===void 0&&(g=0),isNaN(o)||o<0||isNaN(i)||i<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=i,this.left=h,this.right=g};Uu.prototype.interpolate=function(c,o,i){return o.top!=null&&c.top!=null&&(this.top=p.number(c.top,o.top,i)),o.bottom!=null&&c.bottom!=null&&(this.bottom=p.number(c.bottom,o.bottom,i)),o.left!=null&&c.left!=null&&(this.left=p.number(c.left,o.left,i)),o.right!=null&&c.right!=null&&(this.right=p.number(c.right,o.right,i)),this},Uu.prototype.getCenter=function(c,o){var i=p.clamp((this.left+c-this.right)/2,0,c),h=p.clamp((this.top+o-this.bottom)/2,0,o);return new p.Point(i,h)},Uu.prototype.equals=function(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right},Uu.prototype.clone=function(){return new Uu(this.top,this.bottom,this.left,this.right)},Uu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var zi=function(o,i,h,g,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=o||0,this._maxZoom=i||22,this._minPitch=h==null?0:h,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Uu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Pa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};zi.prototype.clone=function(){var c=new zi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.tileSize=this.tileSize,c.latRange=this.latRange,c.width=this.width,c.height=this.height,c._center=this._center,c.zoom=this.zoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._calcMatrices(),c},Pa.minZoom.get=function(){return this._minZoom},Pa.minZoom.set=function(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))},Pa.maxZoom.get=function(){return this._maxZoom},Pa.maxZoom.set=function(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))},Pa.minPitch.get=function(){return this._minPitch},Pa.minPitch.set=function(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))},Pa.maxPitch.get=function(){return this._maxPitch},Pa.maxPitch.set=function(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))},Pa.renderWorldCopies.get=function(){return this._renderWorldCopies},Pa.renderWorldCopies.set=function(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c},Pa.worldSize.get=function(){return this.tileSize*this.scale},Pa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Pa.size.get=function(){return new p.Point(this.width,this.height)},Pa.bearing.get=function(){return-this.angle/Math.PI*180},Pa.bearing.set=function(c){var o=-p.wrap(c,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Pa.pitch.get=function(){return this._pitch/Math.PI*180},Pa.pitch.set=function(c){var o=p.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())},Pa.fov.get=function(){return this._fov/Math.PI*180},Pa.fov.set=function(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())},Pa.zoom.get=function(){return this._zoom},Pa.zoom.set=function(c){var o=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom,this._constrain(),this._calcMatrices())},Pa.center.get=function(){return this._center},Pa.center.set=function(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())},Pa.padding.get=function(){return this._edgeInsets.toJSON()},Pa.padding.set=function(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())},Pa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},zi.prototype.isPaddingEqual=function(c){return this._edgeInsets.equals(c)},zi.prototype.interpolatePadding=function(c,o,i){this._unmodified=!1,this._edgeInsets.interpolate(c,o,i),this._constrain(),this._calcMatrices()},zi.prototype.coveringZoomLevel=function(c){var o=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,o)},zi.prototype.getVisibleUnwrappedCoordinates=function(c){var o=[new p.UnwrappedTileID(0,c)];if(this._renderWorldCopies)for(var i=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),g=this.pointCoordinate(new p.Point(this.width,this.height)),E=this.pointCoordinate(new p.Point(0,this.height)),C=Math.floor(Math.min(i.x,h.x,g.x,E.x)),L=Math.floor(Math.max(i.x,h.x,g.x,E.x)),Z=C-1;Z<=L+1;Z++)Z!==0&&o.push(new p.UnwrappedTileID(Z,c));return o},zi.prototype.coveringTiles=function(c){var o=this.coveringZoomLevel(c),i=o;if(c.minzoom!==void 0&&o<c.minzoom)return[];c.maxzoom!==void 0&&o>c.maxzoom&&(o=c.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),g=Math.pow(2,o),E=[g*h.x,g*h.y,0],C=jl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o),L=c.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=o);var Z=function(vn){return{aabb:new wu([vn*g,0,0],[(vn+1)*g,g,0]),zoom:0,x:0,y:0,wrap:vn,fullyVisible:!1}},ne=[],me=[],ye=o,Se=c.reparseOverscaled?i:o;if(this._renderWorldCopies)for(var Ye=1;Ye<=3;Ye++)ne.push(Z(-Ye)),ne.push(Z(Ye));for(ne.push(Z(0));ne.length>0;){var Xe=ne.pop(),ct=Xe.x,$e=Xe.y,tt=Xe.fullyVisible;if(!tt){var It=Xe.aabb.intersects(C);if(It===0)continue;tt=It===2}var Mt=Xe.aabb.distanceX(E),Sr=Xe.aabb.distanceY(E),nr=Math.max(Math.abs(Mt),Math.abs(Sr));if(Xe.zoom===ye||nr>3+(1<<ye-Xe.zoom)-2&&Xe.zoom>=L)me.push({tileID:new p.OverscaledTileID(Xe.zoom===ye?Se:Xe.zoom,Xe.wrap,Xe.zoom,ct,$e),distanceSq:p.sqrLen([E[0]-.5-ct,E[1]-.5-$e])});else for(var xr=0;xr<4;xr++){var Cr=(ct<<1)+xr%2,an=($e<<1)+(xr>>1);ne.push({aabb:Xe.aabb.quadrant(xr),zoom:Xe.zoom+1,x:Cr,y:an,wrap:Xe.wrap,fullyVisible:tt})}}return me.sort(function(Xr,vn){return Xr.distanceSq-vn.distanceSq}).map(function(Xr){return Xr.tileID})},zi.prototype.resize=function(c,o){this.width=c,this.height=o,this.pixelsToGLUnits=[2/c,-2/o],this._constrain(),this._calcMatrices()},Pa.unmodified.get=function(){return this._unmodified},zi.prototype.zoomScale=function(c){return Math.pow(2,c)},zi.prototype.scaleZoom=function(c){return Math.log(c)/Math.LN2},zi.prototype.project=function(c){var o=p.clamp(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(c.lng)*this.worldSize,p.mercatorYfromLat(o)*this.worldSize)},zi.prototype.unproject=function(c){return new p.MercatorCoordinate(c.x/this.worldSize,c.y/this.worldSize).toLngLat()},Pa.point.get=function(){return this.project(this.center)},zi.prototype.setLocationAtPoint=function(c,o){var i=this.pointCoordinate(o),h=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(c),E=new p.MercatorCoordinate(g.x-(i.x-h.x),g.y-(i.y-h.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())},zi.prototype.locationPoint=function(c){return this.coordinatePoint(this.locationCoordinate(c))},zi.prototype.pointLocation=function(c){return this.coordinateLocation(this.pointCoordinate(c))},zi.prototype.locationCoordinate=function(c){return p.MercatorCoordinate.fromLngLat(c)},zi.prototype.coordinateLocation=function(c){return c.toLngLat()},zi.prototype.pointCoordinate=function(c){var o=[c.x,c.y,0,1],i=[c.x,c.y,1,1];p.transformMat4(o,o,this.pixelMatrixInverse),p.transformMat4(i,i,this.pixelMatrixInverse);var h=o[3],g=i[3],E=o[1]/h,C=i[1]/g,L=o[2]/h,Z=i[2]/g,ne=L===Z?0:(0-L)/(Z-L);return new p.MercatorCoordinate(p.number(o[0]/h,i[0]/g,ne)/this.worldSize,p.number(E,C,ne)/this.worldSize)},zi.prototype.coordinatePoint=function(c){var o=[c.x*this.worldSize,c.y*this.worldSize,0,1];return p.transformMat4(o,o,this.pixelMatrix),new p.Point(o[0]/o[3],o[1]/o[3])},zi.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},zi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},zi.prototype.setMaxBounds=function(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},zi.prototype.calculatePosMatrix=function(c,o){o===void 0&&(o=!1);var i=c.key,h=o?this._alignedPosMatrixCache:this._posMatrixCache;if(h[i])return h[i];var g=c.canonical,E=this.worldSize/this.zoomScale(g.z),C=g.x+Math.pow(2,g.z)*c.wrap,L=p.identity(new Float64Array(16));return p.translate(L,L,[C*E,g.y*E,0]),p.scale(L,L,[E/p.EXTENT,E/p.EXTENT,1]),p.multiply(L,o?this.alignedProjMatrix:this.projMatrix,L),h[i]=new Float32Array(L),h[i]},zi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},zi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var c,o,i,h,g=-90,E=90,C=-180,L=180,Z=this.size,ne=this._unmodified;if(this.latRange){var me=this.latRange;g=p.mercatorYfromLat(me[1])*this.worldSize,c=(E=p.mercatorYfromLat(me[0])*this.worldSize)-g<Z.y?Z.y/(E-g):0}if(this.lngRange){var ye=this.lngRange;C=p.mercatorXfromLng(ye[0])*this.worldSize,o=(L=p.mercatorXfromLng(ye[1])*this.worldSize)-C<Z.x?Z.x/(L-C):0}var Se=this.point,Ye=Math.max(o||0,c||0);if(Ye)return this.center=this.unproject(new p.Point(o?(L+C)/2:Se.x,c?(E+g)/2:Se.y)),this.zoom+=this.scaleZoom(Ye),this._unmodified=ne,void(this._constraining=!1);if(this.latRange){var Xe=Se.y,ct=Z.y/2;Xe-ct<g&&(h=g+ct),Xe+ct>E&&(h=E-ct)}if(this.lngRange){var $e=Se.x,tt=Z.x/2;$e-tt<C&&(i=C+tt),$e+tt>L&&(i=L-tt)}i===void 0&&h===void 0||(this.center=this.unproject(new p.Point(i!==void 0?i:Se.x,h!==void 0?h:Se.y))),this._unmodified=ne,this._constraining=!1}},zi.prototype._calcMatrices=function(){if(this.height){var c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var o=Math.PI/2+this._pitch,i=this._fov*(.5+c.y/this.height),h=Math.sin(i)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-o-i,.01,Math.PI-.01)),g=this.point,E=g.x,C=g.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),Z=this.height/50,ne=new Float64Array(16);p.perspective(ne,this._fov,this.width/this.height,Z,L),ne[8]=2*-c.x/this.width,ne[9]=2*c.y/this.height,p.scale(ne,ne,[1,-1,1]),p.translate(ne,ne,[0,0,-this.cameraToCenterDistance]),p.rotateX(ne,ne,this._pitch),p.rotateZ(ne,ne,this.angle),p.translate(ne,ne,[-E,-C,0]),this.mercatorMatrix=p.scale([],ne,[this.worldSize,this.worldSize,this.worldSize]),p.scale(ne,ne,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ne,this.invProjMatrix=p.invert([],this.projMatrix);var me=this.width%2/2,ye=this.height%2/2,Se=Math.cos(this.angle),Ye=Math.sin(this.angle),Xe=E-Math.round(E)+Se*me+Ye*ye,ct=C-Math.round(C)+Se*ye+Ye*me,$e=new Float64Array(ne);if(p.translate($e,$e,[Xe>.5?Xe-1:Xe,ct>.5?ct-1:ct,0]),this.alignedProjMatrix=$e,ne=p.create(),p.scale(ne,ne,[this.width/2,-this.height/2,1]),p.translate(ne,ne,[1,-1,0]),this.labelPlaneMatrix=ne,ne=p.create(),p.scale(ne,ne,[1,-1,1]),p.translate(ne,ne,[-1,-1,0]),p.scale(ne,ne,[2/this.width,2/this.height,1]),this.glCoordMatrix=ne,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ne=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ne,this._posMatrixCache={},this._alignedPosMatrixCache={}}},zi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var c=this.pointCoordinate(new p.Point(0,0)),o=[c.x*this.worldSize,c.y*this.worldSize,0,1];return p.transformMat4(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance},zi.prototype.getCameraPoint=function(){var c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,c))},zi.prototype.getCameraQueryGeometry=function(c){var o=this.getCameraPoint();if(c.length===1)return[c[0],o];for(var i=o.x,h=o.y,g=o.x,E=o.y,C=0,L=c;C<L.length;C+=1){var Z=L[C];i=Math.min(i,Z.x),h=Math.min(h,Z.y),g=Math.max(g,Z.x),E=Math.max(E,Z.y)}return[new p.Point(i,h),new p.Point(g,h),new p.Point(g,E),new p.Point(i,E),new p.Point(i,h)]},Object.defineProperties(zi.prototype,Pa);var Ma=function(o){var i,h,g,E;this._hashName=o&&encodeURIComponent(o),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(i=this._updateHashUnthrottled.bind(this),h=!1,g=null,E=function(){g=null,h&&(i(),g=setTimeout(E,300),h=!1)},function(){return h=!0,g||E(),g})};Ma.prototype.addTo=function(c){return this._map=c,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ma.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ma.prototype.getHashString=function(c){var o=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,h=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),E=Math.round(o.lng*g)/g,C=Math.round(o.lat*g)/g,L=this._map.getBearing(),Z=this._map.getPitch(),ne="";if(ne+=c?"/"+E+"/"+C+"/"+i:i+"/"+C+"/"+E,(L||Z)&&(ne+="/"+Math.round(10*L)/10),Z&&(ne+="/"+Math.round(Z)),this._hashName){var me=this._hashName,ye=!1,Se=p.window.location.hash.slice(1).split("&").map(function(Ye){var Xe=Ye.split("=")[0];return Xe===me?(ye=!0,Xe+"="+ne):Ye}).filter(function(Ye){return Ye});return ye||Se.push(me+"="+ne),"#"+Se.join("&")}return"#"+ne},Ma.prototype._getCurrentHash=function(){var c,o=this,i=p.window.location.hash.replace("#","");return this._hashName?(i.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===o._hashName&&(c=h)}),(c&&c[1]||"").split("/")):i.split("/")},Ma.prototype._onHashChange=function(){var c=this._getCurrentHash();if(c.length>=3&&!c.some(function(i){return isNaN(i)})){var o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:o,pitch:+(c[4]||0)}),!0}return!1},Ma.prototype._updateHashUnthrottled=function(){var c=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,c)}catch(o){}};var tc={linearity:.3,easing:p.bezier(0,0,.3,1)},Zl=p.extend({deceleration:2500,maxSpeed:1400},tc),rc=p.extend({deceleration:20,maxSpeed:1400},tc),wf=p.extend({deceleration:1e3,maxSpeed:360},tc),Tf=p.extend({deceleration:1e3,maxSpeed:90},tc),Vl=function(o){this._map=o,this.clear()};function ju(c,o){(!c.duration||c.duration<o.duration)&&(c.duration=o.duration,c.easing=o.easing)}function Zu(c,o,i){var h=i.maxSpeed,g=i.linearity,E=i.deceleration,C=p.clamp(c*g/(o/1e3),-h,h),L=Math.abs(C)/(E*g);return{easing:i.easing,duration:1e3*L,amount:C*(L/2)}}Vl.prototype.clear=function(){this._inertiaBuffer=[]},Vl.prototype.record=function(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:c})},Vl.prototype._drainInertiaBuffer=function(){for(var c=this._inertiaBuffer,o=p.browser.now();c.length>0&&o-c[0].time>160;)c.shift()},Vl.prototype._onMoveEnd=function(c){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var o={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},i=0,h=this._inertiaBuffer;i<h.length;i+=1){var g=h[i].settings;o.zoom+=g.zoomDelta||0,o.bearing+=g.bearingDelta||0,o.pitch+=g.pitchDelta||0,g.panDelta&&o.pan._add(g.panDelta),g.around&&(o.around=g.around),g.pinchAround&&(o.pinchAround=g.pinchAround)}var E=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,C={};if(o.pan.mag()){var L=Zu(o.pan.mag(),E,p.extend({},Zl,c||{}));C.offset=o.pan.mult(L.amount/o.pan.mag()),C.center=this._map.transform.center,ju(C,L)}if(o.zoom){var Z=Zu(o.zoom,E,rc);C.zoom=this._map.transform.zoom+Z.amount,ju(C,Z)}if(o.bearing){var ne=Zu(o.bearing,E,wf);C.bearing=this._map.transform.bearing+p.clamp(ne.amount,-179,179),ju(C,ne)}if(o.pitch){var me=Zu(o.pitch,E,Tf);C.pitch=this._map.transform.pitch+me.amount,ju(C,me)}if(C.zoom||C.bearing){var ye=o.pinchAround===void 0?o.around:o.pinchAround;C.around=ye?this._map.unproject(ye):this._map.getCenter()}return this.clear(),p.extend(C,{noMoveStart:!0})}};var Qa=function(c){function o(h,g,E,C){C===void 0&&(C={});var L=S.mousePos(g.getCanvasContainer(),E),Z=g.unproject(L);c.call(this,h,p.extend({point:L,lngLat:Z,originalEvent:E},C)),this._defaultPrevented=!1,this.target=g}c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o;var i={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,i),o}(p.Event),ys=function(c){function o(h,g,E){var C=h==="touchend"?E.changedTouches:E.touches,L=S.touchPos(g.getCanvasContainer(),C),Z=L.map(function(ye){return g.unproject(ye)}),ne=L.reduce(function(ye,Se,Ye,Xe){return ye.add(Se.div(Xe.length))},new p.Point(0,0)),me=g.unproject(ne);c.call(this,h,{points:L,point:ne,lngLats:Z,lngLat:me,originalEvent:E}),this._defaultPrevented=!1}c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o;var i={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,i),o}(p.Event),vl=function(c){function o(h,g,E){c.call(this,h,{originalEvent:E}),this._defaultPrevented=!1}c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o;var i={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,i),o}(p.Event),so=function(o,i){this._map=o,this._clickTolerance=i.clickTolerance};so.prototype.reset=function(){delete this._mousedownPos},so.prototype.wheel=function(c){return this._firePreventable(new vl(c.type,this._map,c))},so.prototype.mousedown=function(c,o){return this._mousedownPos=o,this._firePreventable(new Qa(c.type,this._map,c))},so.prototype.mouseup=function(c){this._map.fire(new Qa(c.type,this._map,c))},so.prototype.click=function(c,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Qa(c.type,this._map,c))},so.prototype.dblclick=function(c){return this._firePreventable(new Qa(c.type,this._map,c))},so.prototype.mouseover=function(c){this._map.fire(new Qa(c.type,this._map,c))},so.prototype.mouseout=function(c){this._map.fire(new Qa(c.type,this._map,c))},so.prototype.touchstart=function(c){return this._firePreventable(new ys(c.type,this._map,c))},so.prototype.touchmove=function(c){this._map.fire(new ys(c.type,this._map,c))},so.prototype.touchend=function(c){this._map.fire(new ys(c.type,this._map,c))},so.prototype.touchcancel=function(c){this._map.fire(new ys(c.type,this._map,c))},so.prototype._firePreventable=function(c){if(this._map.fire(c),c.defaultPrevented)return{}},so.prototype.isEnabled=function(){return!0},so.prototype.isActive=function(){return!1},so.prototype.enable=function(){},so.prototype.disable=function(){};var Tn=function(o){this._map=o};Tn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Tn.prototype.mousemove=function(c){this._map.fire(new Qa(c.type,this._map,c))},Tn.prototype.mousedown=function(){this._delayContextMenu=!0},Tn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Tn.prototype.contextmenu=function(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Qa(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()},Tn.prototype.isEnabled=function(){return!0},Tn.prototype.isActive=function(){return!1},Tn.prototype.enable=function(){},Tn.prototype.disable=function(){};var Ns=function(o,i){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=i.clickTolerance||1};function nc(c,o){for(var i={},h=0;h<c.length;h++)i[c[h].identifier]=o[h];return i}Ns.prototype.isEnabled=function(){return!!this._enabled},Ns.prototype.isActive=function(){return!!this._active},Ns.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Ns.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ns.prototype.mousedown=function(c,o){this.isEnabled()&&c.shiftKey&&c.button===0&&(S.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)},Ns.prototype.mousemoveWindow=function(c,o){if(this._active){var i=o;if(!(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=i,this._box||(this._box=S.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));var g=Math.min(h.x,i.x),E=Math.max(h.x,i.x),C=Math.min(h.y,i.y),L=Math.max(h.y,i.y);S.setTransform(this._box,"translate("+g+"px,"+C+"px)"),this._box.style.width=E-g+"px",this._box.style.height=L-C+"px"}}},Ns.prototype.mouseupWindow=function(c,o){var i=this;if(this._active&&c.button===0){var h=this._startPos,g=o;if(this.reset(),S.suppressClick(),h.x!==g.x||h.y!==g.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:function(C){return C.fitScreenCoordinates(h,g,i._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",c)}},Ns.prototype.keydown=function(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))},Ns.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(S.remove(this._box),this._box=null),S.enableDrag(),delete this._startPos,delete this._lastPos},Ns.prototype._fireEvent=function(c,o){return this._map.fire(new p.Event(c,{originalEvent:o}))};var ml=function(o){this.reset(),this.numTouches=o.numTouches};ml.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ml.prototype.touchstart=function(c,o,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),i.length===this.numTouches&&(this.centroid=function(h){for(var g=new p.Point(0,0),E=0,C=h;E<C.length;E+=1)g._add(C[E]);return g.div(h.length)}(o),this.touches=nc(i,o)))},ml.prototype.touchmove=function(c,o,i){if(!this.aborted&&this.centroid){var h=nc(i,o);for(var g in this.touches){var E=h[g];(!E||E.dist(this.touches[g])>30)&&(this.aborted=!0)}}},ml.prototype.touchend=function(c,o,i){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),i.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var eu=function(o){this.singleTap=new ml(o),this.numTaps=o.numTaps,this.reset()};eu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},eu.prototype.touchstart=function(c,o,i){this.singleTap.touchstart(c,o,i)},eu.prototype.touchmove=function(c,o,i){this.singleTap.touchmove(c,o,i)},eu.prototype.touchend=function(c,o,i){var h=this.singleTap.touchend(c,o,i);if(h){var g=c.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(h)<30;if(g&&E||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var Zs=function(){this._zoomIn=new eu({numTouches:1,numTaps:2}),this._zoomOut=new eu({numTouches:2,numTaps:1}),this.reset()};Zs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Zs.prototype.touchstart=function(c,o,i){this._zoomIn.touchstart(c,o,i),this._zoomOut.touchstart(c,o,i)},Zs.prototype.touchmove=function(c,o,i){this._zoomIn.touchmove(c,o,i),this._zoomOut.touchmove(c,o,i)},Zs.prototype.touchend=function(c,o,i){var h=this,g=this._zoomIn.touchend(c,o,i),E=this._zoomOut.touchend(c,o,i);return g?(this._active=!0,c.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(L){return L.easeTo({duration:300,zoom:L.getZoom()+1,around:L.unproject(g)},{originalEvent:c})}}):E?(this._active=!0,c.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(L){return L.easeTo({duration:300,zoom:L.getZoom()-1,around:L.unproject(E)},{originalEvent:c})}}):void 0},Zs.prototype.touchcancel=function(){this.reset()},Zs.prototype.enable=function(){this._enabled=!0},Zs.prototype.disable=function(){this._enabled=!1,this.reset()},Zs.prototype.isEnabled=function(){return this._enabled},Zs.prototype.isActive=function(){return this._active};var gl={0:1,2:2},en=function(o){this.reset(),this._clickTolerance=o.clickTolerance||1};en.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},en.prototype._correctButton=function(c,o){return!1},en.prototype._move=function(c,o){return{}},en.prototype.mousedown=function(c,o){if(!this._lastPoint){var i=S.mouseButton(c);this._correctButton(c,i)&&(this._lastPoint=o,this._eventButton=i)}},en.prototype.mousemoveWindow=function(c,o){var i=this._lastPoint;if(i){if(c.preventDefault(),function(h,g){var E=gl[g];return h.buttons===void 0||(h.buttons&E)!==E}(c,this._eventButton))this.reset();else if(this._moved||!(o.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(i,o)}},en.prototype.mouseupWindow=function(c){this._lastPoint&&S.mouseButton(c)===this._eventButton&&(this._moved&&S.suppressClick(),this.reset())},en.prototype.enable=function(){this._enabled=!0},en.prototype.disable=function(){this._enabled=!1,this.reset()},en.prototype.isEnabled=function(){return this._enabled},en.prototype.isActive=function(){return this._active};var Xc=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.mousedown=function(i,h){c.prototype.mousedown.call(this,i,h),this._lastPoint&&(this._active=!0)},o.prototype._correctButton=function(i,h){return h===0&&!i.ctrlKey},o.prototype._move=function(i,h){return{around:h,panDelta:h.sub(i)}},o}(en),yc=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype._correctButton=function(i,h){return h===0&&i.ctrlKey||h===2},o.prototype._move=function(i,h){var g=.8*(h.x-i.x);if(g)return this._active=!0,{bearingDelta:g}},o.prototype.contextmenu=function(i){i.preventDefault()},o}(en),Vu=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype._correctButton=function(i,h){return h===0&&i.ctrlKey||h===2},o.prototype._move=function(i,h){var g=-.5*(h.y-i.y);if(g)return this._active=!0,{pitchDelta:g}},o.prototype.contextmenu=function(i){i.preventDefault()},o}(en),tu=function(o){this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset()};tu.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},tu.prototype.touchstart=function(c,o,i){return this._calculateTransform(c,o,i)},tu.prototype.touchmove=function(c,o,i){if(this._active&&!(i.length<this._minTouches))return c.preventDefault(),this._calculateTransform(c,o,i)},tu.prototype.touchend=function(c,o,i){this._calculateTransform(c,o,i),this._active&&i.length<this._minTouches&&this.reset()},tu.prototype.touchcancel=function(){this.reset()},tu.prototype._calculateTransform=function(c,o,i){i.length>0&&(this._active=!0);var h=nc(i,o),g=new p.Point(0,0),E=new p.Point(0,0),C=0;for(var L in h){var Z=h[L],ne=this._touches[L];ne&&(g._add(Z),E._add(Z.sub(ne)),C++,h[L]=Z)}if(this._touches=h,!(C<this._minTouches)&&E.mag()){var me=E.div(C);if(this._sum._add(me),!(this._sum.mag()<this._clickTolerance))return{around:g.div(C),panDelta:me}}},tu.prototype.enable=function(){this._enabled=!0},tu.prototype.disable=function(){this._enabled=!1,this.reset()},tu.prototype.isEnabled=function(){return this._enabled},tu.prototype.isActive=function(){return this._active};var Ba=function(){this.reset()};function Tu(c,o,i){for(var h=0;h<c.length;h++)if(c[h].identifier===i)return o[h]}function Au(c,o){return Math.log(c/o)/Math.LN2}Ba.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ba.prototype._start=function(c){},Ba.prototype._move=function(c,o,i){return{}},Ba.prototype.touchstart=function(c,o,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([o[0],o[1]]))},Ba.prototype.touchmove=function(c,o,i){if(this._firstTwoTouches){c.preventDefault();var h=this._firstTwoTouches,g=h[1],E=Tu(i,o,h[0]),C=Tu(i,o,g);if(E&&C){var L=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],L,c)}}},Ba.prototype.touchend=function(c,o,i){if(this._firstTwoTouches){var h=this._firstTwoTouches,g=h[1],E=Tu(i,o,h[0]),C=Tu(i,o,g);E&&C||(this._active&&S.suppressClick(),this.reset())}},Ba.prototype.touchcancel=function(){this.reset()},Ba.prototype.enable=function(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"},Ba.prototype.disable=function(){this._enabled=!1,this.reset()},Ba.prototype.isEnabled=function(){return this._enabled},Ba.prototype.isActive=function(){return this._active};var Wo=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.reset=function(){c.prototype.reset.call(this),delete this._distance,delete this._startDistance},o.prototype._start=function(i){this._startDistance=this._distance=i[0].dist(i[1])},o.prototype._move=function(i,h){var g=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Au(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Au(this._distance,g),pinchAround:h}},o}(Ba);function Cu(c,o){return 180*c.angleWith(o)/Math.PI}var il=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.reset=function(){c.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},o.prototype._start=function(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])},o.prototype._move=function(i,h){var g=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Cu(this._vector,g),pinchAround:h}},o.prototype._isBelowThreshold=function(i){this._minDiameter=Math.min(this._minDiameter,i.mag());var h=25/(Math.PI*this._minDiameter)*360,g=Cu(i,this._startVector);return Math.abs(g)<h},o}(Ba);function yl(c){return Math.abs(c.y)>Math.abs(c.x)}var Kc=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.reset=function(){c.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},o.prototype._start=function(i){this._lastPoints=i,yl(i[0].sub(i[1]))&&(this._valid=!1)},o.prototype._move=function(i,h,g){var E=i[0].sub(this._lastPoints[0]),C=i[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(E,C,g.timeStamp),this._valid)return this._lastPoints=i,this._active=!0,{pitchDelta:(E.y+C.y)/2*-.5}},o.prototype.gestureBeginsVertically=function(i,h,g){if(this._valid!==void 0)return this._valid;var E=i.mag()>=2,C=h.mag()>=2;if(E||C){if(!E||!C)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;var L=i.y>0==h.y>0;return yl(i)&&yl(h)&&L}},o}(Ba),_c={panStep:100,bearingStep:15,pitchStep:10},ws=function(){var o=_c;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1};function Ts(c){return c*(2-c)}ws.prototype.reset=function(){this._active=!1},ws.prototype.keydown=function(c){var o=this;if(!(c.altKey||c.ctrlKey||c.metaKey)){var i=0,h=0,g=0,E=0,C=0;switch(c.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:c.shiftKey?h=-1:(c.preventDefault(),E=-1);break;case 39:c.shiftKey?h=1:(c.preventDefault(),E=1);break;case 38:c.shiftKey?g=1:(c.preventDefault(),C=-1);break;case 40:c.shiftKey?g=-1:(c.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:function(Z){var ne=Z.getZoom();Z.easeTo({duration:300,easeId:"keyboardHandler",easing:Ts,zoom:i?Math.round(ne)+i*(c.shiftKey?2:1):ne,bearing:Z.getBearing()+h*o._bearingStep,pitch:Z.getPitch()+g*o._pitchStep,offset:[-E*o._panStep,-C*o._panStep],center:Z.getCenter()},{originalEvent:c})}}}},ws.prototype.enable=function(){this._enabled=!0},ws.prototype.disable=function(){this._enabled=!1,this.reset()},ws.prototype.isEnabled=function(){return this._enabled},ws.prototype.isActive=function(){return this._active},ws.prototype.disableRotation=function(){this._rotationDisabled=!0},ws.prototype.enableRotation=function(){this._rotationDisabled=!1};var Oi=function(o,i){this._map=o,this._el=o.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};Oi.prototype.setZoomRate=function(c){this._defaultZoomRate=c},Oi.prototype.setWheelZoomRate=function(c){this._wheelZoomRate=c},Oi.prototype.isEnabled=function(){return!!this._enabled},Oi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Oi.prototype.isZooming=function(){return!!this._zooming},Oi.prototype.enable=function(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=c&&c.around==="center")},Oi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Oi.prototype.wheel=function(c){if(this.isEnabled()){var o=c.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,i=p.browser.now(),h=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,o!==0&&o%4.000244140625==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(h*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),c.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=c,this._delta-=o,this._active||this._start(c)),c.preventDefault()}},Oi.prototype._onTimeout=function(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},Oi.prototype._start=function(c){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var o=S.mousePos(this._el,c);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(o)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Oi.prototype.renderFrame=function(){var c=this;if(this._frameId&&(this._frameId=null,this.isActive())){var o=this._map.transform;if(this._delta!==0){var i=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&h!==0&&(h=1/h);var g=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(g*h))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var E,C=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,L=this._startZoom,Z=this._easing,ne=!1;if(this._type==="wheel"&&L&&Z){var me=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),ye=Z(me);E=p.number(L,C,ye),me<1?this._frameId||(this._frameId=!0):ne=!0}else E=C,ne=!0;return this._active=!0,ne&&(this._active=!1,this._finishTimeout=setTimeout(function(){c._zooming=!1,c._handler._triggerRenderFrame(),delete c._targetZoom,delete c._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ne,zoomDelta:E-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Oi.prototype._smoothOutEasing=function(c){var o=p.ease;if(this._prevEase){var i=this._prevEase,h=(p.browser.now()-i.start)/i.duration,g=i.easing(h+.01)-i.easing(h),E=.27/Math.sqrt(g*g+1e-4)*.01,C=Math.sqrt(.0729-E*E);o=p.bezier(E,C,.25,1)}return this._prevEase={start:p.browser.now(),duration:c,easing:o},o},Oi.prototype.reset=function(){this._active=!1};var Pu=function(o,i){this._clickZoom=o,this._tapZoom=i};Pu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Pu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Pu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Pu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Xo=function(){this.reset()};Xo.prototype.reset=function(){this._active=!1},Xo.prototype.dblclick=function(c,o){return c.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(c.shiftKey?-1:1),around:h.unproject(o)},{originalEvent:c})}}},Xo.prototype.enable=function(){this._enabled=!0},Xo.prototype.disable=function(){this._enabled=!1,this.reset()},Xo.prototype.isEnabled=function(){return this._enabled},Xo.prototype.isActive=function(){return this._active};var Io=function(){this._tap=new eu({numTouches:1,numTaps:1}),this.reset()};Io.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Io.prototype.touchstart=function(c,o,i){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=o[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(c,o,i))},Io.prototype.touchmove=function(c,o,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;var h=o[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,c.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(c,o,i)},Io.prototype.touchend=function(c,o,i){this._tapTime?this._swipePoint&&i.length===0&&this.reset():this._tap.touchend(c,o,i)&&(this._tapTime=c.timeStamp)},Io.prototype.touchcancel=function(){this.reset()},Io.prototype.enable=function(){this._enabled=!0},Io.prototype.disable=function(){this._enabled=!1,this.reset()},Io.prototype.isEnabled=function(){return this._enabled},Io.prototype.isActive=function(){return this._active};var _l=function(o,i,h){this._el=o,this._mousePan=i,this._touchPan=h};_l.prototype.enable=function(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},_l.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},_l.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},_l.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Gu=function(o,i,h){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=i,this._mousePitch=h};Gu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Gu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Gu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Gu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var ru=function(o,i,h,g){this._el=o,this._touchZoom=i,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};ru.prototype.enable=function(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},ru.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},ru.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},ru.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},ru.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},ru.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var as=function(o){return o.zoom||o.drag||o.pitch||o.rotate},Mu=function(c){function o(){c.apply(this,arguments)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o}(p.Event);function Bn(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}var On=function(o,i){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vl(o),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i),p.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[p.window,"blur",void 0]];for(var g=0,E=this._listeners;g<E.length;g+=1){var C=E[g],L=C[0];S.addEventListener(L,C[1],L===p.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};On.prototype.destroy=function(){for(var c=0,o=this._listeners;c<o.length;c+=1){var i=o[c],h=i[0];S.removeEventListener(h,i[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,i[2])}},On.prototype._addDefaultHandlers=function(c){var o=this._map,i=o.getCanvasContainer();this._add("mapEvent",new so(o,c));var h=o.boxZoom=new Ns(o,c);this._add("boxZoom",h);var g=new Zs,E=new Xo;o.doubleClickZoom=new Pu(E,g),this._add("tapZoom",g),this._add("clickZoom",E);var C=new Io;this._add("tapDragZoom",C);var L=o.touchPitch=new Kc;this._add("touchPitch",L);var Z=new yc(c),ne=new Vu(c);o.dragRotate=new Gu(c,Z,ne),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",ne,["mouseRotate"]);var me=new Xc(c),ye=new tu(c);o.dragPan=new _l(i,me,ye),this._add("mousePan",me),this._add("touchPan",ye,["touchZoom","touchRotate"]);var Se=new il,Ye=new Wo;o.touchZoomRotate=new ru(i,Ye,Se,C),this._add("touchRotate",Se,["touchPan","touchZoom"]),this._add("touchZoom",Ye,["touchPan","touchRotate"]);var Xe=o.scrollZoom=new Oi(o,this);this._add("scrollZoom",Xe,["mousePan"]);var ct=o.keyboard=new ws;this._add("keyboard",ct),this._add("blockableMapEvent",new Tn(o));for(var $e=0,tt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];$e<tt.length;$e+=1){var It=tt[$e];c.interactive&&c[It]&&o[It].enable(c[It])}},On.prototype._add=function(c,o,i){this._handlers.push({handlerName:c,handler:o,allowed:i}),this._handlersById[c]=o},On.prototype.stop=function(c){if(!this._updatingCamera){for(var o=0,i=this._handlers;o<i.length;o+=1)i[o].handler.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}},On.prototype.isActive=function(){for(var c=0,o=this._handlers;c<o.length;c+=1)if(o[c].handler.isActive())return!0;return!1},On.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},On.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},On.prototype.isMoving=function(){return Boolean(as(this._eventsInProgress))||this.isZooming()},On.prototype._blockedByActive=function(c,o,i){for(var h in c)if(h!==i&&(!o||o.indexOf(h)<0))return!0;return!1},On.prototype.handleWindowEvent=function(c){this.handleEvent(c,c.type+"Window")},On.prototype._getMapTouches=function(c){for(var o=[],i=0,h=c;i<h.length;i+=1){var g=h[i];this._el.contains(g.target)&&o.push(g)}return o},On.prototype.handleEvent=function(c,o){if(c.type!=="blur"){this._updatingCamera=!0;for(var i=c.type==="renderFrame"?void 0:c,h={needsRenderFrame:!1},g={},E={},C=c.touches?this._getMapTouches(c.touches):void 0,L=C?S.touchPos(this._el,C):S.mousePos(this._el,c),Z=0,ne=this._handlers;Z<ne.length;Z+=1){var me=ne[Z],ye=me.handlerName,Se=me.handler,Ye=me.allowed;if(Se.isEnabled()){var Xe=void 0;this._blockedByActive(E,Ye,ye)?Se.reset():Se[o||c.type]&&(Xe=Se[o||c.type](c,L,C),this.mergeHandlerResult(h,g,Xe,ye,i),Xe&&Xe.needsRenderFrame&&this._triggerRenderFrame()),(Xe||Se.isActive())&&(E[ye]=Se)}}var ct={};for(var $e in this._previousActiveHandlers)E[$e]||(ct[$e]=i);this._previousActiveHandlers=E,(Object.keys(ct).length||Bn(h))&&(this._changes.push([h,g,ct]),this._triggerRenderFrame()),(Object.keys(E).length||Bn(h))&&this._map._stop(!0),this._updatingCamera=!1;var tt=h.cameraAnimation;tt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],tt(this._map))}else this.stop(!0)},On.prototype.mergeHandlerResult=function(c,o,i,h,g){if(i){p.extend(c,i);var E={handlerName:h,originalEvent:i.originalEvent||g};i.zoomDelta!==void 0&&(o.zoom=E),i.panDelta!==void 0&&(o.drag=E),i.pitchDelta!==void 0&&(o.pitch=E),i.bearingDelta!==void 0&&(o.rotate=E)}},On.prototype._applyChanges=function(){for(var c={},o={},i={},h=0,g=this._changes;h<g.length;h+=1){var E=g[h],C=E[0],L=E[1],Z=E[2];C.panDelta&&(c.panDelta=(c.panDelta||new p.Point(0,0))._add(C.panDelta)),C.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+C.zoomDelta),C.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+C.bearingDelta),C.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+C.pitchDelta),C.around!==void 0&&(c.around=C.around),C.pinchAround!==void 0&&(c.pinchAround=C.pinchAround),C.noInertia&&(c.noInertia=C.noInertia),p.extend(o,L),p.extend(i,Z)}this._updateMapTransform(c,o,i),this._changes=[]},On.prototype._updateMapTransform=function(c,o,i){var h=this._map,g=h.transform;if(!Bn(c))return this._fireEvents(o,i,!0);var E=c.panDelta,C=c.zoomDelta,L=c.bearingDelta,Z=c.pitchDelta,ne=c.around,me=c.pinchAround;me!==void 0&&(ne=me),h._stop(!0),ne=ne||h.transform.centerPoint;var ye=g.pointLocation(E?ne.sub(E):ne);L&&(g.bearing+=L),Z&&(g.pitch+=Z),C&&(g.zoom+=C),g.setLocationAtPoint(ye,ne),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(o,i,!0)},On.prototype._fireEvents=function(c,o,i){var h=this,g=as(this._eventsInProgress),E=as(c),C={};for(var L in c)this._eventsInProgress[L]||(C[L+"start"]=c[L].originalEvent),this._eventsInProgress[L]=c[L];for(var Z in!g&&E&&this._fireEvent("movestart",E.originalEvent),C)this._fireEvent(Z,C[Z]);for(var ne in E&&this._fireEvent("move",E.originalEvent),c)this._fireEvent(ne,c[ne].originalEvent);var me,ye={};for(var Se in this._eventsInProgress){var Ye=this._eventsInProgress[Se],Xe=Ye.handlerName,ct=Ye.originalEvent;this._handlersById[Xe].isActive()||(delete this._eventsInProgress[Se],ye[Se+"end"]=me=o[Xe]||ct)}for(var $e in ye)this._fireEvent($e,ye[$e]);var tt=as(this._eventsInProgress);if(i&&(g||E)&&!tt){this._updatingCamera=!0;var It=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Mt=function(nr){return nr!==0&&-h._bearingSnap<nr&&nr<h._bearingSnap};It?(Mt(It.bearing||this._map.getBearing())&&(It.bearing=0),this._map.easeTo(It,{originalEvent:me})):(this._map.fire(new p.Event("moveend",{originalEvent:me})),Mt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},On.prototype._fireEvent=function(c,o){this._map.fire(new p.Event(c,o?{originalEvent:o}:{}))},On.prototype._requestFrame=function(){var c=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(o){delete c._frameId,c.handleEvent(new Mu("renderFrame",{timeStamp:o})),c._applyChanges()})},On.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var xc=function(c){function o(i,h){c.call(this),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},o.prototype.setCenter=function(i,h){return this.jumpTo({center:i},h)},o.prototype.panBy=function(i,h,g){return i=p.Point.convert(i).mult(-1),this.panTo(this.transform.center,p.extend({offset:i},h),g)},o.prototype.panTo=function(i,h,g){return this.easeTo(p.extend({center:i},h),g)},o.prototype.getZoom=function(){return this.transform.zoom},o.prototype.setZoom=function(i,h){return this.jumpTo({zoom:i},h),this},o.prototype.zoomTo=function(i,h,g){return this.easeTo(p.extend({zoom:i},h),g)},o.prototype.zoomIn=function(i,h){return this.zoomTo(this.getZoom()+1,i,h),this},o.prototype.zoomOut=function(i,h){return this.zoomTo(this.getZoom()-1,i,h),this},o.prototype.getBearing=function(){return this.transform.bearing},o.prototype.setBearing=function(i,h){return this.jumpTo({bearing:i},h),this},o.prototype.getPadding=function(){return this.transform.padding},o.prototype.setPadding=function(i,h){return this.jumpTo({padding:i},h),this},o.prototype.rotateTo=function(i,h,g){return this.easeTo(p.extend({bearing:i},h),g)},o.prototype.resetNorth=function(i,h){return this.rotateTo(0,p.extend({duration:1e3},i),h),this},o.prototype.resetNorthPitch=function(i,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},i),h),this},o.prototype.snapToNorth=function(i,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,h):this},o.prototype.getPitch=function(){return this.transform.pitch},o.prototype.setPitch=function(i,h){return this.jumpTo({pitch:i},h),this},o.prototype.cameraForBounds=function(i,h){i=p.LngLatBounds.convert(i);var g=h&&h.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),g,h)},o.prototype._cameraForBoxAndBearing=function(i,h,g,E){var C={top:0,bottom:0,right:0,left:0};if(typeof(E=p.extend({padding:C,offset:[0,0],maxZoom:this.transform.maxZoom},E)).padding=="number"){var L=E.padding;E.padding={top:L,bottom:L,right:L,left:L}}E.padding=p.extend(C,E.padding);var Z=this.transform,ne=Z.padding,me=Z.project(p.LngLat.convert(i)),ye=Z.project(p.LngLat.convert(h)),Se=me.rotate(-g*Math.PI/180),Ye=ye.rotate(-g*Math.PI/180),Xe=new p.Point(Math.max(Se.x,Ye.x),Math.max(Se.y,Ye.y)),ct=new p.Point(Math.min(Se.x,Ye.x),Math.min(Se.y,Ye.y)),$e=Xe.sub(ct),tt=(Z.width-(ne.left+ne.right+E.padding.left+E.padding.right))/$e.x,It=(Z.height-(ne.top+ne.bottom+E.padding.top+E.padding.bottom))/$e.y;if(!(It<0||tt<0)){var Mt=Math.min(Z.scaleZoom(Z.scale*Math.min(tt,It)),E.maxZoom),Sr=typeof E.offset.x=="number"?new p.Point(E.offset.x,E.offset.y):p.Point.convert(E.offset),nr=new p.Point((E.padding.left-E.padding.right)/2,(E.padding.top-E.padding.bottom)/2).rotate(g*Math.PI/180),xr=Sr.add(nr).mult(Z.scale/Z.zoomScale(Mt));return{center:Z.unproject(me.add(ye).div(2).sub(xr)),zoom:Mt,bearing:g}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},o.prototype.fitBounds=function(i,h,g){return this._fitInternal(this.cameraForBounds(i,h),h,g)},o.prototype.fitScreenCoordinates=function(i,h,g,E,C){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(i)),this.transform.pointLocation(p.Point.convert(h)),g,E),E,C)},o.prototype._fitInternal=function(i,h,g){return i?(delete(h=p.extend(i,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this},o.prototype.jumpTo=function(i,h){this.stop();var g=this.transform,E=!1,C=!1,L=!1;return"zoom"in i&&g.zoom!==+i.zoom&&(E=!0,g.zoom=+i.zoom),i.center!==void 0&&(g.center=p.LngLat.convert(i.center)),"bearing"in i&&g.bearing!==+i.bearing&&(C=!0,g.bearing=+i.bearing),"pitch"in i&&g.pitch!==+i.pitch&&(L=!0,g.pitch=+i.pitch),i.padding==null||g.isPaddingEqual(i.padding)||(g.padding=i.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),E&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),C&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),L&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},o.prototype.easeTo=function(i,h){var g=this;this._stop(!1,i.easeId),((i=p.extend({offset:[0,0],duration:500,easing:p.ease},i)).animate===!1||!i.essential&&p.browser.prefersReducedMotion)&&(i.duration=0);var E=this.transform,C=this.getZoom(),L=this.getBearing(),Z=this.getPitch(),ne=this.getPadding(),me="zoom"in i?+i.zoom:C,ye="bearing"in i?this._normalizeBearing(i.bearing,L):L,Se="pitch"in i?+i.pitch:Z,Ye="padding"in i?i.padding:E.padding,Xe=p.Point.convert(i.offset),ct=E.centerPoint.add(Xe),$e=E.pointLocation(ct),tt=p.LngLat.convert(i.center||$e);this._normalizeCenter(tt);var It,Mt,Sr=E.project($e),nr=E.project(tt).sub(Sr),xr=E.zoomScale(me-C);i.around&&(It=p.LngLat.convert(i.around),Mt=E.locationPoint(It));var Cr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||me!==C,this._rotating=this._rotating||L!==ye,this._pitching=this._pitching||Se!==Z,this._padding=!E.isPaddingEqual(Ye),this._easeId=i.easeId,this._prepareEase(h,i.noMoveStart,Cr),this._ease(function(an){if(g._zooming&&(E.zoom=p.number(C,me,an)),g._rotating&&(E.bearing=p.number(L,ye,an)),g._pitching&&(E.pitch=p.number(Z,Se,an)),g._padding&&(E.interpolatePadding(ne,Ye,an),ct=E.centerPoint.add(Xe)),It)E.setLocationAtPoint(It,Mt);else{var Xr=E.zoomScale(E.zoom-C),vn=me>C?Math.min(2,xr):Math.max(.5,xr),An=Math.pow(vn,1-an),Xn=E.unproject(Sr.add(nr.mult(an*An)).mult(Xr));E.setLocationAtPoint(E.renderWorldCopies?Xn.wrap():Xn,ct)}g._fireMoveEvents(h)},function(an){g._afterEase(h,an)},i),this},o.prototype._prepareEase=function(i,h,g){g===void 0&&(g={}),this._moving=!0,h||g.moving||this.fire(new p.Event("movestart",i)),this._zooming&&!g.zooming&&this.fire(new p.Event("zoomstart",i)),this._rotating&&!g.rotating&&this.fire(new p.Event("rotatestart",i)),this._pitching&&!g.pitching&&this.fire(new p.Event("pitchstart",i))},o.prototype._fireMoveEvents=function(i){this.fire(new p.Event("move",i)),this._zooming&&this.fire(new p.Event("zoom",i)),this._rotating&&this.fire(new p.Event("rotate",i)),this._pitching&&this.fire(new p.Event("pitch",i))},o.prototype._afterEase=function(i,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var g=this._zooming,E=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new p.Event("zoomend",i)),E&&this.fire(new p.Event("rotateend",i)),C&&this.fire(new p.Event("pitchend",i)),this.fire(new p.Event("moveend",i))}},o.prototype.flyTo=function(i,h){var g=this;if(!i.essential&&p.browser.prefersReducedMotion){var E=p.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(E,h)}this.stop(),i=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},i);var C=this.transform,L=this.getZoom(),Z=this.getBearing(),ne=this.getPitch(),me=this.getPadding(),ye="zoom"in i?p.clamp(+i.zoom,C.minZoom,C.maxZoom):L,Se="bearing"in i?this._normalizeBearing(i.bearing,Z):Z,Ye="pitch"in i?+i.pitch:ne,Xe="padding"in i?i.padding:C.padding,ct=C.zoomScale(ye-L),$e=p.Point.convert(i.offset),tt=C.centerPoint.add($e),It=C.pointLocation(tt),Mt=p.LngLat.convert(i.center||It);this._normalizeCenter(Mt);var Sr=C.project(It),nr=C.project(Mt).sub(Sr),xr=i.curve,Cr=Math.max(C.width,C.height),an=Cr/ct,Xr=nr.mag();if("minZoom"in i){var vn=p.clamp(Math.min(i.minZoom,L,ye),C.minZoom,C.maxZoom),An=Cr/C.zoomScale(vn-L);xr=Math.sqrt(An/Xr*2)}var Xn=xr*xr;function Qn(Kn){var Si=(an*an-Cr*Cr+(Kn?-1:1)*Xn*Xn*Xr*Xr)/(2*(Kn?an:Cr)*Xn*Xr);return Math.log(Math.sqrt(Si*Si+1)-Si)}function Ci(Kn){return(Math.exp(Kn)-Math.exp(-Kn))/2}function Ji(Kn){return(Math.exp(Kn)+Math.exp(-Kn))/2}var Sn=Qn(0),fi=function(Si){return Ji(Sn)/Ji(Sn+xr*Si)},gi=function(Si){return Cr*((Ji(Sn)*(Ci(Gi=Sn+xr*Si)/Ji(Gi))-Ci(Sn))/Xn)/Xr;var Gi},Un=(Qn(1)-Sn)/xr;if(Math.abs(Xr)<1e-6||!isFinite(Un)){if(Math.abs(Cr-an)<1e-6)return this.easeTo(i,h);var di=an<Cr?-1:1;Un=Math.abs(Math.log(an/Cr))/xr,gi=function(){return 0},fi=function(Si){return Math.exp(di*xr*Si)}}return i.duration="duration"in i?+i.duration:1e3*Un/("screenSpeed"in i?+i.screenSpeed/xr:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=Z!==Se,this._pitching=Ye!==ne,this._padding=!C.isPaddingEqual(Xe),this._prepareEase(h,!1),this._ease(function(Kn){var Si=Kn*Un,Gi=1/fi(Si);C.zoom=Kn===1?ye:L+C.scaleZoom(Gi),g._rotating&&(C.bearing=p.number(Z,Se,Kn)),g._pitching&&(C.pitch=p.number(ne,Ye,Kn)),g._padding&&(C.interpolatePadding(me,Xe,Kn),tt=C.centerPoint.add($e));var yo=Kn===1?Mt:C.unproject(Sr.add(nr.mult(gi(Si))).mult(Gi));C.setLocationAtPoint(C.renderWorldCopies?yo.wrap():yo,tt),g._fireMoveEvents(h)},function(){return g._afterEase(h)},i),this},o.prototype.isEasing=function(){return!!this._easeFrameId},o.prototype.stop=function(){return this._stop()},o.prototype._stop=function(i,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,h)}if(!i){var E=this.handlers;E&&E.stop(!1)}return this},o.prototype._ease=function(i,h,g){g.animate===!1||g.duration===0?(i(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=g,this._onEaseFrame=i,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},o.prototype._renderFrameCallback=function(){var i=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},o.prototype._normalizeBearing=function(i,h){i=p.wrap(i,-180,180);var g=Math.abs(i-h);return Math.abs(i-360-h)<g&&(i-=360),Math.abs(i+360-h)<g&&(i+=360),i},o.prototype._normalizeCenter=function(i){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var g=i.lng-h.center.lng;i.lng+=g>180?-360:g<-180?360:0}},o}(p.Evented),os=function(o){o===void 0&&(o={}),this.options=o,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};os.prototype.getDefaultPosition=function(){return"bottom-right"},os.prototype.onAdd=function(c){var o=this.options&&this.options.compact;return this._map=c,this._container=S.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=S.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=S.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},os.prototype.onRemove=function(){S.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},os.prototype._setElementTitle=function(c,o){var i=this._map._getUIString("AttributionControl."+o);c.title=i,c.setAttribute("aria-label",i)},os.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},os.prototype._updateEditLink=function(){var c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));var o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(c){var i=o.reduce(function(h,g,E){return g.value&&(h+=g.key+"="+g.value+(E<o.length-1?"&":"")),h},"?");c.href=p.config.FEEDBACK_URL+"/"+i+(this._map._hash?this._map._hash.getHashString(!0):""),c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}},os.prototype._updateData=function(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},os.prototype._updateAttributions=function(){if(this._map.style){var c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){var o=this._map.style.stylesheet;this.styleOwner=o.owner,this.styleId=o.id}var i=this._map.style.sourceCaches;for(var h in i){var g=i[h];if(g.used){var E=g.getSource();E.attribution&&c.indexOf(E.attribution)<0&&c.push(E.attribution)}}c.sort(function(L,Z){return L.length-Z.length});var C=(c=c.filter(function(L,Z){for(var ne=Z+1;ne<c.length;ne++)if(c[ne].indexOf(L)>=0)return!1;return!0})).join(" | ");C!==this._attribHTML&&(this._attribHTML=C,c.length?(this._innerContainer.innerHTML=C,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},os.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var bo=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};bo.prototype.onAdd=function(c){this._map=c,this._container=S.create("div","mapboxgl-ctrl");var o=S.create("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},bo.prototype.onRemove=function(){S.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},bo.prototype.getDefaultPosition=function(){return"bottom-left"},bo.prototype._updateLogo=function(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},bo.prototype._logoRequired=function(){if(this._map.style){var c=this._map.style.sourceCaches;for(var o in c)if(c[o].getSource().mapbox_logo)return!0;return!1}},bo.prototype._updateCompact=function(){var c=this._container.children;if(c.length){var o=c[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}};var Fo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Fo.prototype.add=function(c){var o=++this._id;return this._queue.push({callback:c,id:o,cancelled:!1}),o},Fo.prototype.remove=function(c){for(var o=this._currentlyRunning,i=0,h=o?this._queue.concat(o):this._queue;i<h.length;i+=1){var g=h[i];if(g.id===c)return void(g.cancelled=!0)}},Fo.prototype.run=function(c){c===void 0&&(c=0);var o=this._currentlyRunning=this._queue;this._queue=[];for(var i=0,h=o;i<h.length;i+=1){var g=h[i];if(!g.cancelled&&(g.callback(c),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Fo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Vs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Gs=p.window.HTMLImageElement,Gl=p.window.HTMLElement,$i=p.window.ImageBitmap,So={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},ff=function(c){function o(h){var g=this;if((h=p.extend({},So,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var E=new zi(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(c.call(this,E,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Fo,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},Vs,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof Gl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return g._update(!1)}),this.on("moveend",function(){return g._update(!1)}),this.on("zoom",function(){return g._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new On(this,h),this._hash=h.hash&&new Ma(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new os({customAttribution:h.customAttribution})),this.addControl(new bo,h.logoPosition),this.on("style.load",function(){g.transform.unmodified&&g.jumpTo(g.style.stylesheet)}),this.on("data",function(C){g._update(C.dataType==="style"),g.fire(new p.Event(C.dataType+"data",C))}),this.on("dataloading",function(C){g.fire(new p.Event(C.dataType+"dataloading",C))})}c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o;var i={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return o.prototype._getMapId=function(){return this._mapId},o.prototype.addControl=function(h,g){if(g===void 0&&(g=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var E=h.onAdd(this);this._controls.push(h);var C=this._controlPositions[g];return g.indexOf("bottom")!==-1?C.insertBefore(E,C.firstChild):C.appendChild(E),this},o.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var g=this._controls.indexOf(h);return g>-1&&this._controls.splice(g,1),h.onRemove(this),this},o.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},o.prototype.resize=function(h){var g=this._containerDimensions(),E=g[0],C=g[1];this._resizeCanvas(E,C),this.transform.resize(E,C),this.painter.resize(E,C);var L=!this._moving;return L&&(this.stop(),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h))),this.fire(new p.Event("resize",h)),L&&this.fire(new p.Event("moveend",h)),this},o.prototype.getBounds=function(){return this.transform.getBounds()},o.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},o.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},o.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},o.prototype.getMinZoom=function(){return this.transform.minZoom},o.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},o.prototype.getMaxZoom=function(){return this.transform.maxZoom},o.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},o.prototype.getMinPitch=function(){return this.transform.minPitch},o.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},o.prototype.getMaxPitch=function(){return this.transform.maxPitch},o.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},o.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},o.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},o.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},o.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},o.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},o.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},o.prototype._createDelegatedListener=function(h,g,E){var C,L=this;if(h==="mouseenter"||h==="mouseover"){var Z=!1;return{layer:g,listener:E,delegates:{mousemove:function(ye){var Se=L.getLayer(g)?L.queryRenderedFeatures(ye.point,{layers:[g]}):[];Se.length?Z||(Z=!0,E.call(L,new Qa(h,L,ye.originalEvent,{features:Se}))):Z=!1},mouseout:function(){Z=!1}}}}if(h==="mouseleave"||h==="mouseout"){var ne=!1;return{layer:g,listener:E,delegates:{mousemove:function(ye){(L.getLayer(g)?L.queryRenderedFeatures(ye.point,{layers:[g]}):[]).length?ne=!0:ne&&(ne=!1,E.call(L,new Qa(h,L,ye.originalEvent)))},mouseout:function(ye){ne&&(ne=!1,E.call(L,new Qa(h,L,ye.originalEvent)))}}}}return{layer:g,listener:E,delegates:(C={},C[h]=function(me){var ye=L.getLayer(g)?L.queryRenderedFeatures(me.point,{layers:[g]}):[];ye.length&&(me.features=ye,E.call(L,me),delete me.features)},C)}},o.prototype.on=function(h,g,E){if(E===void 0)return c.prototype.on.call(this,h,g);var C=this._createDelegatedListener(h,g,E);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(C),C.delegates)this.on(L,C.delegates[L]);return this},o.prototype.once=function(h,g,E){if(E===void 0)return c.prototype.once.call(this,h,g);var C=this._createDelegatedListener(h,g,E);for(var L in C.delegates)this.once(L,C.delegates[L]);return this},o.prototype.off=function(h,g,E){var C=this;return E===void 0?c.prototype.off.call(this,h,g):(this._delegatedListeners&&this._delegatedListeners[h]&&function(L){for(var Z=L[h],ne=0;ne<Z.length;ne++){var me=Z[ne];if(me.layer===g&&me.listener===E){for(var ye in me.delegates)C.off(ye,me.delegates[ye]);return Z.splice(ne,1),C}}}(this._delegatedListeners),this)},o.prototype.queryRenderedFeatures=function(h,g){if(!this.style)return[];var E;if(g!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(g=h,h=void 0),g=g||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")E=[p.Point.convert(h)];else{var C=p.Point.convert(h[0]),L=p.Point.convert(h[1]);E=[C,new p.Point(L.x,C.y),L,new p.Point(C.x,L.y),C]}return this.style.queryRenderedFeatures(E,g,this.transform)},o.prototype.querySourceFeatures=function(h,g){return this.style.querySourceFeatures(h,g)},o.prototype.setStyle=function(h,g){return(g=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(h,g))},o.prototype._getUIString=function(h){var g=this._locale[h];if(g==null)throw new Error("Missing UI string '"+h+"'");return g},o.prototype._updateStyle=function(h,g){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new Ja(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},o.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ja(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},o.prototype._diffStyle=function(h,g){var E=this;if(typeof h=="string"){var C=this._requestManager.normalizeStyleURL(h),L=this._requestManager.transformRequest(C,p.ResourceType.Style);p.getJSON(L,function(Z,ne){Z?E.fire(new p.ErrorEvent(Z)):ne&&E._updateDiff(ne,g)})}else typeof h=="object"&&this._updateDiff(h,g)},o.prototype._updateDiff=function(h,g){try{this.style.setState(h)&&this._update(!0)}catch(E){p.warnOnce("Unable to perform style diff: "+(E.message||E.error||E)+".  Rebuilding the style from scratch."),this._updateStyle(h,g)}},o.prototype.getStyle=function(){if(this.style)return this.style.serialize()},o.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},o.prototype.addSource=function(h,g){return this._lazyInitEmptyStyle(),this.style.addSource(h,g),this._update(!0)},o.prototype.isSourceLoaded=function(h){var g=this.style&&this.style.sourceCaches[h];if(g!==void 0)return g.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},o.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var g in h){var E=h[g]._tiles;for(var C in E){var L=E[C];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},o.prototype.addSourceType=function(h,g,E){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,g,E)},o.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},o.prototype.getSource=function(h){return this.style.getSource(h)},o.prototype.addImage=function(h,g,E){E===void 0&&(E={});var C=E.pixelRatio;C===void 0&&(C=1);var L=E.sdf;L===void 0&&(L=!1);var Z=E.stretchX,ne=E.stretchY,me=E.content;if(this._lazyInitEmptyStyle(),g instanceof Gs||$i&&g instanceof $i){var ye=p.browser.getImageData(g);this.style.addImage(h,{data:new p.RGBAImage({width:ye.width,height:ye.height},ye.data),pixelRatio:C,stretchX:Z,stretchY:ne,content:me,sdf:L,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Se=g;this.style.addImage(h,{data:new p.RGBAImage({width:g.width,height:g.height},new Uint8Array(g.data)),pixelRatio:C,stretchX:Z,stretchY:ne,content:me,sdf:L,version:0,userImage:Se}),Se.onAdd&&Se.onAdd(this,h)}},o.prototype.updateImage=function(h,g){var E=this.style.getImage(h);if(!E)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var C=g instanceof Gs||$i&&g instanceof $i?p.browser.getImageData(g):g,L=C.width,Z=C.height,ne=C.data;return L===void 0||Z===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==E.data.width||Z!==E.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(E.data.replace(ne,!(g instanceof Gs||$i&&g instanceof $i)),void this.style.updateImage(h,E))},o.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},o.prototype.removeImage=function(h){this.style.removeImage(h)},o.prototype.loadImage=function(h,g){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),g)},o.prototype.listImages=function(){return this.style.listImages()},o.prototype.addLayer=function(h,g){return this._lazyInitEmptyStyle(),this.style.addLayer(h,g),this._update(!0)},o.prototype.moveLayer=function(h,g){return this.style.moveLayer(h,g),this._update(!0)},o.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},o.prototype.getLayer=function(h){return this.style.getLayer(h)},o.prototype.setLayerZoomRange=function(h,g,E){return this.style.setLayerZoomRange(h,g,E),this._update(!0)},o.prototype.setFilter=function(h,g,E){return E===void 0&&(E={}),this.style.setFilter(h,g,E),this._update(!0)},o.prototype.getFilter=function(h){return this.style.getFilter(h)},o.prototype.setPaintProperty=function(h,g,E,C){return C===void 0&&(C={}),this.style.setPaintProperty(h,g,E,C),this._update(!0)},o.prototype.getPaintProperty=function(h,g){return this.style.getPaintProperty(h,g)},o.prototype.setLayoutProperty=function(h,g,E,C){return C===void 0&&(C={}),this.style.setLayoutProperty(h,g,E,C),this._update(!0)},o.prototype.getLayoutProperty=function(h,g){return this.style.getLayoutProperty(h,g)},o.prototype.setLight=function(h,g){return g===void 0&&(g={}),this._lazyInitEmptyStyle(),this.style.setLight(h,g),this._update(!0)},o.prototype.getLight=function(){return this.style.getLight()},o.prototype.setFeatureState=function(h,g){return this.style.setFeatureState(h,g),this._update()},o.prototype.removeFeatureState=function(h,g){return this.style.removeFeatureState(h,g),this._update()},o.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},o.prototype.getContainer=function(){return this._container},o.prototype.getCanvasContainer=function(){return this._canvasContainer},o.prototype.getCanvas=function(){return this._canvas},o.prototype._containerDimensions=function(){var h=0,g=0;return this._container&&(h=this._container.clientWidth||400,g=this._container.clientHeight||300),[h,g]},o.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},o.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=S.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var g=this._canvasContainer=S.create("div","mapboxgl-canvas-container",h);this._interactive&&g.classList.add("mapboxgl-interactive"),this._canvas=S.create("canvas","mapboxgl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var E=this._containerDimensions();this._resizeCanvas(E[0],E[1]);var C=this._controlContainer=S.create("div","mapboxgl-control-container",h),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Z){L[Z]=S.create("div","mapboxgl-ctrl-"+Z,C)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},o.prototype._resizeCanvas=function(h,g){var E=p.browser.devicePixelRatio||1;this._canvas.width=E*h,this._canvas.height=E*g,this._canvas.style.width=h+"px",this._canvas.style.height=g+"px"},o.prototype._setupPainter=function(){var h=p.extend({},G.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),g=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);g?(this.painter=new Ia(g,this.transform),p.webpSupported.testSupport(g)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},o.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},o.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},o.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},o.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},o.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},o.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},o.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},o.prototype._render=function(h){var g,E=this,C=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,g),C=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var Z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ne=this.transform.zoom,me=p.browser.now();this.style.zoomHistory.update(ne,me);var ye=new p.EvaluationParameters(ne,{now:me,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Se=ye.crossFadingFactor();Se===1&&Se===this._crossFadingFactor||(Z=!0,this._crossFadingFactor=Se),this.style.update(ye)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||Z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ye=p.browser.now()-C;L.endQueryEXT(L.TIME_ELAPSED_EXT,g),setTimeout(function(){var $e=L.getQueryObjectEXT(g,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(g),E.fire(new p.Event("gpu-timing-frame",{cpuTime:Ye,gpuTime:$e}))},50)}if(this.listens("gpu-timing-layer")){var Xe=this.painter.collectGpuTimers();setTimeout(function(){var $e=E.painter.queryGpuTimers(Xe);E.fire(new p.Event("gpu-timing-layer",{layerTimes:$e}))},50)}var ct=this._sourcesDirty||this._styleDirty||this._placementDirty;return ct||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||ct||(this._fullyLoaded=!0),this}},o.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,g=this._controls;h<g.length;h+=1)g[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var E=this.painter.context.gl.getExtension("WEBGL_lose_context");E&&E.loseContext(),xl(this._canvasContainer),xl(this._controlContainer),xl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},o.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(g){h._frame=null,h._render(g)}))},o.prototype._onWindowOnline=function(){this._update()},o.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},i.showTileBoundaries.get=function(){return!!this._showTileBoundaries},i.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},i.showPadding.get=function(){return!!this._showPadding},i.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},i.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},i.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},i.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},i.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},i.repaint.get=function(){return!!this._repaint},i.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},i.vertices.get=function(){return!!this._vertices},i.vertices.set=function(h){this._vertices=h,this._update()},o.prototype._setCacheLimits=function(h,g){p.setCacheLimits(h,g)},i.version.get=function(){return p.version},Object.defineProperties(o.prototype,i),o}(xc);function xl(c){c.parentNode&&c.parentNode.removeChild(c)}var bc={showCompass:!0,showZoom:!0,visualizePitch:!1},Iu=function(o){var i=this;this.options=p.extend({},bc,o),this._container=S.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return i._map.zoomIn({},{originalEvent:h})}),S.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return i._map.zoomOut({},{originalEvent:h})}),S.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){i.options.visualizePitch?i._map.resetNorthPitch({},{originalEvent:h}):i._map.resetNorth({},{originalEvent:h})}),this._compassIcon=S.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Iu.prototype._updateZoomButtons=function(){var c=this._map.getZoom(),o=c===this._map.getMaxZoom(),i=c===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())},Iu.prototype._rotateCompassArrow=function(){var c=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=c},Iu.prototype.onAdd=function(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new As(this._map,this._compass,this.options.visualizePitch)),this._container},Iu.prototype.onRemove=function(){S.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Iu.prototype._createButton=function(c,o){var i=S.create("button",c,this._container);return i.type="button",i.addEventListener("click",o),i},Iu.prototype._setButtonTitle=function(c,o){var i=this._map._getUIString("NavigationControl."+o);c.title=i,c.setAttribute("aria-label",i)};var As=function(o,i,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=i,this.mouseRotate=new yc({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,h&&(this.mousePitch=new Vu({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),S.addEventListener(i,"mousedown",this.mousedown),S.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),S.addEventListener(i,"touchmove",this.touchmove),S.addEventListener(i,"touchend",this.touchend),S.addEventListener(i,"touchcancel",this.reset)};function bl(c,o,i){if(c=new p.LngLat(c.lng,c.lat),o){var h=new p.LngLat(c.lng-360,c.lat),g=new p.LngLat(c.lng+360,c.lat),E=i.locationPoint(c).distSqr(o);i.locationPoint(h).distSqr(o)<E?c=h:i.locationPoint(g).distSqr(o)<E&&(c=g)}for(;Math.abs(c.lng-i.center.lng)>180;){var C=i.locationPoint(c);if(C.x>=0&&C.y>=0&&C.x<=i.width&&C.y<=i.height)break;c.lng>i.center.lng?c.lng-=360:c.lng+=360}return c}As.prototype.down=function(c,o){this.mouseRotate.mousedown(c,o),this.mousePitch&&this.mousePitch.mousedown(c,o),S.disableDrag()},As.prototype.move=function(c,o){var i=this.map,h=this.mouseRotate.mousemoveWindow(c,o);if(h&&h.bearingDelta&&i.setBearing(i.getBearing()+h.bearingDelta),this.mousePitch){var g=this.mousePitch.mousemoveWindow(c,o);g&&g.pitchDelta&&i.setPitch(i.getPitch()+g.pitchDelta)}},As.prototype.off=function(){var c=this.element;S.removeEventListener(c,"mousedown",this.mousedown),S.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),S.removeEventListener(c,"touchmove",this.touchmove),S.removeEventListener(c,"touchend",this.touchend),S.removeEventListener(c,"touchcancel",this.reset),this.offTemp()},As.prototype.offTemp=function(){S.enableDrag(),S.removeEventListener(p.window,"mousemove",this.mousemove),S.removeEventListener(p.window,"mouseup",this.mouseup)},As.prototype.mousedown=function(c){this.down(p.extend({},c,{ctrlKey:!0,preventDefault:function(){return c.preventDefault()}}),S.mousePos(this.element,c)),S.addEventListener(p.window,"mousemove",this.mousemove),S.addEventListener(p.window,"mouseup",this.mouseup)},As.prototype.mousemove=function(c){this.move(c,S.mousePos(this.element,c))},As.prototype.mouseup=function(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()},As.prototype.touchstart=function(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=S.touchPos(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return c.preventDefault()}},this._startPos))},As.prototype.touchmove=function(c){c.targetTouches.length!==1?this.reset():(this._lastPos=S.touchPos(this.element,c.targetTouches)[0],this.move({preventDefault:function(){return c.preventDefault()}},this._lastPos))},As.prototype.touchend=function(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},As.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ou={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Sc(c,o,i){var h=c.classList;for(var g in Ou)h.remove("mapboxgl-"+i+"-anchor-"+g);h.add("mapboxgl-"+i+"-anchor-"+o)}var ic,Ec=function(c){function o(i,h){if(c.call(this),(i instanceof p.window.HTMLElement||h)&&(i=p.extend({element:i},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=p.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=S.create("div"),this._element.setAttribute("aria-label","Map marker");var g=S.createNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","41px"),g.setAttributeNS(null,"width","27px"),g.setAttributeNS(null,"viewBox","0 0 27 41");var E=S.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");var C=S.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");var L=S.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var Z=0,ne=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Z<ne.length;Z+=1){var me=ne[Z],ye=S.createNS("http://www.w3.org/2000/svg","ellipse");ye.setAttributeNS(null,"opacity","0.04"),ye.setAttributeNS(null,"cx","10.5"),ye.setAttributeNS(null,"cy","5.80029008"),ye.setAttributeNS(null,"rx",me.rx),ye.setAttributeNS(null,"ry",me.ry),L.appendChild(ye)}var Se=S.createNS("http://www.w3.org/2000/svg","g");Se.setAttributeNS(null,"fill",this._color);var Ye=S.createNS("http://www.w3.org/2000/svg","path");Ye.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Se.appendChild(Ye);var Xe=S.createNS("http://www.w3.org/2000/svg","g");Xe.setAttributeNS(null,"opacity","0.25"),Xe.setAttributeNS(null,"fill","#000000");var ct=S.createNS("http://www.w3.org/2000/svg","path");ct.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Xe.appendChild(ct);var $e=S.createNS("http://www.w3.org/2000/svg","g");$e.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$e.setAttributeNS(null,"fill","#FFFFFF");var tt=S.createNS("http://www.w3.org/2000/svg","g");tt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var It=S.createNS("http://www.w3.org/2000/svg","circle");It.setAttributeNS(null,"fill","#000000"),It.setAttributeNS(null,"opacity","0.25"),It.setAttributeNS(null,"cx","5.5"),It.setAttributeNS(null,"cy","5.5"),It.setAttributeNS(null,"r","5.4999962");var Mt=S.createNS("http://www.w3.org/2000/svg","circle");Mt.setAttributeNS(null,"fill","#FFFFFF"),Mt.setAttributeNS(null,"cx","5.5"),Mt.setAttributeNS(null,"cy","5.5"),Mt.setAttributeNS(null,"r","5.4999962"),tt.appendChild(It),tt.appendChild(Mt),C.appendChild(L),C.appendChild(Se),C.appendChild(Xe),C.appendChild($e),C.appendChild(tt),g.appendChild(C),g.setAttributeNS(null,"height",41*this._scale+"px"),g.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(g),this._offset=p.Point.convert(i&&i.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Sr){Sr.preventDefault()}),this._element.addEventListener("mousedown",function(Sr){Sr.preventDefault()}),Sc(this._element,this._anchor,"marker"),this._popup=null}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.addTo=function(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},o.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),S.remove(this._element),this._popup&&this._popup.remove(),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(i){return this._lngLat=p.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},o.prototype.getElement=function(){return this._element},o.prototype.setPopup=function(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},o.prototype._onKeyPress=function(i){var h=i.code,g=i.charCode||i.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()},o.prototype._onMapClick=function(i){var h=i.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()},o.prototype.getPopup=function(){return this._popup},o.prototype.togglePopup=function(){var i=this._popup;return i?(i.isOpen()?i.remove():i.addTo(this._map),this):this},o.prototype._update=function(i){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=bl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g="rotateX("+this._map.getPitch()+"deg)"),i&&i.type!=="moveend"||(this._pos=this._pos.round()),S.setTransform(this._element,Ou[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+g+" "+h)}},o.prototype.getOffset=function(){return this._offset},o.prototype.setOffset=function(i){return this._offset=p.Point.convert(i),this._update(),this},o.prototype._onMove=function(i){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},o.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},o.prototype._addDragHandler=function(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},o.prototype.setDraggable=function(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},o.prototype.isDraggable=function(){return this._draggable},o.prototype.setRotation=function(i){return this._rotation=i||0,this._update(),this},o.prototype.getRotation=function(){return this._rotation},o.prototype.setRotationAlignment=function(i){return this._rotationAlignment=i||"auto",this._update(),this},o.prototype.getRotationAlignment=function(){return this._rotationAlignment},o.prototype.setPitchAlignment=function(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this},o.prototype.getPitchAlignment=function(){return this._pitchAlignment},o}(p.Evented),Yc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ac=0,al=!1,wc=function(c){function o(i){c.call(this),this.options=p.extend({},Yc,i),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.onAdd=function(i){var h;return this._map=i,this._container=S.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,ic!==void 0?h(ic):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(g){h(ic=g.state!=="denied")}):h(ic=!!p.window.navigator.geolocation),this._container},o.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),S.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ac=0,al=!1},o.prototype._isOutOfMapMaxBounds=function(i){var h=this._map.getMaxBounds(),g=i.coords;return h&&(g.longitude<h.getWest()||g.longitude>h.getEast()||g.latitude<h.getSouth()||g.latitude>h.getNorth())},o.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},o.prototype._onSuccess=function(i){if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",i)),this._finish()}},o.prototype._updateCamera=function(i){var h=new p.LngLat(i.coords.longitude,i.coords.latitude),g=i.coords.accuracy,E=this._map.getBearing(),C=p.extend({bearing:E},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(g),C,{geolocateSource:!0})},o.prototype._updateMarker=function(i){if(i){var h=new p.LngLat(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},o.prototype._updateCircleRadius=function(){var i=this._map._container.clientHeight/2,h=this._map.unproject([0,i]),g=this._map.unproject([1,i]),E=h.distanceTo(g),C=Math.ceil(2*this._accuracy/E);this._circleElement.style.width=C+"px",this._circleElement.style.height=C+"px"},o.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},o.prototype._onError=function(i){if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&al)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",i)),this._finish()}},o.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},o.prototype._setupUI=function(i){var h=this;if(this._container.addEventListener("contextmenu",function(C){return C.preventDefault()}),this._geolocateButton=S.create("button","mapboxgl-ctrl-geolocate",this._container),S.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",i===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{var E=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=S.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ec(this._dotElement),this._circleElement=S.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ec({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(C){C.geolocateSource||h._watchState!=="ACTIVE_LOCK"||C.originalEvent&&C.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},o.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ac--,al=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var i;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ac>1?(i={maximumAge:6e5,timeout:0},al=!0):(i=this.options.positionOptions,al=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,i)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},o.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},o}(p.Evented),ma={maxWidth:100,unit:"metric"},Hu=function(o){this.options=p.extend({},ma,o),p.bindAll(["_onMove","setUnit"],this)};function Sl(c,o,i){var h=i&&i.maxWidth||100,g=c._container.clientHeight/2,E=c.unproject([0,g]),C=c.unproject([h,g]),L=E.distanceTo(C);if(i&&i.unit==="imperial"){var Z=3.2808*L;Z>5280?nu(o,h,Z/5280,c._getUIString("ScaleControl.Miles")):nu(o,h,Z,c._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?nu(o,h,L/1852,c._getUIString("ScaleControl.NauticalMiles")):L>=1e3?nu(o,h,L/1e3,c._getUIString("ScaleControl.Kilometers")):nu(o,h,L,c._getUIString("ScaleControl.Meters"))}function nu(c,o,i,h){var g,E,C,L=(g=i,(E=Math.pow(10,(""+Math.floor(g)).length-1))*(C=(C=g/E)>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(Z){var ne=Math.pow(10,Math.ceil(-Math.log(Z)/Math.LN10));return Math.round(Z*ne)/ne}(C)));c.style.width=o*(L/i)+"px",c.innerHTML=L+"&nbsp;"+h}Hu.prototype.getDefaultPosition=function(){return"bottom-left"},Hu.prototype._onMove=function(){Sl(this._map,this._container,this.options)},Hu.prototype.onAdd=function(c){return this._map=c,this._container=S.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Hu.prototype.onRemove=function(){S.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Hu.prototype.setUnit=function(c){this.options.unit=c,Sl(this._map,this._container,this.options)};var Hs=function(o){this._fullscreen=!1,o&&o.container&&(o.container instanceof p.window.HTMLElement?this._container=o.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};Hs.prototype.onAdd=function(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=S.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Hs.prototype.onRemove=function(){S.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Hs.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},Hs.prototype._setupUI=function(){var c=this._fullscreenButton=S.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);S.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Hs.prototype._updateTitle=function(){var c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c},Hs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Hs.prototype._isFullscreen=function(){return this._fullscreen},Hs.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Hs.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Tc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},oc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),hf=function(c){function o(i){c.call(this),this.options=p.extend(Object.create(Tc),i),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return c&&(o.__proto__=c),(o.prototype=Object.create(c&&c.prototype)).constructor=o,o.prototype.addTo=function(i){return this._map&&this.remove(),this._map=i,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},o.prototype.isOpen=function(){return!!this._map},o.prototype.remove=function(){return this._content&&S.remove(this._content),this._container&&(S.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(i){return this._lngLat=p.LngLat.convert(i),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},o.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},o.prototype.getElement=function(){return this._container},o.prototype.setText=function(i){return this.setDOMContent(p.window.document.createTextNode(i))},o.prototype.setHTML=function(i){var h,g=p.window.document.createDocumentFragment(),E=p.window.document.createElement("body");for(E.innerHTML=i;h=E.firstChild;)g.appendChild(h);return this.setDOMContent(g)},o.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},o.prototype.setMaxWidth=function(i){return this.options.maxWidth=i,this._update(),this},o.prototype.setDOMContent=function(i){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=S.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(i),this._createCloseButton(),this._update(),this._focusFirstElement(),this},o.prototype.addClassName=function(i){this._container&&this._container.classList.add(i)},o.prototype.removeClassName=function(i){this._container&&this._container.classList.remove(i)},o.prototype.setOffset=function(i){return this.options.offset=i,this._update(),this},o.prototype.toggleClassName=function(i){if(this._container)return this._container.classList.toggle(i)},o.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=S.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},o.prototype._onMouseUp=function(i){this._update(i.point)},o.prototype._onMouseMove=function(i){this._update(i.point)},o.prototype._onDrag=function(i){this._update(i.point)},o.prototype._update=function(i){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=S.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=S.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ye){return h._container.classList.add(ye)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=bl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||i)){var g=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat),E=this.options.anchor,C=function ye(Se){if(Se){if(typeof Se=="number"){var Ye=Math.round(Math.sqrt(.5*Math.pow(Se,2)));return{center:new p.Point(0,0),top:new p.Point(0,Se),"top-left":new p.Point(Ye,Ye),"top-right":new p.Point(-Ye,Ye),bottom:new p.Point(0,-Se),"bottom-left":new p.Point(Ye,-Ye),"bottom-right":new p.Point(-Ye,-Ye),left:new p.Point(Se,0),right:new p.Point(-Se,0)}}if(Se instanceof p.Point||Array.isArray(Se)){var Xe=p.Point.convert(Se);return{center:Xe,top:Xe,"top-left":Xe,"top-right":Xe,bottom:Xe,"bottom-left":Xe,"bottom-right":Xe,left:Xe,right:Xe}}return{center:p.Point.convert(Se.center||[0,0]),top:p.Point.convert(Se.top||[0,0]),"top-left":p.Point.convert(Se["top-left"]||[0,0]),"top-right":p.Point.convert(Se["top-right"]||[0,0]),bottom:p.Point.convert(Se.bottom||[0,0]),"bottom-left":p.Point.convert(Se["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(Se["bottom-right"]||[0,0]),left:p.Point.convert(Se.left||[0,0]),right:p.Point.convert(Se.right||[0,0])}}return ye(new p.Point(0,0))}(this.options.offset);if(!E){var L,Z=this._container.offsetWidth,ne=this._container.offsetHeight;L=g.y+C.bottom.y<ne?["top"]:g.y>this._map.transform.height-ne?["bottom"]:[],g.x<Z/2?L.push("left"):g.x>this._map.transform.width-Z/2&&L.push("right"),E=L.length===0?"bottom":L.join("-")}var me=g.add(C[E]).round();S.setTransform(this._container,Ou[E]+" translate("+me.x+"px,"+me.y+"px)"),Sc(this._container,E,"popup")}},o.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var i=this._container.querySelector(oc);i&&i.focus()}},o.prototype._onClose=function(){this.remove()},o}(p.Evented),$c={version:p.version,supported:G,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:ff,NavigationControl:Iu,GeolocateControl:wc,AttributionControl:os,ScaleControl:Hu,FullscreenControl:Hs,Popup:hf,Marker:Ec,Style:Ja,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){dr().acquire($t)},clearPrewarmedResources:function(){var o=qr;o&&(o.isPreloaded()&&o.numActive()===1?(o.release($t),qr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(c){p.config.ACCESS_TOKEN=c},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(c){p.config.API_URL=c},get workerCount(){return yr.workerCount},set workerCount(c){yr.workerCount=c},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){p.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage:function(o){p.clearTileCache(o)},workerUrl:""};return $c}),V})},30264:function(_t,O,y){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.default=function(Xt){return(0,b.default)((0,ce.default)(Xt)&&Xt.length>=1,"Must merge at least 1 JSON schema."),G.default.apply(void 0,[{}].concat(Nt(Xt),[function(Bt,Qe,xt){if(!(0,F.default)(Bt)){if(xt==="required")return(0,we.default)(Bt.concat(Qe));if((0,Be.default)(Bt)){if(!(0,Be.default)(Qe))throw new Error('Failed to merge schemas because "'+xt+'" has different values.');return}b.default.deepEqual(Bt,Qe,'Failed to merge schemas because "'+xt+'" has different values: '+JSON.stringify(Bt)+" and "+JSON.stringify(Qe)+".")}}]))};var V=y(37154),b=Oe(V),p=y(59227),G=Oe(p),S=y(96695),F=Oe(S),te=y(81921),ce=Oe(te),q=y(41176),we=Oe(q),Pe=y(60283),Be=Oe(Pe);function Oe(Xt){return Xt&&Xt.__esModule?Xt:{default:Xt}}function Nt(Xt){if(Array.isArray(Xt)){for(var Bt=0,Qe=Array(Xt.length);Bt<Xt.length;Bt++)Qe[Bt]=Xt[Bt];return Qe}else return Array.from(Xt)}_t.exports=O.default},80642:function(_t,O,y){var V=y(82195);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var b;(function(p){(function(G){var S=typeof y.g=="object"?y.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),F=te(p);typeof S.Reflect=="undefined"?S.Reflect=p:F=te(S.Reflect,F),G(F);function te(ce,q){return function(we,Pe){typeof ce[we]!="function"&&Object.defineProperty(ce,we,{configurable:!0,writable:!0,value:Pe}),q&&q(we,Pe)}}})(function(G){var S=Object.prototype.hasOwnProperty,F=typeof Symbol=="function",te=F&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ce=F&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",q=typeof Object.create=="function",we={__proto__:[]}instanceof Array,Pe=!q&&!we,Be={create:q?function(){return Rr(Object.create(null))}:we?function(){return Rr({__proto__:null})}:function(){return Rr({})},has:Pe?function(et,gt){return S.call(et,gt)}:function(et,gt){return gt in et},get:Pe?function(et,gt){return S.call(et,gt)?et[gt]:void 0}:function(et,gt){return et[gt]}},Oe=Object.getPrototypeOf(Function),Nt=typeof V=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Xt=!Nt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:hr(),Bt=!Nt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:_r(),Qe=!Nt&&typeof WeakMap=="function"?WeakMap:Ar(),xt=new Qe;function nt(et,gt,dt,fr){if(wr(dt)){if(!w(et))throw new TypeError;if(!ve(gt))throw new TypeError;return bt(et,gt)}else{if(!w(et))throw new TypeError;if(!se(gt))throw new TypeError;if(!se(fr)&&!wr(fr)&&!Nr(fr))throw new TypeError;return Nr(fr)&&(fr=void 0),dt=jt(dt),tr(et,gt,dt,fr)}}G("decorate",nt);function cr(et,gt){function dt(fr,$r){if(!se(fr))throw new TypeError;if(!wr($r)&&!Ae($r))throw new TypeError;ke(et,gt,fr,$r)}return dt}G("metadata",cr);function At(et,gt,dt,fr){if(!se(dt))throw new TypeError;return wr(fr)||(fr=jt(fr)),ke(et,gt,dt,fr)}G("defineMetadata",At);function Gt(et,gt,dt){if(!se(gt))throw new TypeError;return wr(dt)||(dt=jt(dt)),Ee(et,gt,dt)}G("hasMetadata",Gt);function St(et,gt,dt){if(!se(gt))throw new TypeError;return wr(dt)||(dt=jt(dt)),le(et,gt,dt)}G("hasOwnMetadata",St);function Ze(et,gt,dt){if(!se(gt))throw new TypeError;return wr(dt)||(dt=jt(dt)),Q(et,gt,dt)}G("getMetadata",Ze);function yt(et,gt,dt){if(!se(gt))throw new TypeError;return wr(dt)||(dt=jt(dt)),re(et,gt,dt)}G("getOwnMetadata",yt);function Me(et,gt){if(!se(et))throw new TypeError;return wr(gt)||(gt=jt(gt)),qe(et,gt)}G("getMetadataKeys",Me);function Te(et,gt){if(!se(et))throw new TypeError;return wr(gt)||(gt=jt(gt)),Wt(et,gt)}G("getOwnMetadataKeys",Te);function Ie(et,gt,dt){if(!se(gt))throw new TypeError;wr(dt)||(dt=jt(dt));var fr=ae(gt,dt,!1);if(wr(fr)||!fr.delete(et))return!1;if(fr.size>0)return!0;var $r=xt.get(gt);return $r.delete(dt),$r.size>0||xt.delete(gt),!0}G("deleteMetadata",Ie);function bt(et,gt){for(var dt=et.length-1;dt>=0;--dt){var fr=et[dt],$r=fr(gt);if(!wr($r)&&!Nr($r)){if(!ve($r))throw new TypeError;gt=$r}}return gt}function tr(et,gt,dt,fr){for(var $r=et.length-1;$r>=0;--$r){var mt=et[$r],Dt=mt(gt,dt,fr);if(!wr(Dt)&&!Nr(Dt)){if(!se(Dt))throw new TypeError;fr=Dt}}return fr}function ae(et,gt,dt){var fr=xt.get(et);if(wr(fr)){if(!dt)return;fr=new Xt,xt.set(et,fr)}var $r=fr.get(gt);if(wr($r)){if(!dt)return;$r=new Xt,fr.set(gt,$r)}return $r}function Ee(et,gt,dt){var fr=le(et,gt,dt);if(fr)return!0;var $r=Kt(gt);return Nr($r)?!1:Ee(et,$r,dt)}function le(et,gt,dt){var fr=ae(gt,dt,!1);return wr(fr)?!1:ot(fr.has(et))}function Q(et,gt,dt){var fr=le(et,gt,dt);if(fr)return re(et,gt,dt);var $r=Kt(gt);if(!Nr($r))return Q(et,$r,dt)}function re(et,gt,dt){var fr=ae(gt,dt,!1);if(!wr(fr))return fr.get(et)}function ke(et,gt,dt,fr){var $r=ae(dt,fr,!0);$r.set(et,gt)}function qe(et,gt){var dt=Wt(et,gt),fr=Kt(et);if(fr===null)return dt;var $r=qe(fr,gt);if($r.length<=0)return dt;if(dt.length<=0)return $r;for(var mt=new Bt,Dt=[],ar=0,sr=dt;ar<sr.length;ar++){var yn=sr[ar],_n=mt.has(yn);_n||(mt.add(yn),Dt.push(yn))}for(var ai=0,vi=$r;ai<vi.length;ai++){var yn=vi[ai],_n=mt.has(yn);_n||(mt.add(yn),Dt.push(yn))}return Dt}function Wt(et,gt){var dt=[],fr=ae(et,gt,!1);if(wr(fr))return dt;for(var $r=fr.keys(),mt=st($r),Dt=0;;){var ar=X(mt);if(!ar)return dt.length=Dt,dt;var sr=Lt(ar);try{dt[Dt]=sr}catch(yn){try{Tt(mt)}finally{throw yn}}Dt++}}function Or(et){if(et===null)return 1;switch(typeof et){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return et===null?1:6;default:return 6}}function wr(et){return et===void 0}function Nr(et){return et===null}function Vt(et){return typeof et=="symbol"}function se(et){return typeof et=="object"?et!==null:typeof et=="function"}function _e(et,gt){switch(Or(et)){case 0:return et;case 1:return et;case 2:return et;case 3:return et;case 4:return et;case 5:return et}var dt=gt===3?"string":gt===5?"number":"default",fr=Je(et,te);if(fr!==void 0){var $r=fr.call(et,dt);if(se($r))throw new TypeError;return $r}return Le(et,dt==="default"?"number":dt)}function Le(et,gt){if(gt==="string"){var dt=et.toString;if(N(dt)){var fr=dt.call(et);if(!se(fr))return fr}var $r=et.valueOf;if(N($r)){var fr=$r.call(et);if(!se(fr))return fr}}else{var $r=et.valueOf;if(N($r)){var fr=$r.call(et);if(!se(fr))return fr}var mt=et.toString;if(N(mt)){var fr=mt.call(et);if(!se(fr))return fr}}throw new TypeError}function ot(et){return!!et}function Rt(et){return""+et}function jt(et){var gt=_e(et,3);return Vt(gt)?gt:Rt(gt)}function w(et){return Array.isArray?Array.isArray(et):et instanceof Object?et instanceof Array:Object.prototype.toString.call(et)==="[object Array]"}function N(et){return typeof et=="function"}function ve(et){return typeof et=="function"}function Ae(et){switch(Or(et)){case 3:return!0;case 4:return!0;default:return!1}}function Je(et,gt){var dt=et[gt];if(dt!=null){if(!N(dt))throw new TypeError;return dt}}function st(et){var gt=Je(et,ce);if(!N(gt))throw new TypeError;var dt=gt.call(et);if(!se(dt))throw new TypeError;return dt}function Lt(et){return et.value}function X(et){var gt=et.next();return gt.done?!1:gt}function Tt(et){var gt=et.return;gt&&gt.call(et)}function Kt(et){var gt=Object.getPrototypeOf(et);if(typeof et!="function"||et===Oe||gt!==Oe)return gt;var dt=et.prototype,fr=dt&&Object.getPrototypeOf(dt);if(fr==null||fr===Object.prototype)return gt;var $r=fr.constructor;return typeof $r!="function"||$r===et?gt:$r}function hr(){var et={},gt=[],dt=function(){function Dt(ar,sr,yn){this._index=0,this._keys=ar,this._values=sr,this._selector=yn}return Dt.prototype["@@iterator"]=function(){return this},Dt.prototype[ce]=function(){return this},Dt.prototype.next=function(){var ar=this._index;if(ar>=0&&ar<this._keys.length){var sr=this._selector(this._keys[ar],this._values[ar]);return ar+1>=this._keys.length?(this._index=-1,this._keys=gt,this._values=gt):this._index++,{value:sr,done:!1}}return{value:void 0,done:!0}},Dt.prototype.throw=function(ar){throw this._index>=0&&(this._index=-1,this._keys=gt,this._values=gt),ar},Dt.prototype.return=function(ar){return this._index>=0&&(this._index=-1,this._keys=gt,this._values=gt),{value:ar,done:!0}},Dt}();return function(){function Dt(){this._keys=[],this._values=[],this._cacheKey=et,this._cacheIndex=-2}return Object.defineProperty(Dt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Dt.prototype.has=function(ar){return this._find(ar,!1)>=0},Dt.prototype.get=function(ar){var sr=this._find(ar,!1);return sr>=0?this._values[sr]:void 0},Dt.prototype.set=function(ar,sr){var yn=this._find(ar,!0);return this._values[yn]=sr,this},Dt.prototype.delete=function(ar){var sr=this._find(ar,!1);if(sr>=0){for(var yn=this._keys.length,_n=sr+1;_n<yn;_n++)this._keys[_n-1]=this._keys[_n],this._values[_n-1]=this._values[_n];return this._keys.length--,this._values.length--,ar===this._cacheKey&&(this._cacheKey=et,this._cacheIndex=-2),!0}return!1},Dt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=et,this._cacheIndex=-2},Dt.prototype.keys=function(){return new dt(this._keys,this._values,fr)},Dt.prototype.values=function(){return new dt(this._keys,this._values,$r)},Dt.prototype.entries=function(){return new dt(this._keys,this._values,mt)},Dt.prototype["@@iterator"]=function(){return this.entries()},Dt.prototype[ce]=function(){return this.entries()},Dt.prototype._find=function(ar,sr){return this._cacheKey!==ar&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=ar)),this._cacheIndex<0&&sr&&(this._cacheIndex=this._keys.length,this._keys.push(ar),this._values.push(void 0)),this._cacheIndex},Dt}();function fr(Dt,ar){return Dt}function $r(Dt,ar){return ar}function mt(Dt,ar){return[Dt,ar]}}function _r(){return function(){function et(){this._map=new Xt}return Object.defineProperty(et.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),et.prototype.has=function(gt){return this._map.has(gt)},et.prototype.add=function(gt){return this._map.set(gt,gt),this},et.prototype.delete=function(gt){return this._map.delete(gt)},et.prototype.clear=function(){this._map.clear()},et.prototype.keys=function(){return this._map.keys()},et.prototype.values=function(){return this._map.values()},et.prototype.entries=function(){return this._map.entries()},et.prototype["@@iterator"]=function(){return this.keys()},et.prototype[ce]=function(){return this.keys()},et}()}function Ar(){var et=16,gt=Be.create(),dt=fr();return function(){function sr(){this._key=fr()}return sr.prototype.has=function(yn){var _n=$r(yn,!1);return _n!==void 0?Be.has(_n,this._key):!1},sr.prototype.get=function(yn){var _n=$r(yn,!1);return _n!==void 0?Be.get(_n,this._key):void 0},sr.prototype.set=function(yn,_n){var ai=$r(yn,!0);return ai[this._key]=_n,this},sr.prototype.delete=function(yn){var _n=$r(yn,!1);return _n!==void 0?delete _n[this._key]:!1},sr.prototype.clear=function(){this._key=fr()},sr}();function fr(){var sr;do sr="@@WeakMap@@"+ar();while(Be.has(gt,sr));return gt[sr]=!0,sr}function $r(sr,yn){if(!S.call(sr,dt)){if(!yn)return;Object.defineProperty(sr,dt,{value:Be.create()})}return sr[dt]}function mt(sr,yn){for(var _n=0;_n<yn;++_n)sr[_n]=Math.random()*255|0;return sr}function Dt(sr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(sr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(sr)):mt(new Uint8Array(sr),sr):mt(new Array(sr),sr)}function ar(){var sr=Dt(et);sr[6]=sr[6]&79|64,sr[8]=sr[8]&191|128;for(var yn="",_n=0;_n<et;++_n){var ai=sr[_n];(_n===4||_n===6||_n===8)&&(yn+="-"),ai<16&&(yn+="0"),yn+=ai.toString(16).toLowerCase()}return yn}}function Rr(et){return et.__=void 0,delete et.__,et}})})(b||(b={}))},66164:function(_t){(function(O,y){_t.exports=y()})(this,function(){"use strict";var O=function(fe){return fe instanceof Uint8Array||fe instanceof Uint16Array||fe instanceof Uint32Array||fe instanceof Int8Array||fe instanceof Int16Array||fe instanceof Int32Array||fe instanceof Float32Array||fe instanceof Float64Array||fe instanceof Uint8ClampedArray},y=function(fe,Ue){for(var Jt=Object.keys(Ue),mr=0;mr<Jt.length;++mr)fe[Jt[mr]]=Ue[Jt[mr]];return fe},V=`
`;function b(J){return typeof atob!="undefined"?atob(J):"base64:"+J}function p(J){var fe=new Error("(regl) "+J);throw console.error(fe),fe}function G(J,fe){J||p(fe)}function S(J){return J?": "+J:""}function F(J,fe,Ue){J in fe||p("unknown parameter ("+J+")"+S(Ue)+". possible values: "+Object.keys(fe).join())}function te(J,fe){O(J)||p("invalid parameter type"+S(fe)+". must be a typed array")}function ce(J,fe){switch(fe){case"number":return typeof J=="number";case"object":return typeof J=="object";case"string":return typeof J=="string";case"boolean":return typeof J=="boolean";case"function":return typeof J=="function";case"undefined":return typeof J=="undefined";case"symbol":return typeof J=="symbol"}}function q(J,fe,Ue){ce(J,fe)||p("invalid parameter type"+S(Ue)+". expected "+fe+", got "+typeof J)}function we(J,fe){J>=0&&(J|0)===J||p("invalid parameter type, ("+J+")"+S(fe)+". must be a nonnegative integer")}function Pe(J,fe,Ue){fe.indexOf(J)<0&&p("invalid value"+S(Ue)+". must be one of: "+fe)}var Be=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Oe(J){Object.keys(J).forEach(function(fe){Be.indexOf(fe)<0&&p('invalid regl constructor argument "'+fe+'". must be one of '+Be)})}function Nt(J,fe){for(J=J+"";J.length<fe;)J=" "+J;return J}function Xt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Bt(J,fe){this.number=J,this.line=fe,this.errors=[]}function Qe(J,fe,Ue){this.file=J,this.line=fe,this.message=Ue}function xt(){var J=new Error,fe=(J.stack||J).toString(),Ue=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(fe);if(Ue)return Ue[1];var Jt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(fe);return Jt?Jt[1]:"unknown"}function nt(){var J=new Error,fe=(J.stack||J).toString(),Ue=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(fe);if(Ue)return Ue[1];var Jt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(fe);return Jt?Jt[1]:"unknown"}function cr(J,fe){var Ue=J.split(`
`),Jt=1,mr=0,pr={unknown:new Xt,0:new Xt};pr.unknown.name=pr[0].name=fe||xt(),pr.unknown.lines.push(new Bt(0,""));for(var rr=0;rr<Ue.length;++rr){var Zr=Ue[rr],nn=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Zr);if(nn)switch(nn[1]){case"line":var zr=/(\d+)(\s+\d+)?/.exec(nn[2]);zr&&(Jt=zr[1]|0,zr[2]&&(mr=zr[2]|0,mr in pr||(pr[mr]=new Xt)));break;case"define":var Jr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(nn[2]);Jr&&(pr[mr].name=Jr[1]?b(Jr[2]):Jr[2]);break}pr[mr].lines.push(new Bt(Jt++,Zr))}return Object.keys(pr).forEach(function(sn){var mn=pr[sn];mn.lines.forEach(function(on){mn.index[on.number]=on})}),pr}function At(J){var fe=[];return J.split(`
`).forEach(function(Ue){if(!(Ue.length<5)){var Jt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ue);Jt?fe.push(new Qe(Jt[1]|0,Jt[2]|0,Jt[3].trim())):Ue.length>0&&fe.push(new Qe("unknown",0,Ue))}}),fe}function Gt(J,fe){fe.forEach(function(Ue){var Jt=J[Ue.file];if(Jt){var mr=Jt.index[Ue.line];if(mr){mr.errors.push(Ue),Jt.hasErrors=!0;return}}J.unknown.hasErrors=!0,J.unknown.lines[0].errors.push(Ue)})}function St(J,fe,Ue,Jt,mr){if(!J.getShaderParameter(fe,J.COMPILE_STATUS)){var pr=J.getShaderInfoLog(fe),rr=Jt===J.FRAGMENT_SHADER?"fragment":"vertex";tr(Ue,"string",rr+" shader source must be a string",mr);var Zr=cr(Ue,mr),nn=At(pr);Gt(Zr,nn),Object.keys(Zr).forEach(function(zr){var Jr=Zr[zr];if(!Jr.hasErrors)return;var sn=[""],mn=[""];function on(rn,or){sn.push(rn),mn.push(or||"")}on("file number "+zr+": "+Jr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Jr.lines.forEach(function(rn){if(rn.errors.length>0){on(Nt(rn.number,4)+"|  ","background-color:yellow; font-weight:bold"),on(rn.line+V,"color:red; background-color:yellow; font-weight:bold");var or=0;rn.errors.forEach(function(er){var Gr=er.message,En=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Gr);if(En){var Pr=En[1];switch(Gr=En[2],Pr){case"assign":Pr="=";break}or=Math.max(rn.line.indexOf(Pr,or),0)}else or=0;on(Nt("| ",6)),on(Nt("^^^",or+3)+V,"font-weight:bold"),on(Nt("| ",6)),on(Gr+V,"font-weight:bold")}),on(Nt("| ",6)+V)}else on(Nt(rn.number,4)+"|  "),on(rn.line+V,"color:red")}),typeof document!="undefined"&&!window.chrome?(mn[0]=sn.join("%c"),console.log.apply(console,mn)):console.log(sn.join(""))}),G.raise("Error compiling "+rr+" shader, "+Zr[0].name)}}function Ze(J,fe,Ue,Jt,mr){if(!J.getProgramParameter(fe,J.LINK_STATUS)){var pr=J.getProgramInfoLog(fe),rr=cr(Ue,mr),Zr=cr(Jt,mr),nn='Error linking program with vertex shader, "'+Zr[0].name+'", and fragment shader "'+rr[0].name+'"';typeof document!="undefined"?console.log("%c"+nn+V+"%c"+pr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(nn+V+pr),G.raise(nn)}}function yt(J){J._commandRef=xt()}function Me(J,fe,Ue,Jt){yt(J);function mr(nn){return nn?Jt.id(nn):0}J._fragId=mr(J.static.frag),J._vertId=mr(J.static.vert);function pr(nn,zr){Object.keys(zr).forEach(function(Jr){nn[Jt.id(Jr)]=!0})}var rr=J._uniformSet={};pr(rr,fe.static),pr(rr,fe.dynamic);var Zr=J._attributeSet={};pr(Zr,Ue.static),pr(Zr,Ue.dynamic),J._hasCount="count"in J.static||"count"in J.dynamic||"elements"in J.static||"elements"in J.dynamic}function Te(J,fe){var Ue=nt();p(J+" in command "+(fe||xt())+(Ue==="unknown"?"":" called from "+Ue))}function Ie(J,fe,Ue){J||Te(fe,Ue||xt())}function bt(J,fe,Ue,Jt){J in fe||Te("unknown parameter ("+J+")"+S(Ue)+". possible values: "+Object.keys(fe).join(),Jt||xt())}function tr(J,fe,Ue,Jt){ce(J,fe)||Te("invalid parameter type"+S(Ue)+". expected "+fe+", got "+typeof J,Jt||xt())}function ae(J){J()}function Ee(J,fe,Ue){J.texture?Pe(J.texture._texture.internalformat,fe,"unsupported texture format for attachment"):Pe(J.renderbuffer._renderbuffer.format,Ue,"unsupported renderbuffer format for attachment")}var le=33071,Q=9728,re=9984,ke=9985,qe=9986,Wt=9987,Or=5120,wr=5121,Nr=5122,Vt=5123,se=5124,_e=5125,Le=5126,ot=32819,Rt=32820,jt=33635,w=34042,N=36193,ve={};ve[Or]=ve[wr]=1,ve[Nr]=ve[Vt]=ve[N]=ve[jt]=ve[ot]=ve[Rt]=2,ve[se]=ve[_e]=ve[Le]=ve[w]=4;function Ae(J,fe){return J===Rt||J===ot||J===jt?2:J===w?4:ve[J]*fe}function Je(J){return!(J&J-1)&&!!J}function st(J,fe,Ue){var Jt,mr=fe.width,pr=fe.height,rr=fe.channels;G(mr>0&&mr<=Ue.maxTextureSize&&pr>0&&pr<=Ue.maxTextureSize,"invalid texture shape"),(J.wrapS!==le||J.wrapT!==le)&&G(Je(mr)&&Je(pr),"incompatible wrap mode for texture, both width and height must be power of 2"),fe.mipmask===1?mr!==1&&pr!==1&&G(J.minFilter!==re&&J.minFilter!==qe&&J.minFilter!==ke&&J.minFilter!==Wt,"min filter requires mipmap"):(G(Je(mr)&&Je(pr),"texture must be a square power of 2 to support mipmapping"),G(fe.mipmask===(mr<<1)-1,"missing or incomplete mipmap data")),fe.type===Le&&(Ue.extensions.indexOf("oes_texture_float_linear")<0&&G(J.minFilter===Q&&J.magFilter===Q,"filter not supported, must enable oes_texture_float_linear"),G(!J.genMipmaps,"mipmap generation not supported with float textures"));var Zr=fe.images;for(Jt=0;Jt<16;++Jt)if(Zr[Jt]){var nn=mr>>Jt,zr=pr>>Jt;G(fe.mipmask&1<<Jt,"missing mipmap data");var Jr=Zr[Jt];if(G(Jr.width===nn&&Jr.height===zr,"invalid shape for mip images"),G(Jr.format===fe.format&&Jr.internalformat===fe.internalformat&&Jr.type===fe.type,"incompatible type for mip image"),!Jr.compressed)if(Jr.data){var sn=Math.ceil(Ae(Jr.type,rr)*nn/Jr.unpackAlignment)*Jr.unpackAlignment;G(Jr.data.byteLength===sn*zr,"invalid data for image, buffer size is inconsistent with image format")}else Jr.element||Jr.copy}else J.genMipmaps||G((fe.mipmask&1<<Jt)==0,"extra mipmap data");fe.compressed&&G(!J.genMipmaps,"mipmap generation for compressed images not supported")}function Lt(J,fe,Ue,Jt){var mr=J.width,pr=J.height,rr=J.channels;G(mr>0&&mr<=Jt.maxTextureSize&&pr>0&&pr<=Jt.maxTextureSize,"invalid texture shape"),G(mr===pr,"cube map must be square"),G(fe.wrapS===le&&fe.wrapT===le,"wrap mode not supported by cube map");for(var Zr=0;Zr<Ue.length;++Zr){var nn=Ue[Zr];G(nn.width===mr&&nn.height===pr,"inconsistent cube map face shape"),fe.genMipmaps&&(G(!nn.compressed,"can not generate mipmap for compressed textures"),G(nn.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var zr=nn.images,Jr=0;Jr<16;++Jr){var sn=zr[Jr];if(sn){var mn=mr>>Jr,on=pr>>Jr;G(nn.mipmask&1<<Jr,"missing mipmap data"),G(sn.width===mn&&sn.height===on,"invalid shape for mip images"),G(sn.format===J.format&&sn.internalformat===J.internalformat&&sn.type===J.type,"incompatible type for mip image"),sn.compressed||(sn.data?G(sn.data.byteLength===mn*on*Math.max(Ae(sn.type,rr),sn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):sn.element||sn.copy)}}}}var X=y(G,{optional:ae,raise:p,commandRaise:Te,command:Ie,parameter:F,commandParameter:bt,constructor:Oe,type:q,commandType:tr,isTypedArray:te,nni:we,oneOf:Pe,shaderError:St,linkError:Ze,callSite:nt,saveCommandRef:yt,saveDrawInfo:Me,framebufferFormat:Ee,guessCommand:xt,texture2D:st,textureCube:Lt}),Tt=0,Kt=0,hr=5,_r=6;function Ar(J,fe){this.id=Tt++,this.type=J,this.data=fe}function Rr(J){return J.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function et(J){if(J.length===0)return[];var fe=J.charAt(0),Ue=J.charAt(J.length-1);if(J.length>1&&fe===Ue&&(fe==='"'||fe==="'"))return['"'+Rr(J.substr(1,J.length-2))+'"'];var Jt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(J);if(Jt)return et(J.substr(0,Jt.index)).concat(et(Jt[1])).concat(et(J.substr(Jt.index+Jt[0].length)));var mr=J.split(".");if(mr.length===1)return['"'+Rr(J)+'"'];for(var pr=[],rr=0;rr<mr.length;++rr)pr=pr.concat(et(mr[rr]));return pr}function gt(J){return"["+et(J).join("][")+"]"}function dt(J,fe){return new Ar(J,gt(fe+""))}function fr(J){return typeof J=="function"&&!J._reglType||J instanceof Ar}function $r(J,fe){if(typeof J=="function")return new Ar(Kt,J);if(typeof J=="number"||typeof J=="boolean")return new Ar(hr,J);if(Array.isArray(J))return new Ar(_r,J.map(function(Ue,Jt){return $r(Ue,fe+"["+Jt+"]")}));if(J instanceof Ar)return J;X(!1,"invalid option type in uniform "+fe)}var mt={DynamicVariable:Ar,define:dt,isDynamic:fr,unbox:$r,accessor:gt},Dt={next:typeof requestAnimationFrame=="function"?function(J){return requestAnimationFrame(J)}:function(J){return setTimeout(J,16)},cancel:typeof cancelAnimationFrame=="function"?function(J){return cancelAnimationFrame(J)}:clearTimeout},ar=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function sr(){var J={"":0},fe=[""];return{id:function(Jt){var mr=J[Jt];return mr||(mr=J[Jt]=fe.length,fe.push(Jt),mr)},str:function(Jt){return fe[Jt]}}}function yn(J,fe,Ue){var Jt=document.createElement("canvas");y(Jt.style,{border:0,margin:0,padding:0,top:0,left:0}),J.appendChild(Jt),J===document.body&&(Jt.style.position="absolute",y(J.style,{margin:0,padding:0}));function mr(){var Zr=window.innerWidth,nn=window.innerHeight;if(J!==document.body){var zr=J.getBoundingClientRect();Zr=zr.right-zr.left,nn=zr.bottom-zr.top}Jt.width=Ue*Zr,Jt.height=Ue*nn,y(Jt.style,{width:Zr+"px",height:nn+"px"})}var pr;J!==document.body&&typeof ResizeObserver=="function"?(pr=new ResizeObserver(function(){setTimeout(mr)}),pr.observe(J)):window.addEventListener("resize",mr,!1);function rr(){pr?pr.disconnect():window.removeEventListener("resize",mr),J.removeChild(Jt)}return mr(),{canvas:Jt,onDestroy:rr}}function _n(J,fe){function Ue(Jt){try{return J.getContext(Jt,fe)}catch(mr){return null}}return Ue("webgl")||Ue("experimental-webgl")||Ue("webgl-experimental")}function ai(J){return typeof J.nodeName=="string"&&typeof J.appendChild=="function"&&typeof J.getBoundingClientRect=="function"}function vi(J){return typeof J.drawArrays=="function"||typeof J.drawElements=="function"}function Di(J){return typeof J=="string"?J.split():(X(Array.isArray(J),"invalid extension array"),J)}function Zi(J){return typeof J=="string"?(X(typeof document!="undefined","not supported outside of DOM"),document.querySelector(J)):J}function oi(J){var fe=J||{},Ue,Jt,mr,pr,rr={},Zr=[],nn=[],zr=typeof window=="undefined"?1:window.devicePixelRatio,Jr=!1,sn=function(or){or&&X.raise(or)},mn=function(){};if(typeof fe=="string"?(X(typeof document!="undefined","selector queries only supported in DOM enviroments"),Ue=document.querySelector(fe),X(Ue,"invalid query string for element")):typeof fe=="object"?ai(fe)?Ue=fe:vi(fe)?(pr=fe,mr=pr.canvas):(X.constructor(fe),"gl"in fe?pr=fe.gl:"canvas"in fe?mr=Zi(fe.canvas):"container"in fe&&(Jt=Zi(fe.container)),"attributes"in fe&&(rr=fe.attributes,X.type(rr,"object","invalid context attributes")),"extensions"in fe&&(Zr=Di(fe.extensions)),"optionalExtensions"in fe&&(nn=Di(fe.optionalExtensions)),"onDone"in fe&&(X.type(fe.onDone,"function","invalid or missing onDone callback"),sn=fe.onDone),"profile"in fe&&(Jr=!!fe.profile),"pixelRatio"in fe&&(zr=+fe.pixelRatio,X(zr>0,"invalid pixel ratio"))):X.raise("invalid arguments to regl"),Ue&&(Ue.nodeName.toLowerCase()==="canvas"?mr=Ue:Jt=Ue),!pr){if(!mr){X(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var on=yn(Jt||document.body,sn,zr);if(!on)return null;mr=on.canvas,mn=on.onDestroy}rr.premultipliedAlpha===void 0&&(rr.premultipliedAlpha=!0),pr=_n(mr,rr)}return pr?{gl:pr,canvas:mr,container:Jt,extensions:Zr,optionalExtensions:nn,pixelRatio:zr,profile:Jr,onDone:sn,onDestroy:mn}:(mn(),sn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function $(J,fe){var Ue={};function Jt(rr){X.type(rr,"string","extension name must be string");var Zr=rr.toLowerCase(),nn;try{nn=Ue[Zr]=J.getExtension(Zr)}catch(zr){}return!!nn}for(var mr=0;mr<fe.extensions.length;++mr){var pr=fe.extensions[mr];if(!Jt(pr))return fe.onDestroy(),fe.onDone('"'+pr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return fe.optionalExtensions.forEach(Jt),{extensions:Ue,restore:function(){Object.keys(Ue).forEach(function(Zr){if(Ue[Zr]&&!Jt(Zr))throw new Error("(regl): error restoring extension "+Zr)})}}}function I(J,fe){for(var Ue=Array(J),Jt=0;Jt<J;++Jt)Ue[Jt]=fe(Jt);return Ue}var j=5120,Y=5121,ue=5122,De=5123,He=5124,he=5125,Ne=5126;function Ct(J){for(var fe=16;fe<=1<<28;fe*=16)if(J<=fe)return fe;return 0}function kr(J){var fe,Ue;return fe=(J>65535)<<4,J>>>=fe,Ue=(J>255)<<3,J>>>=Ue,fe|=Ue,Ue=(J>15)<<2,J>>>=Ue,fe|=Ue,Ue=(J>3)<<1,J>>>=Ue,fe|=Ue,fe|J>>1}function jr(){var J=I(8,function(){return[]});function fe(pr){var rr=Ct(pr),Zr=J[kr(rr)>>2];return Zr.length>0?Zr.pop():new ArrayBuffer(rr)}function Ue(pr){J[kr(pr.byteLength)>>2].push(pr)}function Jt(pr,rr){var Zr=null;switch(pr){case j:Zr=new Int8Array(fe(rr),0,rr);break;case Y:Zr=new Uint8Array(fe(rr),0,rr);break;case ue:Zr=new Int16Array(fe(2*rr),0,rr);break;case De:Zr=new Uint16Array(fe(2*rr),0,rr);break;case He:Zr=new Int32Array(fe(4*rr),0,rr);break;case he:Zr=new Uint32Array(fe(4*rr),0,rr);break;case Ne:Zr=new Float32Array(fe(4*rr),0,rr);break;default:return null}return Zr.length!==rr?Zr.subarray(0,rr):Zr}function mr(pr){Ue(pr.buffer)}return{alloc:fe,free:Ue,allocType:Jt,freeType:mr}}var $t=jr();$t.zero=jr();var yr=3408,qr=3410,gn=3411,dr=3412,hn=3413,ln=3414,fn=3415,ri=33901,dn=33902,ci=3379,Bi=3386,pi=34921,_i=36347,Ai=36348,xo=35661,Wi=35660,mi=34930,Fn=36349,kn=34076,Zn=34024,ra=7936,js=7937,ua=7938,Ki=35724,mu=34047,gu=36063,ya=34852,no=3553,Ya=34067,Na=34069,Ho=33984,aa=6408,Ga=5126,io=5121,oa=36160,qi=36053,Pl=36064,ts=16384,$a=function(fe,Ue){var Jt=1;Ue.ext_texture_filter_anisotropic&&(Jt=fe.getParameter(mu));var mr=1,pr=1;Ue.webgl_draw_buffers&&(mr=fe.getParameter(ya),pr=fe.getParameter(gu));var rr=!!Ue.oes_texture_float;if(rr){var Zr=fe.createTexture();fe.bindTexture(no,Zr),fe.texImage2D(no,0,aa,1,1,0,aa,Ga,null);var nn=fe.createFramebuffer();if(fe.bindFramebuffer(oa,nn),fe.framebufferTexture2D(oa,Pl,no,Zr,0),fe.bindTexture(no,null),fe.checkFramebufferStatus(oa)!==qi)rr=!1;else{fe.viewport(0,0,1,1),fe.clearColor(1,0,0,1),fe.clear(ts);var zr=$t.allocType(Ga,4);fe.readPixels(0,0,1,1,aa,Ga,zr),fe.getError()?rr=!1:(fe.deleteFramebuffer(nn),fe.deleteTexture(Zr),rr=zr[0]===1),$t.freeType(zr)}}var Jr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),sn=!0;if(!Jr){var mn=fe.createTexture(),on=$t.allocType(io,36);fe.activeTexture(Ho),fe.bindTexture(Ya,mn),fe.texImage2D(Na,0,aa,3,3,0,aa,io,on),$t.freeType(on),fe.bindTexture(Ya,null),fe.deleteTexture(mn),sn=!fe.getError()}return{colorBits:[fe.getParameter(qr),fe.getParameter(gn),fe.getParameter(dr),fe.getParameter(hn)],depthBits:fe.getParameter(ln),stencilBits:fe.getParameter(fn),subpixelBits:fe.getParameter(yr),extensions:Object.keys(Ue).filter(function(rn){return!!Ue[rn]}),maxAnisotropic:Jt,maxDrawbuffers:mr,maxColorAttachments:pr,pointSizeDims:fe.getParameter(ri),lineWidthDims:fe.getParameter(dn),maxViewportDims:fe.getParameter(Bi),maxCombinedTextureUnits:fe.getParameter(xo),maxCubeMapSize:fe.getParameter(kn),maxRenderbufferSize:fe.getParameter(Zn),maxTextureUnits:fe.getParameter(mi),maxTextureSize:fe.getParameter(ci),maxAttributes:fe.getParameter(pi),maxVertexUniforms:fe.getParameter(_i),maxVertexTextureUnits:fe.getParameter(Wi),maxVaryingVectors:fe.getParameter(Ai),maxFragmentUniforms:fe.getParameter(Fn),glsl:fe.getParameter(Ki),renderer:fe.getParameter(js),vendor:fe.getParameter(ra),version:fe.getParameter(ua),readFloat:rr,npotTextureCube:sn}};function Ha(J){return!!J&&typeof J=="object"&&Array.isArray(J.shape)&&Array.isArray(J.stride)&&typeof J.offset=="number"&&J.shape.length===J.stride.length&&(Array.isArray(J.data)||O(J.data))}var la=function(fe){return Object.keys(fe).map(function(Ue){return fe[Ue]})},it={shape:xi,flatten:bn};function pe(J,fe,Ue){for(var Jt=0;Jt<fe;++Jt)Ue[Jt]=J[Jt]}function Ke(J,fe,Ue,Jt){for(var mr=0,pr=0;pr<fe;++pr)for(var rr=J[pr],Zr=0;Zr<Ue;++Zr)Jt[mr++]=rr[Zr]}function qt(J,fe,Ue,Jt,mr,pr){for(var rr=pr,Zr=0;Zr<fe;++Zr)for(var nn=J[Zr],zr=0;zr<Ue;++zr)for(var Jr=nn[zr],sn=0;sn<Jt;++sn)mr[rr++]=Jr[sn]}function Wr(J,fe,Ue,Jt,mr){for(var pr=1,rr=Ue+1;rr<fe.length;++rr)pr*=fe[rr];var Zr=fe[Ue];if(fe.length-Ue==4){var nn=fe[Ue+1],zr=fe[Ue+2],Jr=fe[Ue+3];for(rr=0;rr<Zr;++rr)qt(J[rr],nn,zr,Jr,Jt,mr),mr+=pr}else for(rr=0;rr<Zr;++rr)Wr(J[rr],fe,Ue+1,Jt,mr),mr+=pr}function bn(J,fe,Ue,Jt){var mr=1;if(fe.length)for(var pr=0;pr<fe.length;++pr)mr*=fe[pr];else mr=0;var rr=Jt||$t.allocType(Ue,mr);switch(fe.length){case 0:break;case 1:pe(J,fe[0],rr);break;case 2:Ke(J,fe[0],fe[1],rr);break;case 3:qt(J,fe[0],fe[1],fe[2],rr,0);break;default:Wr(J,fe,0,rr,0)}return rr}function xi(J){for(var fe=[],Ue=J;Ue.length;Ue=Ue[0])fe.push(Ue.length);return fe}var _a={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Vi=5120,Wa=5122,ko=5124,yu=5121,_u=5123,Qu=5125,rs=5126,ds=5126,ao={int8:Vi,int16:Wa,int32:ko,uint8:yu,uint16:_u,uint32:Qu,float:rs,float32:ds},Ds=35048,su=35040,xa={dynamic:Ds,stream:su,static:35044},bi=it.flatten,Ja=it.shape,ba=35044,Co=35040,oo=5121,cl=5126,Ve=[];Ve[5120]=1,Ve[5122]=2,Ve[5124]=4,Ve[5121]=1,Ve[5123]=2,Ve[5125]=4,Ve[5126]=4;function Ft(J){return _a[Object.prototype.toString.call(J)]|0}function br(J,fe){for(var Ue=0;Ue<fe.length;++Ue)J[Ue]=fe[Ue]}function Cn(J,fe,Ue,Jt,mr,pr,rr){for(var Zr=0,nn=0;nn<Ue;++nn)for(var zr=0;zr<Jt;++zr)J[Zr++]=fe[mr*nn+pr*zr+rr]}function Yi(J,fe,Ue,Jt){var mr=0,pr={};function rr(or){this.id=mr++,this.buffer=J.createBuffer(),this.type=or,this.usage=ba,this.byteLength=0,this.dimension=1,this.dtype=oo,this.persistentData=null,Ue.profile&&(this.stats={size:0})}rr.prototype.bind=function(){J.bindBuffer(this.type,this.buffer)},rr.prototype.destroy=function(){mn(this)};var Zr=[];function nn(or,er){var Gr=Zr.pop();return Gr||(Gr=new rr(or)),Gr.bind(),sn(Gr,er,Co,0,1,!1),Gr}function zr(or){Zr.push(or)}function Jr(or,er,Gr){or.byteLength=er.byteLength,J.bufferData(or.type,er,Gr)}function sn(or,er,Gr,En,Pr,Yn){var Kr;if(or.usage=Gr,Array.isArray(er)){if(or.dtype=En||cl,er.length>0){var Br;if(Array.isArray(er[0])){Kr=Ja(er);for(var Fr=1,Yr=1;Yr<Kr.length;++Yr)Fr*=Kr[Yr];or.dimension=Fr,Br=bi(er,Kr,or.dtype),Jr(or,Br,Gr),Yn?or.persistentData=Br:$t.freeType(Br)}else if(typeof er[0]=="number"){or.dimension=Pr;var jn=$t.allocType(or.dtype,er.length);br(jn,er),Jr(or,jn,Gr),Yn?or.persistentData=jn:$t.freeType(jn)}else O(er[0])?(or.dimension=er[0].length,or.dtype=En||Ft(er[0])||cl,Br=bi(er,[er.length,er[0].length],or.dtype),Jr(or,Br,Gr),Yn?or.persistentData=Br:$t.freeType(Br)):X.raise("invalid buffer data")}}else if(O(er))or.dtype=En||Ft(er),or.dimension=Pr,Jr(or,er,Gr),Yn&&(or.persistentData=new Uint8Array(new Uint8Array(er.buffer)));else if(Ha(er)){Kr=er.shape;var $n=er.stride,un=er.offset,Ur=0,Dr=0,ni=0,ii=0;Kr.length===1?(Ur=Kr[0],Dr=1,ni=$n[0],ii=0):Kr.length===2?(Ur=Kr[0],Dr=Kr[1],ni=$n[0],ii=$n[1]):X.raise("invalid shape"),or.dtype=En||Ft(er.data)||cl,or.dimension=Dr;var Rn=$t.allocType(or.dtype,Ur*Dr);Cn(Rn,er.data,Ur,Dr,ni,ii,un),Jr(or,Rn,Gr),Yn?or.persistentData=Rn:$t.freeType(Rn)}else er instanceof ArrayBuffer?(or.dtype=oo,or.dimension=Pr,Jr(or,er,Gr),Yn&&(or.persistentData=new Uint8Array(new Uint8Array(er)))):X.raise("invalid buffer data")}function mn(or){fe.bufferCount--,Jt(or);var er=or.buffer;X(er,"buffer must not be deleted already"),J.deleteBuffer(er),or.buffer=null,delete pr[or.id]}function on(or,er,Gr,En){fe.bufferCount++;var Pr=new rr(er);pr[Pr.id]=Pr;function Yn(Fr){var Yr=ba,jn=null,$n=0,un=0,Ur=1;return Array.isArray(Fr)||O(Fr)||Ha(Fr)||Fr instanceof ArrayBuffer?jn=Fr:typeof Fr=="number"?$n=Fr|0:Fr&&(X.type(Fr,"object","buffer arguments must be an object, a number or an array"),"data"in Fr&&(X(jn===null||Array.isArray(jn)||O(jn)||Ha(jn),"invalid data for buffer"),jn=Fr.data),"usage"in Fr&&(X.parameter(Fr.usage,xa,"invalid buffer usage"),Yr=xa[Fr.usage]),"type"in Fr&&(X.parameter(Fr.type,ao,"invalid buffer type"),un=ao[Fr.type]),"dimension"in Fr&&(X.type(Fr.dimension,"number","invalid dimension"),Ur=Fr.dimension|0),"length"in Fr&&(X.nni($n,"buffer length must be a nonnegative integer"),$n=Fr.length|0)),Pr.bind(),jn?sn(Pr,jn,Yr,un,Ur,En):($n&&J.bufferData(Pr.type,$n,Yr),Pr.dtype=un||oo,Pr.usage=Yr,Pr.dimension=Ur,Pr.byteLength=$n),Ue.profile&&(Pr.stats.size=Pr.byteLength*Ve[Pr.dtype]),Yn}function Kr(Fr,Yr){X(Yr+Fr.byteLength<=Pr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Fr.byteLength+" starting from offset "+Yr+" to a buffer of size "+Pr.byteLength),J.bufferSubData(Pr.type,Yr,Fr)}function Br(Fr,Yr){var jn=(Yr||0)|0,$n;if(Pr.bind(),O(Fr)||Fr instanceof ArrayBuffer)Kr(Fr,jn);else if(Array.isArray(Fr)){if(Fr.length>0)if(typeof Fr[0]=="number"){var un=$t.allocType(Pr.dtype,Fr.length);br(un,Fr),Kr(un,jn),$t.freeType(un)}else if(Array.isArray(Fr[0])||O(Fr[0])){$n=Ja(Fr);var Ur=bi(Fr,$n,Pr.dtype);Kr(Ur,jn),$t.freeType(Ur)}else X.raise("invalid buffer data")}else if(Ha(Fr)){$n=Fr.shape;var Dr=Fr.stride,ni=0,ii=0,Rn=0,Ui=0;$n.length===1?(ni=$n[0],ii=1,Rn=Dr[0],Ui=0):$n.length===2?(ni=$n[0],ii=$n[1],Rn=Dr[0],Ui=Dr[1]):X.raise("invalid shape");var Mi=Array.isArray(Fr.data)?Pr.dtype:Ft(Fr.data),ji=$t.allocType(Mi,ni*ii);Cn(ji,Fr.data,ni,ii,Rn,Ui,Fr.offset),Kr(ji,jn),$t.freeType(ji)}else X.raise("invalid data for buffer subdata");return Yn}return Gr||Yn(or),Yn._reglType="buffer",Yn._buffer=Pr,Yn.subdata=Br,Ue.profile&&(Yn.stats=Pr.stats),Yn.destroy=function(){mn(Pr)},Yn}function rn(){la(pr).forEach(function(or){or.buffer=J.createBuffer(),J.bindBuffer(or.type,or.buffer),J.bufferData(or.type,or.persistentData||or.byteLength,or.usage)})}return Ue.profile&&(fe.getTotalBufferSize=function(){var or=0;return Object.keys(pr).forEach(function(er){or+=pr[er].stats.size}),or}),{create:on,createStream:nn,destroyStream:zr,clear:function(){la(pr).forEach(mn),Zr.forEach(mn)},getBuffer:function(er){return er&&er._buffer instanceof rr?er._buffer:null},restore:rn,_initBuffer:sn}}var Aa=0,za=0,sa=1,La=1,vs=4,ks=4,ha={points:Aa,point:za,lines:sa,line:La,triangles:vs,triangle:ks,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},fl=0,xu=1,ms=4,Ml=5120,zu=5121,qu=5122,Fs=5123,Il=5124,gs=5125,Jl=34963,Df=35040,Ca=35044;function $f(J,fe,Ue,Jt){var mr={},pr=0,rr={uint8:zu,uint16:Fs};fe.oes_element_index_uint&&(rr.uint32=gs);function Zr(rn){this.id=pr++,mr[this.id]=this,this.buffer=rn,this.primType=ms,this.vertCount=0,this.type=0}Zr.prototype.bind=function(){this.buffer.bind()};var nn=[];function zr(rn){var or=nn.pop();return or||(or=new Zr(Ue.create(null,Jl,!0,!1)._buffer)),sn(or,rn,Df,-1,-1,0,0),or}function Jr(rn){nn.push(rn)}function sn(rn,or,er,Gr,En,Pr,Yn){rn.buffer.bind();var Kr;if(or){var Br=Yn;!Yn&&(!O(or)||Ha(or)&&!O(or.data))&&(Br=fe.oes_element_index_uint?gs:Fs),Ue._initBuffer(rn.buffer,or,er,Br,3)}else J.bufferData(Jl,Pr,er),rn.buffer.dtype=Kr||zu,rn.buffer.usage=er,rn.buffer.dimension=3,rn.buffer.byteLength=Pr;if(Kr=Yn,!Yn){switch(rn.buffer.dtype){case zu:case Ml:Kr=zu;break;case Fs:case qu:Kr=Fs;break;case gs:case Il:Kr=gs;break;default:X.raise("unsupported type for element array")}rn.buffer.dtype=Kr}rn.type=Kr,X(Kr!==gs||!!fe.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Fr=En;Fr<0&&(Fr=rn.buffer.byteLength,Kr===Fs?Fr>>=1:Kr===gs&&(Fr>>=2)),rn.vertCount=Fr;var Yr=Gr;if(Gr<0){Yr=ms;var jn=rn.buffer.dimension;jn===1&&(Yr=fl),jn===2&&(Yr=xu),jn===3&&(Yr=ms)}rn.primType=Yr}function mn(rn){Jt.elementsCount--,X(rn.buffer!==null,"must not double destroy elements"),delete mr[rn.id],rn.buffer.destroy(),rn.buffer=null}function on(rn,or){var er=Ue.create(null,Jl,!0),Gr=new Zr(er._buffer);Jt.elementsCount++;function En(Pr){if(!Pr)er(),Gr.primType=ms,Gr.vertCount=0,Gr.type=zu;else if(typeof Pr=="number")er(Pr),Gr.primType=ms,Gr.vertCount=Pr|0,Gr.type=zu;else{var Yn=null,Kr=Ca,Br=-1,Fr=-1,Yr=0,jn=0;Array.isArray(Pr)||O(Pr)||Ha(Pr)?Yn=Pr:(X.type(Pr,"object","invalid arguments for elements"),"data"in Pr&&(Yn=Pr.data,X(Array.isArray(Yn)||O(Yn)||Ha(Yn),"invalid data for element buffer")),"usage"in Pr&&(X.parameter(Pr.usage,xa,"invalid element buffer usage"),Kr=xa[Pr.usage]),"primitive"in Pr&&(X.parameter(Pr.primitive,ha,"invalid element buffer primitive"),Br=ha[Pr.primitive]),"count"in Pr&&(X(typeof Pr.count=="number"&&Pr.count>=0,"invalid vertex count for elements"),Fr=Pr.count|0),"type"in Pr&&(X.parameter(Pr.type,rr,"invalid buffer type"),jn=rr[Pr.type]),"length"in Pr?Yr=Pr.length|0:(Yr=Fr,jn===Fs||jn===qu?Yr*=2:(jn===gs||jn===Il)&&(Yr*=4))),sn(Gr,Yn,Kr,Br,Fr,Yr,jn)}return En}return En(rn),En._reglType="elements",En._elements=Gr,En.subdata=function(Pr,Yn){return er.subdata(Pr,Yn),En},En.destroy=function(){mn(Gr)},En}return{create:on,createStream:zr,destroyStream:Jr,getElements:function(or){return typeof or=="function"&&or._elements instanceof Zr?or._elements:null},clear:function(){la(mr).forEach(mn)}}}var Uc=new Float32Array(1),af=new Uint32Array(Uc.buffer),Ef=5123;function of(J){for(var fe=$t.allocType(Ef,J.length),Ue=0;Ue<J.length;++Ue)if(isNaN(J[Ue]))fe[Ue]=65535;else if(J[Ue]===Infinity)fe[Ue]=31744;else if(J[Ue]===-Infinity)fe[Ue]=64512;else{Uc[0]=J[Ue];var Jt=af[0],mr=Jt>>>31<<15,pr=(Jt<<1>>>24)-127,rr=Jt>>13&(1<<10)-1;if(pr<-24)fe[Ue]=mr;else if(pr<-14){var Zr=-14-pr;fe[Ue]=mr+(rr+(1<<10)>>Zr)}else pr>15?fe[Ue]=mr+31744:fe[Ue]=mr+(pr+15<<10)+rr}return fe}function go(J){return Array.isArray(J)||O(J)}var Ol=function(fe){return!(fe&fe-1)&&!!fe},Ll=34467,Es=3553,sf=34067,Rl=34069,Bu=6408,Po=6406,uf=6407,bu=6409,hl=6410,kf=32854,Dl=32855,Ra=36194,uu=32819,vc=32820,Mo=33635,ns=34042,kl=6402,Fl=34041,Su=35904,lu=35906,cu=36193,Ql=33776,Nl=33777,pl=33778,ql=33779,qs=35986,is=35987,zl=34798,jc=35840,dl=35841,el=35842,ec=35843,Zc=36196,tl=5121,Bl=5123,mc=5125,rl=5126,Vc=10242,lf=10243,cf=10497,Ul=33071,Gc=33648,Hc=10240,gc=10241,nl=9728,Wc=9729,Eu=9984,Ia=9985,jl=9986,wu=9987,Uu=33170,zi=4352,Pa=4353,Ma=4354,tc=34046,Zl=3317,rc=37440,wf=37441,Tf=37443,Vl=37444,ju=33984,Zu=[Eu,jl,Ia,wu],Qa=[0,bu,hl,uf,Bu],ys={};ys[bu]=ys[Po]=ys[kl]=1,ys[Fl]=ys[hl]=2,ys[uf]=ys[Su]=3,ys[Bu]=ys[lu]=4;function vl(J){return"[object "+J+"]"}var so=vl("HTMLCanvasElement"),Tn=vl("OffscreenCanvas"),Ns=vl("CanvasRenderingContext2D"),nc=vl("ImageBitmap"),ml=vl("HTMLImageElement"),eu=vl("HTMLVideoElement"),Zs=Object.keys(_a).concat([so,Tn,Ns,nc,ml,eu]),gl=[];gl[tl]=1,gl[rl]=4,gl[cu]=2,gl[Bl]=2,gl[mc]=4;var en=[];en[kf]=2,en[Dl]=2,en[Ra]=2,en[Fl]=4,en[Ql]=.5,en[Nl]=.5,en[pl]=1,en[ql]=1,en[qs]=.5,en[is]=1,en[zl]=1,en[jc]=.5,en[dl]=.25,en[el]=.5,en[ec]=.25,en[Zc]=.5;function Xc(J){return Array.isArray(J)&&(J.length===0||typeof J[0]=="number")}function yc(J){if(!Array.isArray(J))return!1;var fe=J.length;return!(fe===0||!go(J[0]))}function Vu(J){return Object.prototype.toString.call(J)}function tu(J){return Vu(J)===so}function Ba(J){return Vu(J)===Tn}function Tu(J){return Vu(J)===Ns}function Au(J){return Vu(J)===nc}function Wo(J){return Vu(J)===ml}function Cu(J){return Vu(J)===eu}function il(J){if(!J)return!1;var fe=Vu(J);return Zs.indexOf(fe)>=0?!0:Xc(J)||yc(J)||Ha(J)}function yl(J){return _a[Object.prototype.toString.call(J)]|0}function Kc(J,fe){var Ue=fe.length;switch(J.type){case tl:case Bl:case mc:case rl:var Jt=$t.allocType(J.type,Ue);Jt.set(fe),J.data=Jt;break;case cu:J.data=of(fe);break;default:X.raise("unsupported texture type, must specify a typed array")}}function _c(J,fe){return $t.allocType(J.type===cu?rl:J.type,fe)}function ws(J,fe){J.type===cu?(J.data=of(fe),$t.freeType(fe)):J.data=fe}function Ts(J,fe,Ue,Jt,mr,pr){for(var rr=J.width,Zr=J.height,nn=J.channels,zr=rr*Zr*nn,Jr=_c(J,zr),sn=0,mn=0;mn<Zr;++mn)for(var on=0;on<rr;++on)for(var rn=0;rn<nn;++rn)Jr[sn++]=fe[Ue*on+Jt*mn+mr*rn+pr];ws(J,Jr)}function Oi(J,fe,Ue,Jt,mr,pr){var rr;if(typeof en[J]!="undefined"?rr=en[J]:rr=ys[J]*gl[fe],pr&&(rr*=6),mr){for(var Zr=0,nn=Ue;nn>=1;)Zr+=rr*nn*nn,nn/=2;return Zr}else return rr*Ue*Jt}function Pu(J,fe,Ue,Jt,mr,pr,rr){var Zr={"don't care":zi,"dont care":zi,nice:Ma,fast:Pa},nn={repeat:cf,clamp:Ul,mirror:Gc},zr={nearest:nl,linear:Wc},Jr=y({mipmap:wu,"nearest mipmap nearest":Eu,"linear mipmap nearest":Ia,"nearest mipmap linear":jl,"linear mipmap linear":wu},zr),sn={none:0,browser:Vl},mn={uint8:tl,rgba4:uu,rgb565:Mo,"rgb5 a1":vc},on={alpha:Po,luminance:bu,"luminance alpha":hl,rgb:uf,rgba:Bu,rgba4:kf,"rgb5 a1":Dl,rgb565:Ra},rn={};fe.ext_srgb&&(on.srgb=Su,on.srgba=lu),fe.oes_texture_float&&(mn.float32=mn.float=rl),fe.oes_texture_half_float&&(mn.float16=mn["half float"]=cu),fe.webgl_depth_texture&&(y(on,{depth:kl,"depth stencil":Fl}),y(mn,{uint16:Bl,uint32:mc,"depth stencil":ns})),fe.webgl_compressed_texture_s3tc&&y(rn,{"rgb s3tc dxt1":Ql,"rgba s3tc dxt1":Nl,"rgba s3tc dxt3":pl,"rgba s3tc dxt5":ql}),fe.webgl_compressed_texture_atc&&y(rn,{"rgb atc":qs,"rgba atc explicit alpha":is,"rgba atc interpolated alpha":zl}),fe.webgl_compressed_texture_pvrtc&&y(rn,{"rgb pvrtc 4bppv1":jc,"rgb pvrtc 2bppv1":dl,"rgba pvrtc 4bppv1":el,"rgba pvrtc 2bppv1":ec}),fe.webgl_compressed_texture_etc1&&(rn["rgb etc1"]=Zc);var or=Array.prototype.slice.call(J.getParameter(Ll));Object.keys(rn).forEach(function(We){var lr=rn[We];or.indexOf(lr)>=0&&(on[We]=lr)});var er=Object.keys(on);Ue.textureFormats=er;var Gr=[];Object.keys(on).forEach(function(We){var lr=on[We];Gr[lr]=We});var En=[];Object.keys(mn).forEach(function(We){var lr=mn[We];En[lr]=We});var Pr=[];Object.keys(zr).forEach(function(We){var lr=zr[We];Pr[lr]=We});var Yn=[];Object.keys(Jr).forEach(function(We){var lr=Jr[We];Yn[lr]=We});var Kr=[];Object.keys(nn).forEach(function(We){var lr=nn[We];Kr[lr]=We});var Br=er.reduce(function(We,lr){var Qt=on[lr];return Qt===bu||Qt===Po||Qt===bu||Qt===hl||Qt===kl||Qt===Fl||fe.ext_srgb&&(Qt===Su||Qt===lu)?We[Qt]=Qt:Qt===Dl||lr.indexOf("rgba")>=0?We[Qt]=Bu:We[Qt]=uf,We},{});function Fr(){this.internalformat=Bu,this.format=Bu,this.type=tl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Vl,this.width=0,this.height=0,this.channels=0}function Yr(We,lr){We.internalformat=lr.internalformat,We.format=lr.format,We.type=lr.type,We.compressed=lr.compressed,We.premultiplyAlpha=lr.premultiplyAlpha,We.flipY=lr.flipY,We.unpackAlignment=lr.unpackAlignment,We.colorSpace=lr.colorSpace,We.width=lr.width,We.height=lr.height,We.channels=lr.channels}function jn(We,lr){if(!(typeof lr!="object"||!lr)){if("premultiplyAlpha"in lr&&(X.type(lr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),We.premultiplyAlpha=lr.premultiplyAlpha),"flipY"in lr&&(X.type(lr.flipY,"boolean","invalid texture flip"),We.flipY=lr.flipY),"alignment"in lr&&(X.oneOf(lr.alignment,[1,2,4,8],"invalid texture unpack alignment"),We.unpackAlignment=lr.alignment),"colorSpace"in lr&&(X.parameter(lr.colorSpace,sn,"invalid colorSpace"),We.colorSpace=sn[lr.colorSpace]),"type"in lr){var Qt=lr.type;X(fe.oes_texture_float||!(Qt==="float"||Qt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),X(fe.oes_texture_half_float||!(Qt==="half float"||Qt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),X(fe.webgl_depth_texture||!(Qt==="uint16"||Qt==="uint32"||Qt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),X.parameter(Qt,mn,"invalid texture type"),We.type=mn[Qt]}var Pn=We.width,Fi=We.height,Re=We.channels,be=!1;"shape"in lr?(X(Array.isArray(lr.shape)&&lr.shape.length>=2,"shape must be an array"),Pn=lr.shape[0],Fi=lr.shape[1],lr.shape.length===3&&(Re=lr.shape[2],X(Re>0&&Re<=4,"invalid number of channels"),be=!0),X(Pn>=0&&Pn<=Ue.maxTextureSize,"invalid width"),X(Fi>=0&&Fi<=Ue.maxTextureSize,"invalid height")):("radius"in lr&&(Pn=Fi=lr.radius,X(Pn>=0&&Pn<=Ue.maxTextureSize,"invalid radius")),"width"in lr&&(Pn=lr.width,X(Pn>=0&&Pn<=Ue.maxTextureSize,"invalid width")),"height"in lr&&(Fi=lr.height,X(Fi>=0&&Fi<=Ue.maxTextureSize,"invalid height")),"channels"in lr&&(Re=lr.channels,X(Re>0&&Re<=4,"invalid number of channels"),be=!0)),We.width=Pn|0,We.height=Fi|0,We.channels=Re|0;var ht=!1;if("format"in lr){var zt=lr.format;X(fe.webgl_depth_texture||!(zt==="depth"||zt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),X.parameter(zt,on,"invalid texture format");var Zt=We.internalformat=on[zt];We.format=Br[Zt],zt in mn&&("type"in lr||(We.type=mn[zt])),zt in rn&&(We.compressed=!0),ht=!0}!be&&ht?We.channels=ys[We.format]:be&&!ht?We.channels!==Qa[We.format]&&(We.format=We.internalformat=Qa[We.channels]):ht&&be&&X(We.channels===ys[We.format],"number of channels inconsistent with specified format")}}function $n(We){J.pixelStorei(rc,We.flipY),J.pixelStorei(wf,We.premultiplyAlpha),J.pixelStorei(Tf,We.colorSpace),J.pixelStorei(Zl,We.unpackAlignment)}function un(){Fr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Ur(We,lr){var Qt=null;if(il(lr)?Qt=lr:lr&&(X.type(lr,"object","invalid pixel data type"),jn(We,lr),"x"in lr&&(We.xOffset=lr.x|0),"y"in lr&&(We.yOffset=lr.y|0),il(lr.data)&&(Qt=lr.data)),X(!We.compressed||Qt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),lr.copy){X(!Qt,"can not specify copy and data field for the same texture");var Pn=mr.viewportWidth,Fi=mr.viewportHeight;We.width=We.width||Pn-We.xOffset,We.height=We.height||Fi-We.yOffset,We.needsCopy=!0,X(We.xOffset>=0&&We.xOffset<Pn&&We.yOffset>=0&&We.yOffset<Fi&&We.width>0&&We.width<=Pn&&We.height>0&&We.height<=Fi,"copy texture read out of bounds")}else if(!Qt)We.width=We.width||1,We.height=We.height||1,We.channels=We.channels||4;else if(O(Qt))We.channels=We.channels||4,We.data=Qt,!("type"in lr)&&We.type===tl&&(We.type=yl(Qt));else if(Xc(Qt))We.channels=We.channels||4,Kc(We,Qt),We.alignment=1,We.needsFree=!0;else if(Ha(Qt)){var Re=Qt.data;!Array.isArray(Re)&&We.type===tl&&(We.type=yl(Re));var be=Qt.shape,ht=Qt.stride,zt,Zt,vt,pt,Pt,Fe;be.length===3?(vt=be[2],Fe=ht[2]):(X(be.length===2,"invalid ndarray pixel data, must be 2 or 3D"),vt=1,Fe=1),zt=be[0],Zt=be[1],pt=ht[0],Pt=ht[1],We.alignment=1,We.width=zt,We.height=Zt,We.channels=vt,We.format=We.internalformat=Qa[vt],We.needsFree=!0,Ts(We,Re,pt,Pt,Fe,Qt.offset)}else if(tu(Qt)||Ba(Qt)||Tu(Qt))tu(Qt)||Ba(Qt)?We.element=Qt:We.element=Qt.canvas,We.width=We.element.width,We.height=We.element.height,We.channels=4;else if(Au(Qt))We.element=Qt,We.width=Qt.width,We.height=Qt.height,We.channels=4;else if(Wo(Qt))We.element=Qt,We.width=Qt.naturalWidth,We.height=Qt.naturalHeight,We.channels=4;else if(Cu(Qt))We.element=Qt,We.width=Qt.videoWidth,We.height=Qt.videoHeight,We.channels=4;else if(yc(Qt)){var lt=We.width||Qt[0].length,Ce=We.height||Qt.length,kt=We.channels;go(Qt[0][0])?kt=kt||Qt[0][0].length:kt=kt||1;for(var Ht=it.shape(Qt),Mr=1,ur=0;ur<Ht.length;++ur)Mr*=Ht[ur];var Tr=_c(We,Mr);it.flatten(Qt,Ht,"",Tr),ws(We,Tr),We.alignment=1,We.width=lt,We.height=Ce,We.channels=kt,We.format=We.internalformat=Qa[kt],We.needsFree=!0}We.type===rl?X(Ue.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):We.type===cu&&X(Ue.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Dr(We,lr,Qt){var Pn=We.element,Fi=We.data,Re=We.internalformat,be=We.format,ht=We.type,zt=We.width,Zt=We.height;$n(We),Pn?J.texImage2D(lr,Qt,be,be,ht,Pn):We.compressed?J.compressedTexImage2D(lr,Qt,Re,zt,Zt,0,Fi):We.needsCopy?(Jt(),J.copyTexImage2D(lr,Qt,be,We.xOffset,We.yOffset,zt,Zt,0)):J.texImage2D(lr,Qt,be,zt,Zt,0,be,ht,Fi||null)}function ni(We,lr,Qt,Pn,Fi){var Re=We.element,be=We.data,ht=We.internalformat,zt=We.format,Zt=We.type,vt=We.width,pt=We.height;$n(We),Re?J.texSubImage2D(lr,Fi,Qt,Pn,zt,Zt,Re):We.compressed?J.compressedTexSubImage2D(lr,Fi,Qt,Pn,ht,vt,pt,be):We.needsCopy?(Jt(),J.copyTexSubImage2D(lr,Fi,Qt,Pn,We.xOffset,We.yOffset,vt,pt)):J.texSubImage2D(lr,Fi,Qt,Pn,vt,pt,zt,Zt,be)}var ii=[];function Rn(){return ii.pop()||new un}function Ui(We){We.needsFree&&$t.freeType(We.data),un.call(We),ii.push(We)}function Mi(){Fr.call(this),this.genMipmaps=!1,this.mipmapHint=zi,this.mipmask=0,this.images=Array(16)}function ji(We,lr,Qt){var Pn=We.images[0]=Rn();We.mipmask=1,Pn.width=We.width=lr,Pn.height=We.height=Qt,Pn.channels=We.channels=4}function na(We,lr){var Qt=null;if(il(lr))Qt=We.images[0]=Rn(),Yr(Qt,We),Ur(Qt,lr),We.mipmask=1;else if(jn(We,lr),Array.isArray(lr.mipmap))for(var Pn=lr.mipmap,Fi=0;Fi<Pn.length;++Fi)Qt=We.images[Fi]=Rn(),Yr(Qt,We),Qt.width>>=Fi,Qt.height>>=Fi,Ur(Qt,Pn[Fi]),We.mipmask|=1<<Fi;else Qt=We.images[0]=Rn(),Yr(Qt,We),Ur(Qt,lr),We.mipmask=1;Yr(We,We.images[0]),We.compressed&&(We.internalformat===Ql||We.internalformat===Nl||We.internalformat===pl||We.internalformat===ql)&&X(We.width%4==0&&We.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Qo(We,lr){for(var Qt=We.images,Pn=0;Pn<Qt.length;++Pn){if(!Qt[Pn])return;Dr(Qt[Pn],lr,Pn)}}var Is=[];function ea(){var We=Is.pop()||new Mi;Fr.call(We),We.mipmask=0;for(var lr=0;lr<16;++lr)We.images[lr]=null;return We}function To(We){for(var lr=We.images,Qt=0;Qt<lr.length;++Qt)lr[Qt]&&Ui(lr[Qt]),lr[Qt]=null;Is.push(We)}function qa(){this.minFilter=nl,this.magFilter=nl,this.wrapS=Ul,this.wrapT=Ul,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=zi}function cs(We,lr){if("min"in lr){var Qt=lr.min;X.parameter(Qt,Jr),We.minFilter=Jr[Qt],Zu.indexOf(We.minFilter)>=0&&!("faces"in lr)&&(We.genMipmaps=!0)}if("mag"in lr){var Pn=lr.mag;X.parameter(Pn,zr),We.magFilter=zr[Pn]}var Fi=We.wrapS,Re=We.wrapT;if("wrap"in lr){var be=lr.wrap;typeof be=="string"?(X.parameter(be,nn),Fi=Re=nn[be]):Array.isArray(be)&&(X.parameter(be[0],nn),X.parameter(be[1],nn),Fi=nn[be[0]],Re=nn[be[1]])}else{if("wrapS"in lr){var ht=lr.wrapS;X.parameter(ht,nn),Fi=nn[ht]}if("wrapT"in lr){var zt=lr.wrapT;X.parameter(zt,nn),Re=nn[zt]}}if(We.wrapS=Fi,We.wrapT=Re,"anisotropic"in lr){var Zt=lr.anisotropic;X(typeof Zt=="number"&&Zt>=1&&Zt<=Ue.maxAnisotropic,"aniso samples must be between 1 and "),We.anisotropic=lr.anisotropic}if("mipmap"in lr){var vt=!1;switch(typeof lr.mipmap){case"string":X.parameter(lr.mipmap,Zr,"invalid mipmap hint"),We.mipmapHint=Zr[lr.mipmap],We.genMipmaps=!0,vt=!0;break;case"boolean":vt=We.genMipmaps=lr.mipmap;break;case"object":X(Array.isArray(lr.mipmap),"invalid mipmap type"),We.genMipmaps=!1,vt=!0;break;default:X.raise("invalid mipmap type")}vt&&!("min"in lr)&&(We.minFilter=Eu)}}function qo(We,lr){J.texParameteri(lr,gc,We.minFilter),J.texParameteri(lr,Hc,We.magFilter),J.texParameteri(lr,Vc,We.wrapS),J.texParameteri(lr,lf,We.wrapT),fe.ext_texture_filter_anisotropic&&J.texParameteri(lr,tc,We.anisotropic),We.genMipmaps&&(J.hint(Uu,We.mipmapHint),J.generateMipmap(lr))}var Os=0,es={},Xs=Ue.maxTextureUnits,Zo=Array(Xs).map(function(){return null});function ki(We){Fr.call(this),this.mipmask=0,this.internalformat=Bu,this.id=Os++,this.refCount=1,this.target=We,this.texture=J.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new qa,rr.profile&&(this.stats={size:0})}function Ks(We){J.activeTexture(ju),J.bindTexture(We.target,We.texture)}function wa(){var We=Zo[0];We?J.bindTexture(We.target,We.texture):J.bindTexture(Es,null)}function ui(We){var lr=We.texture;X(lr,"must not double destroy texture");var Qt=We.unit,Pn=We.target;Qt>=0&&(J.activeTexture(ju+Qt),J.bindTexture(Pn,null),Zo[Qt]=null),J.deleteTexture(lr),We.texture=null,We.params=null,We.pixels=null,We.refCount=0,delete es[We.id],pr.textureCount--}y(ki.prototype,{bind:function(){var lr=this;lr.bindCount+=1;var Qt=lr.unit;if(Qt<0){for(var Pn=0;Pn<Xs;++Pn){var Fi=Zo[Pn];if(Fi){if(Fi.bindCount>0)continue;Fi.unit=-1}Zo[Pn]=lr,Qt=Pn;break}Qt>=Xs&&X.raise("insufficient number of texture units"),rr.profile&&pr.maxTextureUnits<Qt+1&&(pr.maxTextureUnits=Qt+1),lr.unit=Qt,J.activeTexture(ju+Qt),J.bindTexture(lr.target,lr.texture)}return Qt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ui(this)}});function Li(We,lr){var Qt=new ki(Es);es[Qt.id]=Qt,pr.textureCount++;function Pn(be,ht){var zt=Qt.texInfo;qa.call(zt);var Zt=ea();return typeof be=="number"?typeof ht=="number"?ji(Zt,be|0,ht|0):ji(Zt,be|0,be|0):be?(X.type(be,"object","invalid arguments to regl.texture"),cs(zt,be),na(Zt,be)):ji(Zt,1,1),zt.genMipmaps&&(Zt.mipmask=(Zt.width<<1)-1),Qt.mipmask=Zt.mipmask,Yr(Qt,Zt),X.texture2D(zt,Zt,Ue),Qt.internalformat=Zt.internalformat,Pn.width=Zt.width,Pn.height=Zt.height,Ks(Qt),Qo(Zt,Es),qo(zt,Es),wa(),To(Zt),rr.profile&&(Qt.stats.size=Oi(Qt.internalformat,Qt.type,Zt.width,Zt.height,zt.genMipmaps,!1)),Pn.format=Gr[Qt.internalformat],Pn.type=En[Qt.type],Pn.mag=Pr[zt.magFilter],Pn.min=Yn[zt.minFilter],Pn.wrapS=Kr[zt.wrapS],Pn.wrapT=Kr[zt.wrapT],Pn}function Fi(be,ht,zt,Zt){X(!!be,"must specify image data");var vt=ht|0,pt=zt|0,Pt=Zt|0,Fe=Rn();return Yr(Fe,Qt),Fe.width=0,Fe.height=0,Ur(Fe,be),Fe.width=Fe.width||(Qt.width>>Pt)-vt,Fe.height=Fe.height||(Qt.height>>Pt)-pt,X(Qt.type===Fe.type&&Qt.format===Fe.format&&Qt.internalformat===Fe.internalformat,"incompatible format for texture.subimage"),X(vt>=0&&pt>=0&&vt+Fe.width<=Qt.width&&pt+Fe.height<=Qt.height,"texture.subimage write out of bounds"),X(Qt.mipmask&1<<Pt,"missing mipmap data"),X(Fe.data||Fe.element||Fe.needsCopy,"missing image data"),Ks(Qt),ni(Fe,Es,vt,pt,Pt),wa(),Ui(Fe),Pn}function Re(be,ht){var zt=be|0,Zt=ht|0||zt;if(zt===Qt.width&&Zt===Qt.height)return Pn;Pn.width=Qt.width=zt,Pn.height=Qt.height=Zt,Ks(Qt);for(var vt=0;Qt.mipmask>>vt;++vt){var pt=zt>>vt,Pt=Zt>>vt;if(!pt||!Pt)break;J.texImage2D(Es,vt,Qt.format,pt,Pt,0,Qt.format,Qt.type,null)}return wa(),rr.profile&&(Qt.stats.size=Oi(Qt.internalformat,Qt.type,zt,Zt,!1,!1)),Pn}return Pn(We,lr),Pn.subimage=Fi,Pn.resize=Re,Pn._reglType="texture2d",Pn._texture=Qt,rr.profile&&(Pn.stats=Qt.stats),Pn.destroy=function(){Qt.decRef()},Pn}function ta(We,lr,Qt,Pn,Fi,Re){var be=new ki(sf);es[be.id]=be,pr.cubeCount++;var ht=new Array(6);function zt(pt,Pt,Fe,lt,Ce,kt){var Ht,Mr=be.texInfo;for(qa.call(Mr),Ht=0;Ht<6;++Ht)ht[Ht]=ea();if(typeof pt=="number"||!pt){var ur=pt|0||1;for(Ht=0;Ht<6;++Ht)ji(ht[Ht],ur,ur)}else if(typeof pt=="object")if(Pt)na(ht[0],pt),na(ht[1],Pt),na(ht[2],Fe),na(ht[3],lt),na(ht[4],Ce),na(ht[5],kt);else if(cs(Mr,pt),jn(be,pt),"faces"in pt){var Tr=pt.faces;for(X(Array.isArray(Tr)&&Tr.length===6,"cube faces must be a length 6 array"),Ht=0;Ht<6;++Ht)X(typeof Tr[Ht]=="object"&&!!Tr[Ht],"invalid input for cube map face"),Yr(ht[Ht],be),na(ht[Ht],Tr[Ht])}else for(Ht=0;Ht<6;++Ht)na(ht[Ht],pt);else X.raise("invalid arguments to cube map");for(Yr(be,ht[0]),Ue.npotTextureCube||X(Ol(be.width)&&Ol(be.height),"your browser does not support non power or two texture dimensions"),Mr.genMipmaps?be.mipmask=(ht[0].width<<1)-1:be.mipmask=ht[0].mipmask,X.textureCube(be,Mr,ht,Ue),be.internalformat=ht[0].internalformat,zt.width=ht[0].width,zt.height=ht[0].height,Ks(be),Ht=0;Ht<6;++Ht)Qo(ht[Ht],Rl+Ht);for(qo(Mr,sf),wa(),rr.profile&&(be.stats.size=Oi(be.internalformat,be.type,zt.width,zt.height,Mr.genMipmaps,!0)),zt.format=Gr[be.internalformat],zt.type=En[be.type],zt.mag=Pr[Mr.magFilter],zt.min=Yn[Mr.minFilter],zt.wrapS=Kr[Mr.wrapS],zt.wrapT=Kr[Mr.wrapT],Ht=0;Ht<6;++Ht)To(ht[Ht]);return zt}function Zt(pt,Pt,Fe,lt,Ce){X(!!Pt,"must specify image data"),X(typeof pt=="number"&&pt===(pt|0)&&pt>=0&&pt<6,"invalid face");var kt=Fe|0,Ht=lt|0,Mr=Ce|0,ur=Rn();return Yr(ur,be),ur.width=0,ur.height=0,Ur(ur,Pt),ur.width=ur.width||(be.width>>Mr)-kt,ur.height=ur.height||(be.height>>Mr)-Ht,X(be.type===ur.type&&be.format===ur.format&&be.internalformat===ur.internalformat,"incompatible format for texture.subimage"),X(kt>=0&&Ht>=0&&kt+ur.width<=be.width&&Ht+ur.height<=be.height,"texture.subimage write out of bounds"),X(be.mipmask&1<<Mr,"missing mipmap data"),X(ur.data||ur.element||ur.needsCopy,"missing image data"),Ks(be),ni(ur,Rl+pt,kt,Ht,Mr),wa(),Ui(ur),zt}function vt(pt){var Pt=pt|0;if(Pt!==be.width){zt.width=be.width=Pt,zt.height=be.height=Pt,Ks(be);for(var Fe=0;Fe<6;++Fe)for(var lt=0;be.mipmask>>lt;++lt)J.texImage2D(Rl+Fe,lt,be.format,Pt>>lt,Pt>>lt,0,be.format,be.type,null);return wa(),rr.profile&&(be.stats.size=Oi(be.internalformat,be.type,zt.width,zt.height,!1,!0)),zt}}return zt(We,lr,Qt,Pn,Fi,Re),zt.subimage=Zt,zt.resize=vt,zt._reglType="textureCube",zt._texture=be,rr.profile&&(zt.stats=be.stats),zt.destroy=function(){be.decRef()},zt}function xs(){for(var We=0;We<Xs;++We)J.activeTexture(ju+We),J.bindTexture(Es,null),Zo[We]=null;la(es).forEach(ui),pr.cubeCount=0,pr.textureCount=0}rr.profile&&(pr.getTotalTextureSize=function(){var We=0;return Object.keys(es).forEach(function(lr){We+=es[lr].stats.size}),We});function Ys(){for(var We=0;We<Xs;++We){var lr=Zo[We];lr&&(lr.bindCount=0,lr.unit=-1,Zo[We]=null)}la(es).forEach(function(Qt){Qt.texture=J.createTexture(),J.bindTexture(Qt.target,Qt.texture);for(var Pn=0;Pn<32;++Pn)if((Qt.mipmask&1<<Pn)!=0)if(Qt.target===Es)J.texImage2D(Es,Pn,Qt.internalformat,Qt.width>>Pn,Qt.height>>Pn,0,Qt.internalformat,Qt.type,null);else for(var Fi=0;Fi<6;++Fi)J.texImage2D(Rl+Fi,Pn,Qt.internalformat,Qt.width>>Pn,Qt.height>>Pn,0,Qt.internalformat,Qt.type,null);qo(Qt.texInfo,Qt.target)})}function Yl(){for(var We=0;We<Xs;++We){var lr=Zo[We];lr&&(lr.bindCount=0,lr.unit=-1,Zo[We]=null),J.activeTexture(ju+We),J.bindTexture(Es,null),J.bindTexture(sf,null)}}return{create2D:Li,createCube:ta,clear:xs,getTexture:function(lr){return null},restore:Ys,refresh:Yl}}var Xo=36161,Io=32854,_l=32855,Gu=36194,ru=33189,as=36168,Mu=34041,Bn=35907,On=34836,xc=34842,os=34843,bo=[];bo[Io]=2,bo[_l]=2,bo[Gu]=2,bo[ru]=2,bo[as]=1,bo[Mu]=4,bo[Bn]=4,bo[On]=16,bo[xc]=8,bo[os]=6;function Fo(J,fe,Ue){return bo[J]*fe*Ue}var Vs=function(fe,Ue,Jt,mr,pr){var rr={rgba4:Io,rgb565:Gu,"rgb5 a1":_l,depth:ru,stencil:as,"depth stencil":Mu};Ue.ext_srgb&&(rr.srgba=Bn),Ue.ext_color_buffer_half_float&&(rr.rgba16f=xc,rr.rgb16f=os),Ue.webgl_color_buffer_float&&(rr.rgba32f=On);var Zr=[];Object.keys(rr).forEach(function(rn){var or=rr[rn];Zr[or]=rn});var nn=0,zr={};function Jr(rn){this.id=nn++,this.refCount=1,this.renderbuffer=rn,this.format=Io,this.width=0,this.height=0,pr.profile&&(this.stats={size:0})}Jr.prototype.decRef=function(){--this.refCount<=0&&sn(this)};function sn(rn){var or=rn.renderbuffer;X(or,"must not double destroy renderbuffer"),fe.bindRenderbuffer(Xo,null),fe.deleteRenderbuffer(or),rn.renderbuffer=null,rn.refCount=0,delete zr[rn.id],mr.renderbufferCount--}function mn(rn,or){var er=new Jr(fe.createRenderbuffer());zr[er.id]=er,mr.renderbufferCount++;function Gr(Pr,Yn){var Kr=0,Br=0,Fr=Io;if(typeof Pr=="object"&&Pr){var Yr=Pr;if("shape"in Yr){var jn=Yr.shape;X(Array.isArray(jn)&&jn.length>=2,"invalid renderbuffer shape"),Kr=jn[0]|0,Br=jn[1]|0}else"radius"in Yr&&(Kr=Br=Yr.radius|0),"width"in Yr&&(Kr=Yr.width|0),"height"in Yr&&(Br=Yr.height|0);"format"in Yr&&(X.parameter(Yr.format,rr,"invalid renderbuffer format"),Fr=rr[Yr.format])}else typeof Pr=="number"?(Kr=Pr|0,typeof Yn=="number"?Br=Yn|0:Br=Kr):Pr?X.raise("invalid arguments to renderbuffer constructor"):Kr=Br=1;if(X(Kr>0&&Br>0&&Kr<=Jt.maxRenderbufferSize&&Br<=Jt.maxRenderbufferSize,"invalid renderbuffer size"),!(Kr===er.width&&Br===er.height&&Fr===er.format))return Gr.width=er.width=Kr,Gr.height=er.height=Br,er.format=Fr,fe.bindRenderbuffer(Xo,er.renderbuffer),fe.renderbufferStorage(Xo,Fr,Kr,Br),X(fe.getError()===0,"invalid render buffer format"),pr.profile&&(er.stats.size=Fo(er.format,er.width,er.height)),Gr.format=Zr[er.format],Gr}function En(Pr,Yn){var Kr=Pr|0,Br=Yn|0||Kr;return Kr===er.width&&Br===er.height||(X(Kr>0&&Br>0&&Kr<=Jt.maxRenderbufferSize&&Br<=Jt.maxRenderbufferSize,"invalid renderbuffer size"),Gr.width=er.width=Kr,Gr.height=er.height=Br,fe.bindRenderbuffer(Xo,er.renderbuffer),fe.renderbufferStorage(Xo,er.format,Kr,Br),X(fe.getError()===0,"invalid render buffer format"),pr.profile&&(er.stats.size=Fo(er.format,er.width,er.height))),Gr}return Gr(rn,or),Gr.resize=En,Gr._reglType="renderbuffer",Gr._renderbuffer=er,pr.profile&&(Gr.stats=er.stats),Gr.destroy=function(){er.decRef()},Gr}pr.profile&&(mr.getTotalRenderbufferSize=function(){var rn=0;return Object.keys(zr).forEach(function(or){rn+=zr[or].stats.size}),rn});function on(){la(zr).forEach(function(rn){rn.renderbuffer=fe.createRenderbuffer(),fe.bindRenderbuffer(Xo,rn.renderbuffer),fe.renderbufferStorage(Xo,rn.format,rn.width,rn.height)}),fe.bindRenderbuffer(Xo,null)}return{create:mn,clear:function(){la(zr).forEach(sn)},restore:on}},Gs=36160,Gl=36161,$i=3553,So=34069,ff=36064,xl=36096,bc=36128,Iu=33306,As=36053,bl=36054,Ou=36055,Sc=36057,ic=36061,Ec=36193,Yc=5121,ac=5126,al=6407,wc=6408,ma=6402,Hu=[al,wc],Sl=[];Sl[wc]=4,Sl[al]=3;var nu=[];nu[Yc]=1,nu[ac]=4,nu[Ec]=2;var Hs=32854,Tc=32855,oc=36194,hf=33189,$c=36168,c=34041,o=35907,i=34836,h=34842,g=34843,E=[Hs,Tc,oc,o,h,g,i],C={};C[As]="complete",C[bl]="incomplete attachment",C[Sc]="incomplete dimensions",C[Ou]="incomplete, missing attachment",C[ic]="unsupported";function L(J,fe,Ue,Jt,mr,pr){var rr={cur:null,next:null,dirty:!1,setFBO:null},Zr=["rgba"],nn=["rgba4","rgb565","rgb5 a1"];fe.ext_srgb&&nn.push("srgba"),fe.ext_color_buffer_half_float&&nn.push("rgba16f","rgb16f"),fe.webgl_color_buffer_float&&nn.push("rgba32f");var zr=["uint8"];fe.oes_texture_half_float&&zr.push("half float","float16"),fe.oes_texture_float&&zr.push("float","float32");function Jr(un,Ur,Dr){this.target=un,this.texture=Ur,this.renderbuffer=Dr;var ni=0,ii=0;Ur?(ni=Ur.width,ii=Ur.height):Dr&&(ni=Dr.width,ii=Dr.height),this.width=ni,this.height=ii}function sn(un){un&&(un.texture&&un.texture._texture.decRef(),un.renderbuffer&&un.renderbuffer._renderbuffer.decRef())}function mn(un,Ur,Dr){if(!!un)if(un.texture){var ni=un.texture._texture,ii=Math.max(1,ni.width),Rn=Math.max(1,ni.height);X(ii===Ur&&Rn===Dr,"inconsistent width/height for supplied texture"),ni.refCount+=1}else{var Ui=un.renderbuffer._renderbuffer;X(Ui.width===Ur&&Ui.height===Dr,"inconsistent width/height for renderbuffer"),Ui.refCount+=1}}function on(un,Ur){Ur&&(Ur.texture?J.framebufferTexture2D(Gs,un,Ur.target,Ur.texture._texture.texture,0):J.framebufferRenderbuffer(Gs,un,Gl,Ur.renderbuffer._renderbuffer.renderbuffer))}function rn(un){var Ur=$i,Dr=null,ni=null,ii=un;typeof un=="object"&&(ii=un.data,"target"in un&&(Ur=un.target|0)),X.type(ii,"function","invalid attachment data");var Rn=ii._reglType;return Rn==="texture2d"?(Dr=ii,X(Ur===$i)):Rn==="textureCube"?(Dr=ii,X(Ur>=So&&Ur<So+6,"invalid cube map target")):Rn==="renderbuffer"?(ni=ii,Ur=Gl):X.raise("invalid regl object for attachment"),new Jr(Ur,Dr,ni)}function or(un,Ur,Dr,ni,ii){if(Dr){var Rn=Jt.create2D({width:un,height:Ur,format:ni,type:ii});return Rn._texture.refCount=0,new Jr($i,Rn,null)}else{var Ui=mr.create({width:un,height:Ur,format:ni});return Ui._renderbuffer.refCount=0,new Jr(Gl,null,Ui)}}function er(un){return un&&(un.texture||un.renderbuffer)}function Gr(un,Ur,Dr){un&&(un.texture?un.texture.resize(Ur,Dr):un.renderbuffer&&un.renderbuffer.resize(Ur,Dr),un.width=Ur,un.height=Dr)}var En=0,Pr={};function Yn(){this.id=En++,Pr[this.id]=this,this.framebuffer=J.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Kr(un){un.colorAttachments.forEach(sn),sn(un.depthAttachment),sn(un.stencilAttachment),sn(un.depthStencilAttachment)}function Br(un){var Ur=un.framebuffer;X(Ur,"must not double destroy framebuffer"),J.deleteFramebuffer(Ur),un.framebuffer=null,pr.framebufferCount--,delete Pr[un.id]}function Fr(un){var Ur;J.bindFramebuffer(Gs,un.framebuffer);var Dr=un.colorAttachments;for(Ur=0;Ur<Dr.length;++Ur)on(ff+Ur,Dr[Ur]);for(Ur=Dr.length;Ur<Ue.maxColorAttachments;++Ur)J.framebufferTexture2D(Gs,ff+Ur,$i,null,0);J.framebufferTexture2D(Gs,Iu,$i,null,0),J.framebufferTexture2D(Gs,xl,$i,null,0),J.framebufferTexture2D(Gs,bc,$i,null,0),on(xl,un.depthAttachment),on(bc,un.stencilAttachment),on(Iu,un.depthStencilAttachment);var ni=J.checkFramebufferStatus(Gs);!J.isContextLost()&&ni!==As&&X.raise("framebuffer configuration not supported, status = "+C[ni]),J.bindFramebuffer(Gs,rr.next?rr.next.framebuffer:null),rr.cur=rr.next,J.getError()}function Yr(un,Ur){var Dr=new Yn;pr.framebufferCount++;function ni(Rn,Ui){var Mi;X(rr.next!==Dr,"can not update framebuffer which is currently in use");var ji=0,na=0,Qo=!0,Is=!0,ea=null,To=!0,qa="rgba",cs="uint8",qo=1,Os=null,es=null,Xs=null,Zo=!1;if(typeof Rn=="number")ji=Rn|0,na=Ui|0||ji;else if(!Rn)ji=na=1;else{X.type(Rn,"object","invalid arguments for framebuffer");var ki=Rn;if("shape"in ki){var Ks=ki.shape;X(Array.isArray(Ks)&&Ks.length>=2,"invalid shape for framebuffer"),ji=Ks[0],na=Ks[1]}else"radius"in ki&&(ji=na=ki.radius),"width"in ki&&(ji=ki.width),"height"in ki&&(na=ki.height);("color"in ki||"colors"in ki)&&(ea=ki.color||ki.colors,Array.isArray(ea)&&X(ea.length===1||fe.webgl_draw_buffers,"multiple render targets not supported")),ea||("colorCount"in ki&&(qo=ki.colorCount|0,X(qo>0,"invalid color buffer count")),"colorTexture"in ki&&(To=!!ki.colorTexture,qa="rgba4"),"colorType"in ki&&(cs=ki.colorType,To?(X(fe.oes_texture_float||!(cs==="float"||cs==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),X(fe.oes_texture_half_float||!(cs==="half float"||cs==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):cs==="half float"||cs==="float16"?(X(fe.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),qa="rgba16f"):(cs==="float"||cs==="float32")&&(X(fe.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),qa="rgba32f"),X.oneOf(cs,zr,"invalid color type")),"colorFormat"in ki&&(qa=ki.colorFormat,Zr.indexOf(qa)>=0?To=!0:nn.indexOf(qa)>=0?To=!1:To?X.oneOf(ki.colorFormat,Zr,"invalid color format for texture"):X.oneOf(ki.colorFormat,nn,"invalid color format for renderbuffer"))),("depthTexture"in ki||"depthStencilTexture"in ki)&&(Zo=!!(ki.depthTexture||ki.depthStencilTexture),X(!Zo||fe.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in ki&&(typeof ki.depth=="boolean"?Qo=ki.depth:(Os=ki.depth,Is=!1)),"stencil"in ki&&(typeof ki.stencil=="boolean"?Is=ki.stencil:(es=ki.stencil,Qo=!1)),"depthStencil"in ki&&(typeof ki.depthStencil=="boolean"?Qo=Is=ki.depthStencil:(Xs=ki.depthStencil,Qo=!1,Is=!1))}var wa=null,ui=null,Li=null,ta=null;if(Array.isArray(ea))wa=ea.map(rn);else if(ea)wa=[rn(ea)];else for(wa=new Array(qo),Mi=0;Mi<qo;++Mi)wa[Mi]=or(ji,na,To,qa,cs);X(fe.webgl_draw_buffers||wa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),X(wa.length<=Ue.maxColorAttachments,"too many color attachments, not supported"),ji=ji||wa[0].width,na=na||wa[0].height,Os?ui=rn(Os):Qo&&!Is&&(ui=or(ji,na,Zo,"depth","uint32")),es?Li=rn(es):Is&&!Qo&&(Li=or(ji,na,!1,"stencil","uint8")),Xs?ta=rn(Xs):!Os&&!es&&Is&&Qo&&(ta=or(ji,na,Zo,"depth stencil","depth stencil")),X(!!Os+!!es+!!Xs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var xs=null;for(Mi=0;Mi<wa.length;++Mi)if(mn(wa[Mi],ji,na),X(!wa[Mi]||wa[Mi].texture&&Hu.indexOf(wa[Mi].texture._texture.format)>=0||wa[Mi].renderbuffer&&E.indexOf(wa[Mi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Mi+" is invalid"),wa[Mi]&&wa[Mi].texture){var Ys=Sl[wa[Mi].texture._texture.format]*nu[wa[Mi].texture._texture.type];xs===null?xs=Ys:X(xs===Ys,"all color attachments much have the same number of bits per pixel.")}return mn(ui,ji,na),X(!ui||ui.texture&&ui.texture._texture.format===ma||ui.renderbuffer&&ui.renderbuffer._renderbuffer.format===hf,"invalid depth attachment for framebuffer object"),mn(Li,ji,na),X(!Li||Li.renderbuffer&&Li.renderbuffer._renderbuffer.format===$c,"invalid stencil attachment for framebuffer object"),mn(ta,ji,na),X(!ta||ta.texture&&ta.texture._texture.format===c||ta.renderbuffer&&ta.renderbuffer._renderbuffer.format===c,"invalid depth-stencil attachment for framebuffer object"),Kr(Dr),Dr.width=ji,Dr.height=na,Dr.colorAttachments=wa,Dr.depthAttachment=ui,Dr.stencilAttachment=Li,Dr.depthStencilAttachment=ta,ni.color=wa.map(er),ni.depth=er(ui),ni.stencil=er(Li),ni.depthStencil=er(ta),ni.width=Dr.width,ni.height=Dr.height,Fr(Dr),ni}function ii(Rn,Ui){X(rr.next!==Dr,"can not resize a framebuffer which is currently in use");var Mi=Math.max(Rn|0,1),ji=Math.max(Ui|0||Mi,1);if(Mi===Dr.width&&ji===Dr.height)return ni;for(var na=Dr.colorAttachments,Qo=0;Qo<na.length;++Qo)Gr(na[Qo],Mi,ji);return Gr(Dr.depthAttachment,Mi,ji),Gr(Dr.stencilAttachment,Mi,ji),Gr(Dr.depthStencilAttachment,Mi,ji),Dr.width=ni.width=Mi,Dr.height=ni.height=ji,Fr(Dr),ni}return ni(un,Ur),y(ni,{resize:ii,_reglType:"framebuffer",_framebuffer:Dr,destroy:function(){Br(Dr),Kr(Dr)},use:function(Ui){rr.setFBO({framebuffer:ni},Ui)}})}function jn(un){var Ur=Array(6);function Dr(ii){var Rn;X(Ur.indexOf(rr.next)<0,"can not update framebuffer which is currently in use");var Ui={color:null},Mi=0,ji=null,na="rgba",Qo="uint8",Is=1;if(typeof ii=="number")Mi=ii|0;else if(!ii)Mi=1;else{X.type(ii,"object","invalid arguments for framebuffer");var ea=ii;if("shape"in ea){var To=ea.shape;X(Array.isArray(To)&&To.length>=2,"invalid shape for framebuffer"),X(To[0]===To[1],"cube framebuffer must be square"),Mi=To[0]}else"radius"in ea&&(Mi=ea.radius|0),"width"in ea?(Mi=ea.width|0,"height"in ea&&X(ea.height===Mi,"must be square")):"height"in ea&&(Mi=ea.height|0);("color"in ea||"colors"in ea)&&(ji=ea.color||ea.colors,Array.isArray(ji)&&X(ji.length===1||fe.webgl_draw_buffers,"multiple render targets not supported")),ji||("colorCount"in ea&&(Is=ea.colorCount|0,X(Is>0,"invalid color buffer count")),"colorType"in ea&&(X.oneOf(ea.colorType,zr,"invalid color type"),Qo=ea.colorType),"colorFormat"in ea&&(na=ea.colorFormat,X.oneOf(ea.colorFormat,Zr,"invalid color format for texture"))),"depth"in ea&&(Ui.depth=ea.depth),"stencil"in ea&&(Ui.stencil=ea.stencil),"depthStencil"in ea&&(Ui.depthStencil=ea.depthStencil)}var qa;if(ji)if(Array.isArray(ji))for(qa=[],Rn=0;Rn<ji.length;++Rn)qa[Rn]=ji[Rn];else qa=[ji];else{qa=Array(Is);var cs={radius:Mi,format:na,type:Qo};for(Rn=0;Rn<Is;++Rn)qa[Rn]=Jt.createCube(cs)}for(Ui.color=Array(qa.length),Rn=0;Rn<qa.length;++Rn){var qo=qa[Rn];X(typeof qo=="function"&&qo._reglType==="textureCube","invalid cube map"),Mi=Mi||qo.width,X(qo.width===Mi&&qo.height===Mi,"invalid cube map shape"),Ui.color[Rn]={target:So,data:qa[Rn]}}for(Rn=0;Rn<6;++Rn){for(var Os=0;Os<qa.length;++Os)Ui.color[Os].target=So+Rn;Rn>0&&(Ui.depth=Ur[0].depth,Ui.stencil=Ur[0].stencil,Ui.depthStencil=Ur[0].depthStencil),Ur[Rn]?Ur[Rn](Ui):Ur[Rn]=Yr(Ui)}return y(Dr,{width:Mi,height:Mi,color:qa})}function ni(ii){var Rn,Ui=ii|0;if(X(Ui>0&&Ui<=Ue.maxCubeMapSize,"invalid radius for cube fbo"),Ui===Dr.width)return Dr;var Mi=Dr.color;for(Rn=0;Rn<Mi.length;++Rn)Mi[Rn].resize(Ui);for(Rn=0;Rn<6;++Rn)Ur[Rn].resize(Ui);return Dr.width=Dr.height=Ui,Dr}return Dr(un),y(Dr,{faces:Ur,resize:ni,_reglType:"framebufferCube",destroy:function(){Ur.forEach(function(Rn){Rn.destroy()})}})}function $n(){rr.cur=null,rr.next=null,rr.dirty=!0,la(Pr).forEach(function(un){un.framebuffer=J.createFramebuffer(),Fr(un)})}return y(rr,{getFramebuffer:function(Ur){if(typeof Ur=="function"&&Ur._reglType==="framebuffer"){var Dr=Ur._framebuffer;if(Dr instanceof Yn)return Dr}return null},create:Yr,createCube:jn,clear:function(){la(Pr).forEach(Br)},restore:$n})}var Z=5126,ne=34962;function me(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Z,this.offset=0,this.stride=0,this.divisor=0}function ye(J,fe,Ue,Jt,mr){for(var pr=Ue.maxAttributes,rr=new Array(pr),Zr=0;Zr<pr;++Zr)rr[Zr]=new me;var nn=0,zr={},Jr={Record:me,scope:{},state:rr,currentVAO:null,targetVAO:null,restore:mn()?Pr:function(){},createVAO:Yn,getVAO:rn,destroyBuffer:sn,setVAO:mn()?or:er,clear:mn()?Gr:function(){}};function sn(Kr){for(var Br=0;Br<rr.length;++Br){var Fr=rr[Br];Fr.buffer===Kr&&(J.disableVertexAttribArray(Br),Fr.buffer=null)}}function mn(){return fe.oes_vertex_array_object}function on(){return fe.angle_instanced_arrays}function rn(Kr){return typeof Kr=="function"&&Kr._vao?Kr._vao:null}function or(Kr){if(Kr!==Jr.currentVAO){var Br=mn();Kr?Br.bindVertexArrayOES(Kr.vao):Br.bindVertexArrayOES(null),Jr.currentVAO=Kr}}function er(Kr){if(Kr!==Jr.currentVAO){if(Kr)Kr.bindAttrs();else for(var Br=on(),Fr=0;Fr<rr.length;++Fr){var Yr=rr[Fr];Yr.buffer?(J.enableVertexAttribArray(Fr),J.vertexAttribPointer(Fr,Yr.size,Yr.type,Yr.normalized,Yr.stride,Yr.offfset),Br&&Yr.divisor&&Br.vertexAttribDivisorANGLE(Fr,Yr.divisor)):(J.disableVertexAttribArray(Fr),J.vertexAttrib4f(Fr,Yr.x,Yr.y,Yr.z,Yr.w))}Jr.currentVAO=Kr}}function Gr(){la(zr).forEach(function(Kr){Kr.destroy()})}function En(){this.id=++nn,this.attributes=[];var Kr=mn();Kr?this.vao=Kr.createVertexArrayOES():this.vao=null,zr[this.id]=this,this.buffers=[]}En.prototype.bindAttrs=function(){for(var Kr=on(),Br=this.attributes,Fr=0;Fr<Br.length;++Fr){var Yr=Br[Fr];Yr.buffer?(J.enableVertexAttribArray(Fr),J.bindBuffer(ne,Yr.buffer.buffer),J.vertexAttribPointer(Fr,Yr.size,Yr.type,Yr.normalized,Yr.stride,Yr.offset),Kr&&Yr.divisor&&Kr.vertexAttribDivisorANGLE(Fr,Yr.divisor)):(J.disableVertexAttribArray(Fr),J.vertexAttrib4f(Fr,Yr.x,Yr.y,Yr.z,Yr.w))}for(var jn=Br.length;jn<pr;++jn)J.disableVertexAttribArray(jn)},En.prototype.refresh=function(){var Kr=mn();Kr&&(Kr.bindVertexArrayOES(this.vao),this.bindAttrs(),Jr.currentVAO=this)},En.prototype.destroy=function(){if(this.vao){var Kr=mn();this===Jr.currentVAO&&(Jr.currentVAO=null,Kr.bindVertexArrayOES(null)),Kr.deleteVertexArrayOES(this.vao),this.vao=null}zr[this.id]&&(delete zr[this.id],Jt.vaoCount-=1)};function Pr(){var Kr=mn();Kr&&la(zr).forEach(function(Br){Br.refresh()})}function Yn(Kr){var Br=new En;Jt.vaoCount+=1;function Fr(Yr){X(Array.isArray(Yr),"arguments to vertex array constructor must be an array"),X(Yr.length<pr,"too many attributes"),X(Yr.length>0,"must specify at least one attribute");var jn={},$n=Br.attributes;$n.length=Yr.length;for(var un=0;un<Yr.length;++un){var Ur=Yr[un],Dr=$n[un]=new me,ni=Ur.data||Ur;if(Array.isArray(ni)||O(ni)||Ha(ni)){var ii;Br.buffers[un]&&(ii=Br.buffers[un],O(ni)&&ii._buffer.byteLength>=ni.byteLength?ii.subdata(ni):(ii.destroy(),Br.buffers[un]=null)),Br.buffers[un]||(ii=Br.buffers[un]=mr.create(Ur,ne,!1,!0)),Dr.buffer=mr.getBuffer(ii),Dr.size=Dr.buffer.dimension|0,Dr.normalized=!1,Dr.type=Dr.buffer.dtype,Dr.offset=0,Dr.stride=0,Dr.divisor=0,Dr.state=1,jn[un]=1}else mr.getBuffer(Ur)?(Dr.buffer=mr.getBuffer(Ur),Dr.size=Dr.buffer.dimension|0,Dr.normalized=!1,Dr.type=Dr.buffer.dtype,Dr.offset=0,Dr.stride=0,Dr.divisor=0,Dr.state=1):mr.getBuffer(Ur.buffer)?(Dr.buffer=mr.getBuffer(Ur.buffer),Dr.size=(+Ur.size||Dr.buffer.dimension)|0,Dr.normalized=!!Ur.normalized||!1,"type"in Ur?(X.parameter(Ur.type,ao,"invalid buffer type"),Dr.type=ao[Ur.type]):Dr.type=Dr.buffer.dtype,Dr.offset=(Ur.offset||0)|0,Dr.stride=(Ur.stride||0)|0,Dr.divisor=(Ur.divisor||0)|0,Dr.state=1,X(Dr.size>=1&&Dr.size<=4,"size must be between 1 and 4"),X(Dr.offset>=0,"invalid offset"),X(Dr.stride>=0&&Dr.stride<=255,"stride must be between 0 and 255"),X(Dr.divisor>=0,"divisor must be positive"),X(!Dr.divisor||!!fe.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Ur?(X(un>0,"first attribute must not be a constant"),Dr.x=+Ur.x||0,Dr.y=+Ur.y||0,Dr.z=+Ur.z||0,Dr.w=+Ur.w||0,Dr.state=2):X(!1,"invalid attribute spec for location "+un)}for(var Rn=0;Rn<Br.buffers.length;++Rn)!jn[Rn]&&Br.buffers[Rn]&&(Br.buffers[Rn].destroy(),Br.buffers[Rn]=null);return Br.refresh(),Fr}return Fr.destroy=function(){for(var Yr=0;Yr<Br.buffers.length;++Yr)Br.buffers[Yr]&&Br.buffers[Yr].destroy();Br.buffers.length=0,Br.destroy()},Fr._vao=Br,Fr._reglType="vao",Fr(Kr)}return Jr}var Se=35632,Ye=35633,Xe=35718,ct=35721;function $e(J,fe,Ue,Jt){var mr={},pr={};function rr(or,er,Gr,En){this.name=or,this.id=er,this.location=Gr,this.info=En}function Zr(or,er){for(var Gr=0;Gr<or.length;++Gr)if(or[Gr].id===er.id){or[Gr].location=er.location;return}or.push(er)}function nn(or,er,Gr){var En=or===Se?mr:pr,Pr=En[er];if(!Pr){var Yn=fe.str(er);Pr=J.createShader(or),J.shaderSource(Pr,Yn),J.compileShader(Pr),X.shaderError(J,Pr,Yn,or,Gr),En[er]=Pr}return Pr}var zr={},Jr=[],sn=0;function mn(or,er){this.id=sn++,this.fragId=or,this.vertId=er,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Jt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function on(or,er,Gr){var En,Pr,Yn=nn(Se,or.fragId),Kr=nn(Ye,or.vertId),Br=or.program=J.createProgram();if(J.attachShader(Br,Yn),J.attachShader(Br,Kr),Gr)for(En=0;En<Gr.length;++En){var Fr=Gr[En];J.bindAttribLocation(Br,Fr[0],Fr[1])}J.linkProgram(Br),X.linkError(J,Br,fe.str(or.fragId),fe.str(or.vertId),er);var Yr=J.getProgramParameter(Br,Xe);Jt.profile&&(or.stats.uniformsCount=Yr);var jn=or.uniforms;for(En=0;En<Yr;++En)if(Pr=J.getActiveUniform(Br,En),Pr)if(Pr.size>1)for(var $n=0;$n<Pr.size;++$n){var un=Pr.name.replace("[0]","["+$n+"]");Zr(jn,new rr(un,fe.id(un),J.getUniformLocation(Br,un),Pr))}else Zr(jn,new rr(Pr.name,fe.id(Pr.name),J.getUniformLocation(Br,Pr.name),Pr));var Ur=J.getProgramParameter(Br,ct);Jt.profile&&(or.stats.attributesCount=Ur);var Dr=or.attributes;for(En=0;En<Ur;++En)Pr=J.getActiveAttrib(Br,En),Pr&&Zr(Dr,new rr(Pr.name,fe.id(Pr.name),J.getAttribLocation(Br,Pr.name),Pr))}Jt.profile&&(Ue.getMaxUniformsCount=function(){var or=0;return Jr.forEach(function(er){er.stats.uniformsCount>or&&(or=er.stats.uniformsCount)}),or},Ue.getMaxAttributesCount=function(){var or=0;return Jr.forEach(function(er){er.stats.attributesCount>or&&(or=er.stats.attributesCount)}),or});function rn(){mr={},pr={};for(var or=0;or<Jr.length;++or)on(Jr[or],null,Jr[or].attributes.map(function(er){return[er.location,er.name]}))}return{clear:function(){var er=J.deleteShader.bind(J);la(mr).forEach(er),mr={},la(pr).forEach(er),pr={},Jr.forEach(function(Gr){J.deleteProgram(Gr.program)}),Jr.length=0,zr={},Ue.shaderCount=0},program:function(er,Gr,En,Pr){X.command(er>=0,"missing vertex shader",En),X.command(Gr>=0,"missing fragment shader",En);var Yn=zr[Gr];Yn||(Yn=zr[Gr]={});var Kr=Yn[er];if(Kr&&(Kr.refCount++,!Pr))return Kr;var Br=new mn(Gr,er);return Ue.shaderCount++,on(Br,En,Pr),Kr||(Yn[er]=Br),Jr.push(Br),y(Br,{destroy:function(){if(Br.refCount--,Br.refCount<=0){J.deleteProgram(Br.program);var Yr=Jr.indexOf(Br);Jr.splice(Yr,1),Ue.shaderCount--}Yn[Br.vertId].refCount<=0&&(J.deleteShader(pr[Br.vertId]),delete pr[Br.vertId],delete zr[Br.fragId][Br.vertId]),Object.keys(zr[Br.fragId]).length||(J.deleteShader(mr[Br.fragId]),delete mr[Br.fragId],delete zr[Br.fragId])}})},restore:rn,shader:nn,frag:-1,vert:-1}}var tt=6408,It=5121,Mt=3333,Sr=5126;function nr(J,fe,Ue,Jt,mr,pr,rr){function Zr(Jr){var sn;fe.next===null?(X(mr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),sn=It):(X(fe.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),sn=fe.next.colorAttachments[0].texture._texture.type,pr.oes_texture_float?(X(sn===It||sn===Sr,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),sn===Sr&&X(rr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):X(sn===It,"Reading from a framebuffer is only allowed for the type 'uint8'"));var mn=0,on=0,rn=Jt.framebufferWidth,or=Jt.framebufferHeight,er=null;O(Jr)?er=Jr:Jr&&(X.type(Jr,"object","invalid arguments to regl.read()"),mn=Jr.x|0,on=Jr.y|0,X(mn>=0&&mn<Jt.framebufferWidth,"invalid x offset for regl.read"),X(on>=0&&on<Jt.framebufferHeight,"invalid y offset for regl.read"),rn=(Jr.width||Jt.framebufferWidth-mn)|0,or=(Jr.height||Jt.framebufferHeight-on)|0,er=Jr.data||null),er&&(sn===It?X(er instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):sn===Sr&&X(er instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),X(rn>0&&rn+mn<=Jt.framebufferWidth,"invalid width for read pixels"),X(or>0&&or+on<=Jt.framebufferHeight,"invalid height for read pixels"),Ue();var Gr=rn*or*4;return er||(sn===It?er=new Uint8Array(Gr):sn===Sr&&(er=er||new Float32Array(Gr))),X.isTypedArray(er,"data buffer for regl.read() must be a typedarray"),X(er.byteLength>=Gr,"data buffer for regl.read() too small"),J.pixelStorei(Mt,4),J.readPixels(mn,on,rn,or,tt,sn,er),er}function nn(Jr){var sn;return fe.setFBO({framebuffer:Jr.framebuffer},function(){sn=Zr(Jr)}),sn}function zr(Jr){return!Jr||!("framebuffer"in Jr)?Zr(Jr):nn(Jr)}return zr}function xr(J){return Array.prototype.slice.call(J)}function Cr(J){return xr(J).join("")}function an(){var J=0,fe=[],Ue=[];function Jt(sn){for(var mn=0;mn<Ue.length;++mn)if(Ue[mn]===sn)return fe[mn];var on="g"+J++;return fe.push(on),Ue.push(sn),on}function mr(){var sn=[];function mn(){sn.push.apply(sn,xr(arguments))}var on=[];function rn(){var or="v"+J++;return on.push(or),arguments.length>0&&(sn.push(or,"="),sn.push.apply(sn,xr(arguments)),sn.push(";")),or}return y(mn,{def:rn,toString:function(){return Cr([on.length>0?"var "+on.join(",")+";":"",Cr(sn)])}})}function pr(){var sn=mr(),mn=mr(),on=sn.toString,rn=mn.toString;function or(er,Gr){mn(er,Gr,"=",sn.def(er,Gr),";")}return y(function(){sn.apply(sn,xr(arguments))},{def:sn.def,entry:sn,exit:mn,save:or,set:function(Gr,En,Pr){or(Gr,En),sn(Gr,En,"=",Pr,";")},toString:function(){return on()+rn()}})}function rr(){var sn=Cr(arguments),mn=pr(),on=pr(),rn=mn.toString,or=on.toString;return y(mn,{then:function(){return mn.apply(mn,xr(arguments)),this},else:function(){return on.apply(on,xr(arguments)),this},toString:function(){var Gr=or();return Gr&&(Gr="else{"+Gr+"}"),Cr(["if(",sn,"){",rn(),"}",Gr])}})}var Zr=mr(),nn={};function zr(sn,mn){var on=[];function rn(){var Pr="a"+on.length;return on.push(Pr),Pr}mn=mn||0;for(var or=0;or<mn;++or)rn();var er=pr(),Gr=er.toString,En=nn[sn]=y(er,{arg:rn,toString:function(){return Cr(["function(",on.join(),"){",Gr(),"}"])}});return En}function Jr(){var sn=['"use strict";',Zr,"return {"];Object.keys(nn).forEach(function(rn){sn.push('"',rn,'":',nn[rn].toString(),",")}),sn.push("}");var mn=Cr(sn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),on=Function.apply(null,fe.concat(mn));return on.apply(null,Ue)}return{global:Zr,link:Jt,block:mr,proc:zr,scope:pr,cond:rr,compile:Jr}}var Xr="xyzw".split(""),vn=5121,An=1,Xn=2,Qn=0,Ci=1,Ji=2,Sn=3,fi=4,gi=5,Un=6,di="dither",Kn="blend.enable",Si="blend.color",Gi="blend.equation",yo="blend.func",uo="depth.enable",Oo="depth.func",Ua="depth.range",Xa="depth.mask",Cs="colorMask",Ko="cull.enable",Wu="cull.face",Lu="frontFace",ss="lineWidth",zs="polygonOffset.enable",El="polygonOffset.offset",Ac="sample.alpha",Ru="sample.enable",ol="sample.coverage",Hl="stencil.enable",Du="stencil.mask",sc="stencil.func",fu="stencil.opFront",lo="stencil.opBack",hu="scissor.enable",wl="scissor.box",Ps="viewport",Eo="profile",No="framebuffer",Lo="vert",us="frag",Ro="elements",Ws="primitive",Tl="count",uc="offset",Xu="instances",ku="vao",Cc="Width",Al="Height",Ms=No+Cc,zo=No+Al,xh=Ps+Cc,Jf=Ps+Al,Qf="drawingBuffer",Ff=Qf+Cc,Af=Qf+Al,Jc=[yo,Gi,sc,fu,lo,ol,Ps,wl,El],Wl=34962,Cf=34963,Qc=35632,Nf=35633,Cl=3553,qc=34067,zf=2884,bh=3042,qf=3024,eh=2960,Bf=2929,th=3089,rh=32823,Uf=32926,Sh=32928,pu=5126,pf=35664,co=35665,Pc=35666,Pf=5124,Mc=35667,lc=35668,Xl=35669,B=35670,U=35671,M=35672,R=35673,ee=35674,ge=35675,rt=35676,wt=35678,Et=35680,vr=4,Vr=1028,In=1029,Nn=2304,si=2305,Pi=32775,Ei=32776,pa=519,wi=7680,ja=0,Bo=1,Uo=32774,Yo=513,fo=36160,Sa=36064,ga={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},wo=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ho={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Za={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},$o={frag:Qc,vert:Nf},Jo={cw:Nn,ccw:si};function Ic(J){return Array.isArray(J)||O(J)||Ha(J)}function Kl(J){return J.sort(function(fe,Ue){return fe===Ps?-1:Ue===Ps?1:fe<Ue?-1:1})}function _s(J,fe,Ue,Jt){this.thisDep=J,this.contextDep=fe,this.propDep=Ue,this.append=Jt}function Bs(J){return J&&!(J.thisDep||J.contextDep||J.propDep)}function jo(J){return new _s(!1,!1,!1,J)}function Fu(J,fe){var Ue=J.type;if(Ue===Qn){var Jt=J.data.length;return new _s(!0,Jt>=1,Jt>=2,fe)}else if(Ue===fi){var mr=J.data;return new _s(mr.thisDep,mr.contextDep,mr.propDep,fe)}else{if(Ue===gi)return new _s(!1,!1,!1,fe);if(Ue===Un){for(var pr=!1,rr=!1,Zr=!1,nn=0;nn<J.data.length;++nn){var zr=J.data[nn];if(zr.type===Ci)Zr=!0;else if(zr.type===Ji)rr=!0;else if(zr.type===Sn)pr=!0;else if(zr.type===Qn){pr=!0;var Jr=zr.data;Jr>=1&&(rr=!0),Jr>=2&&(Zr=!0)}else zr.type===fi&&(pr=pr||zr.data.thisDep,rr=rr||zr.data.contextDep,Zr=Zr||zr.data.propDep)}return new _s(pr,rr,Zr,fe)}else return new _s(Ue===Sn,Ue===Ji,Ue===Ci,fe)}}var Eh=new _s(!1,!1,!1,function(){});function Jh(J,fe,Ue,Jt,mr,pr,rr,Zr,nn,zr,Jr,sn,mn,on,rn){var or=zr.Record,er={add:32774,subtract:32778,"reverse subtract":32779};Ue.ext_blend_minmax&&(er.min=Pi,er.max=Ei);var Gr=Ue.angle_instanced_arrays,En=Ue.webgl_draw_buffers,Pr={dirty:!0,profile:rn.profile},Yn={},Kr=[],Br={},Fr={};function Yr(Re){return Re.replace(".","_")}function jn(Re,be,ht){var zt=Yr(Re);Kr.push(Re),Yn[zt]=Pr[zt]=!!ht,Br[zt]=be}function $n(Re,be,ht){var zt=Yr(Re);Kr.push(Re),Array.isArray(ht)?(Pr[zt]=ht.slice(),Yn[zt]=ht.slice()):Pr[zt]=Yn[zt]=ht,Fr[zt]=be}jn(di,qf),jn(Kn,bh),$n(Si,"blendColor",[0,0,0,0]),$n(Gi,"blendEquationSeparate",[Uo,Uo]),$n(yo,"blendFuncSeparate",[Bo,ja,Bo,ja]),jn(uo,Bf,!0),$n(Oo,"depthFunc",Yo),$n(Ua,"depthRange",[0,1]),$n(Xa,"depthMask",!0),$n(Cs,Cs,[!0,!0,!0,!0]),jn(Ko,zf),$n(Wu,"cullFace",In),$n(Lu,Lu,si),$n(ss,ss,1),jn(zs,rh),$n(El,"polygonOffset",[0,0]),jn(Ac,Uf),jn(Ru,Sh),$n(ol,"sampleCoverage",[1,!1]),jn(Hl,eh),$n(Du,"stencilMask",-1),$n(sc,"stencilFunc",[pa,0,-1]),$n(fu,"stencilOpSeparate",[Vr,wi,wi,wi]),$n(lo,"stencilOpSeparate",[In,wi,wi,wi]),jn(hu,th),$n(wl,"scissor",[0,0,J.drawingBufferWidth,J.drawingBufferHeight]),$n(Ps,Ps,[0,0,J.drawingBufferWidth,J.drawingBufferHeight]);var un={gl:J,context:mn,strings:fe,next:Yn,current:Pr,draw:sn,elements:pr,buffer:mr,shader:Jr,attributes:zr.state,vao:zr,uniforms:nn,framebuffer:Zr,extensions:Ue,timer:on,isBufferArgs:Ic},Ur={primTypes:ha,compareFuncs:ho,blendFuncs:ga,blendEquations:er,stencilOps:Za,glTypes:ao,orientationType:Jo};X.optional(function(){un.isArrayLike=go}),En&&(Ur.backBuffer=[In],Ur.drawBuffer=I(Jt.maxDrawbuffers,function(Re){return Re===0?[0]:I(Re,function(be){return Sa+be})}));var Dr=0;function ni(){var Re=an(),be=Re.link,ht=Re.global;Re.id=Dr++,Re.batchId="0";var zt=be(un),Zt=Re.shared={props:"a0"};Object.keys(un).forEach(function(lt){Zt[lt]=ht.def(zt,".",lt)}),X.optional(function(){Re.CHECK=be(X),Re.commandStr=X.guessCommand(),Re.command=be(Re.commandStr),Re.assert=function(lt,Ce,kt){lt("if(!(",Ce,"))",this.CHECK,".commandRaise(",be(kt),",",this.command,");")},Ur.invalidBlendCombinations=wo});var vt=Re.next={},pt=Re.current={};Object.keys(Fr).forEach(function(lt){Array.isArray(Pr[lt])&&(vt[lt]=ht.def(Zt.next,".",lt),pt[lt]=ht.def(Zt.current,".",lt))});var Pt=Re.constants={};Object.keys(Ur).forEach(function(lt){Pt[lt]=ht.def(JSON.stringify(Ur[lt]))}),Re.invoke=function(lt,Ce){switch(Ce.type){case Qn:var kt=["this",Zt.context,Zt.props,Re.batchId];return lt.def(be(Ce.data),".call(",kt.slice(0,Math.max(Ce.data.length+1,4)),")");case Ci:return lt.def(Zt.props,Ce.data);case Ji:return lt.def(Zt.context,Ce.data);case Sn:return lt.def("this",Ce.data);case fi:return Ce.data.append(Re,lt),Ce.data.ref;case gi:return Ce.data.toString();case Un:return Ce.data.map(function(Ht){return Re.invoke(lt,Ht)})}},Re.attribCache={};var Fe={};return Re.scopeAttrib=function(lt){var Ce=fe.id(lt);if(Ce in Fe)return Fe[Ce];var kt=zr.scope[Ce];kt||(kt=zr.scope[Ce]=new or);var Ht=Fe[Ce]=be(kt);return Ht},Re}function ii(Re){var be=Re.static,ht=Re.dynamic,zt;if(Eo in be){var Zt=!!be[Eo];zt=jo(function(pt,Pt){return Zt}),zt.enable=Zt}else if(Eo in ht){var vt=ht[Eo];zt=Fu(vt,function(pt,Pt){return pt.invoke(Pt,vt)})}return zt}function Rn(Re,be){var ht=Re.static,zt=Re.dynamic;if(No in ht){var Zt=ht[No];return Zt?(Zt=Zr.getFramebuffer(Zt),X.command(Zt,"invalid framebuffer object"),jo(function(pt,Pt){var Fe=pt.link(Zt),lt=pt.shared;Pt.set(lt.framebuffer,".next",Fe);var Ce=lt.context;return Pt.set(Ce,"."+Ms,Fe+".width"),Pt.set(Ce,"."+zo,Fe+".height"),Fe})):jo(function(pt,Pt){var Fe=pt.shared;Pt.set(Fe.framebuffer,".next","null");var lt=Fe.context;return Pt.set(lt,"."+Ms,lt+"."+Ff),Pt.set(lt,"."+zo,lt+"."+Af),"null"})}else if(No in zt){var vt=zt[No];return Fu(vt,function(pt,Pt){var Fe=pt.invoke(Pt,vt),lt=pt.shared,Ce=lt.framebuffer,kt=Pt.def(Ce,".getFramebuffer(",Fe,")");X.optional(function(){pt.assert(Pt,"!"+Fe+"||"+kt,"invalid framebuffer object")}),Pt.set(Ce,".next",kt);var Ht=lt.context;return Pt.set(Ht,"."+Ms,kt+"?"+kt+".width:"+Ht+"."+Ff),Pt.set(Ht,"."+zo,kt+"?"+kt+".height:"+Ht+"."+Af),kt})}else return null}function Ui(Re,be,ht){var zt=Re.static,Zt=Re.dynamic;function vt(Fe){if(Fe in zt){var lt=zt[Fe];X.commandType(lt,"object","invalid "+Fe,ht.commandStr);var Ce=!0,kt=lt.x|0,Ht=lt.y|0,Mr,ur;return"width"in lt?(Mr=lt.width|0,X.command(Mr>=0,"invalid "+Fe,ht.commandStr)):Ce=!1,"height"in lt?(ur=lt.height|0,X.command(ur>=0,"invalid "+Fe,ht.commandStr)):Ce=!1,new _s(!Ce&&be&&be.thisDep,!Ce&&be&&be.contextDep,!Ce&&be&&be.propDep,function(Vn,Ri){var zn=Vn.shared.context,ti=Mr;"width"in lt||(ti=Ri.def(zn,".",Ms,"-",kt));var yi=ur;return"height"in lt||(yi=Ri.def(zn,".",zo,"-",Ht)),[kt,Ht,ti,yi]})}else if(Fe in Zt){var Tr=Zt[Fe],Qr=Fu(Tr,function(Vn,Ri){var zn=Vn.invoke(Ri,Tr);X.optional(function(){Vn.assert(Ri,zn+"&&typeof "+zn+'==="object"',"invalid "+Fe)});var ti=Vn.shared.context,yi=Ri.def(zn,".x|0"),da=Ri.def(zn,".y|0"),Vo=Ri.def('"width" in ',zn,"?",zn,".width|0:","(",ti,".",Ms,"-",yi,")"),Nu=Ri.def('"height" in ',zn,"?",zn,".height|0:","(",ti,".",zo,"-",da,")");return X.optional(function(){Vn.assert(Ri,Vo+">=0&&"+Nu+">=0","invalid "+Fe)}),[yi,da,Vo,Nu]});return be&&(Qr.thisDep=Qr.thisDep||be.thisDep,Qr.contextDep=Qr.contextDep||be.contextDep,Qr.propDep=Qr.propDep||be.propDep),Qr}else return be?new _s(be.thisDep,be.contextDep,be.propDep,function(Vn,Ri){var zn=Vn.shared.context;return[0,0,Ri.def(zn,".",Ms),Ri.def(zn,".",zo)]}):null}var pt=vt(Ps);if(pt){var Pt=pt;pt=new _s(pt.thisDep,pt.contextDep,pt.propDep,function(Fe,lt){var Ce=Pt.append(Fe,lt),kt=Fe.shared.context;return lt.set(kt,"."+xh,Ce[2]),lt.set(kt,"."+Jf,Ce[3]),Ce})}return{viewport:pt,scissor_box:vt(wl)}}function Mi(Re,be){var ht=Re.static,zt=typeof ht[us]=="string"&&typeof ht[Lo]=="string";if(zt){if(Object.keys(be.dynamic).length>0)return null;var Zt=be.static,vt=Object.keys(Zt);if(vt.length>0&&typeof Zt[vt[0]]=="number"){for(var pt=[],Pt=0;Pt<vt.length;++Pt)X(typeof Zt[vt[Pt]]=="number","must specify all vertex attribute locations when using vaos"),pt.push([Zt[vt[Pt]]|0,vt[Pt]]);return pt}}return null}function ji(Re,be,ht){var zt=Re.static,Zt=Re.dynamic;function vt(Ce){if(Ce in zt){var kt=fe.id(zt[Ce]);X.optional(function(){Jr.shader($o[Ce],kt,X.guessCommand())});var Ht=jo(function(){return kt});return Ht.id=kt,Ht}else if(Ce in Zt){var Mr=Zt[Ce];return Fu(Mr,function(ur,Tr){var Qr=ur.invoke(Tr,Mr),Vn=Tr.def(ur.shared.strings,".id(",Qr,")");return X.optional(function(){Tr(ur.shared.shader,".shader(",$o[Ce],",",Vn,",",ur.command,");")}),Vn})}return null}var pt=vt(us),Pt=vt(Lo),Fe=null,lt;return Bs(pt)&&Bs(Pt)?(Fe=Jr.program(Pt.id,pt.id,null,ht),lt=jo(function(Ce,kt){return Ce.link(Fe)})):lt=new _s(pt&&pt.thisDep||Pt&&Pt.thisDep,pt&&pt.contextDep||Pt&&Pt.contextDep,pt&&pt.propDep||Pt&&Pt.propDep,function(Ce,kt){var Ht=Ce.shared.shader,Mr;pt?Mr=pt.append(Ce,kt):Mr=kt.def(Ht,".",us);var ur;Pt?ur=Pt.append(Ce,kt):ur=kt.def(Ht,".",Lo);var Tr=Ht+".program("+ur+","+Mr;return X.optional(function(){Tr+=","+Ce.command}),kt.def(Tr+")")}),{frag:pt,vert:Pt,progVar:lt,program:Fe}}function na(Re,be){var ht=Re.static,zt=Re.dynamic;function Zt(){if(Ro in ht){var Ce=ht[Ro];Ic(Ce)?Ce=pr.getElements(pr.create(Ce,!0)):Ce&&(Ce=pr.getElements(Ce),X.command(Ce,"invalid elements",be.commandStr));var kt=jo(function(Mr,ur){if(Ce){var Tr=Mr.link(Ce);return Mr.ELEMENTS=Tr,Tr}return Mr.ELEMENTS=null,null});return kt.value=Ce,kt}else if(Ro in zt){var Ht=zt[Ro];return Fu(Ht,function(Mr,ur){var Tr=Mr.shared,Qr=Tr.isBufferArgs,Vn=Tr.elements,Ri=Mr.invoke(ur,Ht),zn=ur.def("null"),ti=ur.def(Qr,"(",Ri,")"),yi=Mr.cond(ti).then(zn,"=",Vn,".createStream(",Ri,");").else(zn,"=",Vn,".getElements(",Ri,");");return X.optional(function(){Mr.assert(yi.else,"!"+Ri+"||"+zn,"invalid elements")}),ur.entry(yi),ur.exit(Mr.cond(ti).then(Vn,".destroyStream(",zn,");")),Mr.ELEMENTS=zn,zn})}return null}var vt=Zt();function pt(){if(Ws in ht){var Ce=ht[Ws];return X.commandParameter(Ce,ha,"invalid primitve",be.commandStr),jo(function(Ht,Mr){return ha[Ce]})}else if(Ws in zt){var kt=zt[Ws];return Fu(kt,function(Ht,Mr){var ur=Ht.constants.primTypes,Tr=Ht.invoke(Mr,kt);return X.optional(function(){Ht.assert(Mr,Tr+" in "+ur,"invalid primitive, must be one of "+Object.keys(ha))}),Mr.def(ur,"[",Tr,"]")})}else if(vt)return Bs(vt)?vt.value?jo(function(Ht,Mr){return Mr.def(Ht.ELEMENTS,".primType")}):jo(function(){return vr}):new _s(vt.thisDep,vt.contextDep,vt.propDep,function(Ht,Mr){var ur=Ht.ELEMENTS;return Mr.def(ur,"?",ur,".primType:",vr)});return null}function Pt(Ce,kt){if(Ce in ht){var Ht=ht[Ce]|0;return X.command(!kt||Ht>=0,"invalid "+Ce,be.commandStr),jo(function(ur,Tr){return kt&&(ur.OFFSET=Ht),Ht})}else if(Ce in zt){var Mr=zt[Ce];return Fu(Mr,function(ur,Tr){var Qr=ur.invoke(Tr,Mr);return kt&&(ur.OFFSET=Qr,X.optional(function(){ur.assert(Tr,Qr+">=0","invalid "+Ce)})),Qr})}else if(kt&&vt)return jo(function(ur,Tr){return ur.OFFSET="0",0});return null}var Fe=Pt(uc,!0);function lt(){if(Tl in ht){var Ce=ht[Tl]|0;return X.command(typeof Ce=="number"&&Ce>=0,"invalid vertex count",be.commandStr),jo(function(){return Ce})}else if(Tl in zt){var kt=zt[Tl];return Fu(kt,function(ur,Tr){var Qr=ur.invoke(Tr,kt);return X.optional(function(){ur.assert(Tr,"typeof "+Qr+'==="number"&&'+Qr+">=0&&"+Qr+"===("+Qr+"|0)","invalid vertex count")}),Qr})}else if(vt)if(Bs(vt)){if(vt)return Fe?new _s(Fe.thisDep,Fe.contextDep,Fe.propDep,function(ur,Tr){var Qr=Tr.def(ur.ELEMENTS,".vertCount-",ur.OFFSET);return X.optional(function(){ur.assert(Tr,Qr+">=0","invalid vertex offset/element buffer too small")}),Qr}):jo(function(ur,Tr){return Tr.def(ur.ELEMENTS,".vertCount")});var Ht=jo(function(){return-1});return X.optional(function(){Ht.MISSING=!0}),Ht}else{var Mr=new _s(vt.thisDep||Fe.thisDep,vt.contextDep||Fe.contextDep,vt.propDep||Fe.propDep,function(ur,Tr){var Qr=ur.ELEMENTS;return ur.OFFSET?Tr.def(Qr,"?",Qr,".vertCount-",ur.OFFSET,":-1"):Tr.def(Qr,"?",Qr,".vertCount:-1")});return X.optional(function(){Mr.DYNAMIC=!0}),Mr}return null}return{elements:vt,primitive:pt(),count:lt(),instances:Pt(Xu,!1),offset:Fe}}function Qo(Re,be){var ht=Re.static,zt=Re.dynamic,Zt={};return Kr.forEach(function(vt){var pt=Yr(vt);function Pt(Fe,lt){if(vt in ht){var Ce=Fe(ht[vt]);Zt[pt]=jo(function(){return Ce})}else if(vt in zt){var kt=zt[vt];Zt[pt]=Fu(kt,function(Ht,Mr){return lt(Ht,Mr,Ht.invoke(Mr,kt))})}}switch(vt){case Ko:case Kn:case di:case Hl:case uo:case hu:case zs:case Ac:case Ru:case Xa:return Pt(function(Fe){return X.commandType(Fe,"boolean",vt,be.commandStr),Fe},function(Fe,lt,Ce){return X.optional(function(){Fe.assert(lt,"typeof "+Ce+'==="boolean"',"invalid flag "+vt,Fe.commandStr)}),Ce});case Oo:return Pt(function(Fe){return X.commandParameter(Fe,ho,"invalid "+vt,be.commandStr),ho[Fe]},function(Fe,lt,Ce){var kt=Fe.constants.compareFuncs;return X.optional(function(){Fe.assert(lt,Ce+" in "+kt,"invalid "+vt+", must be one of "+Object.keys(ho))}),lt.def(kt,"[",Ce,"]")});case Ua:return Pt(function(Fe){return X.command(go(Fe)&&Fe.length===2&&typeof Fe[0]=="number"&&typeof Fe[1]=="number"&&Fe[0]<=Fe[1],"depth range is 2d array",be.commandStr),Fe},function(Fe,lt,Ce){X.optional(function(){Fe.assert(lt,Fe.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===2&&typeof "+Ce+'[0]==="number"&&typeof '+Ce+'[1]==="number"&&'+Ce+"[0]<="+Ce+"[1]","depth range must be a 2d array")});var kt=lt.def("+",Ce,"[0]"),Ht=lt.def("+",Ce,"[1]");return[kt,Ht]});case yo:return Pt(function(Fe){X.commandType(Fe,"object","blend.func",be.commandStr);var lt="srcRGB"in Fe?Fe.srcRGB:Fe.src,Ce="srcAlpha"in Fe?Fe.srcAlpha:Fe.src,kt="dstRGB"in Fe?Fe.dstRGB:Fe.dst,Ht="dstAlpha"in Fe?Fe.dstAlpha:Fe.dst;return X.commandParameter(lt,ga,pt+".srcRGB",be.commandStr),X.commandParameter(Ce,ga,pt+".srcAlpha",be.commandStr),X.commandParameter(kt,ga,pt+".dstRGB",be.commandStr),X.commandParameter(Ht,ga,pt+".dstAlpha",be.commandStr),X.command(wo.indexOf(lt+", "+kt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+lt+", "+kt+")",be.commandStr),[ga[lt],ga[kt],ga[Ce],ga[Ht]]},function(Fe,lt,Ce){var kt=Fe.constants.blendFuncs;X.optional(function(){Fe.assert(lt,Ce+"&&typeof "+Ce+'==="object"',"invalid blend func, must be an object")});function Ht(zn,ti){var yi=lt.def('"',zn,ti,'" in ',Ce,"?",Ce,".",zn,ti,":",Ce,".",zn);return X.optional(function(){Fe.assert(lt,yi+" in "+kt,"invalid "+vt+"."+zn+ti+", must be one of "+Object.keys(ga))}),yi}var Mr=Ht("src","RGB"),ur=Ht("dst","RGB");X.optional(function(){var zn=Fe.constants.invalidBlendCombinations;Fe.assert(lt,zn+".indexOf("+Mr+'+", "+'+ur+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Tr=lt.def(kt,"[",Mr,"]"),Qr=lt.def(kt,"[",Ht("src","Alpha"),"]"),Vn=lt.def(kt,"[",ur,"]"),Ri=lt.def(kt,"[",Ht("dst","Alpha"),"]");return[Tr,Vn,Qr,Ri]});case Gi:return Pt(function(Fe){if(typeof Fe=="string")return X.commandParameter(Fe,er,"invalid "+vt,be.commandStr),[er[Fe],er[Fe]];if(typeof Fe=="object")return X.commandParameter(Fe.rgb,er,vt+".rgb",be.commandStr),X.commandParameter(Fe.alpha,er,vt+".alpha",be.commandStr),[er[Fe.rgb],er[Fe.alpha]];X.commandRaise("invalid blend.equation",be.commandStr)},function(Fe,lt,Ce){var kt=Fe.constants.blendEquations,Ht=lt.def(),Mr=lt.def(),ur=Fe.cond("typeof ",Ce,'==="string"');return X.optional(function(){function Tr(Qr,Vn,Ri){Fe.assert(Qr,Ri+" in "+kt,"invalid "+Vn+", must be one of "+Object.keys(er))}Tr(ur.then,vt,Ce),Fe.assert(ur.else,Ce+"&&typeof "+Ce+'==="object"',"invalid "+vt),Tr(ur.else,vt+".rgb",Ce+".rgb"),Tr(ur.else,vt+".alpha",Ce+".alpha")}),ur.then(Ht,"=",Mr,"=",kt,"[",Ce,"];"),ur.else(Ht,"=",kt,"[",Ce,".rgb];",Mr,"=",kt,"[",Ce,".alpha];"),lt(ur),[Ht,Mr]});case Si:return Pt(function(Fe){return X.command(go(Fe)&&Fe.length===4,"blend.color must be a 4d array",be.commandStr),I(4,function(lt){return+Fe[lt]})},function(Fe,lt,Ce){return X.optional(function(){Fe.assert(lt,Fe.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","blend.color must be a 4d array")}),I(4,function(kt){return lt.def("+",Ce,"[",kt,"]")})});case Du:return Pt(function(Fe){return X.commandType(Fe,"number",pt,be.commandStr),Fe|0},function(Fe,lt,Ce){return X.optional(function(){Fe.assert(lt,"typeof "+Ce+'==="number"',"invalid stencil.mask")}),lt.def(Ce,"|0")});case sc:return Pt(function(Fe){X.commandType(Fe,"object",pt,be.commandStr);var lt=Fe.cmp||"keep",Ce=Fe.ref||0,kt="mask"in Fe?Fe.mask:-1;return X.commandParameter(lt,ho,vt+".cmp",be.commandStr),X.commandType(Ce,"number",vt+".ref",be.commandStr),X.commandType(kt,"number",vt+".mask",be.commandStr),[ho[lt],Ce,kt]},function(Fe,lt,Ce){var kt=Fe.constants.compareFuncs;X.optional(function(){function Tr(){Fe.assert(lt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Tr(Ce+"&&typeof ",Ce,'==="object"'),Tr('!("cmp" in ',Ce,")||(",Ce,".cmp in ",kt,")")});var Ht=lt.def('"cmp" in ',Ce,"?",kt,"[",Ce,".cmp]",":",wi),Mr=lt.def(Ce,".ref|0"),ur=lt.def('"mask" in ',Ce,"?",Ce,".mask|0:-1");return[Ht,Mr,ur]});case fu:case lo:return Pt(function(Fe){X.commandType(Fe,"object",pt,be.commandStr);var lt=Fe.fail||"keep",Ce=Fe.zfail||"keep",kt=Fe.zpass||"keep";return X.commandParameter(lt,Za,vt+".fail",be.commandStr),X.commandParameter(Ce,Za,vt+".zfail",be.commandStr),X.commandParameter(kt,Za,vt+".zpass",be.commandStr),[vt===lo?In:Vr,Za[lt],Za[Ce],Za[kt]]},function(Fe,lt,Ce){var kt=Fe.constants.stencilOps;X.optional(function(){Fe.assert(lt,Ce+"&&typeof "+Ce+'==="object"',"invalid "+vt)});function Ht(Mr){return X.optional(function(){Fe.assert(lt,'!("'+Mr+'" in '+Ce+")||("+Ce+"."+Mr+" in "+kt+")","invalid "+vt+"."+Mr+", must be one of "+Object.keys(Za))}),lt.def('"',Mr,'" in ',Ce,"?",kt,"[",Ce,".",Mr,"]:",wi)}return[vt===lo?In:Vr,Ht("fail"),Ht("zfail"),Ht("zpass")]});case El:return Pt(function(Fe){X.commandType(Fe,"object",pt,be.commandStr);var lt=Fe.factor|0,Ce=Fe.units|0;return X.commandType(lt,"number",pt+".factor",be.commandStr),X.commandType(Ce,"number",pt+".units",be.commandStr),[lt,Ce]},function(Fe,lt,Ce){X.optional(function(){Fe.assert(lt,Ce+"&&typeof "+Ce+'==="object"',"invalid "+vt)});var kt=lt.def(Ce,".factor|0"),Ht=lt.def(Ce,".units|0");return[kt,Ht]});case Wu:return Pt(function(Fe){var lt=0;return Fe==="front"?lt=Vr:Fe==="back"&&(lt=In),X.command(!!lt,pt,be.commandStr),lt},function(Fe,lt,Ce){return X.optional(function(){Fe.assert(lt,Ce+'==="front"||'+Ce+'==="back"',"invalid cull.face")}),lt.def(Ce,'==="front"?',Vr,":",In)});case ss:return Pt(function(Fe){return X.command(typeof Fe=="number"&&Fe>=Jt.lineWidthDims[0]&&Fe<=Jt.lineWidthDims[1],"invalid line width, must be a positive number between "+Jt.lineWidthDims[0]+" and "+Jt.lineWidthDims[1],be.commandStr),Fe},function(Fe,lt,Ce){return X.optional(function(){Fe.assert(lt,"typeof "+Ce+'==="number"&&'+Ce+">="+Jt.lineWidthDims[0]+"&&"+Ce+"<="+Jt.lineWidthDims[1],"invalid line width")}),Ce});case Lu:return Pt(function(Fe){return X.commandParameter(Fe,Jo,pt,be.commandStr),Jo[Fe]},function(Fe,lt,Ce){return X.optional(function(){Fe.assert(lt,Ce+'==="cw"||'+Ce+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),lt.def(Ce+'==="cw"?'+Nn+":"+si)});case Cs:return Pt(function(Fe){return X.command(go(Fe)&&Fe.length===4,"color.mask must be length 4 array",be.commandStr),Fe.map(function(lt){return!!lt})},function(Fe,lt,Ce){return X.optional(function(){Fe.assert(lt,Fe.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","invalid color.mask")}),I(4,function(kt){return"!!"+Ce+"["+kt+"]"})});case ol:return Pt(function(Fe){X.command(typeof Fe=="object"&&Fe,pt,be.commandStr);var lt="value"in Fe?Fe.value:1,Ce=!!Fe.invert;return X.command(typeof lt=="number"&&lt>=0&&lt<=1,"sample.coverage.value must be a number between 0 and 1",be.commandStr),[lt,Ce]},function(Fe,lt,Ce){X.optional(function(){Fe.assert(lt,Ce+"&&typeof "+Ce+'==="object"',"invalid sample.coverage")});var kt=lt.def('"value" in ',Ce,"?+",Ce,".value:1"),Ht=lt.def("!!",Ce,".invert");return[kt,Ht]})}}),Zt}function Is(Re,be){var ht=Re.static,zt=Re.dynamic,Zt={};return Object.keys(ht).forEach(function(vt){var pt=ht[vt],Pt;if(typeof pt=="number"||typeof pt=="boolean")Pt=jo(function(){return pt});else if(typeof pt=="function"){var Fe=pt._reglType;Fe==="texture2d"||Fe==="textureCube"?Pt=jo(function(lt){return lt.link(pt)}):Fe==="framebuffer"||Fe==="framebufferCube"?(X.command(pt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+vt+'"',be.commandStr),Pt=jo(function(lt){return lt.link(pt.color[0])})):X.commandRaise('invalid data for uniform "'+vt+'"',be.commandStr)}else go(pt)?Pt=jo(function(lt){var Ce=lt.global.def("[",I(pt.length,function(kt){return X.command(typeof pt[kt]=="number"||typeof pt[kt]=="boolean","invalid uniform "+vt,lt.commandStr),pt[kt]}),"]");return Ce}):X.commandRaise('invalid or missing data for uniform "'+vt+'"',be.commandStr);Pt.value=pt,Zt[vt]=Pt}),Object.keys(zt).forEach(function(vt){var pt=zt[vt];Zt[vt]=Fu(pt,function(Pt,Fe){return Pt.invoke(Fe,pt)})}),Zt}function ea(Re,be){var ht=Re.static,zt=Re.dynamic,Zt={};return Object.keys(ht).forEach(function(vt){var pt=ht[vt],Pt=fe.id(vt),Fe=new or;if(Ic(pt))Fe.state=An,Fe.buffer=mr.getBuffer(mr.create(pt,Wl,!1,!0)),Fe.type=0;else{var lt=mr.getBuffer(pt);if(lt)Fe.state=An,Fe.buffer=lt,Fe.type=0;else if(X.command(typeof pt=="object"&&pt,"invalid data for attribute "+vt,be.commandStr),"constant"in pt){var Ce=pt.constant;Fe.buffer="null",Fe.state=Xn,typeof Ce=="number"?Fe.x=Ce:(X.command(go(Ce)&&Ce.length>0&&Ce.length<=4,"invalid constant for attribute "+vt,be.commandStr),Xr.forEach(function(Vn,Ri){Ri<Ce.length&&(Fe[Vn]=Ce[Ri])}))}else{Ic(pt.buffer)?lt=mr.getBuffer(mr.create(pt.buffer,Wl,!1,!0)):lt=mr.getBuffer(pt.buffer),X.command(!!lt,'missing buffer for attribute "'+vt+'"',be.commandStr);var kt=pt.offset|0;X.command(kt>=0,'invalid offset for attribute "'+vt+'"',be.commandStr);var Ht=pt.stride|0;X.command(Ht>=0&&Ht<256,'invalid stride for attribute "'+vt+'", must be integer betweeen [0, 255]',be.commandStr);var Mr=pt.size|0;X.command(!("size"in pt)||Mr>0&&Mr<=4,'invalid size for attribute "'+vt+'", must be 1,2,3,4',be.commandStr);var ur=!!pt.normalized,Tr=0;"type"in pt&&(X.commandParameter(pt.type,ao,"invalid type for attribute "+vt,be.commandStr),Tr=ao[pt.type]);var Qr=pt.divisor|0;"divisor"in pt&&(X.command(Qr===0||Gr,'cannot specify divisor for attribute "'+vt+'", instancing not supported',be.commandStr),X.command(Qr>=0,'invalid divisor for attribute "'+vt+'"',be.commandStr)),X.optional(function(){var Vn=be.commandStr,Ri=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(pt).forEach(function(zn){X.command(Ri.indexOf(zn)>=0,'unknown parameter "'+zn+'" for attribute pointer "'+vt+'" (valid parameters are '+Ri+")",Vn)})}),Fe.buffer=lt,Fe.state=An,Fe.size=Mr,Fe.normalized=ur,Fe.type=Tr||lt.dtype,Fe.offset=kt,Fe.stride=Ht,Fe.divisor=Qr}}Zt[vt]=jo(function(Vn,Ri){var zn=Vn.attribCache;if(Pt in zn)return zn[Pt];var ti={isStream:!1};return Object.keys(Fe).forEach(function(yi){ti[yi]=Fe[yi]}),Fe.buffer&&(ti.buffer=Vn.link(Fe.buffer),ti.type=ti.type||ti.buffer+".dtype"),zn[Pt]=ti,ti})}),Object.keys(zt).forEach(function(vt){var pt=zt[vt];function Pt(Fe,lt){var Ce=Fe.invoke(lt,pt),kt=Fe.shared,Ht=Fe.constants,Mr=kt.isBufferArgs,ur=kt.buffer;X.optional(function(){Fe.assert(lt,Ce+"&&(typeof "+Ce+'==="object"||typeof '+Ce+'==="function")&&('+Mr+"("+Ce+")||"+ur+".getBuffer("+Ce+")||"+ur+".getBuffer("+Ce+".buffer)||"+Mr+"("+Ce+'.buffer)||("constant" in '+Ce+"&&(typeof "+Ce+'.constant==="number"||'+kt.isArrayLike+"("+Ce+".constant))))",'invalid dynamic attribute "'+vt+'"')});var Tr={isStream:lt.def(!1)},Qr=new or;Qr.state=An,Object.keys(Qr).forEach(function(ti){Tr[ti]=lt.def(""+Qr[ti])});var Vn=Tr.buffer,Ri=Tr.type;lt("if(",Mr,"(",Ce,")){",Tr.isStream,"=true;",Vn,"=",ur,".createStream(",Wl,",",Ce,");",Ri,"=",Vn,".dtype;","}else{",Vn,"=",ur,".getBuffer(",Ce,");","if(",Vn,"){",Ri,"=",Vn,".dtype;",'}else if("constant" in ',Ce,"){",Tr.state,"=",Xn,";","if(typeof "+Ce+'.constant === "number"){',Tr[Xr[0]],"=",Ce,".constant;",Xr.slice(1).map(function(ti){return Tr[ti]}).join("="),"=0;","}else{",Xr.map(function(ti,yi){return Tr[ti]+"="+Ce+".constant.length>"+yi+"?"+Ce+".constant["+yi+"]:0;"}).join(""),"}}else{","if(",Mr,"(",Ce,".buffer)){",Vn,"=",ur,".createStream(",Wl,",",Ce,".buffer);","}else{",Vn,"=",ur,".getBuffer(",Ce,".buffer);","}",Ri,'="type" in ',Ce,"?",Ht.glTypes,"[",Ce,".type]:",Vn,".dtype;",Tr.normalized,"=!!",Ce,".normalized;");function zn(ti){lt(Tr[ti],"=",Ce,".",ti,"|0;")}return zn("size"),zn("offset"),zn("stride"),zn("divisor"),lt("}}"),lt.exit("if(",Tr.isStream,"){",ur,".destroyStream(",Vn,");","}"),Tr}Zt[vt]=Fu(pt,Pt)}),Zt}function To(Re,be){var ht=Re.static,zt=Re.dynamic;if(ku in ht){var Zt=ht[ku];return Zt!==null&&zr.getVAO(Zt)===null&&(Zt=zr.createVAO(Zt)),jo(function(pt){return pt.link(zr.getVAO(Zt))})}else if(ku in zt){var vt=zt[ku];return Fu(vt,function(pt,Pt){var Fe=pt.invoke(Pt,vt);return Pt.def(pt.shared.vao+".getVAO("+Fe+")")})}return null}function qa(Re){var be=Re.static,ht=Re.dynamic,zt={};return Object.keys(be).forEach(function(Zt){var vt=be[Zt];zt[Zt]=jo(function(pt,Pt){return typeof vt=="number"||typeof vt=="boolean"?""+vt:pt.link(vt)})}),Object.keys(ht).forEach(function(Zt){var vt=ht[Zt];zt[Zt]=Fu(vt,function(pt,Pt){return pt.invoke(Pt,vt)})}),zt}function cs(Re,be,ht,zt,Zt){var vt=Re.static,pt=Re.dynamic;X.optional(function(){var zn=[No,Lo,us,Ro,Ws,uc,Tl,Xu,Eo,ku].concat(Kr);function ti(yi){Object.keys(yi).forEach(function(da){X.command(zn.indexOf(da)>=0,'unknown parameter "'+da+'"',Zt.commandStr)})}ti(vt),ti(pt)});var Pt=Mi(Re,be),Fe=Rn(Re,Zt),lt=Ui(Re,Fe,Zt),Ce=na(Re,Zt),kt=Qo(Re,Zt),Ht=ji(Re,Zt,Pt);function Mr(zn){var ti=lt[zn];ti&&(kt[zn]=ti)}Mr(Ps),Mr(Yr(wl));var ur=Object.keys(kt).length>0,Tr={framebuffer:Fe,draw:Ce,shader:Ht,state:kt,dirty:ur,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Tr.profile=ii(Re,Zt),Tr.uniforms=Is(ht,Zt),Tr.drawVAO=Tr.scopeVAO=To(Re,Zt),!Tr.drawVAO&&Ht.program&&!Pt&&Ue.angle_instanced_arrays){var Qr=!0,Vn=Ht.program.attributes.map(function(zn){var ti=be.static[zn];return Qr=Qr&&!!ti,ti});if(Qr&&Vn.length>0){var Ri=zr.getVAO(zr.createVAO(Vn));Tr.drawVAO=new _s(null,null,null,function(zn,ti){return zn.link(Ri)}),Tr.useVAO=!0}}return Pt?Tr.useVAO=!0:Tr.attributes=ea(be,Zt),Tr.context=qa(zt,Zt),Tr}function qo(Re,be,ht){var zt=Re.shared,Zt=zt.context,vt=Re.scope();Object.keys(ht).forEach(function(pt){be.save(Zt,"."+pt);var Pt=ht[pt],Fe=Pt.append(Re,be);Array.isArray(Fe)?vt(Zt,".",pt,"=[",Fe.join(),"];"):vt(Zt,".",pt,"=",Fe,";")}),be(vt)}function Os(Re,be,ht,zt){var Zt=Re.shared,vt=Zt.gl,pt=Zt.framebuffer,Pt;En&&(Pt=be.def(Zt.extensions,".webgl_draw_buffers"));var Fe=Re.constants,lt=Fe.drawBuffer,Ce=Fe.backBuffer,kt;ht?kt=ht.append(Re,be):kt=be.def(pt,".next"),zt||be("if(",kt,"!==",pt,".cur){"),be("if(",kt,"){",vt,".bindFramebuffer(",fo,",",kt,".framebuffer);"),En&&be(Pt,".drawBuffersWEBGL(",lt,"[",kt,".colorAttachments.length]);"),be("}else{",vt,".bindFramebuffer(",fo,",null);"),En&&be(Pt,".drawBuffersWEBGL(",Ce,");"),be("}",pt,".cur=",kt,";"),zt||be("}")}function es(Re,be,ht){var zt=Re.shared,Zt=zt.gl,vt=Re.current,pt=Re.next,Pt=zt.current,Fe=zt.next,lt=Re.cond(Pt,".dirty");Kr.forEach(function(Ce){var kt=Yr(Ce);if(!(kt in ht.state)){var Ht,Mr;if(kt in pt){Ht=pt[kt],Mr=vt[kt];var ur=I(Pr[kt].length,function(Qr){return lt.def(Ht,"[",Qr,"]")});lt(Re.cond(ur.map(function(Qr,Vn){return Qr+"!=="+Mr+"["+Vn+"]"}).join("||")).then(Zt,".",Fr[kt],"(",ur,");",ur.map(function(Qr,Vn){return Mr+"["+Vn+"]="+Qr}).join(";"),";"))}else{Ht=lt.def(Fe,".",kt);var Tr=Re.cond(Ht,"!==",Pt,".",kt);lt(Tr),kt in Br?Tr(Re.cond(Ht).then(Zt,".enable(",Br[kt],");").else(Zt,".disable(",Br[kt],");"),Pt,".",kt,"=",Ht,";"):Tr(Zt,".",Fr[kt],"(",Ht,");",Pt,".",kt,"=",Ht,";")}}}),Object.keys(ht.state).length===0&&lt(Pt,".dirty=false;"),be(lt)}function Xs(Re,be,ht,zt){var Zt=Re.shared,vt=Re.current,pt=Zt.current,Pt=Zt.gl;Kl(Object.keys(ht)).forEach(function(Fe){var lt=ht[Fe];if(!(zt&&!zt(lt))){var Ce=lt.append(Re,be);if(Br[Fe]){var kt=Br[Fe];Bs(lt)?Ce?be(Pt,".enable(",kt,");"):be(Pt,".disable(",kt,");"):be(Re.cond(Ce).then(Pt,".enable(",kt,");").else(Pt,".disable(",kt,");")),be(pt,".",Fe,"=",Ce,";")}else if(go(Ce)){var Ht=vt[Fe];be(Pt,".",Fr[Fe],"(",Ce,");",Ce.map(function(Mr,ur){return Ht+"["+ur+"]="+Mr}).join(";"),";")}else be(Pt,".",Fr[Fe],"(",Ce,");",pt,".",Fe,"=",Ce,";")}})}function Zo(Re,be){Gr&&(Re.instancing=be.def(Re.shared.extensions,".angle_instanced_arrays"))}function ki(Re,be,ht,zt,Zt){var vt=Re.shared,pt=Re.stats,Pt=vt.current,Fe=vt.timer,lt=ht.profile;function Ce(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var kt,Ht;function Mr(zn){kt=be.def(),zn(kt,"=",Ce(),";"),typeof Zt=="string"?zn(pt,".count+=",Zt,";"):zn(pt,".count++;"),on&&(zt?(Ht=be.def(),zn(Ht,"=",Fe,".getNumPendingQueries();")):zn(Fe,".beginQuery(",pt,");"))}function ur(zn){zn(pt,".cpuTime+=",Ce(),"-",kt,";"),on&&(zt?zn(Fe,".pushScopeStats(",Ht,",",Fe,".getNumPendingQueries(),",pt,");"):zn(Fe,".endQuery();"))}function Tr(zn){var ti=be.def(Pt,".profile");be(Pt,".profile=",zn,";"),be.exit(Pt,".profile=",ti,";")}var Qr;if(lt){if(Bs(lt)){lt.enable?(Mr(be),ur(be.exit),Tr("true")):Tr("false");return}Qr=lt.append(Re,be),Tr(Qr)}else Qr=be.def(Pt,".profile");var Vn=Re.block();Mr(Vn),be("if(",Qr,"){",Vn,"}");var Ri=Re.block();ur(Ri),be.exit("if(",Qr,"){",Ri,"}")}function Ks(Re,be,ht,zt,Zt){var vt=Re.shared;function pt(Fe){switch(Fe){case pf:case Mc:case U:return 2;case co:case lc:case M:return 3;case Pc:case Xl:case R:return 4;default:return 1}}function Pt(Fe,lt,Ce){var kt=vt.gl,Ht=be.def(Fe,".location"),Mr=be.def(vt.attributes,"[",Ht,"]"),ur=Ce.state,Tr=Ce.buffer,Qr=[Ce.x,Ce.y,Ce.z,Ce.w],Vn=["buffer","normalized","offset","stride"];function Ri(){be("if(!",Mr,".buffer){",kt,".enableVertexAttribArray(",Ht,");}");var ti=Ce.type,yi;if(Ce.size?yi=be.def(Ce.size,"||",lt):yi=lt,be("if(",Mr,".type!==",ti,"||",Mr,".size!==",yi,"||",Vn.map(function(Vo){return Mr+"."+Vo+"!=="+Ce[Vo]}).join("||"),"){",kt,".bindBuffer(",Wl,",",Tr,".buffer);",kt,".vertexAttribPointer(",[Ht,yi,ti,Ce.normalized,Ce.stride,Ce.offset],");",Mr,".type=",ti,";",Mr,".size=",yi,";",Vn.map(function(Vo){return Mr+"."+Vo+"="+Ce[Vo]+";"}).join(""),"}"),Gr){var da=Ce.divisor;be("if(",Mr,".divisor!==",da,"){",Re.instancing,".vertexAttribDivisorANGLE(",[Ht,da],");",Mr,".divisor=",da,";}")}}function zn(){be("if(",Mr,".buffer){",kt,".disableVertexAttribArray(",Ht,");",Mr,".buffer=null;","}if(",Xr.map(function(ti,yi){return Mr+"."+ti+"!=="+Qr[yi]}).join("||"),"){",kt,".vertexAttrib4f(",Ht,",",Qr,");",Xr.map(function(ti,yi){return Mr+"."+ti+"="+Qr[yi]+";"}).join(""),"}")}ur===An?Ri():ur===Xn?zn():(be("if(",ur,"===",An,"){"),Ri(),be("}else{"),zn(),be("}"))}zt.forEach(function(Fe){var lt=Fe.name,Ce=ht.attributes[lt],kt;if(Ce){if(!Zt(Ce))return;kt=Ce.append(Re,be)}else{if(!Zt(Eh))return;var Ht=Re.scopeAttrib(lt);X.optional(function(){Re.assert(be,Ht+".state","missing attribute "+lt)}),kt={},Object.keys(new or).forEach(function(Mr){kt[Mr]=be.def(Ht,".",Mr)})}Pt(Re.link(Fe),pt(Fe.info.type),kt)})}function wa(Re,be,ht,zt,Zt){for(var vt=Re.shared,pt=vt.gl,Pt,Fe=0;Fe<zt.length;++Fe){var lt=zt[Fe],Ce=lt.name,kt=lt.info.type,Ht=ht.uniforms[Ce],Mr=Re.link(lt),ur=Mr+".location",Tr;if(Ht){if(!Zt(Ht))continue;if(Bs(Ht)){var Qr=Ht.value;if(X.command(Qr!==null&&typeof Qr!="undefined",'missing uniform "'+Ce+'"',Re.commandStr),kt===wt||kt===Et){X.command(typeof Qr=="function"&&(kt===wt&&(Qr._reglType==="texture2d"||Qr._reglType==="framebuffer")||kt===Et&&(Qr._reglType==="textureCube"||Qr._reglType==="framebufferCube")),"invalid texture for uniform "+Ce,Re.commandStr);var Vn=Re.link(Qr._texture||Qr.color[0]._texture);be(pt,".uniform1i(",ur,",",Vn+".bind());"),be.exit(Vn,".unbind();")}else if(kt===ee||kt===ge||kt===rt){X.optional(function(){X.command(go(Qr),"invalid matrix for uniform "+Ce,Re.commandStr),X.command(kt===ee&&Qr.length===4||kt===ge&&Qr.length===9||kt===rt&&Qr.length===16,"invalid length for matrix uniform "+Ce,Re.commandStr)});var Ri=Re.global.def("new Float32Array(["+Array.prototype.slice.call(Qr)+"])"),zn=2;kt===ge?zn=3:kt===rt&&(zn=4),be(pt,".uniformMatrix",zn,"fv(",ur,",false,",Ri,");")}else{switch(kt){case pu:X.commandType(Qr,"number","uniform "+Ce,Re.commandStr),Pt="1f";break;case pf:X.command(go(Qr)&&Qr.length===2,"uniform "+Ce,Re.commandStr),Pt="2f";break;case co:X.command(go(Qr)&&Qr.length===3,"uniform "+Ce,Re.commandStr),Pt="3f";break;case Pc:X.command(go(Qr)&&Qr.length===4,"uniform "+Ce,Re.commandStr),Pt="4f";break;case B:X.commandType(Qr,"boolean","uniform "+Ce,Re.commandStr),Pt="1i";break;case Pf:X.commandType(Qr,"number","uniform "+Ce,Re.commandStr),Pt="1i";break;case U:X.command(go(Qr)&&Qr.length===2,"uniform "+Ce,Re.commandStr),Pt="2i";break;case Mc:X.command(go(Qr)&&Qr.length===2,"uniform "+Ce,Re.commandStr),Pt="2i";break;case M:X.command(go(Qr)&&Qr.length===3,"uniform "+Ce,Re.commandStr),Pt="3i";break;case lc:X.command(go(Qr)&&Qr.length===3,"uniform "+Ce,Re.commandStr),Pt="3i";break;case R:X.command(go(Qr)&&Qr.length===4,"uniform "+Ce,Re.commandStr),Pt="4i";break;case Xl:X.command(go(Qr)&&Qr.length===4,"uniform "+Ce,Re.commandStr),Pt="4i";break}be(pt,".uniform",Pt,"(",ur,",",go(Qr)?Array.prototype.slice.call(Qr):Qr,");")}continue}else Tr=Ht.append(Re,be)}else{if(!Zt(Eh))continue;Tr=be.def(vt.uniforms,"[",fe.id(Ce),"]")}kt===wt?(X(!Array.isArray(Tr),"must specify a scalar prop for textures"),be("if(",Tr,"&&",Tr,'._reglType==="framebuffer"){',Tr,"=",Tr,".color[0];","}")):kt===Et&&(X(!Array.isArray(Tr),"must specify a scalar prop for cube maps"),be("if(",Tr,"&&",Tr,'._reglType==="framebufferCube"){',Tr,"=",Tr,".color[0];","}")),X.optional(function(){function Nu(iu,jf){Re.assert(be,iu,'bad data or missing for uniform "'+Ce+'".  '+jf)}function ih(iu){X(!Array.isArray(Tr),"must not specify an array type for uniform"),Nu("typeof "+Tr+'==="'+iu+'"',"invalid type, expected "+iu)}function sl(iu,jf){Array.isArray(Tr)?X(Tr.length===iu,"must have length "+iu):Nu(vt.isArrayLike+"("+Tr+")&&"+Tr+".length==="+iu,"invalid vector, should have length "+iu,Re.commandStr)}function Mh(iu){X(!Array.isArray(Tr),"must not specify a value type"),Nu("typeof "+Tr+'==="function"&&'+Tr+'._reglType==="texture'+(iu===Cl?"2d":"Cube")+'"',"invalid texture type",Re.commandStr)}switch(kt){case Pf:ih("number");break;case Mc:sl(2,"number");break;case lc:sl(3,"number");break;case Xl:sl(4,"number");break;case pu:ih("number");break;case pf:sl(2,"number");break;case co:sl(3,"number");break;case Pc:sl(4,"number");break;case B:ih("boolean");break;case U:sl(2,"boolean");break;case M:sl(3,"boolean");break;case R:sl(4,"boolean");break;case ee:sl(4,"number");break;case ge:sl(9,"number");break;case rt:sl(16,"number");break;case wt:Mh(Cl);break;case Et:Mh(qc);break}});var ti=1;switch(kt){case wt:case Et:var yi=be.def(Tr,"._texture");be(pt,".uniform1i(",ur,",",yi,".bind());"),be.exit(yi,".unbind();");continue;case Pf:case B:Pt="1i";break;case Mc:case U:Pt="2i",ti=2;break;case lc:case M:Pt="3i",ti=3;break;case Xl:case R:Pt="4i",ti=4;break;case pu:Pt="1f";break;case pf:Pt="2f",ti=2;break;case co:Pt="3f",ti=3;break;case Pc:Pt="4f",ti=4;break;case ee:Pt="Matrix2fv";break;case ge:Pt="Matrix3fv";break;case rt:Pt="Matrix4fv";break}if(be(pt,".uniform",Pt,"(",ur,","),Pt.charAt(0)==="M"){var da=Math.pow(kt-ee+2,2),Vo=Re.global.def("new Float32Array(",da,")");Array.isArray(Tr)?be("false,(",I(da,function(Nu){return Vo+"["+Nu+"]="+Tr[Nu]}),",",Vo,")"):be("false,(Array.isArray(",Tr,")||",Tr," instanceof Float32Array)?",Tr,":(",I(da,function(Nu){return Vo+"["+Nu+"]="+Tr+"["+Nu+"]"}),",",Vo,")")}else ti>1?be(I(ti,function(Nu){return Array.isArray(Tr)?Tr[Nu]:Tr+"["+Nu+"]"})):(X(!Array.isArray(Tr),"uniform value must not be an array"),be(Tr));be(");")}}function ui(Re,be,ht,zt){var Zt=Re.shared,vt=Zt.gl,pt=Zt.draw,Pt=zt.draw;function Fe(){var yi=Pt.elements,da,Vo=be;return yi?((yi.contextDep&&zt.contextDynamic||yi.propDep)&&(Vo=ht),da=yi.append(Re,Vo)):da=Vo.def(pt,".",Ro),da&&Vo("if("+da+")"+vt+".bindBuffer("+Cf+","+da+".buffer.buffer);"),da}function lt(){var yi=Pt.count,da,Vo=be;return yi?((yi.contextDep&&zt.contextDynamic||yi.propDep)&&(Vo=ht),da=yi.append(Re,Vo),X.optional(function(){yi.MISSING&&Re.assert(be,"false","missing vertex count"),yi.DYNAMIC&&Re.assert(Vo,da+">=0","missing vertex count")})):(da=Vo.def(pt,".",Tl),X.optional(function(){Re.assert(Vo,da+">=0","missing vertex count")})),da}var Ce=Fe();function kt(yi){var da=Pt[yi];return da?da.contextDep&&zt.contextDynamic||da.propDep?da.append(Re,ht):da.append(Re,be):be.def(pt,".",yi)}var Ht=kt(Ws),Mr=kt(uc),ur=lt();if(typeof ur=="number"){if(ur===0)return}else ht("if(",ur,"){"),ht.exit("}");var Tr,Qr;Gr&&(Tr=kt(Xu),Qr=Re.instancing);var Vn=Ce+".type",Ri=Pt.elements&&Bs(Pt.elements);function zn(){function yi(){ht(Qr,".drawElementsInstancedANGLE(",[Ht,ur,Vn,Mr+"<<(("+Vn+"-"+vn+")>>1)",Tr],");")}function da(){ht(Qr,".drawArraysInstancedANGLE(",[Ht,Mr,ur,Tr],");")}Ce?Ri?yi():(ht("if(",Ce,"){"),yi(),ht("}else{"),da(),ht("}")):da()}function ti(){function yi(){ht(vt+".drawElements("+[Ht,ur,Vn,Mr+"<<(("+Vn+"-"+vn+")>>1)"]+");")}function da(){ht(vt+".drawArrays("+[Ht,Mr,ur]+");")}Ce?Ri?yi():(ht("if(",Ce,"){"),yi(),ht("}else{"),da(),ht("}")):da()}Gr&&(typeof Tr!="number"||Tr>=0)?typeof Tr=="string"?(ht("if(",Tr,">0){"),zn(),ht("}else if(",Tr,"<0){"),ti(),ht("}")):zn():ti()}function Li(Re,be,ht,zt,Zt){var vt=ni(),pt=vt.proc("body",Zt);return X.optional(function(){vt.commandStr=be.commandStr,vt.command=vt.link(be.commandStr)}),Gr&&(vt.instancing=pt.def(vt.shared.extensions,".angle_instanced_arrays")),Re(vt,pt,ht,zt),vt.compile().body}function ta(Re,be,ht,zt){Zo(Re,be),ht.useVAO?ht.drawVAO?be(Re.shared.vao,".setVAO(",ht.drawVAO.append(Re,be),");"):be(Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"):(be(Re.shared.vao,".setVAO(null);"),Ks(Re,be,ht,zt.attributes,function(){return!0})),wa(Re,be,ht,zt.uniforms,function(){return!0}),ui(Re,be,be,ht)}function xs(Re,be){var ht=Re.proc("draw",1);Zo(Re,ht),qo(Re,ht,be.context),Os(Re,ht,be.framebuffer),es(Re,ht,be),Xs(Re,ht,be.state),ki(Re,ht,be,!1,!0);var zt=be.shader.progVar.append(Re,ht);if(ht(Re.shared.gl,".useProgram(",zt,".program);"),be.shader.program)ta(Re,ht,be,be.shader.program);else{ht(Re.shared.vao,".setVAO(null);");var Zt=Re.global.def("{}"),vt=ht.def(zt,".id"),pt=ht.def(Zt,"[",vt,"]");ht(Re.cond(pt).then(pt,".call(this,a0);").else(pt,"=",Zt,"[",vt,"]=",Re.link(function(Pt){return Li(ta,Re,be,Pt,1)}),"(",zt,");",pt,".call(this,a0);"))}Object.keys(be.state).length>0&&ht(Re.shared.current,".dirty=true;")}function Ys(Re,be,ht,zt){Re.batchId="a1",Zo(Re,be);function Zt(){return!0}Ks(Re,be,ht,zt.attributes,Zt),wa(Re,be,ht,zt.uniforms,Zt),ui(Re,be,be,ht)}function Yl(Re,be,ht,zt){Zo(Re,be);var Zt=ht.contextDep,vt=be.def(),pt="a0",Pt="a1",Fe=be.def();Re.shared.props=Fe,Re.batchId=vt;var lt=Re.scope(),Ce=Re.scope();be(lt.entry,"for(",vt,"=0;",vt,"<",Pt,";++",vt,"){",Fe,"=",pt,"[",vt,"];",Ce,"}",lt.exit);function kt(Vn){return Vn.contextDep&&Zt||Vn.propDep}function Ht(Vn){return!kt(Vn)}if(ht.needsContext&&qo(Re,Ce,ht.context),ht.needsFramebuffer&&Os(Re,Ce,ht.framebuffer),Xs(Re,Ce,ht.state,kt),ht.profile&&kt(ht.profile)&&ki(Re,Ce,ht,!1,!0),zt)ht.useVAO?ht.drawVAO?kt(ht.drawVAO)?Ce(Re.shared.vao,".setVAO(",ht.drawVAO.append(Re,Ce),");"):lt(Re.shared.vao,".setVAO(",ht.drawVAO.append(Re,lt),");"):lt(Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"):(lt(Re.shared.vao,".setVAO(null);"),Ks(Re,lt,ht,zt.attributes,Ht),Ks(Re,Ce,ht,zt.attributes,kt)),wa(Re,lt,ht,zt.uniforms,Ht),wa(Re,Ce,ht,zt.uniforms,kt),ui(Re,lt,Ce,ht);else{var Mr=Re.global.def("{}"),ur=ht.shader.progVar.append(Re,Ce),Tr=Ce.def(ur,".id"),Qr=Ce.def(Mr,"[",Tr,"]");Ce(Re.shared.gl,".useProgram(",ur,".program);","if(!",Qr,"){",Qr,"=",Mr,"[",Tr,"]=",Re.link(function(Vn){return Li(Ys,Re,ht,Vn,2)}),"(",ur,");}",Qr,".call(this,a0[",vt,"],",vt,");")}}function We(Re,be){var ht=Re.proc("batch",2);Re.batchId="0",Zo(Re,ht);var zt=!1,Zt=!0;Object.keys(be.context).forEach(function(Mr){zt=zt||be.context[Mr].propDep}),zt||(qo(Re,ht,be.context),Zt=!1);var vt=be.framebuffer,pt=!1;vt?(vt.propDep?zt=pt=!0:vt.contextDep&&zt&&(pt=!0),pt||Os(Re,ht,vt)):Os(Re,ht,null),be.state.viewport&&be.state.viewport.propDep&&(zt=!0);function Pt(Mr){return Mr.contextDep&&zt||Mr.propDep}es(Re,ht,be),Xs(Re,ht,be.state,function(Mr){return!Pt(Mr)}),(!be.profile||!Pt(be.profile))&&ki(Re,ht,be,!1,"a1"),be.contextDep=zt,be.needsContext=Zt,be.needsFramebuffer=pt;var Fe=be.shader.progVar;if(Fe.contextDep&&zt||Fe.propDep)Yl(Re,ht,be,null);else{var lt=Fe.append(Re,ht);if(ht(Re.shared.gl,".useProgram(",lt,".program);"),be.shader.program)Yl(Re,ht,be,be.shader.program);else{ht(Re.shared.vao,".setVAO(null);");var Ce=Re.global.def("{}"),kt=ht.def(lt,".id"),Ht=ht.def(Ce,"[",kt,"]");ht(Re.cond(Ht).then(Ht,".call(this,a0,a1);").else(Ht,"=",Ce,"[",kt,"]=",Re.link(function(Mr){return Li(Yl,Re,be,Mr,2)}),"(",lt,");",Ht,".call(this,a0,a1);"))}}Object.keys(be.state).length>0&&ht(Re.shared.current,".dirty=true;")}function lr(Re,be){var ht=Re.proc("scope",3);Re.batchId="a2";var zt=Re.shared,Zt=zt.current;qo(Re,ht,be.context),be.framebuffer&&be.framebuffer.append(Re,ht),Kl(Object.keys(be.state)).forEach(function(pt){var Pt=be.state[pt],Fe=Pt.append(Re,ht);go(Fe)?Fe.forEach(function(lt,Ce){ht.set(Re.next[pt],"["+Ce+"]",lt)}):ht.set(zt.next,"."+pt,Fe)}),ki(Re,ht,be,!0,!0),[Ro,uc,Tl,Xu,Ws].forEach(function(pt){var Pt=be.draw[pt];!Pt||ht.set(zt.draw,"."+pt,""+Pt.append(Re,ht))}),Object.keys(be.uniforms).forEach(function(pt){var Pt=be.uniforms[pt].append(Re,ht);Array.isArray(Pt)&&(Pt="["+Pt.join()+"]"),ht.set(zt.uniforms,"["+fe.id(pt)+"]",Pt)}),Object.keys(be.attributes).forEach(function(pt){var Pt=be.attributes[pt].append(Re,ht),Fe=Re.scopeAttrib(pt);Object.keys(new or).forEach(function(lt){ht.set(Fe,"."+lt,Pt[lt])})}),be.scopeVAO&&ht.set(zt.vao,".targetVAO",be.scopeVAO.append(Re,ht));function vt(pt){var Pt=be.shader[pt];Pt&&ht.set(zt.shader,"."+pt,Pt.append(Re,ht))}vt(Lo),vt(us),Object.keys(be.state).length>0&&(ht(Zt,".dirty=true;"),ht.exit(Zt,".dirty=true;")),ht("a1(",Re.shared.context,",a0,",Re.batchId,");")}function Qt(Re){if(!(typeof Re!="object"||go(Re))){for(var be=Object.keys(Re),ht=0;ht<be.length;++ht)if(mt.isDynamic(Re[be[ht]]))return!0;return!1}}function Pn(Re,be,ht){var zt=be.static[ht];if(!zt||!Qt(zt))return;var Zt=Re.global,vt=Object.keys(zt),pt=!1,Pt=!1,Fe=!1,lt=Re.global.def("{}");vt.forEach(function(kt){var Ht=zt[kt];if(mt.isDynamic(Ht)){typeof Ht=="function"&&(Ht=zt[kt]=mt.unbox(Ht));var Mr=Fu(Ht,null);pt=pt||Mr.thisDep,Fe=Fe||Mr.propDep,Pt=Pt||Mr.contextDep}else{switch(Zt(lt,".",kt,"="),typeof Ht){case"number":Zt(Ht);break;case"string":Zt('"',Ht,'"');break;case"object":Array.isArray(Ht)&&Zt("[",Ht.join(),"]");break;default:Zt(Re.link(Ht));break}Zt(";")}});function Ce(kt,Ht){vt.forEach(function(Mr){var ur=zt[Mr];if(!!mt.isDynamic(ur)){var Tr=kt.invoke(Ht,ur);Ht(lt,".",Mr,"=",Tr,";")}})}be.dynamic[ht]=new mt.DynamicVariable(fi,{thisDep:pt,contextDep:Pt,propDep:Fe,ref:lt,append:Ce}),delete be.static[ht]}function Fi(Re,be,ht,zt,Zt){var vt=ni();vt.stats=vt.link(Zt),Object.keys(be.static).forEach(function(Pt){Pn(vt,be,Pt)}),Jc.forEach(function(Pt){Pn(vt,Re,Pt)});var pt=cs(Re,be,ht,zt,vt);return xs(vt,pt),lr(vt,pt),We(vt,pt),y(vt.compile(),{destroy:function(){pt.shader.program.destroy()}})}return{next:Yn,current:Pr,procs:function(){var Re=ni(),be=Re.proc("poll"),ht=Re.proc("refresh"),zt=Re.block();be(zt),ht(zt);var Zt=Re.shared,vt=Zt.gl,pt=Zt.next,Pt=Zt.current;zt(Pt,".dirty=false;"),Os(Re,be),Os(Re,ht,null,!0);var Fe;Gr&&(Fe=Re.link(Gr)),Ue.oes_vertex_array_object&&ht(Re.link(Ue.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var lt=0;lt<Jt.maxAttributes;++lt){var Ce=ht.def(Zt.attributes,"[",lt,"]"),kt=Re.cond(Ce,".buffer");kt.then(vt,".enableVertexAttribArray(",lt,");",vt,".bindBuffer(",Wl,",",Ce,".buffer.buffer);",vt,".vertexAttribPointer(",lt,",",Ce,".size,",Ce,".type,",Ce,".normalized,",Ce,".stride,",Ce,".offset);").else(vt,".disableVertexAttribArray(",lt,");",vt,".vertexAttrib4f(",lt,",",Ce,".x,",Ce,".y,",Ce,".z,",Ce,".w);",Ce,".buffer=null;"),ht(kt),Gr&&ht(Fe,".vertexAttribDivisorANGLE(",lt,",",Ce,".divisor);")}return ht(Re.shared.vao,".currentVAO=null;",Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"),Object.keys(Br).forEach(function(Ht){var Mr=Br[Ht],ur=zt.def(pt,".",Ht),Tr=Re.block();Tr("if(",ur,"){",vt,".enable(",Mr,")}else{",vt,".disable(",Mr,")}",Pt,".",Ht,"=",ur,";"),ht(Tr),be("if(",ur,"!==",Pt,".",Ht,"){",Tr,"}")}),Object.keys(Fr).forEach(function(Ht){var Mr=Fr[Ht],ur=Pr[Ht],Tr,Qr,Vn=Re.block();if(Vn(vt,".",Mr,"("),go(ur)){var Ri=ur.length;Tr=Re.global.def(pt,".",Ht),Qr=Re.global.def(Pt,".",Ht),Vn(I(Ri,function(zn){return Tr+"["+zn+"]"}),");",I(Ri,function(zn){return Qr+"["+zn+"]="+Tr+"["+zn+"];"}).join("")),be("if(",I(Ri,function(zn){return Tr+"["+zn+"]!=="+Qr+"["+zn+"]"}).join("||"),"){",Vn,"}")}else Tr=zt.def(pt,".",Ht),Qr=zt.def(Pt,".",Ht),Vn(Tr,");",Pt,".",Ht,"=",Tr,";"),be("if(",Tr,"!==",Qr,"){",Vn,"}");ht(Vn)}),Re.compile()}(),compile:Fi}}function Qh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var wh=34918,ls=34919,Th=35007,Ah=function(fe,Ue){if(!Ue.ext_disjoint_timer_query)return null;var Jt=[];function mr(){return Jt.pop()||Ue.ext_disjoint_timer_query.createQueryEXT()}function pr(En){Jt.push(En)}var rr=[];function Zr(En){var Pr=mr();Ue.ext_disjoint_timer_query.beginQueryEXT(Th,Pr),rr.push(Pr),rn(rr.length-1,rr.length,En)}function nn(){Ue.ext_disjoint_timer_query.endQueryEXT(Th)}function zr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Jr=[];function sn(){return Jr.pop()||new zr}function mn(En){Jr.push(En)}var on=[];function rn(En,Pr,Yn){var Kr=sn();Kr.startQueryIndex=En,Kr.endQueryIndex=Pr,Kr.sum=0,Kr.stats=Yn,on.push(Kr)}var or=[],er=[];function Gr(){var En,Pr,Yn=rr.length;if(Yn!==0){er.length=Math.max(er.length,Yn+1),or.length=Math.max(or.length,Yn+1),or[0]=0,er[0]=0;var Kr=0;for(En=0,Pr=0;Pr<rr.length;++Pr){var Br=rr[Pr];Ue.ext_disjoint_timer_query.getQueryObjectEXT(Br,ls)?(Kr+=Ue.ext_disjoint_timer_query.getQueryObjectEXT(Br,wh),pr(Br)):rr[En++]=Br,or[Pr+1]=Kr,er[Pr+1]=En}for(rr.length=En,En=0,Pr=0;Pr<on.length;++Pr){var Fr=on[Pr],Yr=Fr.startQueryIndex,jn=Fr.endQueryIndex;Fr.sum+=or[jn]-or[Yr];var $n=er[Yr],un=er[jn];un===$n?(Fr.stats.gpuTime+=Fr.sum/1e6,mn(Fr)):(Fr.startQueryIndex=$n,Fr.endQueryIndex=un,on[En++]=Fr)}on.length=En}}return{beginQuery:Zr,endQuery:nn,pushScopeStats:rn,update:Gr,getNumPendingQueries:function(){return rr.length},clear:function(){Jt.push.apply(Jt,rr);for(var Pr=0;Pr<Jt.length;Pr++)Ue.ext_disjoint_timer_query.deleteQueryEXT(Jt[Pr]);rr.length=0,Jt.length=0},restore:function(){rr.length=0,Jt.length=0}}},Ch=16384,qh=256,Ph=1024,ep=34962,tp="webglcontextlost",rp="webglcontextrestored",nh=1,np=2,ip=3;function cc(J,fe){for(var Ue=0;Ue<J.length;++Ue)if(J[Ue]===fe)return Ue;return-1}function ap(J){var fe=oi(J);if(!fe)return null;var Ue=fe.gl,Jt=Ue.getContextAttributes(),mr=Ue.isContextLost(),pr=$(Ue,fe);if(!pr)return null;var rr=sr(),Zr=Qh(),nn=pr.extensions,zr=Ah(Ue,nn),Jr=ar(),sn=Ue.drawingBufferWidth,mn=Ue.drawingBufferHeight,on={tick:0,time:0,viewportWidth:sn,viewportHeight:mn,framebufferWidth:sn,framebufferHeight:mn,drawingBufferWidth:sn,drawingBufferHeight:mn,pixelRatio:fe.pixelRatio},rn={},or={elements:null,primitive:4,count:-1,offset:0,instances:-1},er=$a(Ue,nn),Gr=Yi(Ue,Zr,fe,Pr),En=ye(Ue,nn,er,Zr,Gr);function Pr(ui){return En.destroyBuffer(ui)}var Yn=$f(Ue,nn,Gr,Zr),Kr=$e(Ue,rr,Zr,fe),Br=Pu(Ue,nn,er,function(){jn.procs.poll()},on,Zr,fe),Fr=Vs(Ue,nn,er,Zr,fe),Yr=L(Ue,nn,er,Br,Fr,Zr),jn=Jh(Ue,rr,nn,er,Gr,Yn,Br,Yr,rn,En,Kr,or,on,zr,fe),$n=nr(Ue,Yr,jn.procs.poll,on,Jt,nn,er),un=jn.next,Ur=Ue.canvas,Dr=[],ni=[],ii=[],Rn=[fe.onDestroy],Ui=null;function Mi(){if(Dr.length===0){zr&&zr.update(),Ui=null;return}Ui=Dt.next(Mi),Xs();for(var ui=Dr.length-1;ui>=0;--ui){var Li=Dr[ui];Li&&Li(on,null,0)}Ue.flush(),zr&&zr.update()}function ji(){!Ui&&Dr.length>0&&(Ui=Dt.next(Mi))}function na(){Ui&&(Dt.cancel(Mi),Ui=null)}function Qo(ui){ui.preventDefault(),mr=!0,na(),ni.forEach(function(Li){Li()})}function Is(ui){Ue.getError(),mr=!1,pr.restore(),Kr.restore(),Gr.restore(),Br.restore(),Fr.restore(),Yr.restore(),En.restore(),zr&&zr.restore(),jn.procs.refresh(),ji(),ii.forEach(function(Li){Li()})}Ur&&(Ur.addEventListener(tp,Qo,!1),Ur.addEventListener(rp,Is,!1));function ea(){Dr.length=0,na(),Ur&&(Ur.removeEventListener(tp,Qo),Ur.removeEventListener(rp,Is)),Kr.clear(),Yr.clear(),Fr.clear(),Br.clear(),Yn.clear(),Gr.clear(),En.clear(),zr&&zr.clear(),Rn.forEach(function(ui){ui()})}function To(ui){X(!!ui,"invalid args to regl({...})"),X.type(ui,"object","invalid args to regl({...})");function Li(Zt){var vt=y({},Zt);delete vt.uniforms,delete vt.attributes,delete vt.context,delete vt.vao,"stencil"in vt&&vt.stencil.op&&(vt.stencil.opBack=vt.stencil.opFront=vt.stencil.op,delete vt.stencil.op);function pt(Pt){if(Pt in vt){var Fe=vt[Pt];delete vt[Pt],Object.keys(Fe).forEach(function(lt){vt[Pt+"."+lt]=Fe[lt]})}}return pt("blend"),pt("depth"),pt("cull"),pt("stencil"),pt("polygonOffset"),pt("scissor"),pt("sample"),"vao"in Zt&&(vt.vao=Zt.vao),vt}function ta(Zt,vt){var pt={},Pt={};return Object.keys(Zt).forEach(function(Fe){var lt=Zt[Fe];if(mt.isDynamic(lt)){Pt[Fe]=mt.unbox(lt,Fe);return}else if(vt&&Array.isArray(lt)){for(var Ce=0;Ce<lt.length;++Ce)if(mt.isDynamic(lt[Ce])){Pt[Fe]=mt.unbox(lt,Fe);return}}pt[Fe]=lt}),{dynamic:Pt,static:pt}}var xs=ta(ui.context||{},!0),Ys=ta(ui.uniforms||{},!0),Yl=ta(ui.attributes||{},!1),We=ta(Li(ui),!1),lr={gpuTime:0,cpuTime:0,count:0},Qt=jn.compile(We,Yl,Ys,xs,lr),Pn=Qt.draw,Fi=Qt.batch,Re=Qt.scope,be=[];function ht(Zt){for(;be.length<Zt;)be.push(null);return be}function zt(Zt,vt){var pt;if(mr&&X.raise("context lost"),typeof Zt=="function")return Re.call(this,null,Zt,0);if(typeof vt=="function")if(typeof Zt=="number")for(pt=0;pt<Zt;++pt)Re.call(this,null,vt,pt);else if(Array.isArray(Zt))for(pt=0;pt<Zt.length;++pt)Re.call(this,Zt[pt],vt,pt);else return Re.call(this,Zt,vt,0);else if(typeof Zt=="number"){if(Zt>0)return Fi.call(this,ht(Zt|0),Zt|0)}else if(Array.isArray(Zt)){if(Zt.length)return Fi.call(this,Zt,Zt.length)}else return Pn.call(this,Zt)}return y(zt,{stats:lr,destroy:function(){Qt.destroy()}})}var qa=Yr.setFBO=To({framebuffer:mt.define.call(null,nh,"framebuffer")});function cs(ui,Li){var ta=0;jn.procs.poll();var xs=Li.color;xs&&(Ue.clearColor(+xs[0]||0,+xs[1]||0,+xs[2]||0,+xs[3]||0),ta|=Ch),"depth"in Li&&(Ue.clearDepth(+Li.depth),ta|=qh),"stencil"in Li&&(Ue.clearStencil(Li.stencil|0),ta|=Ph),X(!!ta,"called regl.clear with no buffer specified"),Ue.clear(ta)}function qo(ui){if(X(typeof ui=="object"&&ui,"regl.clear() takes an object as input"),"framebuffer"in ui)if(ui.framebuffer&&ui.framebuffer_reglType==="framebufferCube")for(var Li=0;Li<6;++Li)qa(y({framebuffer:ui.framebuffer.faces[Li]},ui),cs);else qa(ui,cs);else cs(null,ui)}function Os(ui){X.type(ui,"function","regl.frame() callback must be a function"),Dr.push(ui);function Li(){var ta=cc(Dr,ui);X(ta>=0,"cannot cancel a frame twice");function xs(){var Ys=cc(Dr,xs);Dr[Ys]=Dr[Dr.length-1],Dr.length-=1,Dr.length<=0&&na()}Dr[ta]=xs}return ji(),{cancel:Li}}function es(){var ui=un.viewport,Li=un.scissor_box;ui[0]=ui[1]=Li[0]=Li[1]=0,on.viewportWidth=on.framebufferWidth=on.drawingBufferWidth=ui[2]=Li[2]=Ue.drawingBufferWidth,on.viewportHeight=on.framebufferHeight=on.drawingBufferHeight=ui[3]=Li[3]=Ue.drawingBufferHeight}function Xs(){on.tick+=1,on.time=ki(),es(),jn.procs.poll()}function Zo(){Br.refresh(),es(),jn.procs.refresh(),zr&&zr.update()}function ki(){return(ar()-Jr)/1e3}Zo();function Ks(ui,Li){X.type(Li,"function","listener callback must be a function");var ta;switch(ui){case"frame":return Os(Li);case"lost":ta=ni;break;case"restore":ta=ii;break;case"destroy":ta=Rn;break;default:X.raise("invalid event, must be one of frame,lost,restore,destroy")}return ta.push(Li),{cancel:function(){for(var Ys=0;Ys<ta.length;++Ys)if(ta[Ys]===Li){ta[Ys]=ta[ta.length-1],ta.pop();return}}}}var wa=y(To,{clear:qo,prop:mt.define.bind(null,nh),context:mt.define.bind(null,np),this:mt.define.bind(null,ip),draw:To({}),buffer:function(Li){return Gr.create(Li,ep,!1,!1)},elements:function(Li){return Yn.create(Li,!1)},texture:Br.create2D,cube:Br.createCube,renderbuffer:Fr.create,framebuffer:Yr.create,framebufferCube:Yr.createCube,vao:En.createVAO,attributes:Jt,frame:Os,on:Ks,limits:er,hasExtension:function(Li){return er.extensions.indexOf(Li.toLowerCase())>=0},read:$n,destroy:ea,_gl:Ue,_refresh:Zo,poll:function(){Xs(),zr&&zr.update()},now:ki,stats:Zr});return fe.onDone(null,wa),wa}return ap})},92249:function(_t){(function(O,y){_t.exports=y()})(this,function(){"use strict";function O(St,Ze,yt,Me,Te,Ie){if(!(Te-Me<=yt)){var bt=Me+Te>>1;y(St,Ze,bt,Me,Te,Ie%2),O(St,Ze,yt,Me,bt-1,Ie+1),O(St,Ze,yt,bt+1,Te,Ie+1)}}function y(St,Ze,yt,Me,Te,Ie){for(;Te>Me;){if(Te-Me>600){var bt=Te-Me+1,tr=yt-Me+1,ae=Math.log(bt),Ee=.5*Math.exp(2*ae/3),le=.5*Math.sqrt(ae*Ee*(bt-Ee)/bt)*(tr-bt/2<0?-1:1),Q=Math.max(Me,Math.floor(yt-tr*Ee/bt+le)),re=Math.min(Te,Math.floor(yt+(bt-tr)*Ee/bt+le));y(St,Ze,yt,Q,re,Ie)}var ke=Ze[2*yt+Ie],qe=Me,Wt=Te;for(V(St,Ze,Me,yt),Ze[2*Te+Ie]>ke&&V(St,Ze,Me,Te);qe<Wt;){for(V(St,Ze,qe,Wt),qe++,Wt--;Ze[2*qe+Ie]<ke;)qe++;for(;Ze[2*Wt+Ie]>ke;)Wt--}Ze[2*Me+Ie]===ke?V(St,Ze,Me,Wt):(Wt++,V(St,Ze,Wt,Te)),Wt<=yt&&(Me=Wt+1),yt<=Wt&&(Te=Wt-1)}}function V(St,Ze,yt,Me){b(St,yt,Me),b(Ze,2*yt,2*Me),b(Ze,2*yt+1,2*Me+1)}function b(St,Ze,yt){var Me=St[Ze];St[Ze]=St[yt],St[yt]=Me}function p(St,Ze,yt,Me,Te,Ie,bt){for(var tr=[0,St.length-1,0],ae=[],Ee,le;tr.length;){var Q=tr.pop(),re=tr.pop(),ke=tr.pop();if(re-ke<=bt){for(var qe=ke;qe<=re;qe++)Ee=Ze[2*qe],le=Ze[2*qe+1],Ee>=yt&&Ee<=Te&&le>=Me&&le<=Ie&&ae.push(St[qe]);continue}var Wt=Math.floor((ke+re)/2);Ee=Ze[2*Wt],le=Ze[2*Wt+1],Ee>=yt&&Ee<=Te&&le>=Me&&le<=Ie&&ae.push(St[Wt]);var Or=(Q+1)%2;(Q===0?yt<=Ee:Me<=le)&&(tr.push(ke),tr.push(Wt-1),tr.push(Or)),(Q===0?Te>=Ee:Ie>=le)&&(tr.push(Wt+1),tr.push(re),tr.push(Or))}return ae}function G(St,Ze,yt,Me,Te,Ie){for(var bt=[0,St.length-1,0],tr=[],ae=Te*Te;bt.length;){var Ee=bt.pop(),le=bt.pop(),Q=bt.pop();if(le-Q<=Ie){for(var re=Q;re<=le;re++)S(Ze[2*re],Ze[2*re+1],yt,Me)<=ae&&tr.push(St[re]);continue}var ke=Math.floor((Q+le)/2),qe=Ze[2*ke],Wt=Ze[2*ke+1];S(qe,Wt,yt,Me)<=ae&&tr.push(St[ke]);var Or=(Ee+1)%2;(Ee===0?yt-Te<=qe:Me-Te<=Wt)&&(bt.push(Q),bt.push(ke-1),bt.push(Or)),(Ee===0?yt+Te>=qe:Me+Te>=Wt)&&(bt.push(ke+1),bt.push(le),bt.push(Or))}return tr}function S(St,Ze,yt,Me){var Te=St-yt,Ie=Ze-Me;return Te*Te+Ie*Ie}var F=function(Ze){return Ze[0]},te=function(Ze){return Ze[1]},ce=function(Ze,yt,Me,Te,Ie){yt===void 0&&(yt=F),Me===void 0&&(Me=te),Te===void 0&&(Te=64),Ie===void 0&&(Ie=Float64Array),this.nodeSize=Te,this.points=Ze;for(var bt=Ze.length<65536?Uint16Array:Uint32Array,tr=this.ids=new bt(Ze.length),ae=this.coords=new Ie(Ze.length*2),Ee=0;Ee<Ze.length;Ee++)tr[Ee]=Ee,ae[2*Ee]=yt(Ze[Ee]),ae[2*Ee+1]=Me(Ze[Ee]);O(tr,ae,Te,0,tr.length-1,0)};ce.prototype.range=function(Ze,yt,Me,Te){return p(this.ids,this.coords,Ze,yt,Me,Te,this.nodeSize)},ce.prototype.within=function(Ze,yt,Me){return G(this.ids,this.coords,Ze,yt,Me,this.nodeSize)};var q={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Ze){return Ze}},we=Math.fround||function(St){return function(Ze){return St[0]=+Ze,St[0]}}(new Float32Array(1)),Pe=function(Ze){this.options=cr(Object.create(q),Ze),this.trees=new Array(this.options.maxZoom+1)};Pe.prototype.load=function(Ze){var yt=this.options,Me=yt.log,Te=yt.minZoom,Ie=yt.maxZoom,bt=yt.nodeSize;Me&&console.time("total time");var tr="prepare "+Ze.length+" points";Me&&console.time(tr),this.points=Ze;for(var ae=[],Ee=0;Ee<Ze.length;Ee++)!Ze[Ee].geometry||ae.push(Oe(Ze[Ee],Ee));this.trees[Ie+1]=new ce(ae,At,Gt,bt,Float32Array),Me&&console.timeEnd(tr);for(var le=Ie;le>=Te;le--){var Q=+Date.now();ae=this._cluster(ae,le),this.trees[le]=new ce(ae,At,Gt,bt,Float32Array),Me&&console.log("z%d: %d clusters in %dms",le,ae.length,+Date.now()-Q)}return Me&&console.timeEnd("total time"),this},Pe.prototype.getClusters=function(Ze,yt){var Me=((Ze[0]+180)%360+360)%360-180,Te=Math.max(-90,Math.min(90,Ze[1])),Ie=Ze[2]===180?180:((Ze[2]+180)%360+360)%360-180,bt=Math.max(-90,Math.min(90,Ze[3]));if(Ze[2]-Ze[0]>=360)Me=-180,Ie=180;else if(Me>Ie){var tr=this.getClusters([Me,Te,180,bt],yt),ae=this.getClusters([-180,Te,Ie,bt],yt);return tr.concat(ae)}for(var Ee=this.trees[this._limitZoom(yt)],le=Ee.range(Bt(Me),Qe(bt),Bt(Ie),Qe(Te)),Q=[],re=0,ke=le;re<ke.length;re+=1){var qe=ke[re],Wt=Ee.points[qe];Q.push(Wt.numPoints?Nt(Wt):this.points[Wt.index])}return Q},Pe.prototype.getChildren=function(Ze){var yt=this._getOriginId(Ze),Me=this._getOriginZoom(Ze),Te="No cluster with the specified id.",Ie=this.trees[Me];if(!Ie)throw new Error(Te);var bt=Ie.points[yt];if(!bt)throw new Error(Te);for(var tr=this.options.radius/(this.options.extent*Math.pow(2,Me-1)),ae=Ie.within(bt.x,bt.y,tr),Ee=[],le=0,Q=ae;le<Q.length;le+=1){var re=Q[le],ke=Ie.points[re];ke.parentId===Ze&&Ee.push(ke.numPoints?Nt(ke):this.points[ke.index])}if(Ee.length===0)throw new Error(Te);return Ee},Pe.prototype.getLeaves=function(Ze,yt,Me){yt=yt||10,Me=Me||0;var Te=[];return this._appendLeaves(Te,Ze,yt,Me,0),Te},Pe.prototype.getTile=function(Ze,yt,Me){var Te=this.trees[this._limitZoom(Ze)],Ie=Math.pow(2,Ze),bt=this.options,tr=bt.extent,ae=bt.radius,Ee=ae/tr,le=(Me-Ee)/Ie,Q=(Me+1+Ee)/Ie,re={features:[]};return this._addTileFeatures(Te.range((yt-Ee)/Ie,le,(yt+1+Ee)/Ie,Q),Te.points,yt,Me,Ie,re),yt===0&&this._addTileFeatures(Te.range(1-Ee/Ie,le,1,Q),Te.points,Ie,Me,Ie,re),yt===Ie-1&&this._addTileFeatures(Te.range(0,le,Ee/Ie,Q),Te.points,-1,Me,Ie,re),re.features.length?re:null},Pe.prototype.getClusterExpansionZoom=function(Ze){for(var yt=this._getOriginZoom(Ze)-1;yt<=this.options.maxZoom;){var Me=this.getChildren(Ze);if(yt++,Me.length!==1)break;Ze=Me[0].properties.cluster_id}return yt},Pe.prototype._appendLeaves=function(Ze,yt,Me,Te,Ie){for(var bt=this.getChildren(yt),tr=0,ae=bt;tr<ae.length;tr+=1){var Ee=ae[tr],le=Ee.properties;if(le&&le.cluster?Ie+le.point_count<=Te?Ie+=le.point_count:Ie=this._appendLeaves(Ze,le.cluster_id,Me,Te,Ie):Ie<Te?Ie++:Ze.push(Ee),Ze.length===Me)break}return Ie},Pe.prototype._addTileFeatures=function(Ze,yt,Me,Te,Ie,bt){for(var tr=0,ae=Ze;tr<ae.length;tr+=1){var Ee=ae[tr],le=yt[Ee],Q=le.numPoints,re=void 0,ke=void 0,qe=void 0;if(Q)re=Xt(le),ke=le.x,qe=le.y;else{var Wt=this.points[le.index];re=Wt.properties,ke=Bt(Wt.geometry.coordinates[0]),qe=Qe(Wt.geometry.coordinates[1])}var Or={type:1,geometry:[[Math.round(this.options.extent*(ke*Ie-Me)),Math.round(this.options.extent*(qe*Ie-Te))]],tags:re},wr=void 0;Q?wr=le.id:this.options.generateId?wr=le.index:this.points[le.index].id&&(wr=this.points[le.index].id),wr!==void 0&&(Or.id=wr),bt.features.push(Or)}},Pe.prototype._limitZoom=function(Ze){return Math.max(this.options.minZoom,Math.min(+Ze,this.options.maxZoom+1))},Pe.prototype._cluster=function(Ze,yt){for(var Me=[],Te=this.options,Ie=Te.radius,bt=Te.extent,tr=Te.reduce,ae=Te.minPoints,Ee=Ie/(bt*Math.pow(2,yt)),le=0;le<Ze.length;le++){var Q=Ze[le];if(!(Q.zoom<=yt)){Q.zoom=yt;for(var re=this.trees[yt+1],ke=re.within(Q.x,Q.y,Ee),qe=Q.numPoints||1,Wt=qe,Or=0,wr=ke;Or<wr.length;Or+=1){var Nr=wr[Or],Vt=re.points[Nr];Vt.zoom>yt&&(Wt+=Vt.numPoints||1)}if(Wt>=ae){for(var se=Q.x*qe,_e=Q.y*qe,Le=tr&&qe>1?this._map(Q,!0):null,ot=(le<<5)+(yt+1)+this.points.length,Rt=0,jt=ke;Rt<jt.length;Rt+=1){var w=jt[Rt],N=re.points[w];if(!(N.zoom<=yt)){N.zoom=yt;var ve=N.numPoints||1;se+=N.x*ve,_e+=N.y*ve,N.parentId=ot,tr&&(Le||(Le=this._map(Q,!0)),tr(Le,this._map(N)))}}Q.parentId=ot,Me.push(Be(se/Wt,_e/Wt,ot,Wt,Le))}else if(Me.push(Q),Wt>1)for(var Ae=0,Je=ke;Ae<Je.length;Ae+=1){var st=Je[Ae],Lt=re.points[st];Lt.zoom<=yt||(Lt.zoom=yt,Me.push(Lt))}}}return Me},Pe.prototype._getOriginId=function(Ze){return Ze-this.points.length>>5},Pe.prototype._getOriginZoom=function(Ze){return(Ze-this.points.length)%32},Pe.prototype._map=function(Ze,yt){if(Ze.numPoints)return yt?cr({},Ze.properties):Ze.properties;var Me=this.points[Ze.index].properties,Te=this.options.map(Me);return yt&&Te===Me?cr({},Te):Te};function Be(St,Ze,yt,Me,Te){return{x:we(St),y:we(Ze),zoom:Infinity,id:yt,parentId:-1,numPoints:Me,properties:Te}}function Oe(St,Ze){var yt=St.geometry.coordinates,Me=yt[0],Te=yt[1];return{x:we(Bt(Me)),y:we(Qe(Te)),zoom:Infinity,index:Ze,parentId:-1}}function Nt(St){return{type:"Feature",id:St.id,properties:Xt(St),geometry:{type:"Point",coordinates:[xt(St.x),nt(St.y)]}}}function Xt(St){var Ze=St.numPoints,yt=Ze>=1e4?Math.round(Ze/1e3)+"k":Ze>=1e3?Math.round(Ze/100)/10+"k":Ze;return cr(cr({},St.properties),{cluster:!0,cluster_id:St.id,point_count:Ze,point_count_abbreviated:yt})}function Bt(St){return St/360+.5}function Qe(St){var Ze=Math.sin(St*Math.PI/180),yt=.5-.25*Math.log((1+Ze)/(1-Ze))/Math.PI;return yt<0?0:yt>1?1:yt}function xt(St){return(St-.5)*360}function nt(St){var Ze=(180-St*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ze))/Math.PI-90}function cr(St,Ze){for(var yt in Ze)St[yt]=Ze[yt];return St}function At(St){return St.x}function Gt(St){return St.y}return Pe})},78798:function(_t){_t.exports.RADIUS=6378137,_t.exports.FLATTENING=1/298.257223563,_t.exports.POLAR_RADIUS=63567523142e-4},77412:function(_t){function O(y,V){for(var b=-1,p=y==null?0:y.length;++b<p&&V(y[b],b,y)!==!1;);return y}_t.exports=O},47443:function(_t,O,y){var V=y(42118);function b(p,G){var S=p==null?0:p.length;return!!S&&V(p,G,0)>-1}_t.exports=b},1196:function(_t){function O(y,V,b){for(var p=-1,G=y==null?0:y.length;++p<G;)if(b(V,y[p]))return!0;return!1}_t.exports=O},62663:function(_t){function O(y,V,b,p){var G=-1,S=y==null?0:y.length;for(p&&S&&(b=y[++G]);++G<S;)b=V(b,y[G],G,y);return b}_t.exports=O},49029:function(_t){var O=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function y(V){return V.match(O)||[]}_t.exports=y},44037:function(_t,O,y){var V=y(98363),b=y(3674);function p(G,S){return G&&V(S,b(S),G)}_t.exports=p},63886:function(_t,O,y){var V=y(98363),b=y(81704);function p(G,S){return G&&V(S,b(S),G)}_t.exports=p},89465:function(_t,O,y){var V=y(38777);function b(p,G,S){G=="__proto__"&&V?V(p,G,{configurable:!0,enumerable:!0,value:S,writable:!0}):p[G]=S}_t.exports=b},29750:function(_t){function O(y,V,b){return y===y&&(b!==void 0&&(y=y<=b?y:b),V!==void 0&&(y=y>=V?y:V)),y}_t.exports=O},85990:function(_t,O,y){var V=y(46384),b=y(77412),p=y(34865),G=y(44037),S=y(63886),F=y(64626),te=y(278),ce=y(18805),q=y(1911),we=y(58234),Pe=y(46904),Be=y(64160),Oe=y(43824),Nt=y(29148),Xt=y(38517),Bt=y(1469),Qe=y(44144),xt=y(56688),nt=y(13218),cr=y(72928),At=y(3674),Gt=y(81704),St=1,Ze=2,yt=4,Me="[object Arguments]",Te="[object Array]",Ie="[object Boolean]",bt="[object Date]",tr="[object Error]",ae="[object Function]",Ee="[object GeneratorFunction]",le="[object Map]",Q="[object Number]",re="[object Object]",ke="[object RegExp]",qe="[object Set]",Wt="[object String]",Or="[object Symbol]",wr="[object WeakMap]",Nr="[object ArrayBuffer]",Vt="[object DataView]",se="[object Float32Array]",_e="[object Float64Array]",Le="[object Int8Array]",ot="[object Int16Array]",Rt="[object Int32Array]",jt="[object Uint8Array]",w="[object Uint8ClampedArray]",N="[object Uint16Array]",ve="[object Uint32Array]",Ae={};Ae[Me]=Ae[Te]=Ae[Nr]=Ae[Vt]=Ae[Ie]=Ae[bt]=Ae[se]=Ae[_e]=Ae[Le]=Ae[ot]=Ae[Rt]=Ae[le]=Ae[Q]=Ae[re]=Ae[ke]=Ae[qe]=Ae[Wt]=Ae[Or]=Ae[jt]=Ae[w]=Ae[N]=Ae[ve]=!0,Ae[tr]=Ae[ae]=Ae[wr]=!1;function Je(st,Lt,X,Tt,Kt,hr){var _r,Ar=Lt&St,Rr=Lt&Ze,et=Lt&yt;if(X&&(_r=Kt?X(st,Tt,Kt,hr):X(st)),_r!==void 0)return _r;if(!nt(st))return st;var gt=Bt(st);if(gt){if(_r=Oe(st),!Ar)return te(st,_r)}else{var dt=Be(st),fr=dt==ae||dt==Ee;if(Qe(st))return F(st,Ar);if(dt==re||dt==Me||fr&&!Kt){if(_r=Rr||fr?{}:Xt(st),!Ar)return Rr?q(st,S(_r,st)):ce(st,G(_r,st))}else{if(!Ae[dt])return Kt?st:{};_r=Nt(st,dt,Ar)}}hr||(hr=new V);var $r=hr.get(st);if($r)return $r;hr.set(st,_r),cr(st)?st.forEach(function(ar){_r.add(Je(ar,Lt,X,ar,st,hr))}):xt(st)&&st.forEach(function(ar,sr){_r.set(sr,Je(ar,Lt,X,sr,st,hr))});var mt=et?Rr?Pe:we:Rr?Gt:At,Dt=gt?void 0:mt(st);return b(Dt||st,function(ar,sr){Dt&&(sr=ar,ar=st[sr]),p(_r,sr,Je(ar,Lt,X,sr,st,hr))}),_r}_t.exports=Je},41848:function(_t){function O(y,V,b,p){for(var G=y.length,S=b+(p?1:-1);p?S--:++S<G;)if(V(y[S],S,y))return S;return-1}_t.exports=O},28483:function(_t,O,y){var V=y(25063),b=V();_t.exports=b},42118:function(_t,O,y){var V=y(41848),b=y(62722),p=y(42351);function G(S,F,te){return F===F?p(S,F,te):V(S,b,te)}_t.exports=G},25588:function(_t,O,y){var V=y(64160),b=y(37005),p="[object Map]";function G(S){return b(S)&&V(S)==p}_t.exports=G},62722:function(_t){function O(y){return y!==y}_t.exports=O},29221:function(_t,O,y){var V=y(64160),b=y(37005),p="[object Set]";function G(S){return b(S)&&V(S)==p}_t.exports=G},18674:function(_t){function O(y){return function(V){return y==null?void 0:y[V]}}_t.exports=O},45652:function(_t,O,y){var V=y(88668),b=y(47443),p=y(1196),G=y(74757),S=y(23593),F=y(21814),te=200;function ce(q,we,Pe){var Be=-1,Oe=b,Nt=q.length,Xt=!0,Bt=[],Qe=Bt;if(Pe)Xt=!1,Oe=p;else if(Nt>=te){var xt=we?null:S(q);if(xt)return F(xt);Xt=!1,Oe=G,Qe=new V}else Qe=we?[]:Bt;e:for(;++Be<Nt;){var nt=q[Be],cr=we?we(nt):nt;if(nt=Pe||nt!==0?nt:0,Xt&&cr===cr){for(var At=Qe.length;At--;)if(Qe[At]===cr)continue e;we&&Qe.push(cr),Bt.push(nt)}else Oe(Qe,cr,Pe)||(Qe!==Bt&&Qe.push(cr),Bt.push(nt))}return Bt}_t.exports=ce},57157:function(_t,O,y){var V=y(74318);function b(p,G){var S=G?V(p.buffer):p.buffer;return new p.constructor(S,p.byteOffset,p.byteLength)}_t.exports=b},93147:function(_t){var O=/\w*$/;function y(V){var b=new V.constructor(V.source,O.exec(V));return b.lastIndex=V.lastIndex,b}_t.exports=y},40419:function(_t,O,y){var V=y(62705),b=V?V.prototype:void 0,p=b?b.valueOf:void 0;function G(S){return p?Object(p.call(S)):{}}_t.exports=G},18805:function(_t,O,y){var V=y(98363),b=y(99551);function p(G,S){return V(G,b(G),S)}_t.exports=p},1911:function(_t,O,y){var V=y(98363),b=y(51442);function p(G,S){return V(G,b(G),S)}_t.exports=p},25063:function(_t){function O(y){return function(V,b,p){for(var G=-1,S=Object(V),F=p(V),te=F.length;te--;){var ce=F[y?te:++G];if(b(S[ce],ce,S)===!1)break}return V}}_t.exports=O},35393:function(_t,O,y){var V=y(62663),b=y(53816),p=y(58748),G="['\u2019]",S=RegExp(G,"g");function F(te){return function(ce){return V(p(b(ce).replace(S,"")),te,"")}}_t.exports=F},23593:function(_t,O,y){var V=y(58525),b=y(50308),p=y(21814),G=1/0,S=V&&1/p(new V([,-0]))[1]==G?function(F){return new V(F)}:b;_t.exports=S},69389:function(_t,O,y){var V=y(18674),b={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=V(b);_t.exports=p},38777:function(_t,O,y){var V=y(10852),b=function(){try{var p=V(Object,"defineProperty");return p({},"",{}),p}catch(G){}}();_t.exports=b},46904:function(_t,O,y){var V=y(68866),b=y(51442),p=y(81704);function G(S){return V(S,p,b)}_t.exports=G},51442:function(_t,O,y){var V=y(62488),b=y(85924),p=y(99551),G=y(70479),S=Object.getOwnPropertySymbols,F=S?function(te){for(var ce=[];te;)V(ce,p(te)),te=b(te);return ce}:G;_t.exports=F},93157:function(_t){var O=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function y(V){return O.test(V)}_t.exports=y},43824:function(_t){var O=Object.prototype,y=O.hasOwnProperty;function V(b){var p=b.length,G=new b.constructor(p);return p&&typeof b[0]=="string"&&y.call(b,"index")&&(G.index=b.index,G.input=b.input),G}_t.exports=V},29148:function(_t,O,y){var V=y(74318),b=y(57157),p=y(93147),G=y(40419),S=y(77133),F="[object Boolean]",te="[object Date]",ce="[object Map]",q="[object Number]",we="[object RegExp]",Pe="[object Set]",Be="[object String]",Oe="[object Symbol]",Nt="[object ArrayBuffer]",Xt="[object DataView]",Bt="[object Float32Array]",Qe="[object Float64Array]",xt="[object Int8Array]",nt="[object Int16Array]",cr="[object Int32Array]",At="[object Uint8Array]",Gt="[object Uint8ClampedArray]",St="[object Uint16Array]",Ze="[object Uint32Array]";function yt(Me,Te,Ie){var bt=Me.constructor;switch(Te){case Nt:return V(Me);case F:case te:return new bt(+Me);case Xt:return b(Me,Ie);case Bt:case Qe:case xt:case nt:case cr:case At:case Gt:case St:case Ze:return S(Me,Ie);case ce:return new bt;case q:case Be:return new bt(Me);case we:return p(Me);case Pe:return new bt;case Oe:return G(Me)}}_t.exports=yt},42351:function(_t){function O(y,V,b){for(var p=b-1,G=y.length;++p<G;)if(y[p]===V)return p;return-1}_t.exports=O},2757:function(_t){var O="\\ud800-\\udfff",y="\\u0300-\\u036f",V="\\ufe20-\\ufe2f",b="\\u20d0-\\u20ff",p=y+V+b,G="\\u2700-\\u27bf",S="a-z\\xdf-\\xf6\\xf8-\\xff",F="\\xac\\xb1\\xd7\\xf7",te="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ce="\\u2000-\\u206f",q=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",we="A-Z\\xc0-\\xd6\\xd8-\\xde",Pe="\\ufe0e\\ufe0f",Be=F+te+ce+q,Oe="['\u2019]",Nt="["+Be+"]",Xt="["+p+"]",Bt="\\d+",Qe="["+G+"]",xt="["+S+"]",nt="[^"+O+Be+Bt+G+S+we+"]",cr="\\ud83c[\\udffb-\\udfff]",At="(?:"+Xt+"|"+cr+")",Gt="[^"+O+"]",St="(?:\\ud83c[\\udde6-\\uddff]){2}",Ze="[\\ud800-\\udbff][\\udc00-\\udfff]",yt="["+we+"]",Me="\\u200d",Te="(?:"+xt+"|"+nt+")",Ie="(?:"+yt+"|"+nt+")",bt="(?:"+Oe+"(?:d|ll|m|re|s|t|ve))?",tr="(?:"+Oe+"(?:D|LL|M|RE|S|T|VE))?",ae=At+"?",Ee="["+Pe+"]?",le="(?:"+Me+"(?:"+[Gt,St,Ze].join("|")+")"+Ee+ae+")*",Q="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",re="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ke=Ee+ae+le,qe="(?:"+[Qe,St,Ze].join("|")+")"+ke,Wt=RegExp([yt+"?"+xt+"+"+bt+"(?="+[Nt,yt,"$"].join("|")+")",Ie+"+"+tr+"(?="+[Nt,yt+Te,"$"].join("|")+")",yt+"?"+Te+"+"+bt,yt+"+"+tr,re,Q,Bt,qe].join("|"),"g");function Or(wr){return wr.match(Wt)||[]}_t.exports=Or},68929:function(_t,O,y){var V=y(48403),b=y(35393),p=b(function(G,S,F){return S=S.toLowerCase(),G+(F?V(S):S)});_t.exports=p},48403:function(_t,O,y){var V=y(79833),b=y(11700);function p(G){return b(V(G).toLowerCase())}_t.exports=p},74691:function(_t,O,y){var V=y(29750),b=y(14841);function p(G,S,F){return F===void 0&&(F=S,S=void 0),F!==void 0&&(F=b(F),F=F===F?F:0),S!==void 0&&(S=b(S),S=S===S?S:0),V(b(G),S,F)}_t.exports=p},50361:function(_t,O,y){var V=y(85990),b=1,p=4;function G(S){return V(S,b|p)}_t.exports=G},53816:function(_t,O,y){var V=y(69389),b=y(79833),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,G="\\u0300-\\u036f",S="\\ufe20-\\ufe2f",F="\\u20d0-\\u20ff",te=G+S+F,ce="["+te+"]",q=RegExp(ce,"g");function we(Pe){return Pe=b(Pe),Pe&&Pe.replace(p,V).replace(q,"")}_t.exports=we},6557:function(_t){function O(y){return y}_t.exports=O},56688:function(_t,O,y){var V=y(25588),b=y(7518),p=y(31167),G=p&&p.isMap,S=G?b(G):V;_t.exports=S},14293:function(_t){function O(y){return y==null}_t.exports=O},81763:function(_t,O,y){var V=y(44239),b=y(37005),p="[object Number]";function G(S){return typeof S=="number"||b(S)&&V(S)==p}_t.exports=G},72928:function(_t,O,y){var V=y(29221),b=y(7518),p=y(31167),G=p&&p.isSet,S=G?b(G):V;_t.exports=S},47037:function(_t,O,y){var V=y(44239),b=y(1469),p=y(37005),G="[object String]";function S(F){return typeof F=="string"||!b(F)&&p(F)&&V(F)==G}_t.exports=S},30236:function(_t,O,y){var V=y(42980),b=y(21463),p=b(function(G,S,F,te){V(G,S,F,te)});_t.exports=p},50308:function(_t){function O(){}_t.exports=O},44908:function(_t,O,y){var V=y(45652);function b(p){return p&&p.length?V(p):[]}_t.exports=b},58748:function(_t,O,y){var V=y(49029),b=y(93157),p=y(79833),G=y(2757);function S(F,te,ce){return F=p(F),te=ce?void 0:te,te===void 0?b(F)?G(F):V(F):F.match(te)||[]}_t.exports=S}}]);
